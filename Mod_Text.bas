Attribute VB_Name = "Module1"
Option Explicit
Dim ObjectCatalog As FastCollection
Public rndbase As rndvars
Private simplestack1 As rndvars
Private Declare Function ShowCursor Lib "user32" (ByVal bShow As Long) As Long
Private Declare Sub GetMem1 Lib "msvbvm60" (ByVal addr As Long, retval As Byte)
Private Declare Sub GetMem2 Lib "msvbvm60" (ByVal addr As Long, retval As Integer)
Private Declare Sub GetMem4 Lib "msvbvm60" (ByVal addr As Long, retval As Long)
Private Declare Sub GetMem8 Lib "msvbvm60" (ByVal addr As Long, retval As Double)
Private Declare Sub PutMem1 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Byte)
Private Declare Sub PutMem2 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Integer)
Private Declare Sub PutMem4 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Long)
Private Declare Sub PutMem8 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Double)
Private Declare Function CopyBytes Lib "msvbvm60.dll" Alias "__vbaCopyBytes" (ByVal ByteLen As Long, ByVal Destination As Long, ByVal Source As Long) As Long
Private Declare Function ObjSetAddRef Lib "msvbvm60.dll" Alias "__vbaObjSetAddref" (ByRef objDest As Object, ByVal pObject As Long) As Long
Private Declare Function IsBadCodePtr Lib "KERNEL32" (ByVal lpfn As Long) As Long
Private Declare Function CallWindowProc _
 Lib "user32.dll" Alias "CallWindowProcW" ( _
 ByVal lpPrevWndFunc As Long, _
 ByVal hWnd As Long, _
 ByVal Msg As Long, _
 ByVal wParam As Long, _
 ByVal lParam As Long) As Long
Public ModalId As Double
Public Okk As Boolean
Private Declare Sub DisableProcessWindowsGhosting Lib "user32" ()
Public Interrupted As Boolean
Dim NoOptimum As Boolean
Dim zero As basket
 Public Type GenItem
 Key As String
 NDX As String
 firsthash As Long
 lastpos As Long
 Pleft As Long  ' a list
 End Type
Public Declare Function SelectClipRgn Lib "gdi32" (ByVal hDC As Long, ByVal hRgn As Long) As Long
Public UseEsc As Boolean
' 1 to 32 for layers
' 0 for DIS
Public NowDec$, NowThou$
Public priorityOr As Boolean, NoUseDec As Boolean, mNoUseDec As Boolean
Public csvsep$, csvDec$
Public Const DisForm = 0
Public Const BackForm = -1
Public Const PrinterPage = -2
Public players(-2 To 132) As basket  ' tag number not actual number of dsprite()
Private Declare Function GdiFlush Lib "gdi32" () As Long
Public m_bInIDE As Boolean
Public UKEY$
Public TestShowCode As Boolean, TestShowSub As String, TestShowStart As Long
Public feedback$, FeedbackExec$, feednow$ ' for about$
Global Const VerMajor = 8
Global Const VerMinor = 2
Global Const Revision = 3
Private Const doc = "Document"
Public UserCodePage As Long
Public cLine As String  ' it was public in form1
Public casesensitive As Boolean  ' for files
Public userfiles As String
Public TweakLang As Long
Public notweak As Boolean
Public extreme As Boolean
Public taskmainonly As Boolean
Public TaskMain As Boolean
Global Const gintMAX_SIZE& = 255                        'Maximum buffer size
Global Const gstrSEP_DIR$ = "\"
Global DIALOGSHOW As Boolean
' Directory separator character
Public HelpStack As New basetask ' from 6.5.1
Public Const gstrSEP_URLDIR$ = "/"
Public REFRESHRATE As Double
Public RRCOUNTER As Double
Public BLOCKkey As Boolean
Public Const novalidstr = "+-/*!?_()[]&$#@;" & """"

Public tempList2delete As String
Public nnn$, basickey$, homepage$
Private Const LOCALE_SENGLANGUAGE& = 4097
Private Const LOCALE_SLANGUAGE& = &H2 '  localized name of language
Public shortlang As Boolean
Public LEVCOLMENU As Long
 Declare Function ExpandEnvironmentStrings _
   Lib "KERNEL32" Alias "ExpandEnvironmentStringsW" _
   (ByVal lpSrc As Long, ByVal lpDst As Long, _
   ByVal nsize As Long) As Long
Private Declare Function GetTempFileNameW Lib "KERNEL32" _
    (ByVal lpszPath As Long, ByVal lpPrefixString As Long, _
     ByVal wUnique As Long, ByVal lpTempFileName As Long) _
     As Long
     
Private Const UNIQUE_NAME = &H0
Public taskid As Long, kill2$, para$
Private Declare Function timeGetTime Lib "winmm.dll" () As Long
Public sRec As Object
Public defFontname As String
Private pnum As Long
Public my_system As Enum_OperatingPlatform
Public Declare Function Beeper Lib "KERNEL32" Alias "Beep" _
  (ByVal dwFreq As Long, ByVal dwDuration As Long) As Long
Private oprinter As New cDIBSection
Const MAX_FILENAME_LEN As Long = 260 * 2 - 1
Public beeperBEAT As Long
Public funcdeep As Double
Private deep As Double
Private mys As String
Private Declare Function WinExec Lib "KERNEL32" (ByVal lpCmdLine As String, ByVal nCmdShow As Long) As Long
Public needset As Boolean
Public cnt As Boolean
Public exWnd As Long

Public Declare Function GetForegroundWindow Lib "user32" () As Long
Public Declare Function FindExecutable Lib "shell32.dll" Alias "FindExecutableW" (ByVal lpFile As Long, ByVal lpDirectory As Long, ByVal lpResult As Long) As Long
Public expl As Long

Public l_complete As Boolean
Public s_complete As Boolean
Public ThereIsAPrinter As Boolean
Public MOUT As Boolean
Public DXP As Long
Public DYP As Long
Public SLOW As Boolean
Public pname As String
Public port As String
Global elevatestatus As Long
Global elevatestatus2 As Long
Public FKey As Long
Public FK$(1 To 13)
Public strTemp As String
Public STEXIT As Boolean
Public STbyST As Boolean
Public STq As Boolean
Public pagio$, pagiohtml$
Public subHash As New sbHash
Public varhash As New Hash
Public comhash As New sbHash, numid As New sbHash, funid As New sbHash
Public strid  As New sbHash, strfunid As New sbHash
Public cLid As Long 'current id for app id
Public GarbageCollector As New GarbageClass
''
Public basestack1 As New basetask ' this is the global stack
Public sb2used As Long
Public Type modfun
    sb As String
    sbc As Long
    sbgroup As String
End Type
Private sbf() As modfun
Public var2used As Long
Private var() As Variant

Public FLEN(512) As Long
Public Uni(512) As Boolean
Public globalstack As New mStiva

Public IERUN As Boolean
Public IEX As Long
Public IEY As Long
Public IESizeX As Long
Public IESizeY As Long
Public AVIRUN As Boolean
Public AVIUP As Boolean
Public aviX As Long
Public aviY As Long
Public UseAviXY As Boolean
Public UseAviSize As Boolean
Public AviSizeX As Long
Public AviSizeY As Long
Public mycoder As New coder
' play music
Public voices$(0 To 15), BEATS(0 To 15) As Double



Const GFSR_SYSTEMRESOURCES = 0
Const GFSR_GDIRESOURCES = 1
Const GFSR_USERRESOURCES = 2
Declare Function MessageBeep Lib "user32" (ByVal wType As Long) As Long


Declare Function SetLocaleInfo Lib "KERNEL32" Alias "SetLocaleInfoA" (ByVal Locale As Long, ByVal LCType As Long, ByVal lpLCData As String) As Long
Declare Function GetLocaleInfo Lib "KERNEL32" Alias "GetLocaleInfoA" (ByVal Locale As Long, ByVal LCType As Long, lpLCData As String, ByVal cchData As Long) As Long
Declare Function GetTempPath Lib "KERNEL32" Alias "GetTempPathW" (ByVal nBufferLength As Long, ByVal lpBuffer As Long) As Long
Public Declare Function GetWindowsDirectory Lib "KERNEL32" Alias "GetWindowsDirectoryA" (ByVal lpBuffer As String, ByVal nsize As Long) As Long


Private Const LOCALE_USER_DEFAULT = 0

Private Const LOCALE_SDECIMAL = &HE
Private Const LOCALE_SGROUPING = &H10
Private Const LOCALE_STHOUSAND = &HF
Private Const LOCALE_SMONDECIMALSEP = &H16
Private Const LOCALE_SMONTHOUSANDSEP = &H17
Private Const LOCALE_SMONGROUPING = &H18
Public trace As Boolean
Const CSIDL_DESKTOP = &H0
Const CSIDL_PROGRAMS = &H2
Const CSIDL_CONTROLS = &H3
Const CSIDL_PRINTERS = &H4
Const CSIDL_PERSONAL = &H5
Const CSIDL_FAVORITES = &H6
Const CSIDL_STARTUP = &H7
Const CSIDL_RECENT = &H8
Const CSIDL_SENDTO = &H9
Const CSIDL_BITBUCKET = &HA
Const CSIDL_STARTMENU = &HB
Const CSIDL_DESKTOPDIRECTORY = &H10
Const CSIDL_DRIVES = &H11
Const CSIDL_NETWORK = &H12
Const CSIDL_NETHOOD = &H13
Public Const CSIDL_FONTS = &H14

Const CSIDL_TEMPLATES = &H15
Const MAX_PATH = 260
Private Type SHITEMID
    cb As Long
    abID As Byte
End Type
Private Type ITEMIDLIST
    mkid As SHITEMID
End Type
Private Declare Function SHGetSpecialFolderLocation Lib "shell32.dll" (ByVal hWndOwner As Long, ByVal nFolder As Long, pidl As ITEMIDLIST) As Long
Private Declare Function SHGetPathFromIDList Lib "shell32.dll" Alias "SHGetPathFromIDListA" (ByVal pidl As Long, ByVal pszPath As String) As Long

Public Declare Sub Sleep Lib "KERNEL32" (ByVal dwMilliseconds As Long)

Public Declare Function SetTimer Lib "user32" _
       (ByVal hWnd As Long, ByVal nIDEvent As Long, _
        ByVal uElapse As Long, ByVal lpTimerFunc As Long) As Long

Public Declare Sub KillTimer Lib "user32" _
       (ByVal hWnd As Long, ByVal nIDEvent As Long)
'Public Type tagInitCommonControlsEx
 ' lngSize As Long
  ' lngICC As Long
'End Type
'Public Declare Function InitCommonControlsEx Lib "comctl32.dll" (iccex As tagInitCommonControlsEx) As Boolean
'Public Const ICC_USEREX_CLASSES = &H200
' APPLICATION TASK MASTER
Public MasterTimer As Double
Public TaskMaster As TaskMaster
Public Declare Function midiOutClose Lib "winmm.dll" (ByVal hMidiOut As Long) As Long
Public Declare Function midiOutOpen Lib "winmm.dll" (lphMidiOut As Long, ByVal uDeviceID As Long, ByVal dwCallback As Long, ByVal dwInstance As Long, ByVal dwFlags As Long) As Long
Public Declare Function midiOutShortMsg Lib "winmm.dll" (ByVal hMidiOut As Long, ByVal dwMsg As Long) As Long
Public hmidi As Long
Public mute As Boolean
Public beat As Long
Public baseNote As Long
Public prof As New clsProfiler
Public Declare Function GetACP Lib "KERNEL32" () As Long  ' 1253 in my computer

Public Declare Function GetLocaleInfoW Lib "KERNEL32" (ByVal Locale As Long, ByVal LCType As Long, ByVal lpLCData As Long, ByVal cchData As Long) As Long
Private Declare Function GetKeyboardLayout& Lib "user32" (ByVal dwLayout&) ' not NT?
Private Const DWL_ANYTHREAD& = 0
Const LOCALE_ILANGUAGE = 1
'Valid dwCmpFlags
Private Declare Function LCMapStringW Lib "kernel32.dll" (ByVal Locale As Long, ByVal dwMapFlags As Long, ByVal lpSrcStr As Long, ByVal cchSrc As Long, Optional ByVal lpDestStr As Long, Optional ByVal cchDest As Long) As Long
Private Declare Function SysReAllocStringLen Lib "OleAut32.dll" (ByVal pBSTR As Long, Optional ByVal pszStrPtr As Long, Optional ByVal Length As Long) As Long

Function ChangeValues(bstack As basetask, rest$) As Boolean
Dim aa As mHandler, bb As FastCollection, ah As String, p As Double, s$
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
Set bb = aa.objref
If bb.StructLen > 0 Then
MyEr "Structure members are ReadOnly", "Τα μέλη της δομής είναι μόνο για ανάγνωση"
Exit Function
End If
If bb.Done And FastSymbol(rest$, ":=", , 2) Then
        ' change one value
        ah = aheadstatus(rest$, False) + " "
        If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
            If Not IsExp(bstack, rest$, p) Then
                ChangeValues = False
                GoTo there
            End If
            ChangeValues = True
            If Not bstack.lastobj Is Nothing Then
                Set bb.ValueObj = bstack.lastobj
                Set bstack.lastobj = Nothing
            Else
                bb.Value = p
            End If
            
        ElseIf Left$(ah, 1) = "S" Then
            If Not IsStrExp(bstack, rest$, s$) Then
                ChangeValues = False
                GoTo there
            End If
            ChangeValues = True
            If Not bstack.lastobj Is Nothing Then
                Set bb.ValueObj = bstack.lastobj
                Set bstack.lastobj = Nothing
            Else
                bb.Value = s$
            End If
        Else
                MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                ChangeValues = False
        End If
        GoTo there

ElseIf MaybeIsSymbol(rest$, ",") Then
    Do While FastSymbol(rest$, ",")
        ChangeValues = True
        ah = aheadstatus(rest$, False) + " "
        If InStr(ah, "l") Then
                MyEr "Found logical expression", "Βρήκα λογική έκφραση"
                ChangeValues = False
        Else
                If Left$(ah, 1) = "N" Then
                    If Not IsExp(bstack, rest$, p) Then
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bb.Find(p) Then
                         MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    
                ElseIf Left$(ah, 1) = "S" Then
                    If Not IsStrExp(bstack, rest$, s$) Then
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bb.Find(s$) Then
                          MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                Else
                        MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                
                End If
                If FastSymbol(rest$, ":=", , 2) Then
                    ah = aheadstatus(rest$, False) + " "
                    If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                        If Not IsExp(bstack, rest$, p) Then
                            ChangeValues = False
                            GoTo there
                        End If
                        ChangeValues = True
                        If Not bstack.lastobj Is Nothing Then
                            Set bb.ValueObj = bstack.lastobj
                            Set bstack.lastobj = Nothing
                        Else
                            bb.Value = p
                        End If
                ElseIf Left$(ah, 1) = "S" Then
                        If Not IsStrExp(bstack, rest$, s$) Then
                            ChangeValues = False
                            GoTo there
                        End If
                        ChangeValues = True
                        If Not bstack.lastobj Is Nothing Then
                            Set bb.ValueObj = bstack.lastobj
                            Set bstack.lastobj = Nothing
                        Else
                            bb.Value = s$
                        End If
                Else
                        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                        ChangeValues = False
                End If
                End If
        End If
    Loop
ElseIf bb.Done Then
If Not bstack.soros.IsEmpty Then
With bstack.soros
Select Case .StackItemTypeObjectType(1)
Case ""
bb.Value = .StackItem(1)
.drop 1
Case Else
Set bb.ValueObj = .PopObj
End Select
End With
ChangeValues = True
Else

End If
Set bstack.lastobj = Nothing
End If


there:
Set bb = Nothing
Set aa = Nothing
End Function


Function ChangeValuesMem(bstack As basetask, rest$, lang As Long) As Boolean
Dim aa As mHandler, ah As String, p As Double, s$, addr As Long, PP As Double, what$, r As Double
Dim bb1 As MemBlock
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
Set bb1 = aa.objref

    Do While FastSymbol(rest$, ",")
        ChangeValuesMem = True
        PP = bb1.ItemSize
        ah = aheadstatus(rest$, False) + " "
        If InStr(ah, "l") Then
                MyEr "Found logical expression", "Βρήκα λογική έκφραση"
                ChangeValuesMem = False
        Else
                If Left$(ah, 1) = "N" Then
                    If Not IsExp(bstack, rest$, p) Then
                        ChangeValuesMem = False
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                         MyEr "Οffset Null for buffer", "Διεύθυνση 0 για Διάρθρωση"
                        ChangeValuesMem = False
                        GoTo there
                    End If
                    If FastSymbol(rest$, "!") Then
                    
                    If IsLabelOnly(rest$, what$) Then
                        If bb1.UseStruct Then
                                If bb1.structref.Find(myUcase(what$, True)) Then
                                    PP = bb1.structref.sValue
                                    If FastSymbol(rest$, "!") Then
                                        If Not IsExp(bstack, rest$, r) Then
                                                 GoTo there
                                        ElseIf r >= 0 Then
                                                 p = bb1.GetPtr(p) + bb1.structref.Value + Int(r) * PP
                                        Else
                                                 MyEr "negative index", "αρνητικός δείκτη"
                                                GoTo there
                                        End If
                                    Else
                                    p = bb1.GetPtr(p) + bb1.structref.Value
                                    End If
                                    
                                Else
                                rest$ = what$ + rest$
                                If IsExp(bstack, rest$, r) Then
                                        p = bb1.GetPtr(p) + r
                                        
                                    Else
                                    MyErMacro rest$, "Unknown Offset " & what$, "’γνωστη Μετάθεση " & what$
                                    GoTo there
                                End If
                           End If
                        Else
                                If IsExp(bstack, what$, r) Then
                                    p = bb1.GetPtr(p) + r
                                Else
                                    GoTo there
                                End If
                        End If
                        Else
                        p = bb1.GetBytePtr(p)
                        End If
                        
          
                    Else
                        p = bb1.GetPtr(p)
           
                    End If
                    If p = 0 Then
                        MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                        ChangeValuesMem = False
                        GoTo there
                    End If
                    addr = CLng(p)
                
                    
                Else

                        MyEr "No Offset found", "Δεν βρέθηκε Διεύθυνση"
                        ChangeValuesMem = False
                        GoTo there
                
                End If
                If FastSymbol(rest$, ":=", , 2) Then
                    ah = aheadstatus(rest$, False) + " "
                    If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                        If Not IsExp(bstack, rest$, p) Then
                            ChangeValuesMem = False
                            GoTo there
                        End If
                        ChangeValuesMem = True
                        If Not bstack.lastobj Is Nothing Then
                            MyEr "No objects for buffer", "Όχι αντικείμενα για Διάρθρωση"
                            GoTo there
                  
                        Else
                                If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                                    ChangeValuesMem = False
                                    GoTo there
                                Else
                                ' this ia a part to poke some data to buffer
                                 If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                                    ChangeValuesMem = False
                                    GoTo there
                                Else
                            ' here is the part where we copy a string to memblock
                            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang, , , , False) Then
                                If IsLabelSymbolNew(rest$, "ΨΗΦΙΟ", "BYTE", lang, , , , False) Then
                                    PP = 1
                                ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", lang, , , , False) Then
                                    PP = 2
                                ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", lang, , , , False) Then
                                    PP = 4
                                ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", lang, , , , False) Then
                                    PP = 8
                                Else
                                    SyntaxError
                 
                                   GoTo there
                                End If
                                                          
                            End If
                            Err.Clear
                            On Error Resume Next
                           Select Case PP
                           Case 1
                           PutMem1 addr, CByte(LowWord(signlong(p)) And &HFF)
                           Case 2
                           If bb1.ValidArea(addr, 2) Then
                            PutMem2 addr, CInt(LowWord(signlong(p)))
                           Else
                            MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                           End If
                           Case 4
                           If bb1.ValidArea(addr, 4) Then
                                PutMem4 addr, signlong(p)
                           Else
                                MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                           End If
                           Case 8
                           If bb1.ValidArea(addr, 8) Then
                                PutMem8 addr, p
                           Else
                                MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                           End If
                           Case Else
                           End Select
                           If Err <> 0 Then
                           MyEr "Overflow. Problem in Buffer", "Υπερχείλιση. Πρόβλημα στη Διάρθρωση"
                           GoTo there
                           End If
                            
                            End If
                                End If
                           End If
                    ElseIf Left$(ah, 1) = "S" Then
                        If Not IsStrExp(bstack, rest$, s$) Then
                            ChangeValuesMem = False
                            GoTo there
                        End If
                        ChangeValuesMem = True
                        If Not bstack.lastobj Is Nothing Then
                        
                         MyEr "No objects for buffer", "Όχι αντικείμενα για Διάρθρωση"
                            GoTo there
                            
                        Else
                                If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                                    ChangeValuesMem = False
                                    GoTo there
                                Else
                            ' here is the part where we copy a string to memblock
                            Err.Clear
                            On Error Resume Next
                        
                      
                           If bb1.ValidArea(addr, Len(s$) * 2) Then
                           CopyBytes Len(s$) * 2, addr, StrPtr(s$)
                     
                           Else
                            MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                           End If
              
                           If Err <> 0 Then
                           MyEr "Overflow. Problem in Buffer", "Υπερχείλιση. Πρόβλημα στη Διάρθρωση"
                           GoTo there
                           End If
                            
                            End If
                        
                        End If
                Else
                        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                        ChangeValuesMem = False
                End If
                End If
        End If
    Loop


there:

Set bb1 = Nothing
Set aa = Nothing
End Function


Private Function CopyArray(A As Object) As Variant
 Dim pppp1 As mArray
     Set pppp1 = New mArray
     A.CopyArray pppp1
     Set A = Nothing
     Set CopyArray = pppp1
     Set pppp1 = Nothing
End Function

Function enthesi(bstack As basetask, rest$) As String
'first is the string "label {0} other {1}
Dim counter As Long, pat$, final$, pat1$, pl1 As Long, pl2 As Long, pl3 As Long
Dim q$, p As Double, p1 As Double, pd$
If IsStrExp(bstack, rest$, final$) Then
  If FastSymbol(rest$, ",") Then
    Do
    pl2 = 1
        pat$ = "{" + CStr(counter)
       pat1$ = pat$ + ":"
        pat$ = pat$ + "}"
        If IsStrExp(bstack, rest$, q$) Then
            
            final$ = Replace$(final$, pat$, q$)
AGAIN0:
        pl2 = InStr(pl2, final$, pat1$)
          If pl2 > 0 Then
           pl1 = InStr(pl2, final$, "}")
           pl3 = val(Mid$(final$, pl2 + Len(pat1$)) + "}")
           If pl3 <> 0 Then
        If pl3 > 0 Then
            pd$ = Left$(q$ + Space$(pl3), pl3)
            Else
            pd$ = Right$(Space$(Abs(pl3)) + q$, Abs(pl3))
            End If
      End If
            final$ = Replace$(final$, Mid$(final$, pl2, pl1 - pl2 + 1), pd$)
            GoTo AGAIN0
          End If
            If Not FastSymbol(rest$, ",") Then Exit Do
        ElseIf IsExp(bstack, rest$, p) Then
AGAIN1:
        pl2 = InStr(pl2, final$, pat1$)
        If pl2 > 0 Then
        pl1 = InStr(pl2, final$, "}")
        If Mid$(final$, pl2 + Len(pat1$), 1) = ":" Then
        p1 = 0
        pl3 = val(Mid$(final$, pl2 + Len(pat1$) + 1) + "}")
        Else
        p1 = val("0" + Mid$(final$, pl2 + Len(pat1$)))
        
        pl3 = val(Mid$(final$, pl2 + Len(pat1$) + Len(Str$(p1))) + "}")
        If p1 < 0 Then p1 = 22
        If p1 > 22 Then p1 = 22
      p = MyRound(p, p1)
      End If
      pd$ = LTrim(Str(p))
      
      If InStr(pd$, "E") > 0 Or InStr(pd$, "e") > 0 Then '' we can change e to greek ε
      pd$ = Format$(p, "#." + String$(p1, "0") + "E+####")
           If Not NoUseDec Then
            If InStr(pd$, NowDec$) > 0 Then
                pd$ = Replace$(pd$, NowDec$, Chr(2))
                pd$ = Replace$(pd$, NowThou$, ",")
                pd$ = Replace$(pd$, Chr(2), ".")
            
            End If
            End If
      ElseIf p1 <> 0 Then
       pd$ = Format$(p, "#." + String$(p1, "0"))
               If Not NoUseDec Then
            If InStr(pd$, NowDec$) > 0 Then
                pd$ = Replace$(pd$, NowDec$, Chr(2))
                pd$ = Replace$(pd$, NowThou$, ",")
                pd$ = Replace$(pd$, Chr(2), ".")
            
            End If
            End If
      End If
   
      If pl3 <> 0 Then
        If pl3 > 0 Then
            pd$ = Left$(pd$ + Space$(pl3), pl3)
            Else
            pd$ = Right$(Space$(Abs(pl3)) + pd$, Abs(pl3))
            End If
      End If
            final$ = Replace$(final$, Mid$(final$, pl2, pl1 - pl2 + 1), pd$)
            GoTo AGAIN1
        Else
        If NoUseDec Then
            final$ = Replace$(final$, pat$, CStr(p))
        Else
        final$ = Replace$(final$, pat$, LTrim(Str(p)))
        End If
        
        
            End If
            If Not FastSymbol(rest$, ",") Then Exit Do
        Else
            Exit Do
        End If
        counter = counter + 1
    Loop
    End If
End If
enthesi = final$
End Function
Public Function kUpper(A$, p As Double) As String
'idea from Bonnie West, FROM VBFORUMS
Dim nsize As Long
    nsize = Len(A$)
    If nsize Then SysReAllocStringLen VarPtr(kUpper), , nsize Else Exit Function
    Const LCMAP_UPPERCASE = &H200&
Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
If p = 1032 Then
If osnum >= System_Windows_Vista Then A$ = Replace(A$, "ς", "Σ")
Dim i As Long
For i = 1 To Len(A$)
Select Case AscW(Mid$(A$, i, 1))
Case 902
Mid$(A$, i, 1) = ChrW(913)
Case 904
Mid$(A$, i, 1) = ChrW(917)
Case 906
Mid$(A$, i, 1) = ChrW(921)
Case 912
Mid$(A$, i, 1) = ChrW(921)
Case 905
Mid$(A$, i, 1) = ChrW(919)
Case 908
Mid$(A$, i, 1) = ChrW(927)
Case 911
Mid$(A$, i, 1) = ChrW(937)
Case 910
Mid$(A$, i, 1) = ChrW(933)
Case 940
Mid$(A$, i, 1) = ChrW(913)
Case 941
Mid$(A$, i, 1) = ChrW(917)
Case 943
Mid$(A$, i, 1) = ChrW(921)
Case 942
Mid$(A$, i, 1) = ChrW(919)
Case 972
Mid$(A$, i, 1) = ChrW(927)
Case 974
Mid$(A$, i, 1) = ChrW(937)
Case 973
Mid$(A$, i, 1) = ChrW(933)
Case 962
If osnum >= System_Windows_Vista Then
Mid$(A$, i, 1) = ChrW(963)
Else
Mid$(A$, i, 1) = ChrW(931)
End If
End Select

Next i
End If
    nsize = LCMapStringW(mLid, LCMAP_UPPERCASE, StrPtr(A$), nsize, StrPtr(kUpper), nsize)
End Function

Public Function kUpper2(A$, p As Double) As String
'idea from Bonnie West, FROM VBFORUMS
Dim nsize As Long
    nsize = Len(A$)
    If nsize Then SysReAllocStringLen VarPtr(kUpper2), , nsize Else Exit Function
    Const LCMAP_UPPERCASE = &H200&
Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
If p = 1032 Then
''If osnum >= System_Windows_Vista Then a$ = Replace(a$, "ς", "Σ")
Dim i As Long
For i = 1 To Len(A$)
 Select Case AscW(Mid$(A$, i, 1))
Case 902
Mid$(A$, i, 1) = ChrW(913)
Case 904
Mid$(A$, i, 1) = ChrW(917)
Case 906
Mid$(A$, i, 1) = ChrW(921)
Case 912
Mid$(A$, i, 1) = ChrW(921)
Case 905
Mid$(A$, i, 1) = ChrW(919)
Case 908
Mid$(A$, i, 1) = ChrW(927)
Case 911
Mid$(A$, i, 1) = ChrW(937)
Case 910
Mid$(A$, i, 1) = ChrW(933)
Case 940
Mid$(A$, i, 1) = ChrW(913)
Case 941
Mid$(A$, i, 1) = ChrW(917)
Case 943
Mid$(A$, i, 1) = ChrW(921)
Case 942
Mid$(A$, i, 1) = ChrW(919)
Case 972
Mid$(A$, i, 1) = ChrW(927)
Case 974
Mid$(A$, i, 1) = ChrW(937)
Case 973
Mid$(A$, i, 1) = ChrW(933)
Case 962
Mid$(A$, i, 1) = ChrW(931)
End Select
Next i


End If
    nsize = LCMapStringW(mLid, LCMAP_UPPERCASE, StrPtr(A$), nsize, StrPtr(kUpper2), nsize)
End Function
Public Function klower(A$, p As Double) As String
Const LCMAP_LOWERCASE As Long = &H100
Dim nsize As Long
    nsize = Len(A$)
    If nsize Then SysReAllocStringLen VarPtr(klower), , nsize Else Exit Function

Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
nsize = LCMapStringW(mLid, LCMAP_LOWERCASE, StrPtr(A$), nsize, StrPtr(klower), nsize)
If p = 1032 Then
A$ = A$ & Chr(0)
A$ = Replace(A$, "σ" & Chr(0), "ς")
A$ = Replace(A$, Chr(0), "")
A$ = Replace(A$, "σ ", "ς ")
A$ = Replace(A$, "σ$", "ς$")
A$ = Replace(A$, "σ&", "ς&")
A$ = Replace(A$, "σ.", "ς.")
A$ = Replace(A$, "σ(", "ς(")
A$ = Replace(A$, "σ_", "ς_")
A$ = Replace(A$, "σ/", "ς/")
A$ = Replace(A$, "σ\", "ς\")
A$ = Replace(A$, "σ-", "ς-")
A$ = Replace(A$, "σ+", "ς+")
A$ = Replace(A$, "σ*", "ς*")
A$ = Replace(A$, "σ" & vbCr, "ς" & vbCr)
A$ = Replace(A$, "σ" & vbLf, "ς" & vbLf)


End If
klower = A$
End Function



Public Function GetSpecialfolder(CSIDL As Long) As String
    Dim r As Long
    Dim IDL As ITEMIDLIST, NOERROR As Long, path$
    'Get the special folder
    r = SHGetSpecialFolderLocation(100, CSIDL, IDL)
    If r = NOERROR Then
        'Create a buffer
        path$ = Space$(512)
        'Get the path from the IDList
        r = SHGetPathFromIDList(ByVal IDL.mkid.cb, ByVal path$)
        'Remove the unnecessary chr$(0)'s
        GetSpecialfolder = mylcasefILE(Left$(path, InStr(path, Chr$(0)) - 1))
        Exit Function
    End If
    GetSpecialfolder = ""
End Function
Sub MakeArray(basestack As basetask, frm$, o As Long, rest$, pppp As mArray, Optional lcl As Boolean = False, Optional globalonly As Boolean = False) 'global
Dim p As Double, x As Double, i As Long, f As Long, s$
If MaybeIsSymbol(rest$, ")") Then rest$ = "0" + rest$
    Select Case o
    Case 5, 6, 7
    If lcl Then
    
      GlobalArr basestack, here$ & "." + basestack.GroupName & frm$, rest$, i, f, True
    Else
    GlobalArr basestack, basestack.GroupName & frm$, rest$, i, f, True
    End If
    p = i
    If i < 0 Then o = 0
    Case Else
    o = 0
    End Select

    
    Select Case o
    Case 5
        x = 0
      If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
    
    If neoGetArray(basestack, frm$, pppp, , globalonly, Not lcl) Then   '' basestack.GroupName & f
         If Not basestack.lastobj Is Nothing Then
                                If Typename(basestack.lastobj) = "Group" Then
                                Set pppp.GroupRef = basestack.lastobj
                                 pppp.IHaveClass = True
                                Set basestack.lastobj = Nothing
                                pppp.SerialItem 0, 0, 3
                                End If
     Else
            pppp.SerialItem x, 0, 3
    End If
    End If
    Else
    o = 0
    End If
    End If

    Case 7
    x = 0
    If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
   If neoGetArray(basestack, frm$, pppp, , Not lcl) Then  '' basestack.GroupName &
    pppp.SerialItem Int(x), 0, 3
    End If
    Else
    o = 0
    End If
    End If
    Case 6
        s$ = ""
    If FastSymbol(rest$, "=") Then
    If IsStrExp(basestack, rest$, s$) Then
   If neoGetArray(basestack, frm$, pppp, , Not lcl) Then ''basestack.GroupName &
    pppp.SerialItem s$, 0, 3
    End If
    Else
    o = 0
    End If
    End If
    End Select
    If o = 0 Then
      MyEr "Array dimensions missing ", "Ο πίνακας δεν έχει διαστάσεις "
    rest$ = basestack.GroupName & frm$ & rest$
    End If
End Sub


Sub MyMode(scr As Object)
Dim x1 As Long, y1 As Long
On Error Resume Next
With players(GetCode(scr))
    x1 = scr.Width
    y1 = scr.Height
    If Typename(scr) Like "Gui*" Then
    Else
    If scr.name = "Form1" Then
    DisableTargets q(), -1
    
    ElseIf scr.name = "DIS" Then
    DisableTargets q(), 0
    
    ElseIf scr.name = "dSprite" Then
    DisableTargets q(), val(scr.index)
    End If
    End If
    If .SZ < 4 Then .SZ = 4
        Err.Clear
        scr.Font.Size = .SZ
        If Err.Number > 0 Then
                MYFONT = "ARIAL"
                scr.Font.name = MYFONT
                scr.Font.charset = .charset
                scr.Font.name = MYFONT
                scr.Font.charset = .charset
        End If
        .uMineLineSpace = .MineLineSpace
        FrameText scr, .SZ, x1, y1, .Paper
    .currow = 0
    .curpos = 0
    .XGRAPH = 0
    .YGRAPH = 0
End With
End Sub

Function ProcSave(basestack As basetask, rest$, lang As Long) As Boolean
Dim pa$, w$, s$, col As Long, prg$, x1 As Long, par As Boolean, i As Long
On Error Resume Next
If lckfrm <> 0 Then MyEr "Save is locked", "Η αποθήκευση είναι κλειδωμένη": rest$ = "": Exit Function

x1 = Abs(IsLabelBig(basestack, rest$, pa$, , s$))

If x1 <> 1 Then
rest$ = pa$ + rest$: x1 = IsStrExp(basestack, rest$, pa$)
Else
pa$ = s$: s$ = ""
End If

If x1 <> 0 Then
        If subHash.count = 0 Or pa$ = "" Then MyEr "Nothing to save", "Δεν υπάρχει κάτι να σώσω":              Exit Function
        If ExtractType(pa$) = "gsb" Then pa$ = ExtractPath(pa$) + ExtractNameOnly(pa$)
        If ExtractPath(pa$) <> "" Then
                If InStr(ExtractPath(pa$), mcd) <> 1 Then pa$ = pa$ & ".gsb" Else pa$ = pa$ & ".gsb"
        Else
                pa$ = mcd + pa$ & ".gsb"
        End If
        If Not WeCanWrite(pa$) Then Exit Function
        
      
           For i = subHash.count - 1 To 0 Step -1
       subHash.ReadVar i, s$, col
                If Right$(s$, 2) = "()" Then
                s$ = Left$(s$, Len(s$) - 2)
                
                If Right$(sbf(col).sb, 2) <> vbCrLf Then sbf(col).sb = sbf(col).sb + vbCrLf
                If lang Then
                        If Not blockCheck(sbf(col).sb, DialogLang, "Function " & s$ + "()" + vbCrLf) Then Exit Function
                                prg$ = "FUNCTION " & s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                        Else
                                If Not blockCheck(sbf(col).sb, DialogLang, "Συνάρτηση " & s$ + "()" + vbCrLf) Then Exit Function
                                prg$ = "ΣΥΝΑΡΤΗΣΗ " & s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                        End If
                Else
                        If Right$(sbf(col).sb, 2) <> vbCrLf Then sbf(col).sb = sbf(col).sb + vbCrLf
                        If lang Then
                                If Not blockCheck(sbf(col).sb, DialogLang, "Module " & s$ + vbCrLf) Then Exit Function
                                prg$ = "MODULE " & s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                        Else
                                If Not blockCheck(sbf(col).sb, DialogLang, "Τμήμα " & s$ + vbCrLf) Then Exit Function
                                prg$ = "ΤΜΗΜΑ " & s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                        End If
                End If
        Next i
        w$ = ""
        If FastSymbol(rest$, "@@", , 2) Then
            ' default password  - one space only - coder use default internal password
                If Not IsStrExp(basestack, rest$, w$) Then w$ = " "
        ElseIf FastSymbol(rest$, "@") Then
                ' One space only
                w$ = " "
        End If
        par = False
        If FastSymbol(rest$, ",") Then
                If Abs(IsLabel(basestack, rest$, s$)) = 1 Then
                        prg$ = prg$ & s$
                ElseIf FastSymbol(rest$, "{") Then
                        prg$ = prg$ & block(rest$)
                        If Not FastSymbol(rest$, "}") Then Exit Function
                End If
        End If
        ' reuse s$, col$
        If Len(w$) > 1 Then  'scrable col by George
                s$ = "": For col = 1 To Int((33 * Rnd) + 1): s$ = s$ & Chr(65 + Int((23 * Rnd) + 1)): Next col
                ' insert a variable length label......to make a variable length file
                prg$ = s$ & ":" & vbCrLf + prg$
                prg$ = mycoder.encryptline(prg$, w$, Len(prg$) Mod 33)
                par = True
        ElseIf Len(w$) = 1 Then   ' I have to check that...
                s$ = "":   For col = 1 To Int((33 * Rnd) + 1): s$ = s$ & Chr(65 + Int((23 * Rnd) + 1)): Next col
                prg$ = s$ & ":" & vbCrLf + prg$
                prg$ = mycoder.must1(prg$)
                par = True
        End If
        s$ = ""
        If CFname(pa$) <> "" Then
                If lang = 1 Then
                        If MsgBoxN("Replace " + ExtractNameOnly(pa$), vbOKCancel, MesTitle$) <> vbOK Then
                        MyEr "File not saved -1005", "Δεν σώθηκε το αρχείο -1005"
                        ProcSave = True
                        Exit Function
                        End If
                Else
                        If MsgBoxN("Αλλαγή " + ExtractNameOnly(pa$), vbOKCancel, MesTitle$) <> vbOK Then
                        MyEr "File not saved -1005", "Δεν σώθηκε το αρχείο -1005"
                        ProcSave = True
                        Exit Function
                        End If
                End If
                s$ = "*"
        End If
        If Not WeCanWrite(pa$) Then Exit Function
        If par Then
                If s$ = "*" Then
                       '' If CFname(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck") <> "" Then killfile GetDosPath(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"): Sleep 30
                        MakeACopy pa$, ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"
                End If
                If Not SaveUnicode(pa$, prg$, 0) Then BadFilename
                Else
                If s$ <> "" Then
                        ''If CFname(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck") <> "" Then killfile GetDosPath(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"):  Sleep 30
                        MakeACopy pa$, ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"
                End If
                ProcSave = SaveUnicode(pa$, prg$, 2)  ' 2 = utf-8 standard save mode for version 7
                If here$ = "" Then LASTPROG$ = pa$
        End If
 ProcSave = True
Else
MyEr "A name please or use Ctrl+A to perform SAVE COMMAND$  (the last loading)", "Ένα όνομα παρακαλώ, ή πάτα το ctrl+Α για να αποθηκεύσεις με το όνομα του προγράμματος που φορτώθηκε τελευταία"
End If

End Function

Function MySwap(bstack As basetask, rest$, lang As Long) As Boolean
Dim s$, ss$, f As Long, col As Long, x1 As Long, i As Long, pppp As mArray, pppp1 As mArray
    f = Abs(IsLabel(bstack, rest$, s$))
    MySwap = True
    If f = 1 Or f = 4 Then col = 1
    If f = 5 Or f = 7 Then col = 2
    If f = 0 Then MissingnumVar:  Exit Function
    If (f = 3 Or f = 6) And col > 0 Then SyntaxError: MySwap = False:    Exit Function
    If col = 1 Then
        If GetVar(bstack, s$, f) Then
                If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
              If i = 1 Or i = 4 Then
                If GetVar(bstack, ss$, x1) Then
                
                    SwapVariant var(f), var(x1)
                    
                    
                Exit Function
                Else
                    Nosuchvariable ss$
                    MySwap = False
                    Exit Function
                End If
            ElseIf i = 5 Or i = 7 Then
                If neoGetArray(bstack, ss$, pppp) Then
                If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, ss$, x1, rest$, True) Then Exit Function
               
                    SwapVariant2 var(f), pppp, x1
                    
                    
                Else
                
                    NoSwap ss$
                    MySwap = False
                    Exit Function
                End If
            Else
                MissingnumVar
                MySwap = False
                Exit Function
            End If
        Else
            Nosuchvariable s$
            
            Exit Function
        End If
    ElseIf col = 2 Then
        If neoGetArray(bstack, s$, pppp) Then
        If Not pppp.Arr Then NotArray: Exit Function
        If Not NeoGetArrayItem(pppp, bstack, s$, f, rest$) Then Exit Function
            If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
                  
            If i = 1 Or i = 4 Then
                    If GetVar(bstack, ss$, x1) Then
                    If pppp.IHaveClass Then
                            NoSwap ""
                    Else
                         SwapVariant2 var(x1), pppp, f
                     End If
                        
                    Else
                        MissingnumVar
                        MySwap = False
                        Exit Function
                    End If
            ElseIf i = 5 Or i = 7 Then
                    If neoGetArray(bstack, ss$, pppp1) Then
                    If Not pppp1.Arr Then NotArray: Exit Function
                        If Not NeoGetArrayItem(pppp1, bstack, ss$, x1, rest$) Then Exit Function
                   If pppp.IHaveClass Xor Not pppp1.IHaveClass Then
                            
                        SwapVariant3 pppp, f, pppp1, x1
                        If pppp.IHaveClass Then
                            Set pppp.item(f).LinkRef = pppp1.GroupRef
                            Set pppp1.item(x1).LinkRef = pppp.GroupRef
                            End If
                        Else
                        NoSwap ""
                        Exit Function
                        End If
                        
                    Else
                        MissingnumVar
                        
                        Exit Function
                    End If
            Else
                MissingnumVar
                
                Exit Function
            End If
        Else
            MissingnumVar
            
            Exit Function
        End If
    ElseIf f = 3 Then
            If GetVar(bstack, s$, f) Then
            If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
                 If i = 6 Then
                    If Not neoGetArray(bstack, ss$, pppp) Then MissingStrVar:  Exit Function
                    If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, ss$, x1, rest$) Then Exit Function

                    SwapVariant2 var(f), pppp, x1

                ElseIf i = 3 Then
                    If Not GetVar(bstack, ss$, x1) Then: Exit Function

                   SwapVariant var(f), var(x1)
                Else
                MissFuncParameterStringVar
                MySwap = False
                End If
                
                
            Else
                    
                    MissFuncParameterStringVar
                    MySwap = False
            End If
    ElseIf f = 6 Then
            If neoGetArray(bstack, s$, pppp) Then
            If Not pppp.Arr Then NotArray: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, s$, x1, rest$) Then Exit Function
                If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
     
                If i = 6 Then
                    If Not neoGetArray(bstack, ss$, pppp1) Then MissingStrVar:  Exit Function
                    If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp1, bstack, ss$, i, rest$) Then Exit Function

                   SwapVariant3 pppp, x1, pppp1, i
 
                ElseIf i = 3 Then
                    If Not GetVar(bstack, ss$, i) Then: Exit Function

                  SwapVariant2 var(i), pppp, x1
                    Else
                MissFuncParameterStringVar
                MySwap = False
                End If
                
                
            Else
                
                MissPar
                MySwap = False
                
            End If
    Else
                 
                MissPar
                MySwap = False
    End If
    Exit Function

End Function

Public Sub PushStage(basestack As basetask, dummy As Boolean)
        With basestack.RetStack
               basestack.SubLevel = basestack.SubLevel + 1

                If dummy Then
                        .PushVal 0
                        .PushVal 0
                        .PushVal 0
                        .PushVal 0
                        .PushVal -2
                Else
                        .PushVal CDbl(subHash.count)
                        .PushVal CDbl(varhash.count)
                        .PushVal CDbl(sb2used)
                        .PushVal CDbl(var2used)
                        .PushVal -1
End If
        End With
       
End Sub
Public Sub PopStage(basestack As basetask)
Dim kolpo As Boolean, bb$, Once As Boolean, dd As Variant
        With basestack.RetStack
        If .LookTopVal = -1 Then
        basestack.SubLevel = basestack.SubLevel - 1
       .drop 1
            var2used = CLng(.PopVal)
            sb2used = CLng(.PopVal)
            varhash.ReduceHash CLng(.PopVal), var()
            subHash.ReduceHash CLng(.PopVal), sbf()
        ElseIf .LookTopVal = -2 Then
        basestack.SubLevel = basestack.SubLevel - 1
        .drop 5
        End If
        End With
End Sub

Function RevisionPrint(basestack As basetask, rest$, xa As Long, lang As Long) As Boolean
Dim scr As Object, oldCol As Long, oldFTEXT As Long, oldFTXT As String, oldpen As Long
Dim par As Boolean, i As Long, f As Long, p As Double, W4 As Boolean, pn&, s$, dlen As Long
Dim o As Long, W3 As Long, x1 As Long, y1 As Long, x As Double, ColOffset As Long
Dim work As Boolean, work2 As Long, skiplast As Boolean
Set scr = basestack.Owner
W3 = -1
Dim basketcode As Long, prive As basket
basketcode = GetCode(scr)
prive = players(basketcode)
With prive
PlaceBasketPrive scr, prive
scr.FontTransparent = True
On Error GoTo 0
Dim opn&
par = True
If IsSymbol(rest$, "#") Then
   If IsExp(basestack, "#" + Left$(rest$, 6), p) Then
   rest$ = "#" + rest$
   Else
        If IsExp(basestack, rest$, p) Then
                     f = CLng(MyMod(p, 512))
                     If Not FastSymbol(rest$, ",") Then Set scr = Nothing: Exit Function
                     par = False
             End If
    End If
Else
If Not IsLabelSYMB3(rest$, s$) Then
                    f = 0
Else
Select Case lang
Case 1
Select Case UCase(s$)
        Case "OVER"
        f = 1
        Case "UNDER"
        f = 2
        Case "PART"
        f = 3
        Case Else
        rest$ = s$ + rest$
        f = 0
        End Select
Case 0, 2
        Select Case myUcase(s$, True)
        Case "ΠΑΝΩ"
        f = 1
        Case "ΥΠΟ"
        f = 2
        Case "ΜΕΡΟΣ"
        f = 3
        Case Else
        rest$ = s$ + rest$
        f = 0
        End Select
        End Select
        If f > 0 And .lastprint Then
        .lastprint = False
        
        GetXYb scr, prive, x1&, y1&
        If f <> 2 Then If x1& > 0 Or y1& >= .mx Then crNew basestack, prive
        End If
If f = 1 Then  ''
work = True
oldCol = .Column
scr.Line (0&, .currow * .Yt)-((.mx - 1) * .Xt + .Xt * 2, (.currow) * .Yt + .Yt - 2 * DYP), .Paper, BF
LCTbasket scr, prive, .currow, 0&
.Column = .mx - 1
W4 = True
oldFTEXT = .FTEXT
oldFTXT = .FTXT
oldpen = .mypen
pn& = 2
.FTEXT = 4
ElseIf f = 2 Then
work = True
oldCol = .Column
scr.Line (0&, (.currow) * .Yt + .Yt - DYP)-((.mx - 1) * .Xt + .Xt * 2, (.currow) * .Yt + .Yt - 1 * DYP), .mypen, BF
crNew basestack, prive
LCTbasketCur scr, prive
W4 = True
oldFTEXT = .FTEXT
oldFTXT = .FTXT
oldpen = .mypen
.FTEXT = 4
pn& = 2
ElseIf f = 3 Then
' we print in a line with lost chars, so controling the start of printing
' we can render text, like from a view port Some columns are hidden because they went out of screen;
work = True
oldCol = .Column
LCTbasket scr, prive, .currow, 0&
W4 = True
oldFTEXT = .FTEXT
oldFTXT = .FTXT
.FTEXT = 4
oldpen = .mypen
End If
f = 0
End If

End If
If W4 Then pn& = 2 Else pn& = 0

s$ = ""
If par Then
    If .FTEXT > 3 And .curpos >= .mx And Not W4 Then
    crNew basestack, prive
    W3 = 0
End If
End If
If par Then
If FastSymbol(rest$, ";") Then

            If .lastprint Then
            .lastprint = False
            LCTbasketCur scr, prive
            crNew basestack, prive
            End If
         
ElseIf .lastprint Then
If .FTEXT > 3 Then pn& = 7: GoTo newntrance

End If
End If


Do

    If IsExp(basestack, rest$, p) Then
            If .lastprint Then opn& = 5

            pn& = 1
            If .Column = 1 Then
            
            pn& = 6
            End If
            
    ElseIf LastErNum <> 0 Then
            .lastprint = False
            RevisionPrint = LastErNum = -2
            Set scr = Nothing
            Exit Function
    ElseIf IsStrExp(basestack, rest$, s$) Then
    ' special not good for every day...is 255 char in greek codepage
   '   If InStr(s$, ChrW(&HFFFFF8FB)) > 0 Then s$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))
    If .lastprint Then opn& = 5
            pn& = 2
      If .Column = 1 Then
            
            pn& = 7
            End If
    ElseIf LastErNum <> 0 Then
             RevisionPrint = LastErNum = -2
             Set scr = Nothing
                Exit Function
    ElseIf FastSymbol(rest$, "~(", , 2) Then ' means combine
        ' get the color and then look for @( parameters)
        W3 = -1
    If par Then  ' par is false when we print in files, we can't use color;
   
                 If IsExp(basestack, rest$, p) Then .mypen = CLng(mycolor(p))
                 TextColor scr, .mypen
                 
                     If FastSymbol(rest$, ",") Then
                     
                                If W4 Or Not work Then
                                  If prive.lastprint Then
                                   prive.lastprint = False
                                   GetXYb scr, prive, .curpos, .currow
                                                   If work Then
                       .curpos = .curpos - ColOffset
                      If (.curpos Mod (.Column + 1)) <> 0 Then
                      .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                 If W4 Then LCTbasketCur scr, prive
                       End If
                                  End If
                               
                              LCTbasketCur scr, prive
                             
                                Else
                                 If work Then
                       .curpos = .curpos - ColOffset
                      If (.curpos Mod (.Column + 1)) <> 0 Then
                      .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                 If W4 Then LCTbasketCur scr, prive
                       End If
                               '' LCTbasketCur scr, prive
                                End If
                                
                                
'                                         GetXYb scr, prive, .curpos, .currow
                   ''  LCTbasketCur scr, prive
                x1 = .Column + .curpos + 1
                y1 = .currow + 1
                
                                pn& = 99
                             GoTo pthere   ' background and border and or images
            
            
                 End If
                         If Not FastSymbol(rest$, ")") Then RevisionPrint = False: Set scr = Nothing: Exit Function
                         pn& = 99
    End If
    ElseIf FastSymbol(rest$, "@(", , 2) Then
    W3 = -1
               If Not par Then RevisionPrint = False: Set scr = Nothing: Exit Function
                If IsExp(basestack, rest$, p) Then

                .curpos = CLng(p)
                End If
                
                If FastSymbol(rest$, ",") Then
                If IsExp(basestack, rest$, p) Then .currow = CLng(p)
                End If

                If FastSymbol(rest$, ",") Then
                
                If IsExp(basestack, rest$, p) Then x1 = CLng(p)
                Else
                x1 = 1
                End If
                
                If FastSymbol(rest$, ",") Then
                If IsExp(basestack, rest$, p) Then y1 = CLng(p)
                Else
                y1 = 1
                End If

                If FastSymbol(rest$, ",") Then
             '   On Error Resume Next
pthere:
                   LCTbasketCur scr, prive
                If IsStrExp(basestack, rest$, s$) Then
                p = 0
                    If FastSymbol(rest$, ",") Then
                        If IsExp(basestack, rest$, p) Then
                            If p <> 0 Then p = True
                        Else
                        p = True
                        End If
                    End If
             
                    x1 = Abs(x1 - .curpos)
                    y1 = Abs(y1 - .currow)
                    
                    BoxImage scr, prive, x1, y1, s$, 0, (p)
                    'If P <> 0 Then .currow = y1 + .currow
                ElseIf IsExp(basestack, rest$, p) Then
         
                    BoxColorNew scr, prive, x1 - 1, y1 - 1, (p)
                    If FastSymbol(rest$, ",") Then
                        If IsExp(basestack, rest$, x) Then
                            BoxBigNew scr, prive, x1 - 1, y1 - 1, (x)
                            
                            
                            
                        Else
                            RevisionPrint = False
                            Set scr = Nothing
                            Exit Function
                        End If
                    End If
                Else
                    RevisionPrint = False
                    Set scr = Nothing
                    Exit Function
                
                End If

                End If
             LCTbasket scr, prive, .currow, .curpos
                
        If Not FastSymbol(rest$, ")") Then
        RevisionPrint = False
        Set scr = Nothing
        Exit Function
        End If
        work = False
        pn& = 99
        ElseIf LastErNum <> 0 Then
      RevisionPrint = LastErNum <> -2
      Set scr = Nothing
    Exit Function
    
    ElseIf FastSymbol(rest$, "$(", , 2) Then
conthere:
W3 = -1
        If IsExp(basestack, rest$, p) Then
        
            .FTEXT = Abs(p) Mod 10
            ' 0 STANDARD LEFT chars before typed beyond the line are directed to the next line
            ' 1  RIGHT
            ' 2 CENTER
            ' 3 LEFT
            ' 4 LEFT PROP....expand to next .Column......
            ' 5 RIGHT PROP
            ' 6 CENTER PROP
            ' 7 LEFT PROP
            ' 8 left and right justify
            ' 9 New in version 8 Left justify(like 7) without word wrap (cut excess)
        ElseIf IsStrExp(basestack, rest$, s$) Then
            .FTXT = s$
        End If
        If par Then
        If FastSymbol(rest$, ",") Then
                If IsExp(basestack, rest$, p) Then
                p = p - 1
                If Abs(Int(p Mod (.mx + 1))) < 2 Then
                MyEr ".Column minimum width is 4 chars", "Μικρότερο μέγεθος στήλης είναι οι τέσσερις χαρακτήρες"
                Else
                 If W4 Or Not work Then
                   LCTbasketCur scr, prive
                   Else
                   GetXYb scr, prive, .curpos, .currow
                   End If
                 If W4 Then ColOffset = .curpos    ' now we have columns from offset ColOffset
                    .Column = Abs(Int(p Mod (.mx + 1)))
                    End If
                   
                Else
                    RevisionPrint = False
                    Set scr = Nothing
                    Exit Function
                End If
         End If
         End If
            If Not FastSymbol(rest$, ")") Then
            RevisionPrint = False
            Set scr = Nothing
            Exit Function
            End If
        
        
        pn& = 99
        ElseIf LastErNum <> 0 Then
       RevisionPrint = LastErNum <> -2
       Set scr = Nothing
    Exit Function
    Else
    If pn& <> 0 And pn& < 5 And Not .lastprint Then
        If par Then
            If Not W4 Then
          '' GetXYb scr, prive, .curpos, .currow

If Not (.curpos = 0) Then
GetXYb scr, prive, .curpos, .currow
If pn& = 1 Then
crNew basestack, prive: skiplast = True
ElseIf pn& = 2 Then

If Abs(W3) = 1 And .curpos = 0 And Not (.FTEXT = 9 Or .FTEXT = 5 Or .FTEXT = 6) Then

Else
crNew basestack, prive: skiplast = True
End If
End If
End If


            End If
        Else
            If Uni(f) Then
            putUniString f, vbCrLf
            Else
            putANSIString f, vbCrLf
            'Print #f,
            End If
        End If
    End If
 
        Exit Do
    End If
If par Then If .lastprint And opn& > 4 Then .lastprint = False
    If FastSymbol(rest$, ";") Then
'' LEAVE W3
If par Then
   If opn& = 0 And (Not work) And (Not .lastprint) Then

   LCTbasket scr, prive, .currow, .curpos
   End If
   End If
   ' IF  WORK THEN opn&=5
   opn& = 5
newntrance:
work = True
If par Then .lastprint = True
        
         Do While FastSymbol(rest$, ";")
         Loop
    ElseIf Not FastSymbol(rest$, ",") Then
    
    pn& = pn& + opn&
  opn& = 0
  rest$ = NLtrim$(rest$)
  If rest$ <> "" Then
    
  If Not MaybeIsSymbol(rest$, " : }\'" + vbCr) Then
  
    Exit Function
 ''rest$ = "@{}" + Mid$(rest$, 3)
   End If
   End If
    Else

    rest$ = "," & rest$
    End If
    pn& = pn& + opn&
    Select Case pn&
    Case 0
    Exit Do
    Case 1
        If .FTXT = "" Then
        If xa Then
        s$ = PACKLNG2$(p)
        Else
If NoUseDec Then
   s$ = CStr(p)
   
Else
 s$ = Trim$(Str(p))
End If
      If .FTEXT < 4 Then
            If InStr(s$, ".") > 0 Then
                 If InStr(s$, ".") <= .Column Then
                        If RealLen(s$) > .Column + 1 Then
                                 If .FTEXT > 0 Then s$ = Left$(s$, .Column + 1)
                        End If
                End If
            ElseIf .FTEXT > 0 Then
                 If RealLen(s$) > .Column + 1 Then s$ = String$(.Column, "?")
            End If
          End If
    End If
        Else
        s$ = Format$(p, .FTXT)
        If Not NoUseDec Then
            If InStr(s$, NowDec$) > 0 And InStr(.FTXT, ".") > 0 Then
                s$ = Replace$(s$, NowDec$, Chr(2))
                s$ = Replace$(s$, NowThou$, ",")
                s$ = Replace$(s$, Chr(2), ".")
            
            End If
            End If
        End If
     If par Then
        If .Column > 2 Then   ' .Column 3 means 4 chars width
        If opn& < 5 Then
    '                    ensure that we are align in .Column  (.Column is based zero...)
    skiplast = False
               If .currow >= .My Then
               If Not W4 Then crNew basestack, prive: skiplast = True
               End If
        
                        If work Then
                       .curpos = .curpos - ColOffset
                      If (.curpos Mod (.Column + 1)) <> 0 Then
                      .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                 If W4 Then LCTbasketCur scr, prive
                       End If
                       work = True
    End If
            If .curpos >= .mx Then
    '' ???
                    Else
            Select Case .FTEXT
            Case 0
            
                          
                       PlainBaSket scr, prive, Space$(.Column - (RealLen(s$) - 1) Mod (.Column + 1)) + s$, W4, W4
                       
            Case 3
                        PlainBaSket scr, prive, Right$(Space$(.Column - (RealLen(s$) - 1) Mod (.Column + 1)) + Left$(s$, .Column + 1), .Column + 1), W4, W4
            Case 2
                        If RealLen(s$) > .Column + 1 Then s$ = "????"
                        PlainBaSket scr, prive, Left$(Space$((.Column + 1 - RealLen(s$)) \ 2) + Left$(s$, .Column + 1) & Space$(.Column), .Column + 1), W4, W4
            Case 1
                        PlainBaSket scr, prive, Left$(s$ & Space$(.Column), .Column + 1), W4, W4
            Case 5
                        x1 = .curpos
                        y1 = .currow
                        If Not (.mx - 1 <= .curpos And W4 <> 0) Then
                        LCTbasketCur scr, prive
                        scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                        wwPlain basestack, prive, s$, .Column * .Xt + .Xt - (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2, 0, , True, 0, , CBool(W4), True, , True
                        .currow = y1
        

                        .curpos = x1 + .Column + 1
                        
                        End If
                     If .curpos >= .mx And Not W4 Then
                   
                         .currow = .currow + 1
                         .curpos = 0
                         End If
              If .lastprint Then
     
                 If .curpos = 0 Then
                 If .currow >= .My Then crNew basestack, prive Else LCTbasketCur scr, prive
                 End If
                 
     scr.CurrentX = .curpos * .Xt
                
                  scr.CurrentY = .currow * .Yt + .uMineLineSpace
             
         
                   End If
            Case 4, 7, 8
            
                        wwPlain basestack, prive, s$ & vbCrLf, .Column * .Xt + .Xt - (.Xt - TextWidth(scr, Right$(s$, 1))) \ 2, 0, , , 1, , , pn& < 5, , True
                        .curpos = .curpos + .Column + 1
                        If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                        End If
                        If .lastprint Then
                            If .curpos = 0 Then
                                If .currow >= .My Then crNew basestack, prive Else LCTbasketCur scr, prive
                            End If
                            If .curpos > 0 Then scr.CurrentX = .curpos * .Xt - (.Xt - TextWidth(scr, Right$(s$, 1))) \ 2 Else scr.CurrentX = .curpos * .Xt
                            scr.CurrentY = .currow * .Yt + .uMineLineSpace
                        End If
            Case 6
                            
                        wwPlain basestack, prive, s$, .Column * .Xt + .Xt, 0, , False, 2, , , pn& < 5, , True
                        .curpos = .curpos + .Column + 1
                        If .curpos >= .mx And Not W4 Then
                            .curpos = 0
                            .currow = .currow + 1
                        End If
                        If .lastprint Then
                            If .curpos = 0 Then
                                If .currow >= .My Then crNew basestack, prive Else LCTbasketCur scr, prive
                            End If
                            scr.CurrentX = .curpos * .Xt
                            scr.CurrentY = .currow * .Yt + .uMineLineSpace
                        End If
                            
            Case 9
                            LCTbasketCur scr, prive
                            wPlain scr, prive, s$, 1000, 0, True
                             GetXYb scr, prive, .curpos, .currow
                           .curpos = .curpos + 1
                            If (.curpos Mod (.Column + 1)) <> 0 Then
                     .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                             '     .curpos = .curpos + .Column + 1
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                                                               If .lastprint Then
     
                 If .curpos = 0 Then
                 If .currow >= .My Then crNew basestack, prive Else LCTbasketCur scr, prive
                 End If
                If .curpos > 0 Then scr.CurrentX = .curpos * .Xt - (.Xt - TextWidth(scr, Right$(s$, 1))) \ 2 Else scr.CurrentX = .curpos * .Xt
                  scr.CurrentY = .currow * .Yt + .uMineLineSpace
             
         
                   End If
            End Select
End If
            
            
            
        Else
        ' no way to use this any more...7 rev 20
        PlainBaSket scr, prive, s$
        End If
 
        Else
         If Uni(f) Then
            putUniString f, s$
            Else
            putANSIString f, s$
        'Print #f, S$;
        End If
        End If
    Case 2
    '' for string.....................................................................................................................
        If .FTXT <> "" Then
        s$ = Format$(s$, .FTXT)
        End If
        If par Then
        If .Column > 0 Then
                             x1 = .curpos: y1 = .currow
                skiplast = False
                                If .currow >= .My And Not W4 Then
                                crNew basestack, prive
                                skiplast = True
                                End If
                        If work Then
                       .curpos = .curpos - ColOffset
                      If (.curpos Mod (.Column + 1)) <> 0 Then
                      .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                     
                      End If
                      '' LCTbasket scr, prive,   y1, X1
                       If W4 Then LCTbasketCur scr, prive
                       End If
                       work = True
          If s$ = "" Then s$ = " "
          
                 If .curpos >= .mx Then
                 y1 = 1
                    Else
            Select Case .FTEXT
                Case 1
                           '' GetXY scr, X1, y1
                          ''  If s$ = "" Then s$ = " "
                          dlen = RealLen(s$)
                          PlainBaSket scr, prive, Left$(s$ & Space$(Len(s$) - dlen + .Column - (dlen - 1) Mod (.Column + 1)), .Column + 1 + Len(s$) - dlen), W4, W4
                Case 2
                            dlen = RealLen(s$)
                            If dlen > (.Column + 1 + Len(s$) - dlen) Then s$ = Left$(s$, .Column + 1 + Len(s$) - dlen):  dlen = RealLen(s$)
                            
                            PlainBaSket scr, prive, Left$(Space$((.Column + 1 + Len(s$) - dlen - dlen) \ 2) + s$ & Space$(.Column), .Column + 1 + Len(s$) - dlen), W4, W4
                Case 3
                            dlen = RealLen(s$)
                            PlainBaSket scr, prive, Right$(Space$(.Column + Len(s$) - dlen - (dlen - 1) Mod (.Column + 1)) & s$, .Column + 1 + Len(s$) - dlen), W4, W4
                Case 0
                           '' If s$ = "" Then s$ = " "
                        
                            PlainBaSket scr, prive, s$ + Space$(.Column - (RealLen(s$) - 1) Mod (.Column + 1)), W4, W4
                       
                Case 4
                            
                            LCTbasketCur scr, prive
                            scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                            
                            W3 = 0
                            wwPlain basestack, prive, s$, scr.Width, 0, , True, 0, , W3, True
                            W3 = W3 \ .Xt + 1
                            ' go to next .Column...
                            
                            .curpos = (.Column + 1) * ((W3 + .Column + 1) \ (.Column + 1))
                        If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                Case 5
                           '' GetXY scr, X1, y1
                            LCTbasketCur scr, prive
                            scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                            wwPlain basestack, prive, s$, .Column * .Xt + .Xt - (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2, 0, , True, 3, , , True
                            .curpos = .curpos + .Column + 1
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                Case 6
                        ''    LCTbasketCur scr, prive
                            wwPlain basestack, prive, s$, .Column * .Xt + .Xt, 0, , False, 2, , , True
                                        .curpos = .curpos + .Column + 1
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                Case 7
                            
                            LCTbasketCur scr, prive
                    work2 = scr.CurrentY
                            
                            wwPlain basestack, prive, s$ & vbCrLf, .Column * .Xt + .Xt - (.Xt - TextWidth(scr, Right$(s$, 1))) \ 2, 0, , True, 1, , , True, , True
                       scr.CurrentY = work2
                            .curpos = .curpos + .Column + 1
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                Case 8
                            LCTbasketCur scr, prive
                            scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                            If Not (.mx - 1 <= x1 And W4 <> 0) Then
                                    wwPlain basestack, prive, s$, .Column * .Xt + .Xt - (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2, 0, , True, 0, , , True
                            End If
                            .curpos = .curpos + .Column + 1
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                Case 9
                            LCTbasketCur scr, prive

              wPlain scr, prive, s$, .Column + 1, 0, True
                GetXYb scr, prive, .curpos, .currow
                          .curpos = .curpos + 1
                            If (.curpos Mod (.Column + 1)) <> 0 Then
                     .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                            If .curpos >= .mx And Not W4 Then
                                .curpos = 0
                                .currow = .currow + 1
                            End If
                End Select
                End If
        Else
            PlainBaSket scr, prive, s$
        
        End If
        Else
             If Uni(f) Then
            putUniString f, s$
            Else
            putANSIString f, s$
        'Print #f, S$;
        End If
        End If
    Case 6
        If par Then
                If .FTEXT > 3 Then
            W3 = 0
             x1 = .curpos
             y1 = .currow
                        If .FTXT <> "" Then
                                       s$ = Format$(p, .FTXT)
            If Not NoUseDec Then
            If InStr(s$, NowDec$) > 0 And InStr(.FTXT, ".") > 0 Then
                s$ = Replace$(s$, NowDec$, Chr(2))
                s$ = Replace$(s$, NowThou$, ",")
                s$ = Replace$(s$, Chr(2), ".")
            
            End If
            End If
                               
                                If .FTEXT > 4 And Not work Then scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                                If scr.CurrentX < .mx * .Xt Then
                            
                                wwPlain basestack, prive, s$, scr.Width, 0, , True, 0, , W3
                                
                                End If
                                
                        Else
                                 If xa Then
                                        s$ = PACKLNG2$(p)
                                Else
                                        s$ = Trim$(Str$(p))
                                End If

                                If .FTEXT > 4 And Not work Then scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                                      If scr.CurrentX < 0 Then
                             
                                
                                
                                End If
                                wwPlain basestack, prive, s$, scr.Width, 0, , True, 0, , W3
                                work = True
                                scr.CurrentX = W3
                         
                                            
                        End If
                      '' Then LCTbasket scr, prive, y1, W3 \ .Xt + 1
                Else
                        If .FTXT = "" Then
                                If xa Then
                                    PlainBaSket scr, prive, PACKLNG2$(p)
                                Else
                                    PlainBaSket scr, prive, Trim$(Str$(p))
                                End If
                        Else
                      s$ = Format$(p, .FTXT)
            If Not NoUseDec Then
            If InStr(s$, NowDec$) > 0 And InStr(.FTXT, ".") > 0 Then
                s$ = Replace$(s$, NowDec$, Chr(2))
                s$ = Replace$(s$, NowThou$, ",")
                s$ = Replace$(s$, Chr(2), ".")
            
            End If
            End If
      
                            PlainBaSket scr, prive, s$
                        End If
                End If
        Else
             If Uni(f) Then
            putUniString f, s$
            Else
            putANSIString f, s$
        ' Print #f, S$;
        End If
        End If
    Case 7
        If par Then
        If s$ <> "" Then
           If .FTEXT > 3 Then
            W3 = 0
             x1 = .curpos
             y1 = .currow
            If Not work Then LCTbasketCur scr, prive
              If .FTXT <> "" Then s$ = Format$(s$, .FTXT)
                        If .FTEXT > 4 And Not work Then scr.CurrentX = scr.CurrentX + (.Xt - TextWidth(scr, Left$(s$, 1))) \ 2
                        wwPlain basestack, prive, s$, scr.Width, 0, , True, 0, , W3
                        work = True
                       scr.CurrentX = W3
            Else
                If .FTXT <> "" Then
                PlainBaSket scr, prive, Format$(s$, .FTXT)
                Else
                PlainBaSket scr, prive, s$
                End If
                
            End If
        Else

          
        End If
   
        Else
             If Uni(f) Then
            putUniString f, s$
            Else
            putANSIString f, s$
        ' Print #f, S$;
        End If
        End If
    End Select
    If FastSymbol(rest$, ",") Then
W3 = 1
        pn& = 0
      ''  skiplast = False
        If opn& > 4 Then
        scr.CurrentX = scr.CurrentX + .Xt - dv15
        GetXYb scr, prive, .curpos, .currow
                        If work Then
                       .curpos = .curpos - ColOffset
                      If (.curpos Mod (.Column + 1)) <> 0 Then
                      .curpos = .curpos + (.Column + 1) - (.curpos Mod (.Column + 1)) + ColOffset
                      Else
                       .curpos = .curpos + ColOffset
                      End If
                      If W4 Then LCTbasketCur scr, prive
                       End If
                       
                       work = True
                       Else
                       work = False
        End If
        opn& = 0
        Do While FastSymbol(rest$, ",")
            If par Then
            ' ok I want that
            If .Column > .mx And .FTEXT < 4 Then
            
            Else

            If Not W4 Then
            If Not skiplast Then crNew basestack, prive
            End If
            End If
            Else
                 If Uni(f) Then
            putUniString f, vbCrLf
            Else
            putANSIString f, vbCrLf
            'Print #f,
            End If
            End If
            
        Loop

    End If
    
players(basketcode) = prive
Loop
'
''If Not extreme Then If Not basestack.toprinter Then MyDoEvents2 scr
''If scr.CurrentX <> 0 Then scr.CurrentX = ((scr.CurrentX \ .Xt) + 1) * .Xt

If W4 <> 0 Then
        .FTEXT = oldFTEXT
        .FTXT = oldFTXT
        .Column = oldCol
        If .mypen <> oldpen Then .mypen = oldpen: TextColor scr, oldpen
        Else
        If pn& > 4 And opn& = 0 Then
        
                 If pn& < 99 Then
                 If work Then
                 .lastprint = False
                 End If
                 If Not skiplast Then crNew basestack, prive
                 End If
        ElseIf .currow >= .My Or (W3 < 0 And pn& = 0) Then
              crNew basestack, prive
              LCTbasketCur scr, prive
        ElseIf pn& > 4 Then
       
        End If

End If
EXITNOW:
If basestack.IamThread Then
' let thread do the refresh
Else
If Not extreme Then
    If uintnew(timeGetTime) > k1 Then RRCOUNTER = 0
            
            If RRCOUNTER = 0 Then
            k1 = uintnew(timeGetTime + REFRESHRATE): RRCOUNTER = 1
         If scr.Visible Then scr.Refresh
                  End If
End If
End If
RevisionPrint = True
players(basketcode) = prive
If par Then If myexit(basestack) Then RevisionPrint = True: Exit Function

End With
End Function

Private Function SpeedGroup(bstack As basetask, pppp As mArray, Prefix$, ByVal w$, b$, v As Long) As Long
Dim Vars As Long, vname As Long, y1 As Long, subs As Long, snames As Long, i As Long, ec$, ohere$, p As Double
Dim depth As Long, loopthis As Boolean, subspoint As Boolean, RetStackSize As Long

Dim kolpo As Boolean, bb$, Once As Boolean, dd As Variant
Vars = var2used: vname = varhash.count
subs = sb2used: snames = subHash.count
Dim mm As mStiva, tempRef As Object
If Prefix = "VAL" Then
' we stand as right value...
If pppp Is Nothing Then Exit Function
ec$ = w$ + ")"
If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))

        
        y1 = GlobalVar(w$, 0, here$ = "")

        UnFloatGroup bstack, w$, y1, pppp.item(v)
        
        var(y1).FloatGroupName = ec$
       Dim r As Double, bs As New basetask
        b$ = w$ + b$
       If IsNumber(bstack, b$, r) Then
         
            SpeedGroup = 1
            
            CopyGroup var(y1), bs
            
            Set tempRef = pppp.item(v).Link
            Set pppp.item(v) = bs.lastobj
            Set pppp.item(v).LinkRef = tempRef
            Set bs.lastobj = Nothing
                   If bstack.lastobj Is Nothing Then
                        bstack.LastValue = r
                Else
                        bstack.LastValue = CDbl(0)
                    GoTo fastexit
                End If
        End If
     Set bstack.lastobj = Nothing
         GoTo fastexit

ElseIf Prefix = "VAL$" Then
ec$ = w$ + ")"
' we stand as right value...
If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))

   
        y1 = GlobalVar(w$, 0)
          i = GlobalVar(w$ + "$", CStr(""))
        UnFloatGroup bstack, w$, y1, pppp.item(v)
        var(y1).FloatGroupName = ec$
        b$ = vbCrLf + w$ + "$=" + w$ + b$
     SpeedGroup = Execute(bstack, b$, True)
    CopyGroup var(y1), bstack
       Set tempRef = pppp.item(v).Link
      Set pppp.item(v) = bstack.lastobj
      Set pppp.item(v).LinkRef = tempRef
    Set bstack.lastobj = Nothing
  
        bstack.LastValue = CStr(var(i))
        GoTo fastexit
ElseIf Prefix = "FOR" Then
RetStackSize = bstack.RetStackTotal
    If v = -1 Then
    w$ = myUcase(w$)
        y1 = 0
        If w$ = "THIS" Or w$ = "ΑΥΤΟ" Then
        If bstack.UseGroupname <> "" Then
        'w$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
        Else
        
        End If
        w$ = "THIS"  ' look this other time..
        End If
            bstack.MoveNameDot w$
       
    Else
        If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))
        Set dd = New Group
         y1 = GlobalVar(w$, dd)
        UnFloatGroup bstack, w$, y1, pppp.item(v)
        bstack.MoveNameDot myUcase(w$)
    End If

Set mm = New mStiva
mm.DataVal CDbl(y1)
mm.DataVal CDbl(v)
Do While FastSymbol(b$, ",")
i = IsLabelDot("", b$, w$)
If i = 5 Then
w$ = myUcase(w$)
                    If neoGetArray(bstack, w$, pppp) Then

                            If NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
                                    If Typename(pppp.item(v)) = "Group" Then
                                             w$ = pppp.CodeName + CStr(v)
                                                Set dd = New Group
                                                 y1 = GlobalVar(w$, dd)
                                                UnFloatGroup bstack, w$, y1, pppp.item(v)
                                                bstack.MoveNameDot myUcase(w$)
                                                depth = depth + 1
                                                mm.DataVal CDbl(y1)
                                                mm.DataVal CDbl(v)
                                    Else
                                                MissingGroup
                                                GoTo normalexit
                                    End If
                            Else
                                SyntaxError
                                GoTo normalexit
                            End If
                    Else
                            NotExistArray
                            GoTo normalexit
                    End If
ElseIf i = 1 Then
w$ = myUcase(w$)

mm.DataVal CDbl(0)
mm.DataVal CDbl(-1)
        If w$ = "THIS" Or w$ = "ΑΥΤΟ" Then
        If bstack.GroupName = "" Then w$ = ""
        End If

bstack.MoveNameDot myUcase(w$)
        depth = depth + 1
Else
        SyntaxError
        GoTo normalexit
End If
Loop

If FastSymbol(b$, "{") Then

     ec$ = vbCrLf + NLtrim$(block(b$))
  
        If Len(ec$) > 2 Then
                SpeedGroup = 1
                kolpo = False
                Once = True
                i = 1
                ohere$ = here$
                Do
                    bb$ = Mid$(ec$, i)
subsentry10:
                    kolpo = False
                    Select Case Execute(bstack, bb$, kolpo, False, loopthis)   ' this is a major point
                    Case 0
                            b$ = bb$ & b$
                            SpeedGroup = 0
                            Set bstack.lastobj = Nothing
                            GoTo normalexit
                    Case 1
                        If LastErNum <> 0 Then
                   b$ = ""
                    End If

                                  If FastSymbol(b$, "}") Then
                                   If Once Then Exit Do
                                   Else
                                   b$ = Right$(ec$, Len(bb$)) + b$
                                ''   MyDoEvents
                                   End If
                                    here$ = ohere$
                                   Exit Do
                      Case 2
                            If Not kolpo Then
                                      i = 1
                    If bb$ <> "" Then
                            If bb$ = Chr$(0) Then
                                       If RetStackSize = bstack.RetStackTotal And bstack.RetStack.LookTopVal < 0 Then
                                        ' this is a return form other block
                                         SpeedGroup = 2
                                        b$ = bb$
                                        GoTo fastexit
                                        End If
                                    If bstack.IsInRetStackNumber(p) Then
                                                       If LastErNum = -1 Then
                                                                bstack.RetStack.PushVal p
                                                                SpeedGroup = 0
                                                                GoTo fastexit
                                                        End If
                                                        If p < -1 Then
                                                                subspoint = True
                                                                bstack.IsInRetStackNumber p
                                                        
                                                                bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, Len(sbf(bstack.Parent.OriginalCode).sb) - CLng(p) + 1)
                                                        ElseIf p < 0 Then
                                                                subspoint = False
                                                                bstack.IsInRetStackNumber p
                                                        If bstack.RetStackTotal - RetStackSize <= 5 Then
                                                        i = Len(ec$) - CLng(p) + 1
     
                                                       bb$ = Mid$(ec$, i)
                                       

                                                        Else
                                                          If bstack.OriginalCode = 0 Then
                                                               bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, Len(sbf(bstack.Parent.OriginalCode).sb) - CLng(p) + 1)
                                                          Else
                                                               bb$ = Mid$(sbf(bstack.OriginalCode).sb, Len(sbf(bstack.OriginalCode).sb) - CLng(p) + 1)
                                                               End If
                                                               End If
                                                              
                                                              
                                                        End If
                                                
                                               PopStage bstack
                                       GoTo subsentry10
                                       
                                       
                                    ElseIf bstack.IsInRetStackString(bb$) Then
                                                                 If InStr(bb$, " ") > 0 Then
                                                                       If subspoint Then bstack.RetStack.PushVal -2 Else bstack.RetStack.PushVal -1
                                   
                                                                        If searchsub(sbf(bstack.OriginalCode).sb, bb$, i) Then
                                                                          subspoint = False
                                                                            If bb$ <> "" Then
                                                                                    bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(bstack.OriginalCode).sb, i)
                                                                            Else
                                                                                    bb$ = Mid$(sbf(bstack.OriginalCode).sb, i)
                                                                            End If
                                                       
                                                                            kolpo = False
                                                                            GoTo subsentry10
                                                                        ElseIf bstack.IamChild Then
                                                                        If searchsub(sbf(bstack.Parent.OriginalCode).sb, bb$, i) Then
                                                                         subspoint = True
                                                                            If bb$ <> "" Then
                                                                                    bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(bstack.Parent.OriginalCode).sb, i)
                                                                            Else
                                                                                    bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, i)
                                                                            End If
                                                       
                                                                            kolpo = False
                                                                            GoTo subsentry10
                                                                            
                                                                                   Else
                                                                        bstack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                                        Else
                                                                        bstack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                        End If
                                    End If
                             Else
                                    i = PosLabel(bb$, ec$)
                                              If i = 0 Or i > Len(ec$) Then
          b$ = bb$
     
          SpeedGroup = 2
          Exit Do
                                    Else
                                    bb$ = Mid$(ec$, i)
                                    GoTo subsentry10
                                    End If
                                    
                            End If
                            Else
                            loopthis = False
                            End If
                                               Else
                                               If kolpo Then b$ = "BREAK"
                                  Once = kolpo
                                
                                SpeedGroup = 2: Set bstack.lastobj = Nothing
                                  GoTo breakexit
                    End If

                            Case Else
                                    If FastSymbol(b$, "}") Then
      
                                   If Once Then Exit Do
                                     Else
                                   b$ = Right$(ec$, Len(bb$)) + b$
                                   End If
                                    here$ = ohere$
                                   Exit Do
                            
                            End Select
                            here$ = ohere$
                              If myexit(bstack) Then SpeedGroup = 1: Exit Do
                            Loop
            Else
              SpeedGroup = Abs(FastSymbol(b$, "}"))
            End If
  End If
breakexit:
        While mm.Total > 0
        y1 = mm.PopVal
        v = mm.PopVal
        If v <> -1 Then
                        CopyGroup var(y1), bstack
                         Set tempRef = pppp.item(v).Link
                        Set pppp.item(v) = bstack.lastobj
                         Set pppp.item(v).LinkRef = tempRef

      
        End If
        Wend
normalexit:
                bstack.DropNdot depth + 1
Else
i = w$ = "."
If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))


        Set dd = New Group
         y1 = GlobalVar(w$, dd)

        UnFloatGroup bstack, w$, y1, pppp.item(v)

        If Prefix <> "" Then
        If Prefix = "@READ" Then
           If i Then
         b$ = w$ + "." + b$
        Else
         b$ = w$ + " " + b$
         End If
        SpeedGroup = Abs(MyRead(1, bstack, b$, 1))
         GoTo CONTlastEtnum
        Else
        If i Then
         b$ = vbCrLf + Prefix + " " + w$ + "." + b$
        Else
         b$ = vbCrLf + Prefix + " " + w$ + " " + b$
         End If
         End If
         
         Else
        b$ = vbCrLf + w$ + "." + b$
        End If
        SpeedGroup = Execute(bstack, b$, True)
        
CONTlastEtnum:
If LastErNum <> 0 Then

If FK$(13) = "" Then FK$(13) = GetNextLine((sbf(bstack.OriginalCode).sb))
    End If
                        CopyGroup var(y1), bstack
                        Set tempRef = pppp.item(v).Link
                        Set pppp.item(v) = bstack.lastobj
                         Set pppp.item(v).LinkRef = tempRef

   
                        
                              Set bstack.lastobj = Nothing

Set var(y1) = New Group
End If

fastexit:

var2used = Vars
varhash.ReduceHash vname, var()

 sb2used = subs
 subHash.ReduceHash snames, sbf()
    

End Function
Public Sub Thing(w$, v$)
'' from w$ input this value V$...
'' general input
On Error Resume Next
Dim it As Long, pppp As mArray
If Len(w$) < 2 Then Exit Sub

If AscW(w$) = 65 Then
On Error Resume Next
Err.Clear
Set pppp = var(Split(Mid$(w$, 2))(0)) ''  "A...16charRef....ItemNo"
If Err.Number > 0 Then Exit Sub
it = val(Split(Mid$(w$, 2))(1))
If Typename(pppp.item(it)) = doc Then
pppp.item(it).textDoc = v$  ' no checked yet
Else
pppp.item(it) = pppp.item(it) + v$
End If
ElseIf AscW(w$) = 86 Then
it = val("0" & Mid$(w$, 2))          ''"VItemNo"
If Typename(var(it)) = doc Then
var(it).textDoc = v$    ' no checked yet
Else
var(it) = var(it) + v$
End If
Else
' CAN'T READ
End If
End Sub
Public Function MyTitle$(basestack As basetask)
Static PREVT$

' On Error GoTo t1
If exWnd = 0 Then
PREVT$ = ""
MyTitle$ = ""
Exit Function
End If
If PREVT$ <> nnn$ Then
PREVT$ = nnn$

Form1.view1_StatusTextChange11 basestack, Trim$(nnn$)

End If
MyTitle$ = Trim$(PREVT$)

Exit Function
T1:
MyTitle$ = "???"
End Function
Function PointPos(f$) As Long
Dim er As Long, er2 As Long
While FastSymbol(f$, Chr(34))
f$ = GetStrUntil(Chr(34), f$)
Wend
Dim i As Long, j As Long, oj As Long
If f$ = "" Then
PointPos = 1
Else
er = 3
er2 = 3
For i = 1 To Len(f$)
er = er + 1
er2 = er2 + 1
Select Case Mid$(f$, i, 1)
Case "."
oj = j: j = i
Case "\", "/", ":", Is = Chr(34)
If er = 2 Then oj = 0: j = i - 2: Exit For
er2 = 1
oj = j: j = 0
If oj = 0 Then oj = i - 1: If oj < 0 Then oj = 0
Case " ", ChrW(160)
If j > 0 Then Exit For
If er2 = 2 Then oj = 0: j = i - 1: Exit For
er = 1
Case "|", "'"
j = i - 1
Exit For
Case Is > " "
If j > 0 Then oj = j Else oj = 0
Case Else
If oj <> 0 Then j = oj Else j = i
Exit For
End Select
Next i
If j = 0 Then
If oj = 0 Then
j = Len(f$) + 1
Else
j = oj
End If
End If
While Mid$(f$, j, i) = " "
j = j - 1
Wend
PointPos = j
End If
End Function
Public Function ExtractType(f$, Optional JJ As Long = 0) As String
Dim i As Long, j As Long, d$
If FastSymbol(f$, Chr(34)) Then f$ = GetStrUntil(Chr(34), f$)
If f$ = "" Then ExtractType = "": Exit Function
If JJ > 0 Then
j = JJ
Else


j = PointPos(f$)
End If
d$ = f$ & " "
If j < Len(d$) Then
For i = j To Len(d$)
Select Case Mid$(d$, i, 1)
Case "/", "|", "'", " ", Is = Chr(34)
i = i + 1
Exit For
End Select
Next i
If (i - j - 2) < 1 Then
ExtractType = ""
Else
ExtractType = mylcasefILE(Mid$(d$, j + 1, i - j - 2))
End If
Else
ExtractType = ""
End If
End Function
Public Function LONGNAME(Spath As String) As String
LONGNAME = ExtractPath(Spath, , True)
End Function


Public Function ExtractPath(ByVal f$, Optional Slash As Boolean = True, Optional existonly As Boolean = False) As String
If f$ = "" Then Exit Function
Dim i As Long, j As Long, test$
test$ = f$ & " \/:": i = InStr(test$, " "): j = InStr(test$, "\")
If i < j Then j = InStr(test$, "/"): If i < j Then j = InStr(test$, ":"): If i < j Then Exit Function
If Right(f$, 1) = "\" Or Right(f$, 1) = "/" Then f$ = f$ & " a"
j = PointPos(f$)
If Mid$(f$, j, 1) = "." Then j = j - 1
If Len(f$) < j Then
If ExtractType(Mid$(f$, j) & "\.10") = "10" Then j = j - 1 Else Exit Function
Else

End If

j = j - Len(ExtractNameOnly(f$))
If j <= 3 Then
If Mid$(f$, 2, 1) = ":" Then
If Slash Then
ExtractPath = mylcasefILE(Left$(f$, 2)) & "\"
Else
ExtractPath = mylcasefILE(Left$(f$, 2))
End If
Else
ExtractPath = ""
End If
Else
If Slash Then
ExtractPath = mylcasefILE(Left$(f$, j))
Else
ExtractPath = mylcasefILE(Left$(f$, j - 1))
End If
End If

If existonly Then
ExtractPath = mylcasefILE(StripTerminator(GetLongName(ExpEnvirStr(ExtractPath))))
Else
ExtractPath = ExpEnvirStr(ExtractPath)
End If
Dim ccc() As String, c$
ccc() = Split(ExtractPath, "\..")
If UBound(ccc()) > LBound(ccc()) Then
c$ = ""
For i = LBound(ccc()) To UBound(ccc()) - 1
If ccc(i) = "" Then
c$ = ExtractPath(ExtractPath(c$, False))
Else
c$ = c$ & ExtractPath(ccc(i), True)
End If

Next i
If Left$(ccc(i), 1) = "\" Then
ExtractPath = c$ & Mid$(ccc(i), 2)
Else
ExtractPath = c$ & ccc(i)
End If
End If
End Function
Public Function ExtractName(f$) As String
Dim i As Long, j As Long, k$
If f$ = "" Then Exit Function
j = PointPos(f$)
If Mid$(f$, j, 1) = "." Then
k$ = ExtractType(f$, j)
Else
j = Len(f$)
End If
For i = j To 1 Step -1
Select Case Mid$(f$, i, 1)
Case Is < " ", "\", "/", ":"
Exit For
End Select
Next i
If k$ = "" Then
If Mid$(f$, i + j - i, 1) = "." Then
ExtractName = mylcasefILE(Mid$(f$, i + 1, j - i - 1))
Else
ExtractName = mylcasefILE(Mid$(f$, i + 1, j - i))

End If
Else
ExtractName = mylcasefILE(Mid$(f$, i + 1, j - i)) + k$
End If

'ExtractName = mylcasefILE(Trim$(Mid$(f$, I + 1, j - I)))

End Function
Public Function ExtractNameOnly(ByVal f$) As String
Dim i As Long, j As Long
If f$ = "" Then Exit Function
j = PointPos(f$)
If j > Len(f$) Then j = Len(f$)
For i = j To 1 Step -1
Select Case Mid$(f$, i, 1)
Case Is < " ", "\", "/", ":"
Exit For
End Select
Next i
If Mid$(f$, i + j - i, 1) = "." Then
ExtractNameOnly = mylcasefILE(Mid$(f$, i + 1, j - i - 1))
Else
ExtractNameOnly = mylcasefILE(Mid$(f$, i + 1, j - i))
End If
End Function
Public Function GetCurDir(Optional AppPath As Boolean = False) As String
Dim A$, cd As String

If AppPath Then
cd = App.path
AddDirSep cd
A$ = mylcasefILE(cd)
Else
AddDirSep mcd
A$ = mylcasefILE(mcd)

End If
'If Right$(a$, 1) <> "\" Then a$ = a$ & "\"
GetCurDir = A$
End Function
Public Function CFname(A$, Optional TS As Variant) As String
If Left$(A$, 4) = "cDIB" And Len(A$) > 12 Then Exit Function
Dim b$
Dim mDir As New recDir
Sleep 1
If A$ <> "" Then
On Error GoTo 1
b$ = mDir.Dir1(A$, GetCurDir)
If b$ = "" Then b$ = mDir.Dir1(A$, mDir.GetLongName(App.path))
If b$ <> "" Then CFname = mylcasefILE(b$): If Not IsMissing(TS) Then TS = CDbl(mDir.lastTimeStamp)

Exit Function
End If
1:
CFname = ""
End Function
Function rinstr(A As String, b As String, Optional ByVal fr As Long) As Long
Dim i
i = Len(A)
fr = i - fr
If fr < 0 Or fr > i Then fr = i + 1

If i > 0 Then rinstr = InStrRev(A, b, fr)
End Function
Function rinstrTxt(A As String, b As String, Optional ByVal fr As Long) As Long
' NOT USED....INSTRREV IS THE SANE...WITH VBTEXTCOMPARE
Dim i As Long, j As Long
fr = fr - Len(b) + 1
If fr < 0 Then fr = Len(A) + 1
Do
j = i
i = InStr(j + 1, A, b, vbTextCompare)

Loop Until i = 0 Or i > fr

rinstrTxt = j
End Function
Sub dset()

'USING the temporary path
    strTemp = String(MAX_FILENAME_LEN, Chr$(0))
    'Get
    GetTempPath MAX_FILENAME_LEN, StrPtr(strTemp)
    strTemp = LONGNAME(mylcasefILE(Left$(strTemp, InStr(strTemp, Chr(0)) - 1)))
    If strTemp = "" Then
     strTemp = mylcasefILE(Left$(strTemp, InStr(strTemp, Chr(0)) - 1))
    End If
' NOW COPY
' for mcd
Dim cd As String, dummy As Long, q$

''cd = App.Path
''AddDirSep cd
''mcd = mylcasefILE(cd)

' Return to standrad path...for all users
userfiles = GetSpecialfolder(CLng(26)) & "\M2000"
AddDirSep userfiles
If Not isdir(userfiles) Then
MkDir userfiles
End If

mcd = userfiles
NowDec$ = GetlocaleString(LOCALE_SDECIMAL)
NowThou$ = GetlocaleString(LOCALE_STHOUSAND)

CheckDec

End Sub
Public Sub CheckDec()


If NowDec$ = "." Then
NoUseDec = False
Else
NoUseDec = mNoUseDec
End If
End Sub
Public Function Originalusername()

Dim ss$
                 ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
If ss$ = "" Then
Originalusername = username
Else
Originalusername = GetStrUntil("\", ss$)
End If
End Function
Public Function IsSupervisor() As Boolean

Dim ss$
                 ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
IsSupervisor = ss$ = ""
End Function


Public Function UserPath() As String

Dim ss$
                 ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
        If ss$ <> "" Then
        If CanKillFile(mcd) Then
        DropLeft "\", ss$
UserPath = Mid$(mcd, Len(userfiles) - Len(ss$) + 1)
If UserPath = "" Then
UserPath = "."
End If
Else
UserPath = mcd
End If
Else
UserPath = mcd
End If
End Function
Public Function UserPath2() As String

Dim ss$
                 ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
        If ss$ <> "" Then
        If CanKillFile(mcd) Then
        DropLeft "\", ss$
UserPath2 = Mid$(mcd, Len(userfiles) - Len(ss$) + 1)
If UserPath2 = "" Then
UserPath2 = "."
End If
Else
UserPath2 = mcd
End If
Else
UserPath2 = mcd
End If
If Right$(UserPath2, 1) = "\" Then UserPath2 = Left$(UserPath2$, Len(UserPath2$) - 1)


End Function
Public Function username()
Dim A$, b$, c$
A$ = GetSpecialfolder(0)
While A$ <> ""
c$ = b$
b$ = GetStrUntil("\", A$)
Wend
username = c$
End Function
Public Function ScanTarget(j() As target, ByVal x As Long, ByVal y As Long, ByVal MyL As Long) As Long
Dim iu&, Id&, i&, XX&, YY&

iu& = LBound(j())
Id& = UBound(j())
ScanTarget = -1
For i& = iu& To Id&
With j(i&)
If .enable And .layer = MyL Then
XX& = x \ .Xt
YY& = y \ .Yt
If .Lx <= XX& And .tx >= XX& And .ly <= YY& And .ty >= YY& Then
ScanTarget = i&
Exit For
End If
End If
End With
Next i&
End Function
Public Sub DisableTargets(j() As target, ByVal MyL As Long)
Dim iu&, Id&, i&
iu& = LBound(j())
Id& = UBound(j())
For i& = iu& To Id&
 If j(i&).layer = MyL Then j(i&).enable = False
Next i&
End Sub

Function RMAX(ByVal q As Single, ByVal w As Single) As Single
If q > w Then
RMAX = q
Else
RMAX = w
End If
End Function

Function RMIN(ByVal q As Single, ByVal w As Single) As Single
If q < w Then
RMIN = q
Else
RMIN = w
End If
End Function


Function BoxTarget(DSTACK As basetask, ByVal xl&, ByVal yl&, ByVal b As Long, ByVal f As Long, ByVal Tag$, ByVal Id&, ByVal COM$, XXT&, YYT&, Linespace&) As target
Dim x&, y&, d As Object
Set d = DSTACK.Owner
Dim prive As basket
prive = players(GetCode(d))
With prive

x& = .curpos
y& = .currow
xl& = xl& + x&
yl& = yl& + y& - 1
With BoxTarget
.SZ = prive.SZ
.Comm = COM$
.Id = Id&
.Tag = Tag$
.Lx = x&
.ly = y&
.tx = xl& - 1
.ty = yl&
.back = b
.fore = f
.enable = True
.Pen = prive.mypen
.Xt = XXT&
.Yt = YYT&
.sUAddTwipsTop = prive.uMineLineSpace
If d.name = "DIS" Then
.layer = 0
ElseIf d.name = "Form1" Then
.layer = -1
ElseIf d.name = "dSprite" Then
.layer = d.index
End If
End With
If f <> -1 Then BoxBigNew d, prive, xl& - 1, yl&, f
If b <> -1 Then BoxColorNew d, prive, xl& - 1, yl&, b
If Id& < 100 Then
    Tag$ = Left$(Tag$, xl& - x&)
    If Tag$ <> "" Then
    
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    Select Case Id& Mod 10
    Case 2, 5, 8
    x& = (xl& + x& - Len(Tag$)) \ 2
    Case 3, 6, 9
    x& = xl& - Len(Tag$)
    Case Else
    End Select
    If (Id& Mod 10) > 0 Then
    LCTbasket d, prive, y&, x&
    d.FontTransparent = True
    PlainBaSket d, prive, Tag$, True, True
    LCTbasket d, prive, BoxTarget.ly, BoxTarget.Lx
    End If
    End If
Else
    If Tag$ <> "" Then
    Id& = Id& Mod 100
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    f = 3
    Select Case Id& Mod 10
    Case 2, 5, 8
    f = 2
    Case 3, 6, 9
    f = 1
    Case Else
    End Select
    
    If (Id& Mod 10) > 0 Then
    LCTbasket d, prive, y&, x&
    d.FontTransparent = True
    d.CurrentX = d.CurrentX - dv15 * 2
    wwPlain DSTACK, prive, Tag$, xl& - x&, 10000, , True, f, , , True
    LCTbasket d, prive, BoxTarget.ly, BoxTarget.Lx
    End If
End If
    
End If
End With
End Function
Public Function GetTaskId() As Long
taskid = taskid + 1
If taskid = 10000 Then taskid = 1
GetTaskId = taskid

End Function
Sub Dispose()
'use strtemp
On Error Resume Next
Dim r$
While ISSTRINGA(kill2$, r$)
KillFile strTemp + r$
Wend
End Sub
'' this is from Trick (VbForums)
Sub Proto1(ByVal addr As Long, basestack As basetask, rest$, lang As Long, resp As Boolean)
End Sub

Sub Main()
''
'' If App.StartMode = vbSModeStandalone Then NeoSubMain
Dim m As New Callback

m.Run "start"
If m.Status = 0 Then
m.Cli Form1.commandW, ">"
m.Reset
End If
m.ShowGui = False
Debug.Print "ok"
 
End Sub
Public Sub NeoSubMain()
' need to read registry form sub main
On Error Resume Next
'' ADDITION
RandomizeIt rndbase, 0
Set ObjectCatalog = New FastCollection
LCID_DEF = LCID_def1()
If dv15 <> 0 Then
l_complete = False
s_complete = False
DisableProcessWindowsGhosting
Set HelpStack = New basetask
Set oprinter = New cDIBSection
Set basestack1.Sorosref = globalstack
Set subHash = New sbHash
Set varhash = New Hash
Set comhash = New sbHash
Set numid = New sbHash
Set funid = New sbHash
Set strid = New sbHash
Set strfunid = New sbHash
GoTo there
End If
dv15 = 1440 / DpiScrX
DisableProcessWindowsGhosting
'' BY DEAFULT IS FALSE
priorityOr = False  '  TRUE OR FALSE AND FALSE GIVE -1 BECAUSE OR AND XOR PROCESS LEFT FIRST TRUE OR ( FALSE AND FALSE)
'' WITH priorityOr = FALSE WE HAVE FLAT SYSTEM.........TRUE OR FALSE AND FALSE GIVE 0
OperatingSystem
 dv20 = 24.5
Randomize CDbl(timeGetTime)
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
JetPostfix = JetPostfixHelp
JetPrefix = JetPrefixHelp
 
basickey = "Software\m2000v4\"
' by default
'AddTwipsTop = 4 * Screen.TwipsPerPixelY
casesensitive = False
pagio$ = "LATIN"
pagiohtml$ = "DARK"
REFRESHRATE = 40
SizeDialog = 1
helpSizeDialog = 1
Settings = "time,normal,push"
selectorLastX = ScrX() / 4
selectorLastY = ScrY() / 4
AskLastX = ScrX() / 4
AskLastY = ScrY() / 4
sb2used = 0
ReDim sbf(500) As modfun
var2used = 0
ReDim var(3000) As Variant
   StartingRes
   'Dim iccex As tagInitCommonControlsEx
   'With iccex
     ' .lngSize = LenB(iccex)
    '  .lngICC = ICC_USEREX_CLASSES
   'End With
   'InitCommonControlsEx iccex

clickMe2 = -1


''Dim soros As New mStiva
Dim t As Long
ReDim q(0) As target

Set basestack1.Sorosref = globalstack

taskid = 999
DisableMidi
beat = 400 ' beat of 1/16
baseNote = 23
octava = 4
NOTA = 0
ENTASI = 127   '' volume
voices(0) = "CC#"
there:
Randomize
allcommands comhash
NumberId numid, funid
StringId strid, strfunid
Set TaskMaster = New TaskMaster
TaskMaster.Interval = 5
beeperBEAT = 300
MediaPlayer1.FileName = ""
defFontname = "Verdana"
my_system = OperatingPlatform
vol = 50
MediaPlayer1.setLeftVolume vol * 10
MediaPlayer1.setRightVolume vol * 10
deep = 10000
' funcdeep set in something
' step one we show the first form
'Form1.Show , Form5
ReDim MyDM(1 To 1) As Byte
DXP = Screen.TwipsPerPixelX
DYP = Screen.TwipsPerPixelY
Load Form5
' Load Form1
' Form1.Hide
If Not l_complete Then
'MsgBox "Loading of Form1 not complete"
Exit Sub
'End
Else
Form1.something
'If Not App.StartMode = vbSModeStandalone Then Exit Sub

'terminatefinal
End If
End Sub
Sub TerminateM2000()
NoAction = False
DelTemp
'Set DisStack.Owner = Nothing

Set basestack1.Owner = Nothing

Set LastGlist = Nothing
Set LastGlist2 = Nothing
Unload Form5
End Sub
Public Sub terminatefinal()
Set globalstack = Nothing
Set basestack1 = Nothing
CloseAllConnections  ' new for ADO we keep objects not the connections
CleanupLibHandles
'If Not s_complete Then
'MsgBox "Language can't go Up"

'End If
'End
s_complete = False
l_complete = False
End Sub

Function IsExp(basestack As basetask, A$, r As Double, Optional ByVal noand1 As Boolean = True) As Boolean
Dim par As Long
If LastErNum = -2 Then LastErNum = 0
IsExp = IsExpA(basestack, A$, r, par, noand1)
If LastErNum = -2 Then IsExp = False
If par > 0 Then IsExp = False
End Function
Function IsExpA(bstack As basetask, aa$, rr As Double, parenthesis As Long, Optional ByVal noand As Boolean = True) As Boolean
Dim r As Double, ac As Double, po As Double, MUL As Long, r1 As Double
Dim logic As Boolean, l As Boolean

IsExpA = False
If aa$ = "" Then Exit Function
rr = 0
Do While FastSymbol(aa$, "(")
parenthesis = parenthesis + 1
Loop
po = 1
ac = 0
' sign

Do
' first loop remove sign(s)
    Do
    If FastSymbol(aa$, "-") Then
            po = -po
        ElseIf Not FastSymbol(aa$, "+") Then
            Exit Do
        End If
    Loop
again:
    If logical(bstack, aa$, r) Then
        IsExpA = True
        po = po * r
    ElseIf FastSymbol(aa$, "(") Then
                            If IsExp(bstack, aa$, r) Then
                                IsExpA = True
                                po = po * r
                                If Not FastSymbol(aa$, ")") Then
                                    IsExpA = False
                                    Exit Function
                                End If
                            End If
    Else
    
    IsExpA = False
    Exit Function

   End If

r1 = 1
MUL = 0
''second  loop Logic...
Do
  If Fast2Symbol(aa$, "**", 2, "^", 1) Then
            ' get from right number or expression
            If IsNumber(bstack, aa$, r) Then ' κοιτάμε αν είναι αριθμός ή μεταβλητή
                po = po ^ r
            ElseIf FastSymbol(aa$, "(") Then  ' πρώτα ανοίγει την παρένθεση ώστε να μην προχωρήσει όταν η IsExp βρεί την παρένθεση )
                If IsExp(bstack, aa$, r) Then ' Τώρα ψάχνουμε για παράσταση (η IsExp κάλεση την IsExpA και τώρα καλούμε νέα IsExp
                    po = po ^ r
                    If Not FastSymbol(aa$, ")") Then ' Την οποία την ψάχνουμε  εμείς και την πετάμε
                        IsExpA = False
                        Exit Function
                    End If
                End If
            Else
                IsExpA = False
                Exit Function
            End If
    
    ElseIf MUL > 0 Then
            ' do it before we find next / or *
            Select Case MUL
            Case 500
            bstack.soros.DataVal r1
             r1 = 1
            Case 1
                po = r1 * po
            
            Case 2
                If po = 0 Then
                    'DIVISION BY ZERO
                
                    MyErMacro aa$, "division by zero", "διαίρεση με το μηδέν"
                
                    IsExpA = False
                    Exit Function
                Else
                    po = r1 / po
                End If
            Case 3
                po = r1 * po
            Case 4
                If Int(po) = 0 Then
                    'DIVISION BY ZERO
                    MyErMacro aa$, "division by zero", "διαίρεση με το μηδέν"
                    IsExpA = False
                    Exit Function
                Else
                    po = Int(Int(r1) / Int(po))
                End If
            Case 5
                If Int(po) = 0 Then
                    'DIVISION BY ZERO
                    MyErMacro aa$, "division by zero", "διαίρεση με το μηδέν"
            
                    IsExpA = False
                    Exit Function
                Else
                    po = Sgn(r1) * (Int(Abs(r1)) - Int(Int(Abs(r1) / Abs(Int(po))) * Abs(Int(po))))
                End If
            End Select
            r1 = 1
            MUL = 0
             
    ElseIf FastSymbol(aa$, "*") Then
            If logical(bstack, aa$, r) Then
                MUL = 1
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 1
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                End If
            Else
                IsExpA = False
                Exit Function
            End If
    ElseIf FastSymbol(aa$, "/") Then
            If logical(bstack, aa$, r) Then
                MUL = 2
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 2
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                End If
            Else
                IsExpA = False
                Exit Function
            End If
     ElseIf MaybeIsSymbol(aa$, "DMΔΥdmδυ") Then
              If Fast2Label(aa$, "DIV", 3, "ΔΙΑ", 3, "", 0, 4) Then
                    If logical(bstack, aa$, r) Then
                        MUL = 4
                        r1 = po
                        po = r
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r) Then
                            MUL = 4
                            r1 = po
                            po = r
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                        End If
                    Else
                        IsExpA = False
                        Exit Function
                    End If
        ElseIf Fast2Label(aa$, "MOD", 3, "ΥΠΟΛΟΙΠΟ", 8, "ΥΠΟΛ", 4, 9) Then
        
                    If logical(bstack, aa$, r) Then
                        MUL = 5
                        r1 = po
                        po = r
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r) Then
                            MUL = 5
                            r1 = po
                            po = r
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                        End If
                    Else
                        IsExpA = False
                        Exit Function
                    End If
        Else
         logic = True
         Exit Do
        End If
ElseIf MaybeIsSymbol(aa$, "AΑXΚΗOαaxκηoήΉ") And noand Then
If Fast2Label(aa$, "XOR", 3, "ΑΠΟ", 3, "", 0, 4) Then
'  good
  MUL = 3
    If priorityOr Then
       If IsExp(bstack, aa$, r) Then
            po = (ac + po)
            If po <> 0 Then po = -1
            If r <> 0 Then r = -1
            po = po Xor r
            ac = 0
        End If
    Else
        If FastSymbol(aa$, "(") Then
            If IsExp(bstack, aa$, r) Then
                po = (ac + po)
                If po <> 0 Then po = -1
                If r <> 0 Then r = -1
                po = po Xor r
                ac = 0
                If Not FastSymbol(aa$, ")") Then
                    IsExpA = False: Exit Function
                End If
           Else
                IsExpA = False: Exit Function
            End If
        ElseIf IsExp(bstack, aa$, r, False) Then
            po = (ac + po)
            If po <> 0 Then po = -1
            If r <> 0 Then r = -1
            po = po Xor r
            ac = 0
        Else
            IsExpA = False
            Exit Function
        End If
    End If

ElseIf Fast2Label(aa$, "OR", 2, "Η", 1, "", 0, 2) Then
'  good
  MUL = 3
If priorityOr Then
    If IsExp(bstack, aa$, r) Then
    po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
    End If
Else
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
    po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
     
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
     po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
End If

ElseIf Fast2Label(aa$, "AND", 3, "ΚΑΙ", 3, "", 0, 3) Then
'  good
  MUL = 3
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
    po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po And r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
     po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po And r
     ac = 0
 End If
Else
logic = True
Exit Do
 End If
ElseIf FastSymbol(aa$, ")") Then
            If parenthesis > 0 Then
                parenthesis = parenthesis - 1
                po = ac + po
                ac = 0
            Else
                aa$ = ")" & aa$
                rr = ac + po
                Exit Function
            End If
ElseIf FastSymbol(aa$, "<>", , 2) Then
'  good
  MUL = 3
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) <> r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) <> r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
 
ElseIf FastSymbol(aa$, "<=", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) <= r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) <= r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If

ElseIf FastSymbol(aa$, ">=", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) >= r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) >= r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf FastSymbol(aa$, "<<", , 2) Then
If logical(bstack, aa$, r) Then
                MUL = 500
               
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 1
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                End If
            Else
                IsExpA = False
                Exit Function
            End If
ElseIf FastSymbol(aa$, ">") Then
'  good
  MUL = 3
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) > r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
        
ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) > r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
    
ElseIf FastSymbol(aa$, "<") Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) < r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) < r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf FastSymbol(aa$, "==", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
    If r = 0 Then
            po = (ac + po)
            If po = 0 Then
                po = True
            Else
                po = MyRound(po, 10) = 0
            End If
    Else
  po = MyRound((((ac + po) - r) / r), 10) = 0
  End If
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
    If r = 0 Then
            po = (ac + po)
            If po = 0 Then
                po = True
            Else
                po = MyRound(po, 10) = 0
            End If
    Else
  po = MyRound((((ac + po) - r) / r), 10) = 0
  End If
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If

ElseIf FastSymbol(aa$, "=") Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
  po = (ac + po) = r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False) Then
  po = (ac + po) = r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf MaybeIsTwoSymbol(aa$, "->", 2) Then
logic = True
Exit Do
ElseIf FastSymbol(aa$, "-") Then
  ' second parameter push old value to ac
  ' get new one to r
  ' check if we have string logical
  ' or we have parenthesis (....
  ' or just a perform a -1*
If logical(bstack, aa$, r) Then
    r1 = -r1
    MUL = 3
    ac = ac + po
    po = r
    
 ElseIf FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
    r1 = -r1
    MUL = 3
    ac = ac + po
    po = r
    If Not FastSymbol(aa$, ")") Then
    IsExpA = False
    Exit Function
    End If
    End If
  Else
    r1 = -r1
  End If
ElseIf FastSymbol(aa$, "+") Then
If logical(bstack, aa$, r) Then
    
    MUL = 3
    ac = ac + po
    po = r
    ElseIf FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r) Then
    MUL = 3
    ac = ac + po
    po = r
    If Not FastSymbol(aa$, ")") Then
    IsExpA = False
    Exit Function
    End If
    End If
    
End If

Else
logic = True
Exit Do
End If
Loop
ac = ac + po
po = 1
Loop Until logic

rr = ac

Do While parenthesis > 0
If FastSymbol(aa$, ")") Then
parenthesis = parenthesis - 1
Else
Exit Do
End If
Loop
End Function
Function IsNumberA(A$, k As Long) As Boolean
If A$ <> "" Then
k = val("0" & Left$(A$, InStr(2, A$ & " ", " ") - 1))


A$ = Mid$(A$, InStr(2, A$ & " ", " "))
IsNumberA = True
Else
IsNumberA = False
End If
End Function

Function IsNumberD(A$, d As Double) As Boolean
Dim a1 As Long
If A$ <> "" Then
For a1 = 1 To Len(A$) + 1
Select Case Mid$(A$, a1, 1)
Case " ", ",", ChrW(160)
If a1 > 1 Then Exit For
Case Is = Chr(2)
If a1 = 1 Then Exit Function
Exit For
End Select
Next a1
If a1 > Len(A$) Then a1 = Len(A$) + 1
d = CDbl(val("0" & Left$(A$, a1 - 1)))
A$ = Mid$(A$, a1)
IsNumberD = True
Else
IsNumberD = False
End If
End Function
Function IsNumberLabel(A$, Label$) As Boolean
Dim a1 As Long, LI As Long, a2 As Long
LI = Len(A$)
' No zero number.
' First 1....9
' second ...to fifth (0 to 9) 99999 is the maximum
'
If LI > 0 Then
a1 = 1

While Mid$(A$, a1, 1) = " ": a1 = a1 + 1: Wend
' we start from a1
a2 = a1
If a1 > LI Then A$ = "": Exit Function
If LI > 5 + a2 Then LI = 4 + a2
If Mid$(A$, a1, 1) Like "[0-9]" Then
Do While a1 <= LI
a1 = a1 + 1
If Not Mid$(A$, a1, 1) Like "[0-9]" Then Exit Do

Loop
Label$ = Mid$(A$, a2, a1 - a2): A$ = Mid$(A$, a1)
IsNumberLabel = True
End If

End If
End Function
Function IsNumberQuery(A$, fr As Long, r As Double, lR As Long) As Boolean
Dim SG As Long, sng As Long, n$, ig$, DE$, sg1 As Long, ex$   ', e$
' ti kanei to e$
If A$ = "" Then IsNumberQuery = False: Exit Function
SG = 1
sng = fr - 1
    Do While sng < Len(A$)
    sng = sng + 1
    Select Case Mid$(A$, sng, 1)
    Case " ", "+", ChrW(160)
    Case "-"
    SG = -SG
    Case Else
    Exit Do
    End Select
    Loop
n$ = Mid$(A$, sng)

If val("0" & Mid$(A$, sng, 1)) = 0 And Left(Mid$(A$, sng, 1), sng) <> "0" And Left(Mid$(A$, sng, 1), sng) <> "." Then
IsNumberQuery = False

Else
'compute ig$
    If Mid$(A$, sng, 1) = "." Then
    ' no long part
    ig$ = "0"
    DE$ = "."

    Else
    Do While sng <= Len(A$)
        
        Select Case Mid$(A$, sng, 1)
        Case "0" To "9"
        ig$ = ig$ & Mid$(A$, sng, 1)
        Case "."
        DE$ = "."
        Exit Do
        Case Else
        Exit Do
        End Select
       sng = sng + 1
    Loop
    End If
    ' compute decimal part
    If DE$ <> "" Then
      sng = sng + 1
        Do While sng <= Len(A$)
       
        Select Case Mid$(A$, sng, 1)
        Case " ", ChrW(160)
        If Not (sg1 And Len(ex$) = 1) Then
        Exit Do
        End If
        Case "0" To "9"
        If sg1 Then
        ex$ = ex$ & Mid$(A$, sng, 1)
        Else
        DE$ = DE$ & Mid$(A$, sng, 1)
        End If
        Case "E", "e" ' ************check it
             If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
   
               Case "Ε", "ε" ' ************check it
                         If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        
        
        Case "+", "-"
        If sg1 And Len(ex$) = 1 Then
         ex$ = ex$ & Mid$(A$, sng, 1)
        Else
        Exit Do
        End If
        Case Else
        Exit Do
        End Select
         sng = sng + 1
        Loop
        If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then
        sng = sng - Len(ex$)
        End If
    End If
    If ig$ = "" Then
    IsNumberQuery = False
    lR = 1
    Else
    If SG < 0 Then ig$ = "-" & ig$
    Err.Clear
    On Error Resume Next
    If Len(ex$) = 1 Then
    n$ = ig$ & DE$ & ex$ + "1"
     If IsExp(basestack1, n$, r) Then
    sng = Len(ig$ & DE$ & ex$) - Len(n$)
        fr = 0
    End If
       Else
    n$ = ig$ & DE$ & ex$
    If IsExp(basestack1, n$, r) Then
    sng = Len(ig$ & DE$ & ex$) - Len(n$)
        fr = 0
    Else
    End If
    r = val(ig$ & DE$ & ex$)
    End If
    If Err > 0 Then
    lR = 0
    Else
      'A$ = Mid$(A$, sng)
    lR = sng - fr + 1
       IsNumberQuery = True
    End If
    End If
End If
End Function


Function IsNumberOnly(A$, fr As Long, r As Double, lR As Long) As Boolean
Dim SG As Long, sng As Long, n$, ig$, DE$, sg1 As Long, ex$   ', e$
' ti kanei to e$
If A$ = "" Then IsNumberOnly = False: Exit Function
SG = 1
sng = fr - 1
    Do While sng < Len(A$)
    sng = sng + 1
    Select Case Mid$(A$, sng, 1)
    Case " ", "+", ChrW(160)
    Case "-"
    SG = -SG
    Case Else
    Exit Do
    End Select
    Loop
n$ = Mid$(A$, sng)

If val("0" & Mid$(A$, sng, 1)) = 0 And Left(Mid$(A$, sng, 1), sng) <> "0" And Left(Mid$(A$, sng, 1), sng) <> "." Then
IsNumberOnly = False

Else
'compute ig$
    If Mid$(A$, sng, 1) = "." Then
    ' no long part
    ig$ = "0"
    DE$ = "."

    Else
    Do While sng <= Len(A$)
        
        Select Case Mid$(A$, sng, 1)
        Case "0" To "9"
        ig$ = ig$ & Mid$(A$, sng, 1)
        Case "."
        DE$ = "."
        Exit Do
        Case Else
        Exit Do
        End Select
       sng = sng + 1
    Loop
    End If
    ' compute decimal part
    If DE$ <> "" Then
      sng = sng + 1
        Do While sng <= Len(A$)
       
        Select Case Mid$(A$, sng, 1)
        Case " ", ChrW(160)
        If Not (sg1 And Len(ex$) = 1) Then
        Exit Do
        End If
        Case "0" To "9"
        If sg1 Then
        ex$ = ex$ & Mid$(A$, sng, 1)
        Else
        DE$ = DE$ & Mid$(A$, sng, 1)
        End If
        Case "E", "e" ' ************check it
             If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
   
               Case "Ε", "ε" ' ************check it
                         If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        
        
        Case "+", "-"
        If sg1 And Len(ex$) = 1 Then
         ex$ = ex$ & Mid$(A$, sng, 1)
        Else
        Exit Do
        End If
        Case Else
        Exit Do
        End Select
         sng = sng + 1
        Loop
        If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then
        sng = sng - Len(ex$)
        End If
    End If
    If ig$ = "" Then
    IsNumberOnly = False
    lR = 1
    Else
    If SG < 0 Then ig$ = "-" & ig$
    r = val(ig$ & DE$ & ex$)
      'A$ = Mid$(A$, sng)
    lR = sng - fr + 1
    IsNumberOnly = True
    End If
End If
End Function


Function IsNumberD2(A$, d As Double) As Boolean
' for inline stacitems
Dim a1 As Long
If A$ <> "" Then
For a1 = 1 To Len(A$) + 1
Select Case Mid$(A$, a1, 1)
Case " ", ChrW(160)
If a1 > 1 Then Exit For
Case Is = Chr(2)
If a1 = 1 Then Exit Function
Exit For
End Select
Next a1
If a1 > Len(A$) Then a1 = Len(A$) + 1
If IsNumberOnly(A$, 1, d, a1) Then
A$ = Mid$(A$, a1)
IsNumberD2 = True
Else
IsNumberD2 = False
End If
Else
IsNumberD2 = False
End If

End Function

Function IsNumberD3(A$, fr As Long, a1 As Long) As Boolean
' for inline stacitems
Dim d As Double
If A$ <> "" Then
For a1 = fr To Len(A$) + 1
Select Case Mid$(A$, a1, 1)
Case " ", ChrW(160)
If a1 > fr Then Exit For
Case Is = Chr(2)
If a1 = fr Then Exit Function
Exit For
End Select
Next a1
If a1 > Len(A$) Then a1 = Len(A$) + 1
If IsNumberOnly(A$, fr, d, a1) Then
IsNumberD3 = True
Else
a1 = fr
IsNumberD3 = False
End If
Else
a1 = fr
IsNumberD3 = False
End If

End Function

Sub tsekme()
Dim b$, l As Double
b$ = " 12323 45.44545 -2345.343 .345 345.E-45 34.53 434 534 534 534 345"
'b$ = ""
Debug.Print b$
While IsNumberD2(b$, l)
Debug.Print l
Wend
End Sub
Function IsNumberCheck(A$, r As Double) As Boolean
Dim sng&, SG As Double, ig$, DE$, sg1 As Boolean, ex$, s$
SG = 1
Do While sng& < Len(A$)
sng& = sng& + 1
Select Case Mid$(A$, sng&, 1)
Case "#"
    If Len(A$) > sng& Then
    If MaybeIsSymbolNoSpace(Mid$(A$, sng& + 1, 1), "[0123456789ABCDEFabcdef]") Then
    s$ = "0x00" + Mid$(A$, sng& + 1, 6)
    If Len(s$) < 10 Then Exit Function
        If IsNumberCheck(s$, r) Then
        If s$ <> "" Then
          
             
        Else
            s$ = Right$("00000000" & Mid$(A$, sng& + 1, 6), 8)
            A$ = Mid$(A$, sng& + 7)
   r = SG * -(CDbl(UNPACKLNG(Right$(s$, 2)) * 65536#) + CDbl(UNPACKLNG(Mid$(s$, 5, 2)) * 256#) + CDbl(UNPACKLNG(Mid$(s$, 3, 2))))
   IsNumberCheck = True
   Exit Function
        End If
        End If
        Else
        
    End If
    Else

    '' out
    End If
    Exit Function
Case " ", "+", ChrW(160)
Case "-"
SG = -SG
Case Else
Exit Do
End Select
Loop
A$ = Mid$(A$, sng&)
sng& = 1
If val("0" & Mid$(A$, sng&, 1)) = 0 And Left(Mid$(A$, sng&, 1), sng&) <> "0" And Left(Mid$(A$, sng&, 1), sng&) <> "." Then
IsNumberCheck = False
Else

    If Mid$(A$, sng&, 1) = "." Then

    ig$ = "0"
    DE$ = "."
    ElseIf LCase(Mid$(A$, sng&, 2)) Like "0[xχ]" Then
    ig$ = "0"
    DE$ = "0x"
  sng& = sng& + 1
Else
    Do While sng& <= Len(A$)
        
        Select Case Mid$(A$, sng&, 1)
        Case "0" To "9"
        ig$ = ig$ & Mid$(A$, sng&, 1)
        Case "."
        DE$ = "."
        Exit Do
        Case Else
        Exit Do
        End Select
       sng& = sng& + 1
    Loop
    End If
    ' compute decimal part
    If DE$ <> "" Then
      sng& = sng& + 1
        Do While sng& <= Len(A$)
       
        Select Case Mid$(A$, sng&, 1)
        Case " ", ChrW(160)
        If Not (sg1 And Len(ex$) = 1) Then
        Exit Do
        End If
        Case "A" To "D", "a" To "d", "F", "f"
        If Left$(DE$, 2) = "0x" Then
        DE$ = DE$ & Mid$(A$, sng&, 1)
        End If
        Case "0" To "9"
        If sg1 Then
        ex$ = ex$ & Mid$(A$, sng&, 1)
        Else
        DE$ = DE$ & Mid$(A$, sng&, 1)
        End If
        Case "E", "e"
         If Left$(DE$, 2) = "0x" Then
         DE$ = DE$ & Mid$(A$, sng&, 1)
         Else
              If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        End If
        Case "Ε", "ε"
                         If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        ex$ = "E"
        
        Case "+", "-"
        If sg1 And Len(ex$) = 1 Then
         ex$ = ex$ & Mid$(A$, sng&, 1)
        Else
        Exit Do
        End If
        Case Else
        Exit Do
        End Select
         sng& = sng& + 1
        Loop
        If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then sng& = sng& - Len(ex$)
    End If
    If ig$ = "" Then
    IsNumberCheck = False
    Else
  ''  If SG < 0 Then ig$ = "-" & ig$
    If Left$(DE$, 2) = "0x" Then
           ' r = UNPACKLNG(Left$(ex$, 8))
            If Mid$(DE$, 3) = "" Then
            r = 0
            Else
            DE$ = Right$("00000000" & Mid$(DE$, 3), 8)
            r = CDbl(UNPACKLNG(Left$(DE$, 4)) * 65536#) + CDbl(UNPACKLNG(Right$(DE$, 4)))
            End If
    Else
        If SG < 0 Then ig$ = "-" & ig$
                   On Error Resume Next
                           If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then
                               r = val(ig$ & DE$ & ex$ & "0")
                               sng = sng + Len(ex$)
                           ElseIf ex$ <> "" Then
                               If val(Mid$(ex$, 2)) > 308 Or val(Mid$(ex$, 2)) < -324 Then
                                   r = val(ig$ & DE$)
                                   sng = sng - Len(ex$)
                                   ex$ = ""
                                   
                               Else
                                   r = val(ig$ & DE$ & ex$)
                               End If
                           Else
                       
                               r = val(ig$ & DE$)
                           End If
                     If Err.Number = 6 Then
                         If Len(ex$) > 2 Then
                             ex$ = Left$(ex$, Len(ex$) - 1)
                             sng = sng - 1
                             Err.Clear
                             r = val(ig$ & DE$ & ex$)
                             If Err.Number = 6 Then
                                 sng = sng - Len(ex$)
                                  r = val(ig$ & DE$)
                             End If
                         End If
                       MyEr "Error in exponet", "Λάθος στον εκθέτη"
                       IsNumberCheck = False
                       Exit Function
                     End If
           
         End If
           A$ = Mid$(A$, sng&)
           IsNumberCheck = True
End If
End If
End Function
Function IsNumber(bstack As basetask, A$, r As Double) As Boolean
Dim VR As Long, v$, n$, V1&, w1 As Long, w2 As Long, p As Double, s1$, dd As Long, dn As Long, W3 As Long
Dim PP As Double, pppp As mArray, nBstack As basetask, pppp1 As mArray, rB As Byte, ri As Integer
Dim anything As Object

If A$ = "" Then IsNumber = False: Exit Function
On Error Resume Next
Dim sng&, SG As Double, ig$, DE$, sg1 As Boolean, ex$, s$
Dim r2 As Double, r3 As Double, r4 As Double, par As Boolean
SG = 1
Set bstack.lastobj = Nothing
'compute the sign portion
againfordot:
Do While sng& < Len(A$)
sng& = sng& + 1
Select Case Mid$(A$, sng&, 1)
Case "#"
    If Len(A$) > sng& Then
    If MaybeIsSymbolNoSpace(Mid$(A$, sng& + 1, 1), "[0123456789ABCDEFabcdef]") Then
    s$ = "0x00" + Mid$(A$, sng& + 1, 6)
    If Len(s$) < 10 Then Exit Function
        If IsNumberCheck(s$, r) Then
        If s$ <> "" Then
          
             
        Else
            s$ = Right$("00000000" & Mid$(A$, sng& + 1, 6), 8)
            A$ = Mid$(A$, sng& + 7)
   r = SG * -(CDbl(UNPACKLNG(Right$(s$, 2)) * 65536#) + CDbl(UNPACKLNG(Mid$(s$, 5, 2)) * 256#) + CDbl(UNPACKLNG(Mid$(s$, 3, 2))))
   IsNumber = True
   Exit Function
        End If
        End If
        Else
        
    End If
    Else

    '' out
    End If
    Exit Function
Case " ", "+", ChrW(160)
Case "-"
SG = -SG
Case Else
Exit Do
End Select
Loop
A$ = Mid$(A$, sng&)
n$ = A$
w2 = Len(n$)
sng& = 1
V1& = IsLabelBig(bstack, n$, v$, par)

If V1& = 0 Then GoTo zerohere
''''''''''''''''''If NoOptimum Then If v1& > 0 Then par = False
If par Then
par = False
removethis:
V1& = Abs(V1&)
 
 If V1& = 1 Then
 GoTo LOOKFORVARNUM
 ElseIf V1& = 4 Then
 GoTo LOOKFORVARNUM4
 ElseIf V1& = 5 Or V1& = 7 Then
 GoTo LOOKFORSUBNUM
 Else
 '
 IsNumber = False
    Exit Function
 End If
 ''
End If

Select Case V1&
Case 1
If Not numid.ExistKey(v$) Then GoTo LOOKFORVARNUM
Select Case v$
Case "THIS", "ΑΥΤΟ"
Set bstack.lastobj = Nothing

 If bstack.UseGroupname <> "" Then
     s1$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
     If GetVar(bstack, s1$, W3) Then
          CopyGroup var(W3), bstack
          
    End If
    Else
    s1$ = ".DELETEME"
    If IsLabel(bstack, s1$, v$) < 0 Then
    If Len(v$) = 8 Then A$ = n$: IsNumber = False: Exit Function
    v$ = Left$(v$, Len(v$) - 9)
     If GetVar(bstack, v$, W3) Then
          CopyGroup var(W3), bstack
          
    End If
    End If
    End If
     r = SG * 0
IsNumber = True
A$ = n$
Exit Function
Case "RND", "ΤΥΧΑΙΟΣ"
r = SG * RndM(rndbase)
IsNumber = True
A$ = n$
Exit Function

Case "PEN", "ΠΕΝΑ"
A$ = n$
With players(GetCode(bstack.Owner))
For w1 = 0 To 15
If QBColor(w1) = .mypen Then
r = SG * w1
IsNumber = True
Exit Function
End If
Next w1
r = SG * -.mypen
IsNumber = True

Exit Function
End With
'myCompEq("σ","ς")

Case "HWND", "ΠΑΡΑΘΥΡΟ"
If Typename(bstack.Owner) = "GuiM2000" Then
r = SG * bstack.Owner.hWnd
Else
If ttl Then
r = SG * Form3.hWnd
Else
r = SG * bstack.Owner.hWnd
End If
End If
A$ = n$
IsNumber = True
Exit Function
Case "LOCALE", "ΤΟΠΙΚΟ"
r = SG * cLid
    A$ = n$
    IsNumber = True
    Exit Function

Case "CODEPAGE", "ΚΩΔΙΚΟΣΕΛΙΔΑ"
r = SG * UserCodePage
    A$ = n$
    IsNumber = True
    Exit Function
Case "SPEECH", "ΛΟΓΟΣ"
  r = SG * NumVoices

    A$ = n$
    IsNumber = True
    Exit Function
Case "ERROR", "ΛΑΘΟΣ"
  r = SG * LastErNum1
 LastErNum1 = 0  'reset when readed
    A$ = n$
    IsNumber = True
    Exit Function
Case "SCREEN.Y", "ΑΝΑΛΥΣΗ.Υ"
  r = SG * ScrY()
    A$ = n$
    IsNumber = True
    Exit Function
Case "SCREEN.X", "ΑΝΑΛΥΣΗ.Χ"
  r = SG * ScrX()
     A$ = n$
    IsNumber = True
    Exit Function
Case "TWIPSY", "ΥΨΟΣ.ΣΗΜΕΙΟΥ"
  r = SG * Screen.TwipsPerPixelY

    A$ = n$
    IsNumber = True
    Exit Function
Case "TWIPSX", "ΠΛΑΤΟΣ.ΣΗΜΕΙΟΥ"
  r = SG * Screen.TwipsPerPixelX
    A$ = n$
    IsNumber = True
    Exit Function
Case "REPORTLINES", "ΓΡΑΜΜΕΣΑΝΑΦΟΡΑΣ"
  r = SG * players(GetCode(bstack.Owner)).LastReportLines
    A$ = n$
    IsNumber = True
    Exit Function
Case "LINESPACE", "ΔΙΑΣΤΙΧΟ"
    r = SG * players(GetCode(bstack.Owner)).uMineLineSpace '' bstack.linespace
    A$ = n$
    IsNumber = True
    Exit Function
Case "MODE", "ΤΥΠΟΣ"
With players(GetCode(bstack.Owner))
If bstack.toprinter Then
    If .uMineLineSpace > .MineLineSpace Then
        r = SG * .SZ / 6
    Else
         r = SG * .SZ / 3
    End If
    Else
    If .uMineLineSpace > .MineLineSpace Then
        r = SG * .SZ / 2
    Else
         r = SG * .SZ
    End If
    
    
    End If
    End With
    A$ = n$
    IsNumber = True
    Exit Function
Case "MEMORY", "ΜΝΗΜΗ"
    r = SG * check_mem
    A$ = n$
    IsNumber = True
    Exit Function
Case "CHARSET", "ΧΑΡΑΚΤΗΡΕΣ"   ' charset of the object to display
  r = SG * players(GetCode(bstack.Owner)).charset
    A$ = n$
    IsNumber = True
    Exit Function
    Case "ITALIC", "ΠΛΑΓΙΑ"  ' charset of the object to display
    
    r = SG * players(GetCode(bstack.Owner)).italics
    A$ = n$
    IsNumber = True
    Exit Function
    Case "BOLD", "ΦΑΡΔΙΑ"  ' charset of the object to display

    r = SG * players(GetCode(bstack.Owner)).bold
    A$ = n$
    IsNumber = True
    Exit Function

Case "COLORS", "ΧΡΩΜΑΤΑ"
    r = SG * 2# ^ bitsPerPixel
    A$ = n$
    IsNumber = True
    Exit Function
Case "ΑΥΞΟΥΣΑ", "ASCENDING"
    r = 0
    A$ = n$
    IsNumber = True
    Exit Function
Case "ΦΘΙΝΟΥΣΑ", "DESCENDING"
    r = SG
    A$ = n$
    IsNumber = True
    Exit Function

Case "BOOLEAN", "ΛΟΓΙΚΟΣ"
    r = SG * 1
        A$ = n$
    IsNumber = True
    Exit Function
Case "BYTE", "ΨΗΦΙΟ"
    r = SG * 2
        A$ = n$
    IsNumber = True
    Exit Function
Case "INTEGER", "ΑΚΕΡΑΙΟΣ"
    r = SG * 3
        A$ = n$
    IsNumber = True
    Exit Function
Case "LONG", "ΜΑΚΡΥΣ"
    r = SG * 4
        A$ = n$
    IsNumber = True
    Exit Function
Case "CURRENCY", "ΛΟΓΙΣΤΙΚΟ"
    r = SG * 5
        A$ = n$
    IsNumber = True
    Exit Function
Case "SINGLE", "ΑΠΛΟΣ"
    r = SG * 6
        A$ = n$
    IsNumber = True
    Exit Function
Case "DOUBLE", "ΔΙΠΛΟΣ"
    r = SG * 7
        A$ = n$
    IsNumber = True
    Exit Function
Case "DATEFIELD", "ΗΜΕΡΟΜΗΝΙΑ"
    r = SG * 8
        A$ = n$
    IsNumber = True
    Exit Function
Case "BINARY", "ΔΥΑΔΙΚΟ"
    r = SG * 9
        A$ = n$
    IsNumber = True
    Exit Function
Case "TEXT", "ΚΕΙΜΕΝΟ"
    r = SG * 10
        A$ = n$
    IsNumber = True
    Exit Function
Case "OLE"
    r = SG * 11
        A$ = n$
    IsNumber = True
    Exit Function
Case "MEMO", "ΥΠΟΜΝΗΜΑ"
    r = SG * 12
        A$ = n$
    IsNumber = True
    Exit Function
Case "REVISION", "ΑΝΑΘΕΩΡΗΣΗ"
    r = SG * Revision
    A$ = n$
    IsNumber = True
    Exit Function
  Case "BROWSER", "ΑΝΑΛΟΓΙΟ"
        
        r = SG * (Trim(LCase(Form1.view1.LocationURL)) = "about:blank" Or Form1.view1.Visible = False)
    A$ = n$
    IsNumber = True
    Exit Function
Case "VERSION", "ΕΚΔΟΣΗ"
    r = SG * val(CStr(VerMajor) & "." & CStr(VerMinor))
    A$ = n$
    IsNumber = True
    Exit Function
Case "MOTION.X", "ΚΙΝΗΣΗ.Χ"
With bstack
If .toprinter Then
    r = 0
Else
    r = SG * bstack.Owner.Left
    End If
    End With
    A$ = n$
    IsNumber = True
    Exit Function
Case "MOTION.Y", "ΚΙΝΗΣΗ.Υ"
With bstack
If .toprinter Then
    r = 0
Else
    r = SG * .Owner.top
    End If
    
    End With
    A$ = n$
    IsNumber = True

    Exit Function
Case "MOTION.XW", "ΚΙΝΗΣΗ.ΧΠ", "MOTION.WX", "ΚΙΝΗΣΗ.ΠΧ"
    r = SG * Form1.Left
    A$ = n$
    IsNumber = True
    Exit Function
Case "MOTION.YW", "ΚΙΝΗΣΗ.ΥΠ", "MOTION.WY", "ΚΙΝΗΣΗ.ΠΥ"
    r = SG * Form1.top
    A$ = n$
    IsNumber = True
    Exit Function
Case "FIELD", "ΠΕΔΙΟ"
    r = SG * result
    
    A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSE.KEY", "ΔΕΙΚΤΗΣ.ΚΟΜ"
  
    r = SG * mouse


       A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSE", "ΔΕΙΚΤΗΣ"

If Not releasemouse Then
If Not Form1.Visible Then Form1.Visible = True
End If
MyDoEvents

     r = SG * MOUB

    

A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSE.X", "ΔΕΙΚΤΗΣ.Χ"

With bstack
If .toprinter Then
'mouyb = Printer.CurrentY
r = Form1.PrinterDocument1.CurrentX
ElseIf .toback Then
'mouyb = mouy
r = MOUSEX(Form1.Left)
Else
'mouyb = mouy - di.top
r = MOUSEX(Form1.Left + bstack.Owner.Left)
End If
End With
      A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSE.Y", "ΔΕΙΚΤΗΣ.Υ"
With bstack
If .toprinter Then

r = Form1.PrinterDocument1.CurrentY
ElseIf .toback Then
'mouyb = mouy
r = MOUSEY(Form1.top)
Else
'mouyb = mouy - di.top
r = MOUSEY(Form1.top + bstack.Owner.top)
End If
End With
       A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSEA.X", "ΔΕΙΚΤΗΣΑ.Χ"
  
    r = SG * MOUSEX(Form1.Left)
    
      A$ = n$
    IsNumber = True
    Exit Function
Case "MOUSEA.Y", "ΔΕΙΚΤΗΣΑ.Υ"
 
    r = SG * MOUSEY(Form1.top)
   
       A$ = n$
    IsNumber = True
    Exit Function

Case "TRUE", "ΑΛΗΘΕΣ", "ΑΛΗΘΗΣ"
    r = SG * -1
    A$ = n$
    IsNumber = True
    Exit Function
Case "FALSE", "ΨΕΥΔΕΣ", "ΨΕΥΔΗΣ"
    r = 0
    A$ = n$
    IsNumber = True
    Exit Function
Case "STACK.SIZE", "ΜΕΓΕΘΟΣ.ΣΩΡΟΥ"
    IsNumber = True
    r = SG * bstack.soros.Total
    A$ = n$
    Exit Function
Case "ISNUM", "ΕΙΝΑΡ"
    IsNumber = True
      If bstack.soros.Total > 0 Then
    If bstack.soros.PopType = "N" Then r = SG * True Else r = 0
    Else
    r = 0
    End If
    A$ = n$
    Exit Function
Case "PI", "ΠΙ"
    r = SG * Pi
    A$ = n$
    IsNumber = True
    Exit Function
Case "NOT", "ΟΧΙ", "ΔΕΝ"
    r = SG * -1
    A$ = "-" & n$
    IsNumber = True
    Exit Function
Case "ISLET", "ΕΙΝΓΡ"
    IsNumber = True
    If bstack.soros.Total > 0 Then
    If bstack.soros.PopType = "S" Then r = SG * True Else r = 0
    End If
    A$ = n$
    Exit Function
Case "WIDTH", "ΠΛΑΤΟΣ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).mx
    A$ = n$
    Exit Function
Case "POINT", "ΣΗΜΕΙΟ"
'  dsprite ??
    IsNumber = True
    
    With players(GetCode(bstack.Owner))
       r = SG * -(GetPixel(bstack.Owner.hDC, .XGRAPH \ dv15, .YGRAPH \ dv15) And &HFFFFFF)
    End With
    A$ = n$
    Exit Function
Case "POS.X", "ΘΕΣΗ.Χ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).XGRAPH
    A$ = n$
    Exit Function
Case "POS.Y", "ΘΕΣΗ.Υ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).YGRAPH
    A$ = n$
    Exit Function
Case "SCALE.X", "ΚΛΙΜΑΞ.Χ", "Χ.ΣΗΜΕΙΑ", "X.TWIPS"
    IsNumber = True
    If bstack.toprinter Then
    r = SG * Form1.PrinterDocument1.ScaleWidth
    Else
    r = SG * players(GetCode(bstack.Owner)).MAXXGRAPH
    End If
    A$ = n$
    Exit Function
Case "SCALE.Y", "ΚΛΙΜΑΞ.Υ", "Υ.ΣΗΜΕΙΑ", "Y.TWIPS"
    IsNumber = True
    If bstack.toprinter Then
    r = SG * Form1.PrinterDocument1.ScaleHeight
    Else
    r = SG * players(GetCode(bstack.Owner)).MAXYGRAPH
    End If
    A$ = n$
    Exit Function
Case "EMPTY", "ΚΕΝΟ"
    IsNumber = True
    r = SG * (bstack.soros.Total = 0)
    A$ = n$
    Exit Function
Case "MOVIE.COUNTER", "MEDIA.COUNTER", "MUSIC.COUNTER", "ΤΑΙΝΙΑ.ΜΕΤΡΗΤΗΣ", "ΜΟΥΣΙΚΗ.ΜΕΤΡΗΤΗΣ"
    IsNumber = True
    r = SG * MediaPlayer1.getPositionInSec
    If MediaPlayer1.error > 0 Then
    r = SG * -1
    End If
    A$ = n$
    Exit Function
Case "PLAYSCORE", "ΠΑΙΖΕΙΦΩΝΗ"
    IsNumber = True
    
       r = SG * TaskMaster.PlayMusic
    A$ = n$
    Exit Function
Case "MOVIE", "MEDIA", "MUSIC", "ΤΑΙΝΙΑ", "ΜΟΥΣΙΚΗ"
    IsNumber = True
    AVIRUN = MediaPlayer1.isMoviePlaying
    r = SG * AVIRUN
    A$ = n$
    Exit Function
Case "DURATION", "ΔΙΑΡΚΕΙΑ"
    IsNumber = True
    r = SG * MediaPlayer1.getLengthInMS / 1000
   
    A$ = n$
    Exit Function
Case "VOLUME", "ΕΝΤΑΣΗ"
    IsNumber = True
    r = SG * CDbl(CLng(vol))
    A$ = n$
    Exit Function
Case "TAB", "ΣΤΗΛΗ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).Column + 1  'CHANGED FROM Ver 7.1
    A$ = n$
    Exit Function
Case "HEIGHT", "ΥΨΟΣ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).My
    A$ = n$
    Exit Function
Case "POS", "ΘΕΣΗ"
    IsNumber = True
    
    
    
    r = SG * GetRealPos(bstack.Owner)
    A$ = n$
    Exit Function
Case "ROW", "ΓΡΑΜΜΗ"
    IsNumber = True
    r = SG * GetRealRow(bstack.Owner)
    A$ = n$
    Exit Function
    Case "TIMECOUNT", "ΦΟΡΤΟΣ" ' ****************************
  IsNumber = True
    r = SG * prof.MARKTWO
    A$ = n$
    Exit Function

Case "TICK", "ΤΙΚ" ' ****************************
  IsNumber = True
    r = SG * MasterTimer
    A$ = n$
    Exit Function
Case "TODAY", "ΣΗΜΕΡΑ"
    IsNumber = True
    r = SG * CDbl(Date)
    A$ = n$
    Exit Function
Case "NOW", "ΤΩΡΑ"
    IsNumber = True
    r = SG * CDbl(CDate(Time))
    A$ = n$
     Exit Function
Case "MENU.VISIBLE", "ΕΠΙΛΟΓΕΣ.ΦΑΝΕΡΕΣ"  ' NEW 6.5 REV 8
    IsNumber = True
    r = SG * Form1.List1.Visible
    A$ = n$
    Exit Function
Case "MENUITEMS", "ΕΠΙΛΟΓΕΣ"
    IsNumber = True
    r = SG * Form1.List1.listcount
    A$ = n$
    Exit Function
Case "MENU", "ΕΠΙΛΟΓΗ"
    IsNumber = True
    r = 0
    With Form1.List1
    If .listcount > 0 Then
 
     r = SG * CDbl(.ListIndex + 1)
    End If
    End With
    A$ = n$
    Exit Function
Case "NUMBER", "ΑΡΙΘΜΟΣ", "ΤΙΜΗ"
    If bstack.soros.Total = 0 Then
    A$ = n$
            MyErMacro A$, "Stack is empty", "O σωρός είναι άδειος"
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.PopType = "N" Then
    r = SG * bstack.soros.PopVal
    A$ = n$
    IsNumber = True
    Exit Function
    ElseIf bstack.soros.PopType = "L" Then
    r = SG * bstack.soros.PopVal
    A$ = n$
    IsNumber = True
    Exit Function
    Else
     A$ = n$
            MyErMacro A$, "Stack top isn't number", "Η κορυφή του σωρού δεν είναι αριθμός"
  
    IsNumber = False
    End If
    Exit Function
Case "LAMBDA", "ΛΑΜΔΑ"
    Set bstack.lastobj = ProcLambda(bstack, n$)
    r = 0
    A$ = n$
    IsNumber = Not bstack.lastobj Is Nothing
Exit Function
Case Else

LOOKFORVARNUM:

If GetVar(bstack, v$, VR) Then
    If IsObject(var(VR)) Then
    
        v$ = Typename(var(VR))
        If v$ Like "Pro*" Then
            If IsObject(var(VR).Value) Then
               Set bstack.lastobj = var(VR).Value
                r = 0
            Else
                r = SG * var(VR)
            End If
        ElseIf v$ Like "Gr*" Then
            r = 0
            CopyGroup var(VR), bstack
        ElseIf v$ Like "mE*" Then
            CopyEvent var(VR), bstack
            r = 0
        ElseIf v$ = "lambda" Then
            
            CopyLambda var(VR), bstack
            r = 0
        ElseIf v$ = "mHandler" Then
        ' this is ok for both buffer and inventory
            CopyHandler var(VR), bstack
            r = 0
        Else
                Set bstack.lastobj = MakeitObjectGeneric(VR)
                r = 0
        End If
    
Else
    r = SG * var(VR)
End If
A$ = n$
IsNumber = True
ElseIf VR = -1 Then
r = SG * ReadVarDouble(bstack, v$)
A$ = n$
IsNumber = True
Exit Function
Else
If Len(v$) > 5 Then
If Left$(v$, 5) = "THIS." Or Left$(v$, 5) = "ΑΥΤΟ." Then
v$ = Mid$(v$, 5)
V1& = IsLabel(bstack, (v$), v$)
If v$ <> "" Then GoTo removethis
End If
End If
IsNumber = False  ''         " " + & String$(w2 - Len(n$), " ")
 ''If w2 >= Len(n$) Then a$ = " " & String$(w2 - Len(n$), " ") + n$ Else a$ = n$
  If w2 >= Len(n$) Then A$ = NLtrim$(A$) Else A$ = n$
   
 If FindNameForGroup(bstack, v$) Then
 MyErMacro A$, "Unknown Property " & v$, "’γνωστη ιδιότητα " & v$
 Else
MyErMacro A$, "Unknown Variable " & v$, "’γνωστη μεταβλητή " & v$
End If
End If
Exit Function


End Select
Case 4
LOOKFORVARNUM4:
If GetVar(bstack, v$, VR) Then
If Typename(var(VR)) = "lambda" Then
CopyLambda var(VR), bstack
Else
r = SG * var(VR)
End If
A$ = n$
IsNumber = True
Else
If VR = -1 Then
r = SG * ReadVarInt(bstack, v$)
A$ = n$
IsNumber = True
Exit Function
End If
IsNumber = False
   If w2 >= Len(n$) Then A$ = " " & String$(w2 - Len(n$), " ") + n$ Else A$ = n$
 If FindNameForGroup(bstack, v$) Then
 MyErMacro A$, "Unknown Property " & v$, "’γνωστη ιδιότητα " & v$
 Else
MyErMacro A$, "Unknown Variable " & v$, "’γνωστη μεταβλητή " & v$
End If
End If


Exit Function
Case 7
 GoTo LOOKFORSUBNUM
Case 5
On Error Resume Next
If Not funid.ExistKey(v$) Then GoTo LOOKFORSUBNUM
Select Case v$
Case "PARAM(", "ΠΑΡΑΜ("
v$ = ""
If IsStrExp(bstack, n$, s1$) Then

Do
w1 = Len(s1$)
      If IsNumberD2(s1$, p) Then
      If v$ = "" Then
        r = SG * p
        v$ = ","
      Else
        v$ = v$ + "," + CStr(p)
      End If
      Else
             ISSTRINGA s1$, s$
        If v$ = "" Then Exit Do Else v$ = v$ + ",{" + s$ + "}"
    End If
    FastSymbol s1$, ","
Loop Until Trim$(s1) = "" Or w1 = Len(s1$)
ElseIf IsExp(bstack, n$, p) Then
    If bstack.lastobj Is Nothing Then
        MyEr "Expected Object", "Περίμενα αντικείμενο"
    ElseIf TypeOf bstack.lastobj Is mHandler Then
        Set anything = bstack.lastobj
        Set bstack.lastobj = Nothing
        If anything.Indirect Then
            If IsObject(var(anything.Indirect)) Then
                Set bstack.lastobj = New mHandler
                On Error Resume Next
                Err.Clear
                ' maybe we want the typelib
                If FastSymbol(n$, ",") Then
                
                End If
                Set bstack.lastobj.objref = MakeATypeLib(var(anything.Indirect))

                If Err Then
                   MyEr "Can't Read TypeLib", "Δεν μπορώ να διαβάσω τους τύπους των παραμέτρων"
                   Else
                   bstack.lastobj.T1 = 1
                End If
                Set anything = Nothing
            Else
            MyEr "Expected Object", "Περίμενα αντικείμενο"
            End If
        End If
    End If

End If
    IsNumber = FastSymbol(n$, ")", True)
    A$ = Mid$(v$, 2) + n$
    Exit Function

Case "STACKITEM(", "ΤΙΜΗΣΩΡΟΥ("

If IsExp(bstack, n$, p) Then
W3 = Abs(CLng(p))
backitem:
    If bstack.soros.Total < W3 Then
    A$ = n$
            MyErMacro A$, "Stack item not found at position " & CStr(W3), "Δεν υπάρχει τιμή σωρού στη θέση " & CStr(W3)
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.StackItemType(W3) = "N" Then
    r = SG * bstack.soros.StackItem(W3)
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
    Exit Function
    Else
     A$ = n$
            MyErMacro A$, "Stack item isn't number at position " & CStr(W3), "Η τιμή του σωρού δεν είναι αριθμός στη θέση " & CStr(W3)
  
    IsNumber = False
    End If
    Exit Function
Else
W3 = 1
GoTo backitem
End If
Case "SGN(", "ΣΗΜ("
If IsExp(bstack, n$, p) Then
r = SG * Sgn(MyRound(p, 13))

A$ = n$
 IsNumber = FastSymbol(A$, ")", True)
 Else
 A$ = n$: MissParam A$: IsNumber = False
End If
Exit Function

Case "FRAC(", "ΔΕΚ("
If IsExp(bstack, n$, p) Then
r = SG * MyRound(Abs(Abs(p) - Int(Abs(p))), 13)

A$ = n$
 IsNumber = FastSymbol(A$, ")", True)
 Else
 A$ = n$: MissParam A$: IsNumber = False
End If
Exit Function
Case "MATCH(", "ΤΑΥΤΙΣΗ("
If IsStrExp(bstack, n$, s1$) Then
If s1$ = "" Then
r = 0
A$ = n$
               IsNumber = FastSymbol(A$, ")", True)
ElseIf VALIDATEmStiva(bstack, UCase$(s1$), s$) Then   ' Only S and N
                If s$ = "" Then
                    r = 0
                Else
                   r = -SG
               End If
               Else
               r = 0
               End If
               A$ = n$
               IsNumber = FastSymbol(A$, ")", True)
Else
A$ = n$: MissParam A$
End If
Exit Function
Case "LOCALE(", "ΤΟΠΙΚΟ("
If IsStrExp(bstack, n$, s1$) Then
If FastSymbol(n$, ",") Then
If IsExp(bstack, n$, p) Then
r = SG * FoundSpecificLocaleId(s1$, CLng(p))
Else
A$ = n$: MissParam A$: IsNumber = False: Exit Function
End If
Else
r = SG * FoundLocaleId(s1$)
End If
   A$ = n$

    IsNumber = FastSymbol(A$, ")", True)
End If
Exit Function
Case "FILELEN(", "ΑΡΧΕΙΟΥ.ΜΗΚΟΣ("
If IsStrExp(bstack, n$, s1$) Then
If s1$ = "" Then
r = 0
A$ = n$
               IsNumber = FastSymbol(A$, ")", True)
Else
If ExtractPath(s1$) = "" Then
                If CFname(s1$) <> "" Then
                    s1$ = CFname(s1$)
                ElseIf mylcasefILE(s1$) = ExtractName(s1$) Then
                    s1$ = mcd + s1$
                End If
End If
       r = SG * FileLen(GetDosPath(s1$))
               A$ = n$
               IsNumber = FastSymbol(A$, ")", True)
End If
Else
A$ = n$: MissParam A$
End If
Exit Function
Case "TAB(", "ΣΤΗΛΗ("
If IsExp(bstack, n$, p) Then

r = SG * p * (players(GetCode(bstack.Owner)).Column + 1)
   A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
End If
Exit Function
Case "KEYPRESS(", "ΠΑΤΗΜΕΝΟ("
If Not IsExp(bstack, n$, p) Then
r = 0
Else
r = SG * CLng(KeyPressed(CLng(p)))

End If
 A$ = n$

    IsNumber = FastSymbol(A$, ")", True)
    Exit Function
Case "INKEY(", "ΕΝΚΟΜ("

BLOCKkey = True
If Not IsExp(bstack, n$, p) Then p = 50: dn = 1
If p < 50 Then p = 50
p = p / 2
    p = uintnew(p + timeGetTime)
   If dn = 1 Then r = 0 Else r = clickMe

If Not (bstack.IamThread And dn = 1) Then clickMe2 = -2
               w1 = -1
                    Do While p > uintnew(timeGetTime)
                  
                  
                 If Not bstack.IamThread Then
                    MyDoEvents
                    mywait bstack, 1
                    Else
                    
                    p = 0
                    ''If (dn = 0) Then
                    If r = clickMe2 Then Exit Do
                    
                    r = -3
                      clickMe2 = clickMe
                      
                      
                    End If
                    If clickMe2 = r Then clickMe2 = -2
                    If w1 = -1 Then
                    If clickMe2 <> -2 Then
             
              
                    w1 = clickMe2
              
                    If w1 = 19 Or w1 = 131139 Then
                    'this IS A BREAK
                    BLOCKkey = False
                  
                   Form1.GiveASoftBreak (w1 = 19)
                    End If
                    p = 0
                    End If
                    End If
                     
                Loop
                If bstack.IamThread Then
        If bstack.LastClick = w1 Then
            w1 = -1
        Else
            bstack.LastClick = w1
        End If
End If
  r = SG * w1
    
  clickMe2 = -1


A$ = n$
IsNumber = FastSymbol(A$, ")", True)
BLOCKkey = False
Exit Function
Case "ΤΜΗΜΑ(", "MODULE("
  MakeThisSub bstack, n$
If IsLabel(bstack, n$, s$) Then

    r = SG * True
  
    If GetlocalSub(s$, w1) Then
  ' ElseIf GetlocalSubExtra(s$, w1) Then
    ElseIf Not GetSub(s$, w1) Then
    
  
    r = False
    
    End If
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
Else
    A$ = n$
    IsNumber = False
End If
Exit Function
Case "ΒΑΣΗ(", "MDB("
If IsStrExp(bstack, n$, s$) Then
If ExtractType(s$) = "" Then s$ = s$ & ".MDB"
s$ = CFname(s$)
If s$ <> "" Then
r = CheckMine(s$)
Else
r = 0
End If
   A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
End If
Exit Function
Case "ASK(", "ΡΩΤΑ("
If IsStrExp(bstack, n$, AskText$) Then
If UCase(v$) = "ASK(" Then
DialogSetupLang 1
Else
DialogSetupLang 0
End If
If AskText$ = "" Then A$ = n$: ZeroParam A$: IsNumber = False: Exit Function
If FastSymbol(n$, ",") Then IsStrExp bstack, n$, AskTitle$
If FastSymbol(n$, ",") Then IsStrExp bstack, n$, AskOk$
If FastSymbol(n$, ",") Then IsStrExp bstack, n$, AskCancel$
If FastSymbol(n$, ",") Then IsStrExp bstack, n$, AskDIB$
If FastSymbol(n$, ",") Then IsStrExp bstack, n$, AskStrInput$: AskInput = True

olamazi

r = SG * Form3.NeoASK(bstack)
AskInput = False
   A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
End If
Exit Function
Case "ΣΥΓΚΡΟΥΣΗ(", "COLLIDE("
If IsExp(bstack, n$, r) Then
If FastSymbol(n$, ",") Then
    If Not IsExp(bstack, n$, r2) Then A$ = n$: MissParam A$: IsNumber = False: Exit Function
 
    If FastSymbol(n$, ",") Then
    r = SG * CollideArea(CLng(r), CLng(r2), bstack, n$)
    Else
    r = SG * CollidePlayers(CLng(r), CLng(r2))
    End If
Else
r = SG * CollidePlayers(CLng(r), CLng(100))
End If
   A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
End If
Exit Function
Case "ΜΕΓΕΘΟΣ.Υ(", "SIZE.Y("

    If IsStrExp(bstack, n$, s$) Then
    If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: IsNumber = False: Exit Function
    If Not IsStrExp(bstack, n$, s1$) Then A$ = n$: MissParam A$: IsNumber = False: Exit Function
    If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: IsNumber = False: Exit Function
    If Not IsExp(bstack, n$, r2) Then A$ = n$: MissParam A$: IsNumber = False: Exit Function
    r3 = 0
    If FastSymbol(n$, ",") Then
    If Not IsExp(bstack, n$, r3) Then
     A$ = n$: MissParam A$: IsNumber = False: Exit Function
    End If

    End If
    On Error Resume Next
    r = nTextY(bstack, s$, s1$, CSng(r2), r3)
    If Err.Number > 0 Then r = 0
    r = SG * r
    A$ = n$
 
    
    IsNumber = FastSymbol(A$, ")", True)
    End If
    Exit Function
Case "ΜΕΓΕΘΟΣ.Χ(", "SIZE.X("
    If IsStrExp(bstack, n$, s$) Then
    If Not FastSymbol(n$, ",") Then IsNumber = False: Exit Function
    If Not IsStrExp(bstack, n$, s1$) Then IsNumber = False: Exit Function
    If Not FastSymbol(n$, ",") Then IsNumber = False: Exit Function
    If Not IsExp(bstack, n$, r2) Then IsNumber = False: Exit Function
    r3 = 0
    If FastSymbol(n$, ",") Then If Not IsExp(bstack, n$, r3) Then IsNumber = False: Exit Function
    On Error Resume Next
    r = nText(bstack, s$, s1$, CSng(r2), r3)
    If Err.Number > 0 Then r = 0
    r = SG * r
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    End If
    Exit Function
Case "WRITABLE(", "ΕΓΓΡΑΨΙΜΟ("  ' αν μπορώ να γράψω στο φάκελο
    If IsStrExp(bstack, n$, s$) Then
      r = SG * WeCanWrite(s$)
   
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Exit Function
    End If
    IsNumber = False
    Exit Function
Case "COLOR(", "COLOUR(", "ΧΡΩΜΑ("
    
            
    If Not ColorRGB(bstack, n$, r) Then Exit Function
     A$ = n$
    r = SG * -r

        IsNumber = FastSymbol(A$, ")", True)
        Exit Function
Case "DIMENSION(", "ΔΙΑΣΤΑΣΗ("
IsNumber = False
A$ = n$

If Abs(IsLabel(bstack, n$, s$)) > 4 Then

If neoGetArray(bstack, s$, pppp) Then
If pppp.Arr Then
n$ = A$
If IsExp(bstack, n$, p) Then

ElseIf IsStrExp(bstack, n$, s$) Then
End If
If Not bstack.lastobj Is Nothing Then
If Not (TypeOf bstack.lastobj Is mArray) Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
Set pppp = bstack.lastobj
Set bstack.lastobj = Nothing
Else
A$ = n$
IsNumber = False
End If
Else
   If NeoGetArrayItem(pppp, bstack, s$, w1, n$) Then
    Set pppp = pppp.GroupRef.objref.ValueObj
  End If
End If
Else
      MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
End If

 If pppp.Arr Then  '

    If FastSymbol(n$, ",") Then
          If IsExp(bstack, n$, p) Then
          
          pppp.SerialItem PP, CLng(p - 1), 6
          r = SG * PP
              A$ = n$
               IsNumber = FastSymbol(A$, ")", True)
          Else
              A$ = n$
           MyErMacro A$, "Can't read dimension index from array " & s$, "Δεν μπορώ να διαβάσω τον δείκτη διάστασης του πίνακα " & s$
          End If
      Else ' dimensions
      p = 0
      pppp.SerialItem PP, CLng(p), 5
         r = SG * PP
              A$ = n$
              IsNumber = FastSymbol(A$, ")", True)
      End If
      Exit Function
      Else
       n$ = A$
       End If
 Else
 n$ = A$
 End If
If IsStrExp(bstack, n$, s$) Then
    s$ = s$ & "("
    If neoGetArray(bstack, s$, pppp) Then
    
      If Not pppp.Arr Then
    
  If NeoGetArrayItem(pppp, bstack, s$, w1, n$, , False) Then
  Set pppp = pppp.GroupRef.objref.ValueObj
  End If
  
   
  End If
  If Not pppp.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
        If FastSymbol(n$, ",") Then
          If IsExp(bstack, n$, p) Then
            pppp.SerialItem PP, CLng(p - 1), 6
            r = SG * PP
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
          Else
            A$ = n$
            MyErMacro A$, "Can't read dimension index from array " & s$, "Δεν μπορώ να διαβάσω τον δείκτη διάστασης του πίνακα " & s$
          End If
        Else ' dimensions
            p = 0
            pppp.SerialItem PP, CLng(p), 5
            r = SG * PP
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
        End If
        Else
        MyErMacro A$, "Can't find array " & s$, "Δεν βρίσκω πίνακα " & s$
    End If
Else
        MyErMacro A$, "Can't find array " & s$, "Δεν βρίσκω πίνακα " & s$
End If
    Exit Function
Case "ARRAY(", "ΠΙΝΑΚΑΣ("
    IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    If FastSymbol(n$, ",") Then
            w1 = InStr("!" & s$, "(")
            If w1 > 0 And w1 <= Len(s$) Then
            s$ = Left$(s$, w1 - 2)
            End If
            s$ = s$ & "("
                If neoGetArray(bstack, s$, pppp) Then
                If Not pppp.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                IsNumber = NeoGetArrayItem(pppp, bstack, s$, w1, n$)
                r = SG * pppp.item(w1)
                A$ = n$
                Else
                A$ = n$
                MyErMacro A$, "Can't find array " & s$, "Δεν βρίσκω πίνακα " & s$
                End If
    Else
    A$ = n$: MissParam A$
    End If
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
Case "FUNCTION(", "ΣΥΝΑΡΤΗΣΗ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    If IsSymbolBracket(s$) Then
            PushStage bstack, False
            s1$ = block(s$)
            FastSymbol s$, "}"
            GlobalSub "A_()", s1$, Trim$(s$)
            IsSymbol3 n$, ","
              A$ = "A_(@" & n$
            IsNumber = IsExp(bstack, A$, p)
            r = SG * p
            PopStage bstack
Else
If MaybeIsSymbol(n$, ".") Then
dd = 1
      s1$ = aheadstatus(n$, , dd)
s$ = s$ + Left$(n$, dd - 1)
n$ = Mid$(n$, dd)
End If
    If FastSymbol(n$, ",") Then
    End If
     If Right$(s$, 1) = ")" Then
        A$ = Left$(s$, Len(s$) - 1) & n$
    ElseIf InStr(s$, ").") > 0 Then
    If Not FastSymbol(n$, ")") Then
        A$ = s$ & "(@" & n$
    Else
        A$ = s$ & n$
        End If
     Else
      A$ = s$ & "(@" & n$
      End If
    IsNumber = IsExp(bstack, A$, p)
    r = SG * p
  End If
    Else
    A$ = n$: MissParam A$
    
    End If
    Exit Function
Case "DRIVE.SERIAL(", "ΣΕΙΡΙΑΚΟΣ.ΔΙΣΚΟΥ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    r = SG * DriveSerial(Left$(s$, 3))
  
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
Case "FILE.STAMP(", "ΑΡΧΕΙΟΥ.ΣΤΑΜΠΑ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    If CFname(s$, p) <> vbNullString Then
    If p = 0 Then
    A$ = n$
    MyErMacro A$, "Can't Read File TimeStamp", "Δεν μπορώ να διαβάσω την Χρονοσήμανση του αρχείου"
    Else
     r = SG * p
     End If
     Else
       A$ = n$: BadFilename: Exit Function
     
     End If
     A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
Case "EXIST.DIR(", "ΥΠΑΡΧΕΙ.ΚΑΤΑΛΟΓΟΣ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    r = SG * isdir(s$)
     A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
Case "EXIST(", "ΥΠΑΡΧΕΙ("
IsNumber = False
    If IsExp(bstack, n$, p) Then
    If Typename(bstack.lastobj) = "mHandler" Then
    Set anything = bstack.lastobj
    Set bstack.lastobj = Nothing
    With anything
        If anything.Indirect >= 0 Then
                Select Case anything.Indirect
                Case 1 To var2used
                    r = SG * IsObject(var(anything.Indirect))
                Case Else
                    r = 0
                End Select
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
                
                Set anything = Nothing
                Exit Function
        ElseIf TypeOf .objref Is FastCollection Then
            If FastSymbol(n$, ",") Then
                If IsExp(bstack, n$, p) Then
                    r = SG * .objref.Find(p)
                ElseIf IsStrExp(bstack, n$, s$) Then
                    r = SG * .objref.Find(s$)
                End If
                
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
                
                Set anything = Nothing
                Exit Function
            End If
        End If
    End With
      
    End If
    Set anything = Nothing
    A$ = n$
    MissParam A$
    Set bstack.lastobj = Nothing
    ElseIf IsStrExp(bstack, n$, s$) Then
    s$ = CFname(s$)
    If s$ <> "" Then
      r = SG * (InStr(s$, "*") = 0 And InStr(s$, "?") = 0)
      Else
  
    r = 0
    End If
   
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
    
Case "JOYPAD(", "ΛΑΒΗ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
        
    r = SG * Int(r)
    A$ = n$
    
    If r < 0 Or r > 15 Then
    
    MyErMacro A$, "Joypad number 0 to 15", "Αριθμός λαβής από 0 έως 15"

    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
    IsNumber = False
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
        
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).lngButton
IsNumber = FastSymbol(A$, ")", True)
       Else
       IsNumber = False
        A$ = n$: MissParam A$
         ' IsNumber = FastSymbol(a$, ")")
  End If
  Exit Function
Case "JOYPAD.DIRECTION(", "ΛΑΒΗ.ΚΑΤΕΥΘΥΝΣΗ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
    r = SG * Int(r)
    A$ = n$
    If r < 0 Or r > 15 Then
    
    MyErMacro A$, "Joypad number 0 to 15", "Αριθμός Λαβής από 0 έως 15"
    
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).joyPaD
    IsNumber = FastSymbol(A$, ")", True)
       Else
        A$ = n$: MissParam A$
  End If
Case "JOYPAD.ANALOG.X(", "ΛΑΒΗ.ΑΝΑΛΟΓΙΚΟ.Χ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
    r = SG * Int(r)
    A$ = n$
    If r < 0 Or r > 15 Then
    
    MyErMacro A$, "Joypad number 0 to 15", "Αριθμός Λαβής από 0 έως 15"
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
            Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).AnalogX
    IsNumber = FastSymbol(A$, ")", True)
       Else
        A$ = n$: MissParam A$
  End If
Case "JOYPAD.ANALOG.Y(", "ΛΑΒΗ.ΑΝΑΛΟΓΙΚΟ.Υ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
    r = SG * Int(r)
    A$ = n$
    If r < 0 Or r > 15 Then
    
    MyErMacro A$, "Joypad number 0 to 15", "Αριθμός Λαβής από 0 έως 15"
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        MyErMacro A$, "Joypad number " & CStr(r) & " isn't ready", "Το νούμερο Λαβής " & CStr(r) & " δεν είναι έτοιμο"
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).AnalogY
    IsNumber = FastSymbol(A$, ")", True)
       Else
        A$ = n$: MissParam A$
  End If
Case "IMAGE.X(", "ΕΙΚΟΝΑ.Χ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
    r = SG * cDIBwidth(s$) * DXP
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
     Else
            A$ = n$
            MyErMacro A$, "Νο image in string", "Δεν υπάρχει εικόνα στο αλφαριθμητικό"
        End If
    Else
        A$ = n$: MissParam A$
    End If
    Exit Function
Case "IMAGE.Y(", "ΕΙΚΟΝΑ.Υ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
        If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
            r = SG * cDIBheight(s$) * DYP
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
        Else
            A$ = n$
            MyErMacro A$, "Νο image in string", "Δεν υπάρχει εικόνα στο αλφαριθμητικό"
        End If
    Else
        A$ = n$: MissParam A$
    End If
    Exit Function
Case "IMAGE.X.PIXELS(", "ΕΙΚΟΝΑ.Χ.ΣΗΜΕΙΑ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
    r = SG * cDIBwidth(s$)
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
     Else
            A$ = n$
            MyErMacro A$, "Νο image in string", "Δεν υπάρχει εικόνα στο αλφαριθμητικό"
        End If
    Else
        A$ = n$: MissParam A$
    End If
    Exit Function
Case "IMAGE.Y.PIXELS(", "ΕΙΚΟΝΑ.Υ.ΣΗΜΕΙΑ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
        If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
            r = SG * cDIBheight(s$)
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
        Else
            A$ = n$
            MyErMacro A$, "Νο image in string", "Δεν υπάρχει εικόνα στο αλφαριθμητικό"
        End If
    Else
        A$ = n$: MissParam A$
    End If
    Exit Function
    Case "VALID(", "ΕΓΚΥΡΟ("
    A$ = n$
    w1 = 1
    s$ = aheadstatus(n$, True, w1) & "   "  ' version 6.5(11)

    If Left$(s$, 1) = "S" And Not Left$(s$, 3) = "SoN" Then
        If IsStrExp(bstack, n$, s$) Then
    
             r = SG * FastSymbol(n$, ")", True)
             If r = 0 Then
             A$ = Mid$(A$, w1)
               w1 = CLng(FastSymbol(A$, ")"))
             Else
               A$ = n$
               End If
Else
r = 1
If Len(n$) + w1 > Len(A$) Then
'false
r = 0
End If

A$ = Mid(A$, w1)
r = r * SG * FastSymbol(A$, ")", True)

       End If
    ElseIf LastErNum <> 0 Then
    GoTo jumphere
    
    ElseIf IsExp(bstack, n$, p) Then

              r = SG * FastSymbol(n$, ")", True)
              If r = 0 Then
                   A$ = Mid$(A$, w1)
                   w1 = CLng(FastSymbol(A$, ")")) ' throw it
                Else
                    A$ = n$
                End If
    Else
jumphere:
    LastErNum = 0
    A$ = Mid$(A$, w1)
      w1 = CLng(FastSymbol(A$, ")"))
          r = 0
        End If
        IsNumber = True
        LastErNum = 0
    Exit Function
Case "EVAL(", "ΕΚΦΡ(", "ΕΚΦΡΑΣΗ("
    IsNumber = False
    If IsExp(bstack, n$, p) Then
        If Typename(bstack.lastobj) = "mHandler" Then
            Set anything = bstack.lastobj
            With anything
                If .T1 = 1 Then
                    On Error GoTo there12
                    If .objref.Done Then
                         If FastSymbol(n$, "!") Then
                            r = SG * .objref.index
                            Set bstack.lastobj = Nothing
                        Else
                            If .objref.IsObj Then
                                r = SG * CDbl(rValue(bstack, .objref.ValueObj))
                            Else
                                r = SG * val(.objref.Value)
                                Set bstack.lastobj = Nothing
                            End If
                        End If
                        A$ = n$
                        IsNumber = FastSymbol(A$, ")", True)
                    End If
there12:
                    Set anything = Nothing
                    Exit Function
                ElseIf .T1 = 2 Then
                    ' p is offset for items not bytes
                    If FastSymbol(n$, ",") Then
                        If IsExp(bstack, n$, p) Then
                        
                            w1 = Abs(Asc(v$) < 128)
                            If IsLabelSymbolNew(n$, "ΩΣ", "AS", w1, , , , False) Then
                                If IsLabelSymbolNew(n$, "ΨΗΦΙΟ", "BYTE", w1, , , , False) Then
                                    PP = 1
                                ElseIf IsLabelSymbolNew(n$, "ΑΚΕΡΑΙΟΣ", "INTEGER", w1, , , , False) Then
                                    PP = 2
                                ElseIf IsLabelSymbolNew(n$, "ΜΑΚΡΥΣ", "LONG", w1, , , , False) Then
                                    PP = 4
                                ElseIf IsLabelSymbolNew(n$, "ΔΙΠΛΟΣ", "DOUBLE", w1, , , , False) Then
                                    PP = 8
                                Else
                                    SyntaxError
                                    A$ = n$
                                    Exit Function
                                End If
                                ' use another itemsize
                                ' p is byte offset
                                w2 = .objref.GetBytePtr(p)
absolute:
                                If .objref.ValidArea(w2, PP) Then
                                    Select Case PP
                                    Case 1
                                        GetMem1 w2, rB
                                        r = SG * CDbl(rB)
                                    Case 2
                                        GetMem2 w2, ri
                                        r = SG * CDbl(UINT(CLng(ri)))
                                    Case 4
                                        GetMem4 w2, dn
                                        r = SG * CDbl(uintnew(CDbl(dn)))
                                    Case 8
                                        GetMem8 w2, r
                                        r = SG * r
                                    End Select
                                Else
                                    GoTo errortext
                                End If
                            
                            Else
firstpram:
                                Set anything = .objref
                                With anything
         
                                 PP = .ItemSize
                                 If FastSymbol(n$, "!") Then
                                     If IsLabelOnly(n$, s$) Then
                                                If .structref.Find(myUcase(s$, True)) Then
                                                       PP = .structref.sValue
                                                       If FastSymbol(n$, "!") Then
                                                           If Not IsExp(bstack, n$, r) Then
                                                                    GoTo errortext1
                                                           ElseIf r >= 0 Then
                                                           
                                                                    w2 = cUlng(uintnew(.GetPtr(p)) + .structref.Value + Int(r) * PP)
                                                                    GoTo absolute
                                                           Else
                                                                    MyEr "negative index", "αρνητικός δείκτη"
                                                                   GoTo errortext1
                                                           End If
                                                       Else
                                                           w2 = cUlng(uintnew(.GetPtr(p)) + .structref.Value)
                                                           GoTo absolute
                                                       End If
                                                 Else
                                                    MyErMacro n$, "Unknown Offset " & s$, "’γνωστη Μετάθεση " & s$
                                                    GoTo errortext1
                                                 End If
                                    End If
                                End If
                                Select Case PP
                                Case 1
                                    If .ValidArea2(p, 1) Then
                                        GetMem1 .GetPtr(p), rB
                                        r = SG * CDbl(rB)
                                    Else
                                        GoTo errortext
                                    End If
                                Case 2
                                    If .ValidArea2(p, 2) Then
                                        GetMem2 .GetPtr(p), ri
                                        r = SG * CDbl(UINT(CLng(ri)))
                                    Else
                                        GoTo errortext
                                    End If
                                Case 8
                                    If .ValidArea2(p, 8) Then
                                        GetMem8 .GetPtr(p), r
                                        r = SG * r
                                    Else
                                        GoTo errortext
                                    End If
                                Case 4
                                    If .ValidArea2(p, 4) Then
                                        GetMem4 .GetPtr(p), dn
                                        r = SG * CDbl(uintnew(CDbl(dn)))
                                    Else
errortext:
                                         MyEr "Wrong Size-Position for reading buffer", "Λάθος Μέγεθος-θέση, για διάβασμα Διάρθρωσης"
errortext1:
                                        Set anything = Nothing
                                        
                                        A$ = n$
                                        Exit Function
                                    End If
                                End Select
                                
               
                                End With
                            End If
                                           IsNumber = FastSymbol(n$, ")", True)
                                A$ = n$
                                Set anything = Nothing
                                Exit Function
                        End If
                    Else
                    p = 0
                    GoTo firstpram
                    End If
               Else
                    ' eval for objects???
                    r = 0
                       IsNumber = FastSymbol(n$, ")", True)
                       Exit Function
               End If
               Set anything = Nothing
            End With
        End If
        A$ = n$
        MissParam A$
    ElseIf IsStrExp(bstack, n$, s$) Then
    If FastSymbol(n$, ".") Then
    If MaybeIsSymbol(n$, ")") Then
            n$ = s$ + n$
        Else
        n$ = s$ + "." + n$
        End If
        If Not IsExp(bstack, n$, r) Then
          A$ = n$
            MyErMacro A$, "Wrong weak reference", "λάθος ισχνής αναφοράς"
        Else
            r = SG * r
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
        End If
    Else
    
            If Not IsExp(bstack, s$, r) Then
            A$ = n$
            MyErMacro A$, "Wrong expression in string", "λάθος μαθηματική έκφραση στο αλφαριθμητικό"
            Else
            r = SG * r
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
            End If
    End If
    Else
    A$ = n$: MissParam A$
    End If
    Exit Function
Case "POINT(", "ΣΗΜΕΙΟ("

    If IsStrExp(bstack, n$, s$) Then
        If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
            If FastSymbol(n$, ",") Then
                If Not IsExp(bstack, n$, r2) Then A$ = n$: MissParam A$: Exit Function
                If FastSymbol(n$, ",") Then
                    If Not IsExp(bstack, n$, r3) Then A$ = n$: MissParam A$: Exit Function
                    r = SG * GetDIBPixel(s$, r2, r3)
                    A$ = n$
                    
                    IsNumber = FastSymbol(A$, ")", True)
                Else
                    
                     A$ = n$: MissParam A$: Exit Function
                End If
            Else
                A$ = n$: MissParam A$: Exit Function
            End If
        Else
            r = 0
         A$ = n$
         MyErMacro A$, "Νο image in string", "Δεν υπάρχει εικόνα στο αλφαριθμητικό"
         Exit Function
        End If
     Else
   A$ = n$
     MissParam A$
    End If
   Exit Function
Case "CTIME(", "ΥΠΩΡΑ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
  
    r = Abs(r)
    par = True
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r2)
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r3) And par
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r4) And par
    End If
    End If
    End If
    A$ = n$
       If Not par Then
     MissParam A$
     Exit Function
                End If
                On Error Resume Next
    r = SG * CDbl(TimeSerial(Hour(CDate(r)) + r2, Minute(CDate(r)) + r3, Second(CDate(r)) + r4))
                If Err.Number > 0 Then
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
    Err.Clear
    Exit Function
    End If
     IsNumber = FastSymbol(A$, ")", True)
      Else
   A$ = n$
     MissParam A$
    End If
    Exit Function
    
Case "CDATE(", "ΥΠΜΕΡ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then
   
    r = Abs(r Mod 2958466)
    par = True
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r2)
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r3) And par
    If FastSymbol(n$, ",") Then
    par = IsExp(bstack, n$, r4) And par
    
    End If
    End If
    End If
    A$ = n$
    If Not par Then
     MissParam A$
     Exit Function
                End If
                On Error Resume Next
     r = SG * CDbl(DateSerial(Year(r) + r2, Month(r) + r3, Day(r) + r4))
              If Err.Number > 0 Then
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
    Err.Clear
    Exit Function
    End If
    
 IsNumber = FastSymbol(A$, ")", True)
   Else
   A$ = n$
     MissParam A$
    
    End If
    
     Exit Function
Case "TIME(", "ΧΡΟΝΟΣ("
IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    On Error Resume Next
    
    r = SG * CDbl(CDate(TimeValue(s$)))
         If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
    Err.Clear
    Exit Function
    End If
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
     A$ = n$
                MissParam A$
    End If
    Exit Function
Case "DATE(", "ΗΜΕΡΑ("
 IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    On Error Resume Next
    r = SG * CDbl(DateValue(s$))
     If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
    Err.Clear
    Exit Function
    End If
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
      Else
     A$ = n$
                MissParam A$
    End If
    Exit Function
Case "VAL(", "ΤΙΜΗ(", "ΑΞΙΑ("
 IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    On Error Resume Next
    If FastSymbol(n$, ",") Then
      If IsStrExp(bstack, n$, ex$) Then
      If Len(ex$) = -0 Then
      dd = AscW(GetlocaleString(22))
      Else
          dd = AscW(ex$)
          End If
    Else
    A$ = n$
    MyErMacro A$, "Expected decimal separator char", "Περίμενα χαρακτήρα διαχωρισμού δεκαδικών"
    Err.Clear
    Exit Function
      End If
    Else
    dd = AscW(GetDeflocaleString(22))
    End If
    If dd = 46 Then
    r = SG * val(s$)
    Else
    r = SG * val(Replace(s$, ChrW(dd), "."))
    End If
    If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
    Err.Clear
    Exit Function
    End If
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
     A$ = n$
                MissParam A$
    End If
    Exit Function
Case "RINSTR(", "ΘΕΣΗΔΕΞΙΑ("
 IsNumber = False
  
      If IsStrExp(bstack, n$, s$) Then
    If FastSymbol(n$, ",") Then
    If IsStrExp(bstack, n$, s1$) Then
        If FastSymbol(n$, ",") Then
        If Not IsExp(bstack, n$, r) Then
   
              A$ = n$
                MissParam A$
        Exit Function
        End If
             r = Len(s$) - r + 1
        If r < 0 Then r = 1
        If r > Len(s$) Then r = Len(s$)
        Else
        r = Len(s$)
        End If
    r = SG * InStrRev(s$, s1$, r)
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$
                MissParam A$
    End If
        Else
    A$ = n$
                MissParam A$
    End If
        Else
    A$ = n$
                MissParam A$
    End If
    Exit Function

Case "INSTR(", "ΘΕΣΗ("
IsNumber = False

    If IsStrExp(bstack, n$, s$) Then
    If FastSymbol(n$, ",") Then
    If IsStrExp(bstack, n$, s1$) Then
        If FastSymbol(n$, ",") Then
        If Not IsExp(bstack, n$, r) Then
          A$ = n$
                MissParam A$
         Exit Function
        End If
        Else
        r = 1
        End If
    r = SG * InStr(r, s$, s1$)
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
    Else
    A$ = n$
                MissParam A$
    End If
        Else
    A$ = n$
                MissParam A$
    End If
        Else
    A$ = n$
                MissParam A$
    End If
    
    Exit Function

Case "RECORDS(", "ΕΓΓΡΑΦΕΣ("
 IsNumber = False

    If IsExp(bstack, n$, r) Then
        VR = r Mod 512
        If FLEN(VR) = 0 Then
            MyErMacro n$, "not valid file number", "λάθος αριθμός αρχείου"
            A$ = n$
        Else
            r = SG * LOF(VR) / FLEN(VR)
            A$ = n$
            IsNumber = FastSymbol(A$, ")", True)
        End If
    Else
        A$ = n$
        MissParam A$
    End If
    Exit Function
Case "GROUP.COUNT(", "ΟΜΑΔΑ.ΣΥΝΟΛΟ("


        If Abs(IsLabel(bstack, n$, s$)) = 1 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = "Group" Then
                
                    r = SG * var(w1).PrepareSoros(var(), "").Total
                Else
                A$ = n$
                MissingGroup
                Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
                Exit Function
            Else
            A$ = n$
            Nosuchvariable s$
            End If
        Else
        A$ = n$
        MissingGroup
       End If
       Exit Function
Case "PARAGRAPH(", "ΠΑΡΑΓΡΑΦΟΣ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
                  
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
        
                       If IsExp(bstack, n$, PP) Then
                                dn = CLng(PP)
                              r = SG * var(w1).ParagraphFromOrder(dn)           ''
                                 
                            
                                 Else
                                       MissNumExpr
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
         
               Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                                If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
                            If IsExp(bstack, s$, PP) Then
                                dn = CLng(PP)
                                 r = SG * pppp.item(w2).ParagraphFromOrder(dn)
                                 Else
                                        MissNumExpr
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
                  Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissFuncParameterStringVarMacro A$
    End If
    Exit Function
Case "PARAGRAPH.INDEX(", "ΑΡΙΘΜΟΣ.ΠΑΡΑΓΡΑΦΟΥ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
                  
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
                         w2 = Abs(IsLabel(bstack, n$, s$)) ' ONLY AN ARITHMETIC VAR.
    
                        If w2 = 1 Or w2 = 4 Then
                                If GetVar(bstack, s$, w2) Then
                                dn = var(w2)
                              r = SG * var(w1).ParagraphOrder(dn)           ''
                                 
                            
                                 Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
                         
                        Else
                                        MissingnumVar
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                                If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
                         w1 = Abs(IsLabel(bstack, n$, s$)) ' ONLY AN ARITHMETIC VAR..
                        If w1 = 1 Or w1 = 2 Then
                                If GetVar(bstack, s$, w1) Then
                                dn = var(w1)
                                 r = SG * pppp.item(w2).ParagraphOrder(dn)
                                 Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
                         
                        Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissFuncParameterStringVarMacro A$
    End If
    Exit Function
Case "BACKWARD(", "ΠΙΣΩ("
    dd = 1
    GoTo forward
Case "FORWARD(", "ΜΠΡΟΣΤΑ("
forward:
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
                         w2 = Abs(IsLabel(bstack, n$, s$)) ' ONLY AN ARITHMETIC VAR..
                        If w2 = 1 Or w2 = 4 Then
                                If GetVar(bstack, s$, w2) Then
                                dn = var(w2)
                                If dd = 1 Then
                                var(w1).BackStep dn
                                var(w1).BackMove = True
                                Else
                                var(w1).BackMove = False
                                var(w1).Advance dn
                                End If
                                 r = SG * Not var(w1).IsEmpty
                                 '    r = SG * var(w1).ParagraphOrder(dn)          ''
                                 
                                 var(w2) = dn
                                 Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
                         
                        Else
                                        MissingnumVar
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                                If Not FastSymbol(n$, ",") Then A$ = n$: MissParam A$: Exit Function
                         w1 = Abs(IsLabel(bstack, n$, s$)) ' ONLY AN ARITHMETIC VAR..
                         If w1 = 1 Or w1 = 2 Then
                                If GetVar(bstack, s$, w1) Then
                                dn = var(w1)
                                 If dd = 1 Then
                                pppp.item(w2).BackStep dn
                                pppp.item(w2).BackMove = True
                                Else
                              pppp.item(w2).BackMove = False
                                 pppp.item(w2).Advance dn
                                End If
                                r = SG * Not pppp.item(w2).IsEmpty
                                '' r = SG * pppp.item(w2).ParagraphOrder(dn)
                                
                                 var(w1) = dn
                                 Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                                 End If
                         
                        Else
                                        Nosuchvariable s$
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        A$ = n$
                                        IsNumber = False
                                        Exit Function
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissFuncParameterStringVarMacro A$
    End If
    Exit Function
Case "DOC.PAR(", "ΕΓΓΡΑΦΟΥ.ΠΑΡ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))

        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).DocParagraphs
                Else
                    r = 0
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).DocParagraphs
                      Else
                      r = 0
                      End If
                Else
                
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissFuncParameterStringVarMacro A$
    End If
    Exit Function
Case "MAX.DATA(", "ΜΕΓΑΛΟ.ΣΕΙΡΑΣ("
 IsNumber = False
  If IsExp(bstack, n$, r) Then
  
  Do While FastSymbol(n$, ",")
  If Not IsExp(bstack, n$, p) Then A$ = n$: MissNumExpr: Exit Function
  If p > r Then r = p
  
  Loop
  r = SG * r
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
        Else
     A$ = n$: MissNumExpr
        End If
    Exit Function
Case "MIN.DATA(", "ΜΙΚΡΟ.ΣΕΙΡΑΣ("
 IsNumber = False
  If IsExp(bstack, n$, r) Then
  
  Do While FastSymbol(n$, ",")
  If Not IsExp(bstack, n$, p) Then A$ = n$: MissNumExpr: Exit Function
  If p < r Then r = p
  
  Loop
  r = SG * r
    A$ = n$
    IsNumber = FastSymbol(A$, ")", True)
        Else
     A$ = n$: MissNumExpr
        End If
    Exit Function
Case "MAX(", "ΜΕΓΑΛΟ("
dn = 2
GoTo comp1
Case "MIN(", "ΜΙΚΡΟ("
dn = 1
GoTo comp1
Case "COMPARE(", "ΣΥΓΚΡΙΝΕ("
comp1:
IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
    If w1 = 1 Or w1 = 4 Then dd = 1  'WE NEED NUMBERS
    If w1 = 5 Or w1 = 7 Then dd = 2 'WE NEED NUMBERS
    If w1 = 0 Then MissingnumVar: A$ = n$: Exit Function
    If (w1 = 3 Or w1 = 6) And dd > 0 Then SyntaxError: A$ = n$: Exit Function
    If dd = 1 Then
        If GetVar(bstack, s$, w1) Then
                If Not FastSymbol(n$, ",") Then MissingnumVar: A$ = n$: Exit Function
                W3 = Abs(IsLabel(bstack, n$, s1$))
            If W3 = 1 Or W3 = 4 Then
                If GetVar(bstack, s1$, w2) Then
                Select Case dn
                Case 1
                    If var(w1) < var(w2) Then
                        r = SG * var(w1)
                    Else
                        r = SG * var(w2)
                    End If
                Case 2
                    If var(w1) > var(w2) Then
                        r = SG * var(w1)
                    Else
                        r = SG * var(w2)
                    End If
                Case Else
                    If var(w1) = 0 Then
                    If var(w2) = 0 Then
                    r = 0
                    Else
                    r = SG * Sgn(0 - MyRound(var(w2), 10))
                    End If
                    Else
                    r = SG * Sgn(MyRound(((var(w1) - var(w2)) / var(w1)), 10))
                    End If
                
                
                  
                End Select
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                Exit Function
                Else
                    Nosuchvariable s1$
                    A$ = n$
                    Exit Function
                End If
            ElseIf W3 = 5 Or W3 = 7 Then
                If neoGetArray(bstack, s1$, pppp) Then
                    If Not NeoGetArrayItem(pppp, bstack, s1$, w2, n$) Then Exit Function
                    Select Case dn
                Case 1
                    If var(w1) < pppp.item(w2) Then
                        r = SG * var(w1)
                    Else
                        r = SG * pppp.item(w2)
                    End If
                Case 2
                    If var(w1) > pppp.item(w2) Then
                        r = SG * var(w1)
                    Else
                        r = SG * pppp.item(w2)
                    End If
              Case Else
                   If var(w1) = 0 Then
                            If pppp.item(w2) = 0 Then
                            r = 0
                            Else
                            r = SG * Sgn(0 - MyRound(pppp.item(w2), 10))
                            End If
                    Else
                            r = SG * Sgn(MyRound(((var(w1) - pppp.item(w2)) / var(w1)), 10))
                    End If
              
                
                    End Select
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                Else
                    Nosuchvariable s1$
                    A$ = n$
                    Exit Function
                End If
            Else
                MissingnumVar
                A$ = n$
                Exit Function
            End If
        Else
            Nosuchvariable s$
            A$ = n$
            Exit Function
        End If
        
    ElseIf dd = 2 Then
        If neoGetArray(bstack, s$, pppp) Then
            If Not NeoGetArrayItem(pppp, bstack, s$, w1, n$) Then Exit Function
            If Not FastSymbol(n$, ",") Then MissingnumVar: A$ = n$: Exit Function
                W3 = Abs(IsLabel(bstack, n$, s1$))
            If W3 = 1 Or W3 = 4 Then
                    If GetVar(bstack, s1$, w2) Then
                    Select Case dn
                    Case 1
                        If pppp.item(w1) < var(w2) Then
                            r = SG * pppp.item(w1)
                        Else
                            r = SG * var(w2)
                        End If
                    Case 2
                        If pppp.item(w1) > var(w2) Then
                            r = SG * pppp.item(w1)
                        Else
                            r = SG * var(w2)
                        End If
                    Case Else
                    
                    
                      If pppp.item(w1) = 0 Then
                            If var(w2) = 0 Then
                            r = 0
                            Else
                            r = SG * Sgn(0 - MyRound(var(w2), 10))
                            End If
                    Else
                            r = SG * Sgn(MyRound(((pppp.item(w1) - var(w2)) / pppp.item(w1)), 10))
                    End If
                        
                    End Select
                        A$ = n$
                        IsNumber = FastSymbol(A$, ")", True)
                    Else
                        MissingnumVar
                        A$ = n$
                        Exit Function
                    End If
            ElseIf W3 = 5 Or W3 = 7 Then
                    If neoGetArray(bstack, s1$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, s1$, w2, n$) Then Exit Function
                    Select Case dn
                    Case 1
                        If pppp.item(w1) < pppp.item(w2) Then
                            r = SG * pppp.item(w1)
                        Else
                            r = SG * pppp.item(w2)
                        End If
                    Case 2
                        If pppp.item(w1) > var(w2) Then
                            r = SG * pppp.item(w1)
                        Else
                            r = SG * pppp.item(w2)
                        End If
                    Case Else
          If pppp.item(w1) = 0 Then
                            If pppp.item(w2) = 0 Then
                            r = 0
                            Else
                            r = SG * Sgn(0 - MyRound(pppp.item(w2), 10))
                            End If
                    Else
                            r = SG * Sgn(MyRound(((pppp.item(w1) - pppp.item(w2)) / pppp.item(w1)), 10))
                    End If
                    End Select
                        A$ = n$
                        IsNumber = FastSymbol(A$, ")", True)
                    Else
                        MissingnumVar
                        A$ = n$
                        Exit Function
                    End If
            Else
                MissingnumVar
                A$ = n$
                Exit Function
            End If
        Else
            MissingnumVar
            A$ = n$
            Exit Function
        End If
    ElseIf w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
            If Not FastSymbol(n$, ",") Then MissingnumVar: A$ = n$: Exit Function
                W3 = Abs(IsLabel(bstack, n$, s1$))
                If W3 = 6 Then
                    If Not neoGetArray(bstack, s1$, pppp) Then MissingStrVar: A$ = n$:  Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, s1$, w2, n$) Then Exit Function

                    r = SG * StrComp(var(w1), pppp.item(w2))

                ElseIf W3 = 3 Then
                    If Not GetVar(bstack, s1$, w2) Then A$ = n$: Exit Function

                    r = SG * StrComp(var(w1), var(w2))
                            Else
                A$ = n$
                MissFuncParameterStringVarMacro A$
                Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
            End If
    ElseIf w1 = 6 Then
            If neoGetArray(bstack, s$, pppp) Then
                If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                If Not FastSymbol(n$, ",") Then MissingnumVar: A$ = n$: Exit Function
                W3 = Abs(IsLabel(bstack, n$, s1$))
                If W3 = 6 Then
                    If Not neoGetArray(bstack, s1$, pppp1) Then MissingStrVar: A$ = n$:  Exit Function
                    If Not NeoGetArrayItem(pppp1, bstack, s1$, W3, n$) Then Exit Function

                    r = SG * StrComp(pppp.item(w2), pppp1.item(W3))
 
                ElseIf W3 = 3 Then
                    If Not GetVar(bstack, s1$, W3) Then A$ = n$: Exit Function

                    r = SG * StrComp(pppp.item(w2), var(W3))
                Else
                A$ = n$
                MissFuncParameterStringVarMacro A$
                Exit Function
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                A$ = n$
                MissParam A$
            End If
    Else
                 A$ = n$
                MissParam A$
    End If
    Exit Function
Case "DOC.UNIQUE.WORDS(", "ΕΓΓΡΑΦΟΥ.ΜΟΝΑΔΙΚΕΣ.ΛΕΞΕΙΣ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).UniqueWords
                Else
                MissFuncParammeterdOCVar A$
               End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).UniqueWords
                      Else
                       MissFuncParammeterdOCVar A$
                
                      End If
                Else
                
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
    
Case "DOC.WORDS(", "ΕΓΓΡΑΦΟΥ.ΛΕΞΕΙΣ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).WordCount
                Else
                MissFuncParammeterdOCVar A$
               End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).WordCount
                      Else
                       MissFuncParammeterdOCVar A$
                
                      End If
                Else
                
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
    
Case "DOC.LEN(", "ΕΓΓΡΑΦΟΥ.ΜΗΚΟΣ("
 IsNumber = False
    w1 = Abs(IsLabel(bstack, n$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).SizeCRLF
                Else
                    r = SG * Len(var(w1))
                End If
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
            Else
                    A$ = n$
                    MissFuncParameterStringVarMacro A$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, n$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).SizeCRLF
                      Else
                      r = SG * Len(pppp.item(w2))
                      End If
                Else
                
                End If
                    A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
Case "LEN.DISP(", "ΜΗΚΟΣ.ΕΜΦ("
 IsNumber = False
    
    If IsExp(bstack, n$, p) Then
    If Typename(bstack.lastobj) = "mHandler" Then
    
    With bstack.lastobj
    If .Indirect < 0 Then
    If TypeOf .objref Is FastCollection Then
        r = SG * .objref.count
        A$ = n$
        IsNumber = FastSymbol(A$, ")", True)
        Exit Function
    ElseIf TypeOf .objref Is MemBlock Then
        r = SG * .objref.items
        A$ = n$
        IsNumber = FastSymbol(A$, ")", True)
        Exit Function
    End If
    Else
     r = SG * -1
     IsNumber = FastSymbol(A$, ")", True)
        Exit Function
    ' length of object???
    End If
    End With
    End If
    A$ = n$
    MissParam A$
    ElseIf IsStrExp(bstack, n$, s$) Then
    r = SG * RealLen(s$)
    A$ = n$
    
    IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
Case "LEN(", "ΜΗΚΟΣ("
 IsNumber = False
    If IsExp(bstack, n$, p) Then
        If Typename(bstack.lastobj) = "mHandler" Then
        
            With bstack.lastobj
                If .Indirect < 0 Then
                    If .T1 = 1 Then
                            If .objref.StructLen > 0 Then
                                r = SG * .objref.StructLen
                            Else
                                r = SG * .objref.count
                            End If
                            A$ = n$
                            IsNumber = FastSymbol(A$, ")", True)
                            Set bstack.lastobj = Nothing
                        Exit Function
                    ElseIf .T1 = 2 Then
                        r = SG * .objref.SizeByte()
                        A$ = n$
                        IsNumber = FastSymbol(A$, ")", True)
                        Set bstack.lastobj = Nothing
                        Exit Function
                    End If
                Else
                    r = SG * -1
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                End If
            End With
        Else
                r = SG * -1
                A$ = n$
                IsNumber = FastSymbol(A$, ")", True)
        End If
        A$ = n$
        MissParam A$
    ElseIf IsStrExp(bstack, n$, s$) Then
        r = SG * Len(s$)
        A$ = n$
        IsNumber = FastSymbol(A$, ")", True)
    Else
        A$ = n$
        MissParam A$
    End If
    Exit Function
Case "SQRT(", "ΡΙΖΑ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then
    A$ = n$
    If r <= 0 Then
    MyErMacro A$, "negative or zero number", "αρνητικός ή μηδέν σε ρίζα"
    Exit Function
   
    End If
  
    r = SG * Sqr(r)
    
    
   IsNumber = FastSymbol(A$, ")", True)
    Else
                A$ = n$
                MissParam A$
    
    End If
     Exit Function
Case "FREQUENCY(", "ΣΥΧΝΟΤΗΤΑ("
IsNumber = False
    If IsExp(bstack, n$, r) Then
           If FastSymbol(n$, ",") Then
                If IsExp(bstack, n$, p) Then
                    r = SG * GetFrequency(CInt(r), CInt(p))
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                    Else
                A$ = n$
                MissParam A$
                End If
            Else
                A$ = n$
                MissParam A$
            End If
     Else
                A$ = n$
                MissParam A$
     End If
     Exit Function
Case "LOG(", "ΛΟΓ("
IsNumber = False
    If IsExp(bstack, n$, r) Then
        If r <= 0 Then
       MyErMacro A$, "Only > zero parameter", "Μόνο >0 παράμετρος"
        IsNumber = False: Exit Function
    Else
    r = SG * Log(r) / Log(10#)
    A$ = n$
    End If
   IsNumber = FastSymbol(A$, ")", True)
    Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
 Case "LN(", "ΛΦ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then
    If r <= 0 Then
       MyErMacro A$, "Only > zero parameter", "Μόνο >0 παράμετρος"
        IsNumber = False: Exit Function
    Else
    r = SG * Log(r)
    A$ = n$
    End If
    
 IsNumber = FastSymbol(A$, ")", True)
     Else
                A$ = n$
                MissParam A$
    
    End If
     Exit Function
Case "ATN(", "ΤΟΞ.ΕΦ("
IsNumber = False
    If IsExp(bstack, n$, r) Then
     A$ = n$
     r = SG * Atn(r) * 180# / Pi
        
IsNumber = FastSymbol(A$, ")", True)
     Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
 Case "TAN(", "ΕΦΑΠ("
  IsNumber = False
    If IsExp(bstack, n$, r) Then
     A$ = n$
     If r = Int(r) Then
        If r Mod 90 = 0 And r Mod 180 <> 0 Then
        MyErMacro A$, "Wrong Tan Parameter", "Λάθος παράμετρος εφαπτομένης"
        IsNumber = False: Exit Function
        End If
        End If
    r = Sgn(r) * Tan(r * Pi / 180#)

     If Abs(r) < 1E-16 Then r = 0
     If Abs(r) < 1 And Abs(r) + 0.0000000000001 >= 1 Then r = Sgn(r)
   r = SG * r
    
IsNumber = FastSymbol(A$, ")", True)
     Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
 Case "COS(", "ΣΥΝ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then

    r = Cos(r * Pi / 180#)
 
    If Abs(r) < 1E-16 Then r = 0
    r = SG * r
    A$ = n$
    
  IsNumber = FastSymbol(A$, ")", True)
    Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
 Case "SIN(", "ΗΜ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then
    r = Sin(r * Pi / 180#)
    ''r = Sgn(r) * Int(Abs(r) * 10000000000000#) / 10000000000000#
    If Abs(r) < 1E-16 Then r = 0
    r = SG * r
    A$ = n$
    
 IsNumber = FastSymbol(A$, ")", True)
    Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
 Case "ABS(", "ΑΠΟΛ("
   IsNumber = False
    If IsExp(bstack, n$, r) Then
    r = SG * Abs(r)
    A$ = n$
    
 IsNumber = FastSymbol(A$, ")", True)
    Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
Case "LOWORD(", "LOWWORD(", "ΚΑΤΩΜΙΣΟ("
  IsNumber = False
If IsExp(bstack, n$, r) Then
    On Error Resume Next
    
    r = SG * Int((r - Int(r / 65536#) * 65536#))
    If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
        Exit Function
    
    End If
    A$ = n$
    
   IsNumber = FastSymbol(A$, ")", True)
        Else
                A$ = n$
                MissParam A$
 End If
 Exit Function
Case "HIWORD(", "HIGHWORD(", "ΠΑΝΩΜΙΣΟ("
    If IsExp(bstack, n$, r) Then
    On Error Resume Next
    
    r = SG * Int(Int(r / 256) / 256)
    If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, Err.Description, "Λάθος όρισμα"
  
    IsNumber = False
    Exit Function
    End If
    A$ = n$
    
IsNumber = FastSymbol(A$, ")", True)
      Else
                A$ = n$
                MissParam A$
    
    End If
    Exit Function
    Case "BINARY.NEG(", "ΔΥΑΔΙΚΟ.ΑΝΤΙ(", "ΔΥΑΔΙΚΟ.ΑΝΤΙΣΤΡΟΦΟ("
      IsNumber = False
    If IsExp(bstack, n$, r) Then
            On Error Resume Next
    
             r = SG * uintnew(-1) - uintnew(r)
        If Err.Number > 0 Then
            A$ = n$
            MyErMacro A$, Err.Description, "Λάθος όρισμα"
          
            Exit Function
            End If
    A$ = n$
    
IsNumber = FastSymbol(A$, ")", True)
   Else
                A$ = n$
                MissParam A$
    
    End If
     Exit Function
    Case "BINARY.OR(", "ΔΥΑΔΙΚΟ.Η("
    IsNumber = False
        If IsExp(bstack, n$, r) Then
        If FastSymbol(n$, ",") Then
        If IsExp(bstack, n$, p) Then
            r = SG * uintnew((signlong(r) Or signlong(p)))
            A$ = n$
         IsNumber = FastSymbol(A$, ")", True)
           Else
                A$ = n$
                MissParam A$
        End If
          Else
                A$ = n$
                MissParam A$
       End If
         Else
                A$ = n$
                MissParam A$
       End If
       Exit Function
    Case "BINARY.AND(", "ΔΥΑΔΙΚΟ.ΚΑΙ("
        If IsExp(bstack, n$, r) Then
            If FastSymbol(n$, ",") Then
                If IsExp(bstack, n$, p) Then
                    r = SG * uintnew((signlong(r) And signlong(p)))
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                Else
                    A$ = n$
                    MissParam A$
                End If
            Else
                A$ = n$
                MissParam A$
            End If
        Else
            A$ = n$
            MissParam A$
       
       End If
       Exit Function
           Case "BINARY.XOR(", "ΔΥΑΔΙΚΟ.ΑΠΟ("
        If IsExp(bstack, n$, r) Then
            If FastSymbol(n$, ",") Then
                If IsExp(bstack, n$, p) Then
                    r = SG * uintnew((signlong(r) Xor signlong(p)))
                    A$ = n$
                    IsNumber = FastSymbol(A$, ")", True)
                Else
                    A$ = n$
                    MissParam A$
                End If
            Else
                A$ = n$
                MissParam A$
            End If
        Else
            A$ = n$
            MissParam A$
       
       End If
Exit Function
Case "HILOWWORD(", "ΔΥΟΜΙΣΑ("
 IsNumber = False
    If IsExp(bstack, n$, r) Then
        If FastSymbol(n$, ",") Then
              If IsExp(bstack, n$, p) Then
                    r = SG * (r * &H10000 + p)
                    A$ = n$
                     IsNumber = FastSymbol(A$, ")", True)
                  Else
                     A$ = n$
                    MissParam A$
                End If
        Else
             A$ = n$
             MissParam A$
        End If
     Else
             A$ = n$
             MissParam A$
      End If
     
        Exit Function
Case "BINARY.SHIFT(", "ΔΥΑΔΙΚΟ.ΟΛΙΣΘΗΣΗ("
IsNumber = False
   If IsExp(bstack, n$, r) Then
  
            If FastSymbol(n$, ",") Then
                    If IsExp(bstack, n$, p) Then
                         If p > 31 Or p < -31 Then
                         A$ = n$
                         MyErMacro A$, "Shift from -31 to 31", "Ολίσθηση από -31 ως 31"
                         IsNumber = False: Exit Function
                         Else
                               If p > 0 Then
                              r = SG * uintnew((signlong(r) And signlong(2 ^ (32 - p) - 1))) * 2 ^ p
                              ElseIf p = 0 Then
                              r = SG * r
                              Else
                              p = -p
                               r = SG * uintnew((signlong(r) And signlong(uintnew(-1) - uintnew(2 ^ p - 1)))) / 2 ^ p
                              End If
                              A$ = n$
                            IsNumber = FastSymbol(A$, ")", True)
                    Exit Function
                         End If
                    Else
                          A$ = n$
                        MissParam A$
                    End If
            Else
                A$ = n$
                MissParam A$
            End If
    Else
            A$ = n$
            MissParam A$
   End If
         Exit Function
Case "BINARY.ROTATE(", "ΔΥΑΔΙΚΗ.ΠΕΡΙΣΤΡΟΦΗ("
IsNumber = False
        If IsExp(bstack, n$, r) Then
             If FastSymbol(n$, ",") Then
                 If IsExp(bstack, n$, p) Then
                        If p > 31 Or p < -31 Then
                            A$ = n$
                              MyErMacro A$, "Rotation from -31 to 31", "Περιστοφή από -31 ως 31"
                             IsNumber = False: Exit Function
                        Else
                             If p > 0 Then
                                 r = SG * (uintnew((signlong(r) And signlong(2 ^ (32 - p) - 1))) * 2 ^ p + uintnew((signlong(r) And signlong(uintnew(-1) - uintnew(2 ^ (32 - p) - 1)))) / 2 ^ (32 - p))
                     
                             ElseIf p = 0 Then
                                 r = SG * r
                             Else
                                 p = 32 + p
                                 r = SG * (uintnew((signlong(r) And signlong(2 ^ (32 - p) - 1))) * 2 ^ p + uintnew((signlong(r) And signlong(uintnew(-1) - uintnew(2 ^ (32 - p) - 1)))) / 2 ^ (32 - p))
                                 
                             End If
                        End If
                     A$ = n$
                  Else
                    A$ = n$
                    MissParam A$
                 End If
             Else
                A$ = n$
                MissParam A$
            End If
        IsNumber = FastSymbol(A$, ")", True)
        Else
            A$ = n$
            MissParam A$
        End If
       Exit Function
       
Case "SINT(", "ΑΚΕΡΑΙΟ.ΔΥΑΔΙΚΟ("
' GET AN UNSIGN AND GIVES A SIGN...AS READING BITS
 IsNumber = False
 p = 4
 If IsExp(bstack, n$, r) Then
 If Not bstack.lastobj Is Nothing Then
 If Not TypeOf bstack.lastobj Is mHandler Then A$ = n$: Exit Function
 With bstack.lastobj
    If .T1 <> 2 Then GoTo err1256
    If Not TypeOf .objref Is MemBlock Then GoTo err1256
    If Not FastSymbol(n$, ",") Then GoTo err1256
    If Not IsExp(bstack, n$, p) Then GoTo err1256

            Select Case .objref.ItemSize
            Case 1
                If .objref.ValidArea2(p, 1) Then
                GetMem1 .objref.GetPtr(p), rB
                r = SG * cUbyte(CDbl(rB))
                Else
                    GoTo err1256
                End If
            Case 2
                If .objref.ValidArea2(p, 2) Then
                GetMem2 .objref.GetPtr(p), ri
                r = SG * cUint(CDbl(UINT(CLng(ri))))
                Else
                    GoTo err1256
                End If
            Case 8
                If .objref.ValidArea2(p, 8) Then
                GetMem8 .objref.GetPtr(p), r
                r = SG * r
                Else
                    GoTo err1256
                End If
            Case 4
                If .objref.ValidArea2(p, 4) Then
                GetMem4 .objref.GetPtr(p), dn
                r = SG * dn
                
            Else
err1256:
                Set bstack.lastobj = Nothing
                MyEr "Wrong Size-Position for reading buffer", "Λάθος Μέγεθος-θέση, για διάβασμα Διάρθρωσης"
                A$ = n$
                Exit Function
                End If
            End Select
            
 End With
 Set bstack.lastobj = Nothing
    A$ = n$
  IsNumber = FastSymbol(A$, ")", True)
    Exit Function
 End If
 If FastSymbol(n$, ",") Then
 If IsExp(bstack, n$, p) Then
 If p = 4 Then GoTo contsint1
 
 On Error Resume Next
    If r < 0 Then
    A$ = n$
      MyErMacro A$, "Unsign Integer can't be negative", "Ο πληθικός ακέραιος δεν μπορεί να είναι αρνητικός"
   
    Exit Function
    End If
    If p = 2 Then
    r = SG * cUint(r)
    Else
    r = SG * cUbyte(r)
    End If
    If Err.Number > 0 Then
    A$ = n$
      MyErMacro A$, "Unsign Integer to sign failed", "Η μετατροπή πληθικού σε ακέραιο με πρόσημο, απέτυχε"
    IsNumber = False
    Exit Function
    
    End If
    A$ = n$
  IsNumber = FastSymbol(A$, ")", True)
    Exit Function
    
 End If
 Else
contsint1:
    On Error Resume Next
    If r < 0 Then
    A$ = n$
      MyErMacro A$, "Unsign long can't be negative", "Ο πληθικός ακέραιος δεν μπορεί να είναι αρνητικός"
   
    Exit Function
    End If
    r = SG * signlong(r)
    If Err.Number > 0 Then
    A$ = n$
      MyErMacro A$, "Unsign long to sign failed", "Η μετατροπή πληθικού σε ακέραιο με πρόσημο, απέτυχε"
    IsNumber = False
    Exit Function
    End If
    End If
    A$ = n$
  IsNumber = FastSymbol(A$, ")", True)
    Exit Function
      Else
                    A$ = n$
                MissParam A$
    End If
   Exit Function
Case "USGN(", "ΔΥΑΔΙΚΟ("
'
IsNumber = False
 If IsExp(bstack, n$, r) Then
 A$ = n$
    On Error Resume Next
    If r > uintnew(-1) Then r = uintnew(-1)
    r = Fix(r)
    If r < 0 Then r = 0
    
    r = SG * r
    
IsNumber = FastSymbol(A$, ")", True)
    Exit Function
       Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
Case "UINT(", "ΔΥΑΔΙΚΟ.ΑΚΕΡΑΙΟ("
' READING BITS OF A SIGN AND GIVE AN UNSIGN OF SAME BITS
IsNumber = False
 If IsExp(bstack, n$, r) Then
 A$ = n$
    On Error Resume Next
    If r > 2147483647# Then
     MyErMacro A$, "Overflow long, expect lower than (2147483648)", "Υπερχείλιση ακεραίου, περιμένω μικρότερο από (2147483648)"
      
    Exit Function
    ElseIf r < -2147483648# Then
    MyErMacro A$, "Overflow long, expect greater than (-2147483649)", "Υπερχείλιση ακεραίου, περιμένω μεγαλύτερο από (-2147483649)"
     IsNumber = False
    Exit Function
    End If
    r = SG * uintnew(r)
    If Err.Number > 0 Then
    MyErMacro A$, "Sign to Unsign long failed", "Η μετατροπή ακεραίου με πρόσημο σε πληθικό (χωρίς πρόσημο) απέτυχε"
    IsNumber = False
    Exit Function
    
    End If
    
    
IsNumber = FastSymbol(A$, ")", True)
    Exit Function
       Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
 Case "ROUND(", "ΣΤΡΟΓΓ("
   IsNumber = False
    If IsExp(bstack, n$, r) Then
    On Error Resume Next
    If FastSymbol(n$, ")") Then
            
            r = SG * MyRound(r, 13)
            A$ = n$
            IsNumber = True
    ElseIf FastSymbol(n$, ",", True) Then
        If IsExp(bstack, n$, PP) Then
        
          r = SG * MyRound(r, PP)
        
      
            A$ = n$
     IsNumber = FastSymbol(A$, ")", True)
     End If
    Else
                    A$ = n$
                MissParam A$
    
    
    End If
    End If
    Exit Function
   
 Case "INT(", "ΑΚ("
   IsNumber = False
    If IsExp(bstack, n$, r) Then
    On Error Resume Next
    r = SG * Int(r)
    If Err.Number > 0 Then
    A$ = n$
    MyErMacro A$, "long conversion failed", "Η μετατροπή σε ακέραιο απέτυχε"
    Exit Function
    End If
    A$ = n$
 IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    
    
    End If
    Exit Function
Case "SEEK(", "ΜΕΤΑΘΕΣΗ("
 IsNumber = False
  IsSymbol3 n$, "#"  ' drop it
    If IsExp(bstack, n$, r) Then
    VR = r Mod 512
    
    If FLEN(VR) = 0 Then
 MyErMacro n$, "not valid file number", "λάθος αριθμός αρχείου"
A$ = n$
    ElseIf FLEN(VR) <> 1 Then
     MyErMacro n$, "not valid file TYPE", "λάθος ΤΥΠΟΣ αρχείου"
A$ = n$
    Else
    r = SG * Seek(VR)
    A$ = n$
  IsNumber = FastSymbol(A$, ")", True)
  End If
  
    Else
                   
                MissParam A$
    End If
    Exit Function

 Case "EOF(", "ΤΕΛΟΣ("
 IsNumber = False
   IsSymbol3 n$, "#"  ' drop it
    If IsExp(bstack, n$, r) Then
        VR = r Mod 512
        If FLEN(VR) = 0 Then
        MyErMacro n$, "not valid file number", "λάθος αριθμός αρχείου"
         A$ = n$
    Else
    r = SG * (LOF(VR) < Seek(VR))
    A$ = n$
  IsNumber = FastSymbol(A$, ")", True)
  End If
  
    Else
                    A$ = n$
                MissParam A$
    End If
    
    Exit Function
Case "RANDOM(", "ΤΥΧΑΙΟΣ("
If FastSymbol(n$, "!") Then
If IsExp(bstack, n$, r) Then
'' CHOOSE SEED AND SAVEIT TO BASESTACK
On Error Resume Next
simplestack1 = rndbase
RandomizeIt rndbase, CLng(Int(r))

If Err Then
Err.Clear
r = 0
End If
Else
rndbase = simplestack1
End If
     A$ = n$
ElseIf IsExp(bstack, n$, r) Then
    r = Int(r)
        If FastSymbol(n$, ",") Then
        If Not IsExp(bstack, n$, p) Then IsNumber = False: Exit Function
        p = Int(p)
        If p > r Then p = p + r: r = p - r: p = p - r
        Else
        p = 0
        
        End If
    
    r = SG * Int((r - p + 1) * RndM(rndbase) + p)
       A$ = n$
    IsNumber = True
    Else
      RandomizeIt rndbase, timeGetTime
     r = SG * True
      A$ = n$
    End If
    IsNumber = FastSymbol(A$, ")", True)

       Exit Function
Case "CHRCODE(", "ΧΑΡΚΩΔ("
 IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    r = SG * AscW(s$)
    A$ = n$
   
  
    IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function

Case "ASC(", "ΚΩΔ("
 IsNumber = False
    If IsStrExp(bstack, n$, s$) Then
    r = SG * Asc(s$)
    A$ = n$
   
  
    IsNumber = FastSymbol(A$, ")", True)
    Else
                    A$ = n$
                MissParam A$
    End If
    Exit Function
Case Else
LOOKFORSUBNUM:
On Error Resume Next

s1$ = v$ & ")" ' ANY CHAR HERE

MakeThisSubNum bstack, s1$
If IsSymbol(n$, "@") Then
'is a function allways...
If GetlocalSub(s1$, V1&) Then
    GoTo contAr1
ElseIf GetSub(s1$, V1&) Then
GoTo contAr1
Else
GoTo skiphere
End If

Else
If neoGetArray(bstack, v$, pppp, , , True) Then
    GoTo contAr2
ElseIf GetlocalSub(s1$, V1&) Then
    GoTo contAr1
ElseIf neoGetArray(bstack, v$, pppp, , True) Then
GoTo contAr2
ElseIf GetSub(s1$, V1&) Then
GoTo contAr1
Else
skiphere:
If bstack.UseGroupname <> "" Then
If InStr(s1$, bstack.UseGroupname) = 1 Then

s1$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(s1$, Len(bstack.UseGroupname) + 1)
If GetSub(s1$, V1&) Then GoTo contAr1
End If
End If
If Right$(s1$, 1) = ")" Then
If here$ Like "*." + s1$ Then
subHash.ItemCreator s1$, bstack.OriginalCode, True

 GoTo contAr1
ElseIf s1$ = "LAMBDA()" Then
    If bstack.IamLambda Then
        s1$ = bstack.FuncRec
        GoTo contAr1
 Else
        MyEr "Only in lambda function", "Μόνο σε λάμδα συνάρτηση"
    GoTo skiperror
 End If
ElseIf s1$ = "ΛΑΜΔΑ()" Then
    If bstack.IamLambda Then
        s1$ = bstack.FuncRec
        GoTo contAr1
 Else
        MyEr "Only in lambda function", "Μόνο σε λάμδα συνάρτηση"
    GoTo skiperror
 End If
 
End If
End If
GoTo skiperror
End If
End If
'''ver 18
If GetSub(s1$, V1&) Then
GoTo contAr1
ElseIf neoGetArray(bstack, v$, pppp) Then
GoTo contAr2
Else
GoTo skiperror
End If

If GetSub(s1$, V1&) Then
contAr1:
s1$ = Trim$(s1$)
    If bstack.NoFuncError Then
    CallNext bstack, A$, par, p, v$
    If par Then
    r = SG * p
        IsNumber = True
    Else
    r = 0
        IsNumber = False
    End If
                
            
Else
    Set nBstack = New basetask
    nBstack.reflimit = varhash.count
    Set nBstack.Parent = bstack
    If bstack.IamThread Then Set nBstack.Process = bstack.Process
    Set nBstack.Owner = bstack.Owner
    nBstack.OriginalCode = V1&
    nBstack.UseGroupname = sbf(V1&).sbgroup
    If GoFunc(nBstack, s1$, n$, p) Then
        If Not nBstack.StaticCollection Is Nothing Then
        bstack.SetVarobJ "%_" + s1$, nBstack.StaticCollection
        End If
    Set bstack.lastobj = nBstack.lastobj
    Set nBstack = Nothing
        If InStr(v$, "%") > 0 Then
        
        r = SG * Int(p)
        Else
        r = SG * p
        End If
            A$ = n$
            IsNumber = True
    Else
  ''  a$ = n$
     IsNumber = False
    End If
End If
Exit Function

ElseIf neoGetArray(bstack, v$, pppp) Then
contAr2:

If FastSymbol(n$, ")") Then
IsNumber = True

If Not pppp.Arr Then
If Typename(pppp.GroupRef) = "mHandler" Then
'' here the poke as alfa(3).value or Αλφα(3).τιμή
If pppp.GroupRef.Indirect >= 0 Then
    MyEr "Not implemented yet", "Δεν εχει ακόμα υλοποιηθεί αυτό"
    A$ = n$
    Exit Function
End If
If Left$(n$, 1) = "." Then
' LOOK FOR GROUP

w2 = -pppp.GroupRef.objref.index - 2
GoTo contgroup
ElseIf FastSymbol(n$, "(") Then
w2 = -pppp.GroupRef.objref.index - 2
GoTo contlambdahere
Else
Set bstack.lastobj = pppp
If pppp.GroupRef.T1 Then
r = SG * pppp.GroupRef.objref.GetPtr(0)
Else
r = SG * pppp.GroupRef.objref.Done
End If
End If
End If
Else
r = 0
Set bstack.lastobj = pppp
End If
A$ = n$
Exit Function
End If
If pppp.Arr Then
dn = 0

pppp.SerialItem (0), dd, 5
dd = dd - 1
p = 0
PP = 0
    IsNumber = True
    w2 = 0
                    Do While dn <= dd
                    pppp.SerialItem W3, dn, 6
                    
                        If IsExp(bstack, n$, p) Then
                        If dn < dd Then
                            If Not FastSymbol(n$, ",") Then A$ = n$: MyErMacro A$, "need index for " & v$ & ")", "χρειάζομαι δείκτη για το πίνακα " & v$ & ")": IsNumber = False: Exit Function
                           
                            Else
                         If FastSymbol(n$, ",") Then
                    A$ = n$: IsNumber = False
                        MyErMacro A$, "too many indexes for array " & v$ & ")", "πολλοί δείκτες για το πίνακα " & v$ & ")"
                        Exit Function
                         
                         End If
                            If Not FastSymbol(n$, ")") Then A$ = n$: MissSymbol A$, ")": IsNumber = False: Exit Function
                            
                         
                        End If
                            On Error Resume Next
                            If p < 0 Then
                                    A$ = n$: IsNumber = False
                              MyErMacro A$, "negative index in array " & v$ & ")", "αρνητικός δείκτης στο πίνακα " & v$ & ")"
                            Exit Function
                            End If
                            
                        If Not pppp.PushOffset(w2, dn, CLng(p)) Then
                            A$ = n$ ': IsNumber = False
                                MyErMacro A$, "index too high for array " & v$ & ")", "δείκτης υψηλός για το πίνακα " & v$ & ")"
                            Exit Function
                        Else
                                   
                            End If
                        Else
                         IsNumber = False
                        If LastErNum = -2 Then
                        Else
                        A$ = n$
                        MyErMacro A$, "missing index for array " & v$ & ")", "χάθηκε δείκτης για το πίνακα " & v$ & ")"
                        End If
                        Exit Function
                        End If
                    dn = dn + 1
                    Loop
                    ' here here here
    If Typename(pppp.item(w2)) = "Group" Then
    
            If Left$(n$, 1) = "." Then
contgroup:
                                
                              IsNumber = SpeedGroup(bstack, pppp, "VAL", v$, n$, w2) = 1
          
                                 r = SG * bstack.LastValue
            
            Else
                            bstack.soros.CopyGroup pppp.item(w2), anything
                             Set bstack.lastobj = anything
                            
            End If
              A$ = n$
            Exit Function
    ElseIf IsObject(pppp.item(w2)) Then
    If FastSymbol(n$, "(") Then
contlambdahere:
                If Typename(pppp.item(w2)) = "lambda" Then
                        PushStage bstack, False
                        
                    
                         w1 = GlobalVar("A_" + CStr(Abs(w2)), 0)
                       
                         Set var(w1) = pppp.item(w2)
                                    If here$ = "" Then
                                            GlobalSub "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & CStr(w1)
                                        Else
                                            GlobalSub here$ & "." & bstack.GroupName & "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & CStr(w1)
                                    End If
                                    n$ = "A_" + CStr(Abs(w2)) + "(" + n$
                                 IsNumber = IsNumber(bstack, n$, p)
                                 Set var(w1) = Nothing
                                 If Right$(pppp.arrname, 2) = "%(" Then
                                 r = SG * Int(p)
                                 Else
                                 r = SG * p
                                 End If
                        PopStage bstack
                ElseIf Typename(pppp.item(w2)) = "mArray" Then
                Set pppp = pppp.item(w2)
                GoTo contAr2
                ElseIf Typename(pppp.item(w2)) = "mHandler" Then
                Set bstack.lastobj = pppp.item(w2)
               Set pppp = New mArray
                pppp.Arr = False
                Set pppp.GroupRef = bstack.lastobj
                Set bstack.lastobj = Nothing
                GoTo contAr2
                End If
    Else
    ' here is the fault

     
               r = SG * rValue(bstack, pppp.item(w2))
            End If
                 A$ = n$
                        Exit Function
            
    End If
    
    
    r = SG * pppp.item(w2)
    Else
     If Typename(pppp.GroupRef) = "mHandler" Then
     
                If IsExp(bstack, n$, p) Then
                
                If pppp.GroupRef.T1 = 2 Then ' OK for Buffer
                
                 With pppp.GroupRef.objref
                 If FastSymbol(n$, "!") Then
                 r = SG * .GetBytePtr(p)
                 Else
                 r = SG * .GetPtr(p)
                 End If
                 If .Status = 4 Then MyEr "Buffer locked, wrong use of pointer", "Η Διάρθρωση κλειδώθηκε, κακή χρήση δείκτη"
                IsNumber = FastSymbol(n$, ")") And .Status = 0
                    End With
                
                
                A$ = n$
                Exit Function
                End If
                If Not FastSymbol(n$, "!") Then s$ = CStr(p): GoTo contlabel
                 With pppp.GroupRef.objref
                    
                    p = Int(p)
                    
                    If p >= 0 And p < .count Then
                       .index = p
                       .Done = True
                       '' what??? here here here
                       IsNumber = FastSymbol(n$, ")")
                       If Left$(n$, 1) = "." Then
                       
                       w2 = -p - 2
                       GoTo contgroup
                       ElseIf FastSymbol(n$, "(") Then
                       If .IsObj Then
                       
                       w2 = -.index - 2
                       If TypeOf .ValueObj Is lambda Then GoTo contlambdahere
                       If TypeOf .ValueObj Is mArray Then
                        Set pppp = .ValueObj
                        GoTo contAr2
                       End If
                       Else
                       MyEr "No Object found", "Δεν βρήκα αντικείμενο"
                       End If
                       End If
                       
                          If Not .IsObj Then
                     If .ValueType(0, r, s$) Then
                                     r = SG * r
                                  Else
                                      r = 0
                                 End If
                        Else
                        Set bstack.lastobj = pppp.GroupRef.objref.ValueObj
                       r = 0
                       End If
                       
                        A$ = n$
                        Exit Function
                    Else
                       MyEr "Index out of limits", "Δείκτης εκτός ορίων"
                    End If
                       
                    End With
                A$ = n$
                        Exit Function
                ElseIf IsStrExp(bstack, n$, s$) Then
contlabel:
                 With pppp.GroupRef.objref
                If .StructLen > 0 Then s$ = myUcase(s$)
                    If .Find(s$) Then
                       
                       IsNumber = FastSymbol(n$, ")")
                       If Left$(n$, 1) = "." Then
                       
                       w2 = -.index - 2
                       GoTo contgroup
                       ElseIf FastSymbol(n$, "(") Then
                       If .IsObj Then
                       
                       w2 = -.index - 2
                       If TypeOf .ValueObj Is lambda Then GoTo contlambdahere
                       If TypeOf .ValueObj Is mArray Then
                        Set pppp = .ValueObj
                        GoTo contAr2
                    ElseIf TypeOf .ValueObj Is mHandler Then
                        Set pppp.GroupRef = .ValueObj
                        GoTo contAr2
                       End If
                       Else
                       MyEr "No Object found", "Δεν βρήκα αντικείμενο"
                       End If
                       End If
                        If Not .IsObj Then
                           If .ValueType(0, r, s$) Then
                                     r = SG * r
                                  Else
                                      r = 0
                                 End If
                        Else
                       r = SG * rValue(bstack, pppp.GroupRef.objref.ValueObj)
                       End If
                       
                       
                        A$ = n$
                        Exit Function
                    Else
                       MyEr "Index out of limits", "Δείκτης εκτός ορίων"
                    End If
                       
                    End With
                A$ = n$
                        Exit Function
            End If
     Else
            If IsExp(bstack, n$, p) Then
                pppp.GroupRef.index = p
                ElseIf IsStrExp(bstack, n$, s$) Then
                pppp.GroupRef.index = s$
            End If
         End If
        r = SG * pppp.GroupRef.Value
        IsNumber = FastSymbol(n$, ")")
       
        End If
    A$ = n$
    Exit Function
    Else
skiperror:
        A$ = n$: IsNumber = False
         If FindNameForGroup(bstack, v$) Then
 MyErMacro A$, "unknown method/array  " & v$, "’γνωστη μέθοδος/πίνακας " & v$
 Else
     MyErMacro A$, "unknown function/array " & v$, "’γνωστη συνάρτηση/πίνακας " & v$

End If

    
    Exit Function
    End If
    
End Select
Case Else

End Select
zerohere:
If val("0" & Mid$(A$, sng&, 1)) = 0 And Left(Mid$(A$, sng&, 1), sng&) <> "0" And Left(Mid$(A$, sng&, 1), sng&) <> "." Then
IsNumber = False
Else

    If Mid$(A$, sng&, 1) = "." Then

    ig$ = "0"
    DE$ = "."
    ElseIf LCase(Mid$(A$, sng&, 2)) Like "0[xχ]" Then
    ig$ = "0"
    DE$ = "0x"
  sng& = sng& + 1
Else
    Do While sng& <= Len(A$)
        
        Select Case Mid$(A$, sng&, 1)
        Case "0" To "9"
        ig$ = ig$ & Mid$(A$, sng&, 1)
        Case "."
        DE$ = "."
        Exit Do
        Case Else
        Exit Do
        End Select
       sng& = sng& + 1
    Loop
    End If
    ' compute decimal part
    If DE$ <> "" Then
      sng& = sng& + 1
        Do While sng& <= Len(A$)
       
        Select Case Mid$(A$, sng&, 1)
        Case " ", ChrW(160)
        If Not (sg1 And Len(ex$) = 1) Then
        Exit Do
        End If
        Case "A" To "D", "a" To "d", "F", "f"
        If Left$(DE$, 2) = "0x" Then
        DE$ = DE$ & Mid$(A$, sng&, 1)
        End If
        Case "0" To "9"
        If sg1 Then
        ex$ = ex$ & Mid$(A$, sng&, 1)
        Else
        DE$ = DE$ & Mid$(A$, sng&, 1)
        End If
        Case "E", "e"
         If Left$(DE$, 2) = "0x" Then
         DE$ = DE$ & Mid$(A$, sng&, 1)
         Else
              If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        End If
        Case "Ε", "ε"
                         If ex$ = "" Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        ex$ = "E"
        
        Case "+", "-"
        If sg1 And Len(ex$) = 1 Then
         ex$ = ex$ & Mid$(A$, sng&, 1)
        Else
        Exit Do
        End If
        Case Else
        Exit Do
        End Select
         sng& = sng& + 1
        Loop
        If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then sng& = sng& - Len(ex$)
    End If
    If ig$ = "" Then
    IsNumber = False
    Else
  ''  If SG < 0 Then ig$ = "-" & ig$
    If Left$(DE$, 2) = "0x" Then
   ' r = UNPACKLNG(Left$(ex$, 8))
   If Mid$(DE$, 3) = "" Then
   r = 0
   Else
   DE$ = Right$("00000000" & Mid$(DE$, 3), 8)
   r = CDbl(UNPACKLNG(Left$(DE$, 4)) * 65536#) + CDbl(UNPACKLNG(Right$(DE$, 4)))
   End If
    Else
 If SG < 0 Then ig$ = "-" & ig$
            On Error Resume Next
            If ex$ = "E" Or ex$ = "E-" Or ex$ = "E+" Then
            r = val(ig$ & DE$ & ex$ & "0")
            sng = sng + Len(ex$)
            ElseIf ex$ <> "" Then
                If val(Mid$(ex$, 2)) > 308 Or val(Mid$(ex$, 2)) < -324 Then
                    r = val(ig$ & DE$)
                    sng = sng - Len(ex$)
                    ex$ = ""
                    
                    Else
                 r = val(ig$ & DE$ & ex$)
                End If
            Else
        
            r = val(ig$ & DE$)
            End If
            If Err.Number = 6 Then
                If Len(ex$) > 2 Then
                    ex$ = Left$(ex$, Len(ex$) - 1)
                    sng = sng - 1
                    Err.Clear
                    r = val(ig$ & DE$ & ex$)
                    If Err.Number = 6 Then
                        sng = sng - Len(ex$)
                         r = val(ig$ & DE$)
                    End If
                End If
            MyEr "Error in exponet", "Λάθος στον εκθέτη"
          IsNumber = False
            Exit Function
            End If
    
  End If
    A$ = Mid$(A$, sng&)
    IsNumber = True
    End If
End If
End Function
Function ProcLambda(bstack As basetask, rest$) As Object
' no named functio- object
Dim body As New lambda, k As Long, n$, dummy As Variant, er As Boolean, pos1 As Long, p As Double, s$
Dim pppp As mArray, pppp2 As mArray
' need fixed param...with &
AGAIN1:
If Not FastSymbol(rest$, "->", , 2) Then
' put here description for error
If er Then Exit Function
Do
k = IsPureLabel(rest$, n$)
If k = 0 Then Exit Function
If k > 4 Then If Not FastSymbol(rest$, ")") Then Exit Function
n$ = myUcase(n$, True)


If FastSymbol(rest$, "=") Then
Select Case k
Case 1, 4
If IsExp(bstack, rest$, p) Then
If Not bstack.lastobj Is Nothing Then
    Set dummy = bstack.lastobj
    Set bstack.lastobj = Nothing
   body.FeedNonLocal n$, dummy, var()
   Set dummy = Nothing
    Else
       dummy = p
    body.FeedNonLocal n$, dummy, var()
    End If
dummy = Empty
End If
Case 3
If IsStrExp(bstack, rest$, s$) Then
If Not bstack.lastobj Is Nothing Then
    Set dummy = bstack.lastobj
    Set bstack.lastobj = Nothing
   body.FeedNonLocal n$, dummy, var()
   Set dummy = Nothing
    Else
       dummy = s$
    body.FeedNonLocal n$, dummy, var()
    End If
dummy = Empty
End If
Case 5, 7

 If IsExp(bstack, rest$, p) Then
 If Not bstack.lastobj Is Nothing Then
      If Typename(bstack.lastobj) = "mArray" Then
      Set pppp = bstack.lastobj
        pppp.arrname = n$
        Set dummy = pppp
        body.FeedNonLocal n$, dummy, var()
        Set dummy = Nothing
        Set pppp = Nothing
        Else
        Exit Function
      End If
      Else
        Exit Function
      End If
      Else
        Exit Function
     End If
Case 6
If IsStrExp(bstack, rest$, s$) Then
If Not bstack.lastobj Is Nothing Then
      If Typename(bstack.lastobj) = "mArray" Then
      Set pppp = bstack.lastobj
        pppp.arrname = n$
        Set dummy = pppp
        body.FeedNonLocal n$, dummy, var()
        Set dummy = Nothing
        Set pppp = Nothing
        Else
        Exit Function
      End If
      Else
        Exit Function
      End If
      Else
        Exit Function
End If
End Select
ElseIf k < 5 Then
        If GetVar(bstack, n$, pos1, , , True) Then
        If Typename(var(pos1)) = "lambda" Then
        Dim aaa As lambda
        var(pos1).CopyTo aaa, var()
        Set dummy = aaa
            body.FeedNonLocal n$, dummy, var()
            Set dummy = Nothing
            dummy = Empty
            Set aaa = Nothing
        ElseIf Typename(var(pos1)) = "Group" Then
        CopyGroup var(pos1), bstack
        Set dummy = bstack.lastobj
        body.FeedNonLocal n$, dummy, var()
        Set dummy = Nothing
        Else
            body.FeedNonLocal n$, var(pos1), var()
        End If
        Else
            body.FeedNonLocal n$, dummy, var()
        End If
Else
       
        If neoGetArray(bstack, n$, pppp) Then
        Set pppp2 = New mArray
        pppp.CopyArray pppp2
  
        Set dummy = pppp2
        Set pppp2 = Nothing
        Set pppp = Nothing
        body.FeedNonLocal n$, dummy, var()
        Else
        End If
    End If
Loop Until Not FastSymbol(rest$, ",")
er = True
GoTo AGAIN1
ElseIf FastSymbol(rest$, "{") Then
' get block
body.code = block(rest$)
If Trim$(body.code) = "" Then Exit Function
If Not FastSymbol(rest$, "}") Then Exit Function
Else
' get one line only
 pos1 = 1
body.code = aheadstatus(rest$, False, pos1)
If pos1 = 1 Then Exit Function
body.code = "=" + Left$(rest$, pos1 - 1)
rest$ = Mid$(rest$, pos1)
End If
Set ProcLambda = body
End Function
Function IsPureLabel(A$, r$) As Long
Dim rr&, one As Boolean, c$
r$ = ""
If A$ = "" Then IsPureLabel = 0: Exit Function

A$ = NLtrim$(A$)
    Do While Len(A$) > 0
    c$ = myUcase(Left$(A$, 1))
    If AscW(c$) < 256 Then
        Select Case c$
        Case "."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            IsPureLabel = 0
            Exit Function
            End If
        Case "A" To "Z", "Α" To "Ω", "’", "Έ", "Ί", "Ό", "Ή", "Ώ", "Ύ", "ς"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "0" To "9", "_"
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
            
        Case "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                            If Mid$(A$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 A$ = Mid$(A$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(A$, 1)
                                       A$ = Mid$(A$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
    IsPureLabel = rr&
   A$ = NLtrim$(A$)

End Function
Function IsLabelBig(bstack As basetask, A$, rrr$, Optional nocommand As Boolean, Optional r$) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, skipcase As Boolean, cc As Long
r$ = ""
If A$ = "" Then IsLabelBig = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
     c$ = Left$(A$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
           If r$ = "" Then
              A$ = Mid$(A$, 2)
              ElseIf Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              A$ = Mid$(A$, 2)
              Else
                 IsLabelBig = 0: Exit Function
            End If
        Case "?"
        If r$ = "" Then
        rrr$ = "?"
        
        IsLabelBig = 1
        Exit Function
        End If
        A$ = Mid$(A$, 2)
        Case ":"
            If one Then
  
            Exit Do
           
            ElseIf r$ <> "" Then
            If Mid$(A$, 2) <> "" Then
            If Mid$(A$, 2, 1) <> "\" And Mid$(A$, 2, 2) <> vbCrLf Then
            
                    
            Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                IsLabelBig = 0
            Exit Function
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            End If
            Else
            IsLabelBig = 0
            Exit Function
            End If
        Case "."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(A$, 1)
                       A$ = Mid$(A$, 2)
           ''
           ElseIf Not Mid$(A$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(A$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         A$ = Mid$(A$, 2)
                        
                        
            Else
                         If r$ = "" And dot& > 0 Then
                                  nocommand = True
                                 rrr$ = String$(dot& + 1, ".")     ' i want this only in right position for "dir .. "
                                 r$ = rrr$
                                  A$ = Mid$(A$, 2)
                                 IsLabelBig = 1
                         Else
                              IsLabelBig = 0
                        End If
                    
            Exit Function
            End If
        Case "{" To "~", "^"
            Exit Do
        
        Case "\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case "0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
             nocommand = True
            rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then A$ = "." + A$: dot& = 0
            
            Exit Do
            End If
Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
                'ERROR
                rr& = 0
                '' r$ = ""
                rrr$ = ""
                Exit Function
            Else
           nocommand = True
                A$ = Mid$(A$, 2)
                rr& = Abs(IsLabelBig(bstack, A$, r$))
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        A$ = Chr(34) + here$ & "." & r$ & Chr(34) + A$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    A$ = Chr(34) + c$ + Chr(34) + A$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         A$ = Chr(34) + r$ & Chr(34) + A$
                    Else
                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                    rrr$ = r$
                   IsLabelBig = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(A$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid(r$, 6)) Then
                       
                                    A$ = Chr(34) + bstack.UseGroupname & Mid(r$, 6, Len(r$) - 6) + Chr(34) + A$
                                    Else
                                    rr& = 2
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                               A$ = Chr(34) + here$ & "." & Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
  
                                ElseIf varhash.ExistKey(r$) Then
                                    A$ = Chr(34) + Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
                                Else
                                   rr& = 3
                                End If
                                 If rr& > 0 Then
                                 If rr& = 2 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 End If
                                 End If
                                 rr& = 1
                                 If GetSub(r$ + ")", rr&) Then
                            r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = ""
                                Exit Do
                            End If
                    End If
                    
                    r$ = ""
                    rr& = 0
                    Exit Do
            End If
            
        Case "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            nocommand = True
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                If Mid$(A$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              A$ = Mid$(A$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(A$, 1)
                A$ = Mid$(A$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If skipcase Then
    rrr$ = r$
    Else
    rrr$ = myUcase(r$, gr)
    End If
   If dot& Then
   nocommand = True
                           If r$ <> "" Then
     
                        rr& = bstack.GetDotNew(rrr$, dot&) * rr&

                        nocommand = rr&
                           Else
                          If dot& > 1 Then rrr$ = String$(dot&, ".") + rrr$: If rr& = 0 Then rr& = 1
                          End If
    
    
   End If
   
    IsLabelBig = rr&
    nocommand = IsLabelBig And (Len(r$) = 1 Or nocommand)
 '' a$ = LTrim(a$)

End Function
Function IsLabel(bstack As basetask, A$, rrr$, Optional NoSpace As Boolean = False, Optional skipcase As Boolean = False) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, r$, cc As Long
'r$ = ""
If A$ = "" Then IsLabel = 0: Exit Function
If Not NoSpace Then A$ = NLtrim$(A$) Else If AscW(A$) = 32 Then Exit Function
    Do While Len(A$) > 0
     c$ = Left$(A$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
           If r$ = "" Then
              A$ = Mid$(A$, 2)
              ElseIf Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              A$ = Mid$(A$, 2)
              Else
                 IsLabel = 0: Exit Function
            End If
        Case "?"
        If r$ = "" Then
        rrr$ = "?"
        
        IsLabel = 1
        Exit Function
        End If
        A$ = Mid$(A$, 2)
        Case ":"
            If one Then
  
            Exit Do
           
            ElseIf r$ <> "" Then
            If Mid$(A$, 2) <> "" Then
            If Mid$(A$, 2, 1) <> "\" And Mid$(A$, 2, 2) <> vbCrLf Then
            
                    
            Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                IsLabel = 0
            Exit Function
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            End If
            Else
            IsLabel = 0
            Exit Function
            End If
        Case "."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(A$, 1)
                       A$ = Mid$(A$, 2)
           ''
           ElseIf Not Mid$(A$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(A$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         A$ = Mid$(A$, 2)
                        
                        
            Else
                         If r$ = "" And dot& > 0 Then
                                 rrr$ = String$(dot& + 1, ".")     ' i want this only in right position for "dir .. "
                                 r$ = rrr$
                                  A$ = Mid$(A$, 2)
                                 IsLabel = 1
                         Else
                              IsLabel = 0
                        End If
                    
            Exit Function
            End If
        Case "{" To "~", "^"
            Exit Do
        
        Case "\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case "0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then A$ = "." + A$: dot& = 0
            
            Exit Do
            End If
Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
                'ERROR
                rr& = 0
                '' r$ = ""
                rrr$ = ""
                Exit Function
            Else
                A$ = Mid$(A$, 2)
                rr& = Abs(IsLabel(bstack, A$, r$, True))
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        A$ = Chr(34) + here$ & "." & r$ & Chr(34) + A$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    A$ = Chr(34) + c$ + Chr(34) + A$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         A$ = Chr(34) + r$ & Chr(34) + A$
                    Else
                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                    rrr$ = r$
                   IsLabel = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(A$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid(r$, 6)) > 0 Then
                                    A$ = Chr(34) + bstack.UseGroupname & Mid(r$, 6, Len(r$) - 6) + Chr(34) + A$
                                    Else
                                    rr& = 2
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                                     A$ = Chr(34) + here$ & "." & Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
                                ElseIf varhash.ExistKey(r$) Then
                                    A$ = Chr(34) + Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
                                Else
                                   rr& = 3
                                End If
                                If rr& > 0 Then
                                 If rr& = 2 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 End If
                                 End If
                                 rr& = 1
                                 If GetSub(r$ + ")", rr&) Then
                                                                  r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = ""
                                Exit Do
                            End If
                    End If
                    
                    r$ = ""
                    rr& = 0
                    Exit Do
            End If
            
        Case "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                If Mid$(A$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              A$ = Mid$(A$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(A$, 1)
                A$ = Mid$(A$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If skipcase Then
    rrr$ = r$
    Else
    rrr$ = myUcase(r$, gr)
    End If
   If dot& Then
                           If r$ <> "" Then
     
                        rr& = bstack.GetDotNew(rrr$, dot&) * rr&
                           Else
                          If dot& > 1 Then rrr$ = String$(dot&, ".") + rrr$: If rr& = 0 Then rr& = 1
                          End If
    
    
   End If
   
    IsLabel = rr&

 '' a$ = LTrim(a$)

End Function

Function IsLabelDIM(bstack As basetask, A$, r$) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, skipcase As Boolean, cc As Long
r$ = ""
If A$ = "" Then IsLabelDIM = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
     c$ = Left$(A$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
           If r$ = "" Then
              A$ = Mid$(A$, 2)
              ElseIf Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              A$ = Mid$(A$, 2)
              Else
                 IsLabelDIM = 0: Exit Function
            End If
        Case "?"
        If r$ = "" Then
        r$ = "?"
        IsLabelDIM = 1
        Exit Function
        End If
        A$ = Mid$(A$, 2)
        Case ":"
            If one Then
  
            Exit Do
           
            ElseIf r$ <> "" Then
            If Mid$(A$, 2) <> "" Then
            If Mid$(A$, 2, 1) <> "\" And Mid$(A$, 2, 2) <> vbCrLf Then
            
                    
            Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                IsLabelDIM = 0
            Exit Function
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            End If
            Else
            IsLabelDIM = 0
            Exit Function
            End If
        Case "."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(A$, 1)
                       A$ = Mid$(A$, 2)
           ''
           ElseIf Not Mid$(A$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(A$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         A$ = Mid$(A$, 2)
                        
                        
            Else
                         If r$ = "" And dot& > 0 Then
                     
                             
                                 r$ = String$(dot& + 1, ".")
                                  A$ = Mid$(A$, 2)
                                 IsLabelDIM = 1
                         Else
                              IsLabelDIM = 0
                        End If
                    
            Exit Function
            End If
        Case "{" To "~", "^"
            Exit Do
        
        Case "\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case "0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
             rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then A$ = "." + A$: dot& = 0
            
            Exit Do
            End If
Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
            
                rr& = 0
     
              r$ = ""
                Exit Function
            Else
                A$ = Mid$(A$, 2)
                rr& = Abs(IsLabelDIM(bstack, A$, r$))
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        A$ = Chr(34) + here$ & "." & r$ & Chr(34) + A$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    A$ = Chr(34) + c$ + Chr(34) + A$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         A$ = Chr(34) + r$ & Chr(34) + A$
                    Else
                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                
                   IsLabelDIM = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(A$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid(r$, 6)) Then
                                    A$ = Chr(34) + bstack.UseGroupname & Mid(r$, 6, Len(r$) - 6) + Chr(34) + A$
                                    Else
                                    rr& = 1
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                                     A$ = Chr(34) + here$ & "." & Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
                                ElseIf varhash.ExistKey(r$) Then
                                    A$ = Chr(34) + Mid$(r$, 1, Len(r$) - 1) + Chr(34) + A$
                                Else
                                   rr& = 1
                                End If
                                 If rr& = 1 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 Else
                                 End If
                                 If GetSub(r$ + ")", rr&) Then
                                                                  r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    MyErMacro A$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = ""
                                Exit Do
                            End If
                    End If
                    
                    r$ = ""
                    rr& = 0
                    Exit Do
            End If
            
        Case "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                If Mid$(A$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              A$ = Mid$(A$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(A$, 1)
                A$ = Mid$(A$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If Not skipcase Then r$ = myUcase(r$, gr)
   If dot& Then
                           If r$ <> "" Then
                           If dot& = 1 Then
                           r$ = "THIS." + r$
                           rr& = -rr&
                           Else
                        rr& = bstack.GetDotNew(r$, dot&) * rr&
                        End If
                           Else
                          If dot& > 1 Then r$ = String$(dot&, ".") + r$: If rr& = 0 Then rr& = 1
                          End If
    
    
   End If
    IsLabelDIM = rr&
End Function

Function IsLabelOnly(A$, r$) As Long

Dim rr&, one As Boolean, c$, dot&
r$ = ""
If A$ = "" Then IsLabelOnly = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
     c$ = Left$(A$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
           If r$ = "" Then
              A$ = Mid$(A$, 2)
              ElseIf Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              A$ = Mid$(A$, 2)
              Else
                 IsLabelOnly = 0: Exit Function
            End If
        Case "."
            If one Then
            Exit Do
           ElseIf r$ <> "" Then
                    r$ = r$ & Left$(A$, 1)
                       A$ = Mid$(A$, 2)
                    
           ElseIf Not Mid$(A$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(A$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         A$ = Mid$(A$, 2)
                        
                        
            Else
            If r$ = "" And dot& > 0 Then

            r$ = String$(dot& + 1, ".")
            A$ = Mid$(A$, 2)
           IsLabelOnly = 1
            Else
          
            IsLabelOnly = 0
           End If
            Exit Function
            End If
     Case "\", "{" To "~", "^"
Exit Do
        
        Case "0" To "9", "_"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
               rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then A$ = "." + A$: dot& = 0
            
            Exit Do
            End If
Case Is >= "A"
            If one Then
            Exit Do
            Else
            
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
      Case "&"
            If r$ = "" Then rr& = 2:    A$ = Mid$(A$, 2)
            Exit Do
       Case "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
        
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                If Mid$(A$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              A$ = Mid$(A$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(A$, 1)
                A$ = Mid$(A$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
             r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    IsLabelOnly = rr&
   
End Function
Function IsLabelSYMB(A$, r$) As Boolean
Dim rr&, one As Boolean, c$
r$ = ""
If A$ = "" Then IsLabelSYMB = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
     c$ = myUcase(Left$(A$, 1))
    If AscW(c$) < 256 Then
        Select Case c$
        Case "."
            If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            IsLabelSYMB = 0
            Exit Function
            End If
        Case "A" To "Z", "Α" To "Ω", "’", "Έ", "Ί", "Ό", "Ή", "Ώ", "Ύ", "ς"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        
        Case Else
        Exit Do
        End Select
                Else
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        
        End If
    Loop
    
    IsLabelSYMB = rr&
   A$ = NLtrim$(A$)

End Function
Function IsLabelSYMB2(A$, r$) As Boolean
'without ucase
Dim rr&, one As Boolean, c$
r$ = ""
If A$ = "" Then IsLabelSYMB2 = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
     c$ = Left$(A$, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case "."
            If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            IsLabelSYMB2 = 0
            Exit Function
            End If
        Case "A" To "Z", "a" To "z"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        
        Case Else
        Exit Do
        End Select
                Else
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        
        End If
    Loop
    IsLabelSYMB2 = rr&
   A$ = NLtrim$(A$)

End Function
Function IsLabelSYMB3old(A$, r$) As Boolean
A$ = NLtrim$(A$)
If r$ = "" Then Exit Function
If A$ + " " Like r$ + "*" Then
IsLabelSYMB3old = True
A$ = Mid$(A$, Len(r$) + 1)
End If
End Function
Function IsLabelSYMB3(A$, r$) As Boolean
Dim rr&, c$, LB As Long, mb As Long, LLB As Long
A$ = NLtrim$(A$)
LLB = Len(A$)
r$ = ""
If LLB = 0 Then IsLabelSYMB3 = 0: Exit Function
mb = 0   'INDICATE LEFT SPACES
LB = 1
    Do While LB <= LLB
     c$ = Mid$(A$, LB, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case " ", ChrW(160)
        If LB - mb > 1 Then
        LB = LB - 1
        Exit Do
        Else
        mb = LB
        End If
        Case "."
         If LB > mb Then
            rr& = 1
            Else
            IsLabelSYMB3 = 0
            Exit Function
            End If
        Case "A" To "Z", "a" To "z"
     
            rr& = 1 'is an identifier or floating point variable
        Case Else
        LB = LB - 1
        Exit Do
        End Select
                Else
  
           rr& = 1 'is an identifier or floating point variable
   
        
        End If
        LB = LB + 1
    Loop
    r$ = Mid$(A$, mb + 1, LB - mb)
    IsLabelSYMB3 = rr&
  If LB > 0 Then A$ = Mid$(A$, LB + 1)

End Function
Function IsLabelSYMB33(A$, r$, CHARS As Long) As Boolean
Dim rr&, c$, LB As Long, mb As Long, LLB As Long
''A$ = LTrim(A$)
LLB = Len(A$)
r$ = ""
If LLB = 0 Then IsLabelSYMB33 = 0: Exit Function
mb = 0   'INDICATE LEFT SPACES
LB = 1
    Do While LB <= LLB
     c$ = Mid$(A$, LB, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case " ", ChrW(160)
        If LB - mb > 1 Then
        LB = LB - 1
        Exit Do
        Else
        mb = LB
        End If
        Case "."
         If LB > mb Then
            rr& = 1
            Else
            IsLabelSYMB33 = 0
            Exit Function
            End If
        Case "A" To "Z", "a" To "z"
     
            rr& = 1 'is an identifier or floating point variable
        Case Else
        LB = LB - 1
        Exit Do
        End Select
                Else
  
           rr& = 1 'is an identifier or floating point variable
   
        
        End If
        LB = LB + 1
     ' If LB - mb >= CHARS Then Exit Do
    Loop
    r$ = Mid$(A$, mb + 1, LB - mb)
    IsLabelSYMB33 = rr&
   If rr& <> 0 Then
   CHARS = LB + 1
  
 End If
End Function

Function IsLabelA(where$, A$, r$) As Long
' for left side...no &

Dim rr&, one As Boolean, c$, gr As Boolean
r$ = ""
If A$ = "" Then IsLabelA = 0: Exit Function
A$ = NLtrim$(A$)
    Do While Len(A$) > 0
    c$ = Left$(A$, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
            If Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
              where$ = r$
            r$ = ""
            A$ = Mid$(A$, 2)
            Else
              IsLabelA = 0: Exit Function
            End If
        Case "?"
        If r$ = "" Then
        r$ = "?"
        A$ = Mid$(A$, 2)
        IsLabelA = 1
        Exit Function
        Else
        IsLabelA = 1
        Exit Function
        End If
        Case "."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" And Len(A$) > 1 Then
            If Mid$(A$, 2, 2) = ". " Or Mid$(A$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            IsLabelA = 0
            Exit Function
            End If
      Case "&"
            If r$ = "" Then rr& = 2:    A$ = Mid$(A$, 2)
            Exit Do
    Case "\", "{" To "~", "^"
        Exit Do
        
        Case "0" To "9", "_"
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                            If Mid$(A$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 A$ = Mid$(A$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(A$, 1)
                                       A$ = Mid$(A$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
r$ = myUcase(r$, gr)

    IsLabelA = rr&
   'a$ = LTrim(a$)

End Function

Function IsLabelDot(where$, A$, r$) As Long
' for left side...no &

Dim rr&, one As Boolean, c$, firstdot$, gr As Boolean
r$ = ""
If A$ = "" Then IsLabelDot = 0: Exit Function

A$ = NLtrim$(A$)
    Do While Len(A$) > 0
    c$ = Left$(A$, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
            If Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
              where$ = r$
            r$ = ""
            A$ = Mid$(A$, 2)
            Else
              IsLabelDot = 0: A$ = firstdot$ + A$: Exit Function
            End If
        Case "?"
        If r$ = "" And firstdot$ = "" Then
        r$ = "?"
        A$ = Mid$(A$, 2)
        IsLabelDot = 1
        Exit Function
    
        ElseIf firstdot$ = "" Then
        IsLabelDot = 1
        Exit Function
        Else
        IsLabelDot = 0
        Exit Function
        End If
        Case "."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" And Len(A$) > 1 Then
            If Mid$(A$, 2, 2) = ". " Or Mid$(A$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            firstdot$ = firstdot$ + "."
            A$ = Mid$(A$, 2)
            End If
       Case "\", "{" To "~", "^"
        Exit Do

        Case "0" To "9", "_"
           If one Then
            If firstdot$ <> "" Then A$ = firstdot$ + A$
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                            If Mid$(A$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 A$ = Mid$(A$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(A$, 1)
                                       A$ = Mid$(A$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
       r$ = firstdot$ + myUcase(r$, gr)
    IsLabelDot = rr&
   'a$ = LTrim(a$)

End Function
Function IsLabelDotSubOld(where$, A$, rrr$, r$, lang As Long) As Long
' for left side...no &

Dim rr&, one As Boolean, c$, firstdot$, gr As Boolean

rrr$ = ""
r$ = ""
If A$ = "" Then IsLabelDotSubOld = 0: Exit Function

A$ = NLtrim$(A$)

    Do While Len(A$) > 0
    c$ = Left$(A$, 1)
    If AscW(c$) < 256 Then
        Select Case c$
        Case "@"
            If Mid$(A$, 2, 1) <> "(" And r$ <> "" Then
              where$ = r$
            r$ = ""
            rrr$ = ""
            A$ = Mid$(A$, 2)
            Else
              IsLabelDotSubOld = 0: A$ = firstdot$ + A$: Exit Function
            End If
        Case "?"
        If r$ = "" And firstdot$ = "" Then
        rrr$ = "?"
        r$ = rrr$
        A$ = Mid$(A$, 2)
        IsLabelDotSubOld = 1
        Exit Function
    
        ElseIf firstdot$ = "" Then
        IsLabelDotSubOld = 1
        rrr$ = r$
        Exit Function
        Else
        IsLabelDotSubOld = 0
        Exit Function
        End If
        Case "."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" And Len(A$) > 1 Then
            If Mid$(A$, 2, 2) = ". " Or Mid$(A$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1
            Else
            firstdot$ = firstdot$ + "."
            A$ = Mid$(A$, 2)
            End If
       Case "\", "{" To "~", "^"
        Exit Do

        Case "0" To "9", "_"
           If one Then
            If firstdot$ <> "" Then A$ = firstdot$ + A$
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is >= "A"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            Else
            Exit Do
            End If
        Case "("
            If r$ <> "" Then
                            If Mid$(A$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 A$ = Mid$(A$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(A$, 1)
                                       A$ = Mid$(A$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(A$, 1)
            A$ = Mid$(A$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
       rrr$ = firstdot$ + myUcase(r$, gr)
       lang = 1 + CLng(gr)
    IsLabelDotSubOld = rr&
   'a$ = LTrim(a$)

End Function

Function IsStrExp(basestack As basetask, aa$, rr$) As Boolean
If Left$(aheadstatus(aa$, False), 1) <> "S" Then IsStrExp = False: Exit Function
If LastErNum = -2 Then LastErNum = 0 ': LastErNum1 = 0
Dim ac$, fault As Boolean
' uink$ = "" 'MINK$
again:
fault = False
IsStrExp = False
'' FastSymbol aa$, "+"   '' maybe but not sure if it is ok.
Do While IsString(basestack, aa$, rr$)
fault = False
IsStrExp = True
ac$ = ac$ & rr$
If Not FastSymbol(aa$, "+") Then Exit Do
fault = True
Loop
If fault Then
If LastErNum = -2 Then
Exit Function
Else
aa$ = "+" & aa$
End If
End If
If FastSymbol(aa$, "<<", , 2) Then
basestack.soros.DataStr ac$
ac$ = ""
GoTo again
End If
rr$ = ac$
 End Function
Function GrabFrame() As String
Dim p As New cDIBSection
p.CreateFromPicture hDCToPicture(GetDC(0), (AVI.Left + Form1.Left) / DXP, (AVI.top + Form1.top) / DYP, AVI.Width / DXP, AVI.Height / DYP)
If p.Height > 0 Then

GrabFrame = DIBtoSTR(p)
End If
End Function
Function ReadVarDouble(bstack As basetask, what$) As Double
Dim vvv As Variant
bstack.ReadVar what$, vvv
ReadVarDouble = vvv
End Function

Function ReadVarInt(bstack As basetask, what$) As Double
Dim vvv As Variant
bstack.ReadVar what$, vvv
ReadVarInt = Int(vvv)
End Function
Function ReadVarStr(bstack As basetask, what$) As String
Dim vvv As Variant
bstack.ReadVar what$, vvv
ReadVarStr = vvv
End Function
Function IsString(bstackstr As basetask, A$, r$) As Boolean
Dim nBstack As basetask
Dim p As Double, PP As Double, pppp As mArray, ms As mStiva
Dim q$, w As Long, w1&, w2 As Long, s$, par As Boolean
Dim q1$, q2$, W3 As Long, dn As Long, dd As Long, bs As basetask
Set bstackstr.lastobj = Nothing
If IsSymbol3(A$, "{") Then
     r$ = blockString(A$)
     IsString = FastSymbol(A$, "}")
     Exit Function
End If
r$ = ""
w2 = Len(A$)
w1& = IsLabelBig(bstackstr, A$, q$, par)
''''''''If NoOptimum Then If w1& > 0 Then par = False
If w1& <= 0 Or par Then
If w1& = 0 Then GoTo contstr
If w1& = -100 Then
    w1& = 0
    r$ = "deleteme"
      If bstackstr.GetDotNew(r$, 1) Then
      If r$ = "THIS.deleteme" Then
      r$ = Left$(bstackstr.UseGroupname, Len(bstackstr.UseGroupname) - 1)
       ElseIf bstackstr.UseGroupname <> "" Then
           If Len(r$) = 8 Then IsString = False: Exit Function
           r$ = Left$(r$, Len(r$) - 9)
           If r$ + "." = bstackstr.UseGroupname Then
           ElseIf InStr(r$, ".") = 0 Then
            If here$ <> "" Then r$ = here$ + "." + r$
           End If
           
       Else
       If Len(r$) = 8 Then
       Set bs = bstackstr.Parent
       Do While Not (bs Is Nothing)
        If bs.GetDotNew(r$, 1) Then
                     If Len(r$) = 8 Then
                     Set bs = bs.Parent
                     Else
                     r$ = here$ + "." + Left$(r$, Len(r$) - 9)
                     Set bs = Nothing
                     Exit Do
                     End If
Else
r$ = ""
Exit Do
        End If
       Loop
       Else
  r$ = here$ + "." + Left$(r$, Len(r$) - 9)
  End If
  End If
           IsString = True
  
        Exit Function
    ElseIf bstackstr.UseGroupname <> "" Then
        r$ = Left$(bstackstr.UseGroupname, Len(bstackstr.UseGroupname) - 1)
         IsString = True
         Exit Function

    End If
    r$ = ""
End If
w1& = Abs(w1&)
Select Case w1&
Case 2
r$ = q$
IsString = True
Exit Function
Case 3
GoTo itisavar
Case 5
GoTo rvalObjectstring
Case 6
GoTo itisarrayorfunction
Case Else
         IsString = False
        Exit Function

End Select
End If
Select Case w1&
Case 5
            ' check again
rvalObjectstring:
            If Left$(aheadstatus(q$ + Split(A$, Chr$(13))(0), False), 1) = "S" Then

            If neoGetArray(bstackstr, q$, pppp) Then
                If NeoGetArrayItem(pppp, bstackstr, q$, w, A$) Then
                        If Typename(pppp.item(w)) = "Group" Then
                        IsString = SpeedGroup(bstackstr, pppp, "VAL$", q$, A$, w) = 1
                        r$ = bstackstr.LastValue
                        Exit Function
                        End If
                End If
                End If
            Else
                     IsString = False
                    Exit Function
            
            End If
    Case 3
    IsString = False
    If Not strid.ExistKey(q$) Then GoTo itisavar
    
    Select Case q$
    Case "ABOUT$", "ΠΕΡΙ$"
            r$ = feedback$
            feedback$ = ""
             IsString = True
                              Exit Function
    Case "CONTROL$"
                  On Error Resume Next
                  If Screen.ActiveForm Is Nothing Then
                  r$ = ""
                  Else
                  Select Case Screen.ActiveForm.name
                  Case "AVI"
                  r$ = "AVI"
                  Case "Form1"
                    r$ = "Main"
                  Case "Form4"
                  r$ = "Help"
                  Case Else
                  r$ = ""
                  End Select
                  End If
                      IsString = True
                              Exit Function
     Case "ΦΟΡΜΑ$"
                  On Error Resume Next
                  If Screen.ActiveForm Is Nothing Then
                  r$ = ""
                  Else
                  Select Case Screen.ActiveForm.name
                  Case "AVI"
                  r$ = "ΤΑΙΝΙΑ"
                  Case "Form1"
                    r$ = "ΚΥΡΙΟ"
                  Case "Form4"
                  r$ = "ΒΟΗΘΕΙΑ"
                  Case Else
                  r$ = ""
                  End Select
                  End If
                 IsString = True
                              Exit Function
                           
    Case "THREADS$"
                               r$ = bstackstr.Parent.ThreadsStr(1)
                               IsString = True
                              Exit Function
  Case "ΝΗΜΑΤΑ$"
                               r$ = bstackstr.Parent.ThreadsStr
                               IsString = True
                              Exit Function
    Case "LAN$", "ΔΙΚΤΥΟ$"
    r$ = getIP
      IsString = True
     Exit Function
    Case "GRABFRAME$", "ΠΑΡΕΚΑΡΕ$"
                              If AVIUP Then
                              If MediaPlayer1.MovieHeight > 0 Then
                              r$ = GrabFrame
                              End If
                              End If
                             IsString = True
                            Exit Function
    Case "ΕΝΑΟΝΟΜΑ$", "TEMPNAME$"
                             r$ = GetTempFileName
                            IsString = True
                            Exit Function
    Case "TEMPORARY$", "ΠΡΟΣΩΡΙΝΟ$"  ' ΒΡΈΘΗΚΕ ΔΥΟ ΦΟΡΕΣ ΤΟ ΠΡΟΣΩΡΙΝΟ$
                            r$ = strTemp  'ΑΥΤΟΣ ΕΙΝΑΙ Ο ΦΑΚΕΛΟΣ
                            IsString = True
                            Exit Function
    Case "USER.NAME$", "ΟΝΟΜΑ.ΧΡΗΣΤΗ$"
                             r$ = Originalusername
                            IsString = True
                            Exit Function
    Case "COMPUTER$", "ΥΠΟΛΟΓΙΣΤΗΣ$"
                             r$ = strMachineName
                            IsString = True
                            Exit Function
    Case "CLIPBOARD$", "ΠΡΟΧΕΙΡΟ$"
                            r$ = GetTextData(CF_UNICODETEXT)
                            If r$ = "" Then r$ = Clipboard.GetText
                            IsString = True
                            Exit Function
    Case "CLIPBOARD.IMAGE$", "ΠΡΟΧΕΙΡΟ.ΕΙΚΟΝΑ$"
                        r$ = GetImage()
                         IsString = True
                         Exit Function

    Case "ΠΑΡΑΜΕΤΡΟΙ$", "PARAMETERS$"
                        r$ = para$
                        IsString = True
                        Exit Function
    Case "OS$", "ΛΣ$"
                        r$ = os
                        IsString = True
                        Exit Function
    Case "ΕΝΤΟΛΗ$", "COMMAND$"
                        r$ = LASTPROG$
                    IsString = True
                    Exit Function
    Case "ΛΑΘΟΣ$"
        If Left$(LastErNameGR, 1) = Chr(0) Then LastErNameGR = Mid$(LastErNameGR, 2)
                     r$ = LastErNameGR
                      LastErNum1 = 0
                        LastErNameGR = ""
                     LastErName = ""
                    IsString = True
                    Exit Function
    Case "ERROR$"
    If Left$(LastErName, 1) = Chr(0) Then LastErName = Mid$(LastErName, 2)
                     r$ = LastErName
                      LastErNum1 = 0
                     LastErNameGR = ""
                     LastErName = ""
                    IsString = True
                    Exit Function
    Case "MODULE$", "ΤΜΗΜΑ$"
                    r$ = here$ ''''''''''''' ανάγνωση του Here$ (προσοχή κίνδυνος)
                                '''''''''''' γιατί μπορεί η τιμή να μην είναι αυτή που περιμέναμε
                                '''''''''''' να δοκιμάσω διπλό νήμα, όπου το δεύτερο είναι σε τμήμα
                                '''''''''''' που κάλεσε το τμήμα του πρώτου νήματος.
                                '''''''''''' Επίσης θα υπάρχει πρόβλημα αν το τμήμα αλλάζει όνομα
                                '''''''''''' με άμεση εντολή ΤΜΗΜΑ "ΑΛΛΟ ΟΝΟΜΑ"
                    IsString = True
                    Exit Function
    Case "PRINTERNAME$", "ΕΚΤΥΠΩΤΗΣ$"  ' δεν παίζει ρόλο πια η πόρτα
                    r$ = pname & " (" & port & ")"
                    IsString = True
                    Exit Function
    Case "PROPERTIES$", "ΙΔΙΟΤΗΤΕΣ$"
                If ThereIsAPrinter Then
                If UBound(MyDM) = 1 Then
                    PrinterDim pw, ph, psw, psh, pwox, phoy
                End If
                r$ = ARRAYtoStr(MyDM())
                Else
                r$ = ""
                End If
                    IsString = True
                    Exit Function
    Case "MOVIE.STATUS$", "ΚΑΤΑΣΤΑΣΗ.ΤΑΙΝΙΑΣ$"
                   r$ = MediaPlayer1.getStatus
                IsString = True
                Exit Function
    Case "MOVIE.DEVICE$", "ΣΥΣΚΕΥΗ.ΠΡΟΒΟΛΗΣ$"
                   r$ = MediaPlayer1.getDeviceName
                IsString = True
                Exit Function
    Case "MOVIE.ERROR$", "ΛΑΘΟΣ.ΤΑΙΝΙΑΣ$"
                   r$ = MediaPlayer1.checkError
                IsString = True
                Exit Function
    Case "PLATFORM$", "ΠΛΑΤΦΟΡΜΑ$"
                r$ = platform
                IsString = True
                Exit Function

    Case "FONTNAME$", "ΓΡΑΜΜΑΤΟΣΕΙΡΑ$"
    With bstackstr
                 If .tolayer > 0 And .tolayer < 32 Then
                 r$ = Form1.dSprite(.tolayer).Font.name
                 ElseIf .tolayer >= 32 Then
                 r$ = players(.tolayer).FontName
                 ElseIf .toback Then
                 r$ = Form1.Font.name
                 ElseIf .toprinter Then
                 r$ = Form1.PrinterDocument1.Font.name
                 Else
                r$ = Form1.DIS.Font.name
                End If
                End With
                 IsString = True
                 Exit Function
    Case "BROWSER$", "ΑΝΑΛΟΓΙΟ$"
                r$ = Form1.view1.LocationURL
                IsString = True
                Exit Function

    Case "SPRITE$", "ΔΙΑΦΑΝΕΙΑ$"
                r$ = BACKSPRITE
                BACKSPRITE = ""
                IsString = True
                Exit Function
    Case "APPDIR$", "ΕΦΑΡΜΟΓΗ.ΚΑΤ$"
                r$ = GetLongName(App.path)
                If Right(r$, 1) <> "\" Then r$ = r$ + "\"
                IsString = True
                Exit Function
    Case "DIR$", "ΚΑΤ$"
    
                r$ = UserPath
    
                IsString = True
                Exit Function
    Case "KEY$", "ΚΟΜ$"
                ' this is because w1 do a pretty new functionality...form1 can minimized..without own titlebar or controls.

                    If Not Form1.Visible Then Form1.Visible = True: MyDoEvents
                  ''  If Not bstackstr.toprinter Then bstackstr.Owner.refresh
                ' so if we need a keystroke to read then we go ton non minimized status.
                r$ = UINKEY$  ' look if we have some keys here
                If r$ = "" Or r$ = Chr(0) + Chr(0) Then
                Do
               ProcTask2 bstackstr

           
                       If uintnew(timeGetTime) > k1 Then RRCOUNTER = 0
            
                If RRCOUNTER = 0 Then
                    k1 = uintnew(timeGetTime + REFRESHRATE): RRCOUNTER = 1
                 If bstackstr.Owner.Visible Then bstackstr.Owner.Refresh
                  End If
                r$ = INKEY$  ' (inkey$ has autorepeat...)
                Loop Until r$ <> ""
                UINK$ = UINK$ & r$   ' so we send it there
                End If
                IsString = True
                Exit Function
    Case "INKEY$", "ΕΝΚΟΜ$"
     If Not releasemouse Then
If Not Form1.Visible Then Form1.Visible = True
 MyDoEvents2 bstackstr.Owner
Else

           If uintnew(timeGetTime) > k1 Then RRCOUNTER = 0
            
                If RRCOUNTER = 0 Then
                    k1 = uintnew(timeGetTime + REFRESHRATE): RRCOUNTER = 1
                 If bstackstr.Owner.Visible Then bstackstr.Owner.Refresh
                  End If
                If Not bstackstr.IamThread Then MyDoEvents
End If
                r$ = UINKEY$

                If r$ = "" Then
           '     Sleep 10
              ''MyDoEvents
          
                    r$ = INKEY$
                     If r$ = "" Then
                     UINK$ = UINK$ & Chr(0) + Chr(0)
                     Else
                     UINK$ = UINK$ & r$
                     End If
                ElseIf r$ = Chr(0) + Chr(0) Then
                r$ = ""
                End If
                IsString = True
                Exit Function
    Case "LETTER$", "ΓΡΑΜΜΑ$"
                If bstackstr.soros.Total = 0 Then
                ElseIf bstackstr.soros.PopType = "S" Then
                r$ = bstackstr.soros.PopStr
                IsString = True
                Exit Function
                End If
    Case "LAMBDA$", "ΛΑΜΔΑ$"
        Set bstackstr.lastobj = ProcLambda(bstackstr, A$)
        r$ = ""
        IsString = Not bstackstr.lastobj Is Nothing
    Exit Function
    Case Else
itisavar:
                If GetVar(bstackstr, q$, w) Then
                If IsObject(var(w)) Then
                If Typename$(var(w)) = "lambda" Then
                Dim aaa As lambda
                r$ = ""
                var(w).CopyTo aaa, var()
                Set bstackstr.lastobj = aaa
                Set aaa = Nothing
                Else
                r$ = var(w)
                End If
                Else
                r$ = var(w)
                End If
                IsString = True
                
                Else
                  If w = -1 Then
                      r$ = ReadVarStr(bstackstr, q$)
                      IsString = True
                      Exit Function
                End If
                     IsString = False
                     ' MAKE LENGTH EQUAL...
                     If w2 >= Len(A$) Then A$ = q$ + A$
                    
                             If FindNameForGroup(bstackstr, q$) Then
                             MyErMacro A$, "Unknown property  " & q$, "’γνωστη ιδιότητα " & q$
                             Else
                                MyErMacro A$, "Unknown variable " & q$, "’γνωστη μεταβλητή " & q$
                            
                            End If
                    End If
                
                Exit Function
    End Select
                A$ = q$ & A$
                               
    Exit Function
    
Case 6
    IsString = False
If Not strfunid.ExistKey(q$) Then GoTo itisarrayorfunction
    Select Case q$
Case "FORMAT$(", "ΜΟΡΦΗ$("
    r$ = enthesi(bstackstr, A$)
    IsString = FastSymbol(A$, ")", True)
    Exit Function
Case "EVAL$(", "ΕΚΦΡ$(", "ΕΚΦΡΑΣΗ$("
    If IsExp(bstackstr, A$, p) Then
    If bstackstr.lastobj Is Nothing Then Exit Function
    If TypeOf bstackstr.lastobj Is mHandler Then
    Dim anything As Object
        Set anything = bstackstr.lastobj
        With anything
            If .T1 = 1 Then
            If FastSymbol(A$, ",") Then
                If IsExp(bstackstr, A$, p) Then
                p = Int(p)
                If p >= 0 And p < .objref.count Then
                .objref.index = p
                .objref.Done = True
                r$ = .objref.KeyToString
                  Else
         
                  MyEr "Index out of limits", "Δείκτης εκτός ορίων"

                End If
                Else
                MissPar
                End If
                ElseIf .objref.Done Then
                    If FastSymbol(A$, "!") Then
                     r$ = .objref.KeyToString
                     Set bstackstr.lastobj = Nothing
                    Else
                    If .objref.IsObj Then
                        If TypeOf .objref.ValueObj Is lambda Then CopyLambda .objref.ValueObj, bstackstr
                           r$ = ""
                        Else
                        Set bstackstr.lastobj = Nothing
                            r$ = CStr(.objref.Value)
                        End If
                    End If
                    End If
            
            Else ' IS A MEMBLOCK
                Set bstackstr.lastobj = Nothing
                If FastSymbol(A$, ",") Then
                    If IsExp(bstackstr, A$, p) Then
                    PP = p
                        If FastSymbol(A$, "!") Then
                        
                         If IsLabelOnly(A$, s$) Then
                            If .objref.UseStruct Then
                                If .objref.structref.Find(myUcase(s$, True)) Then
                                PP = .objref.structref.sValue
                                    w2 = cUlng(uintnew(.objref.GetPtr(p)) + .objref.structref.Value)
                                    If FastSymbol(A$, "!") Then
                                     If IsExp(bstackstr, A$, p) Then
                                      ' w2 = w2 + Int(p) * PP
                                     w2 = cUlng(uintnew(w2) + Int(p) * PP)
                                     End If
                                    End If
                                Else
                                
                                    MyErMacro A$, "Unknown variable " & s$, "’γνωστη μεταβλητή " & s$
                                    Exit Function
                                
                                End If
                            Else
                                    MyErMacro A$, "no structure exist", "δεν υπάρχει δομή"
                                    Exit Function
                            
                        End If
                        Else
                        w2 = .objref.GetBytePtr(p)
                        End If
                        
                            
                        Else
                            w2 = .objref.GetPtr(p)
                        End If
                        If .objref.Status = 4 Then MyEr "Buffer locked, wrong use of pointer", "Η Διάρθρωση κλειδώθηκε, κακή χρήση δείκτη": Exit Function
                        If FastSymbol(A$, ",") Then
                            If IsExp(bstackstr, A$, p) Then
                            ' NOW WE KNOW HOW MANY BYTES WE TAKE (ALWAYS BYTES)
                                p = Int(p)
                                If .objref.ValidArea(w2, p) Then
                                    r$ = String$((p + 1) \ 2, Chr(0))
                                    CopyBytes CLng(p), StrPtr(r$), w2
                                Else
                                    MyEr "Buffer is small, can't get so many bytes", "Η Διάρθρωση είναι μικρή, δεν μπορώ να πάρω τόσα ψηφία"
                                End If
                            Else
                                MissPar
                                IsString = False
                                Exit Function
                            End If
                        Else
                                    p = .objref.SizeByte - PP * 2
                                     r$ = String$((.objref.SizeByte - PP * 2 + 1) \ 2, Chr(0))
                                    CopyBytes CLng(p), StrPtr(r$), w2
                        End If
                        IsString = FastSymbol(A$, ")") And .objref.Status = 0
                        Exit Function
                    Else
                        MissPar
                        IsString = False
                        Exit Function
                    End If
                    
                Else  ' elval$(alfa)  'copy entire block to r$
                    If .objref.SizeByte > 0 And .objref.Status = 0 Then
                        r$ = String$((.objref.SizeByte + 1) \ 2, Chr(0))
                        CopyBytes .objref.SizeByte, StrPtr(r$), .objref.GetPtr(0)
                    Else
                        r$ = ""
                    End If
                End If
           
            
            End If
               IsString = FastSymbol(A$, ")", True)
                Set anything = Nothing
                Exit Function
        End With
        Set anything = Nothing
    End If
    MissParam A$
    ElseIf IsStrExp(bstackstr, A$, q$) Then
If FastSymbol(A$, ".") Then
If MaybeIsSymbol(A$, ")") Then
A$ = q$ + A$
Else
    A$ = q$ + "." + A$
    End If
   If Not IsStrExp(bstackstr, A$, r$) Then
      IsString = False: Exit Function
    End If
    
    Else
    r$ = q$
End If

Else
r$ = ""
End If
    IsString = FastSymbol(A$, ")", True)
    Exit Function
Case "STACKTYPE$(", "ΣΩΡΟΥΤΥΠΟΣ$("
If IsExp(bstackstr, A$, p) Then
W3 = Abs(CLng(p))
backitem1:
    If bstackstr.soros.Total < W3 Then
 
            MyErMacro A$, "Stack item not found at position " & CStr(W3), "Δεν υπάρχει στοιχείο σωρού στη θέση " & CStr(W3)
  
        IsString = False: Exit Function

    ElseIf bstackstr.soros.StackItemType(W3) = "*" Then
    Set bstackstr.lastobj = bstackstr.soros.StackItem(W3)
    r$ = Typename$(bstackstr.lastobj)
    Set bstackstr.lastobj = Nothing
    IsString = FastSymbol(A$, ")", True)
    ElseIf bstackstr.soros.StackItemType(W3) = "?" Then
    r$ = "(?)"
    ElseIf bstackstr.soros.StackItemType(W3) = "S" Then
    s$ = CStr(bstackstr.soros.StackItem(W3))
    r$ = ""
    Select Case Abs(IsLabel(bstackstr, s$, q2$))
    Case 1, 3, 4
    
    If varhash.ExistKey(q2$) Then
    r$ = "ReferVar"
    ElseIf varhash.ExistKey(q2$ + "(") Then
    r$ = "ReferArray"
    End If
    
    Case 5, 6, 7
   
    End Select
    If r$ = "" Then r$ = "String"
            IsString = FastSymbol(A$, ")", True)
    ElseIf bstackstr.soros.StackItemType(W3) = "N" Then
    
    r$ = "Number"
        IsString = FastSymbol(A$, ")", True)
    Else
            MyErMacro A$, "Stack item isn't known object at position " & CStr(W3), "To στοιχείο του σωρού δεν είναι γνωστό αντικείμενο στη θέση " & CStr(W3)
  
    IsString = False
    End If
    Exit Function
Else
W3 = 1
GoTo backitem1
End If

Case "STACKITEM$(", "ΤΙΜΗΣΩΡΟΥ$("
If IsExp(bstackstr, A$, p) Then
W3 = Abs(CLng(p))
backitem2:
    If bstackstr.soros.Total < W3 Then
 
            MyErMacro A$, "Stack item not found at position " & CStr(W3), "Δεν υπάρχει τιμή σωρού στη θέση " & CStr(W3)
  
        IsString = False: Exit Function

    ElseIf bstackstr.soros.StackItemType(W3) = "S" Then
    r$ = bstackstr.soros.StackItem(W3)
    IsString = FastSymbol(A$, ")", True)
    Exit Function
    Else
            MyErMacro A$, "Stack item isn't string at position " & CStr(W3), "Η τιμή του σωρού δεν είναι γράμμα στη θέση " & CStr(W3)
  
    IsString = False
    End If
    Exit Function
Else
W3 = 1
GoTo backitem2
End If
Case "ΙΣΧΝΗ$(", "WEAK$("
                r$ = Funcweak(bstackstr, A$)

                 IsString = FastSymbol(A$, ")") And r$ <> ""
             If Not IsString Then
             MyErMacro A$, "No variable found or is static", "Δεν υπάρχει μεταβλητή ή είναι στατική"
             End If
                Exit Function
Case "ΛΟΓΟΣ$(", "SPEECH$("
           If IsExp(bstackstr, A$, p) Then
                       
                        r$ = VoiceName(p)
                       
                        End If
                        IsString = FastSymbol(A$, ")")
             
                Exit Function
Case "ASK$(", "ΡΩΤΑ$("
If IsStrExp(bstackstr, A$, AskText$) Then
If UCase(q$) = "ASK$(" Then
DialogSetupLang 1
Else
DialogSetupLang 0
End If
If AskText$ = "" Then ZeroParam A$: IsString = False: Exit Function
If FastSymbol(A$, ",") Then IsStrExp bstackstr, A$, AskTitle$
If FastSymbol(A$, ",") Then IsStrExp bstackstr, A$, AskOk$
If FastSymbol(A$, ",") Then IsStrExp bstackstr, A$, AskCancel$
If FastSymbol(A$, ",") Then IsStrExp bstackstr, A$, AskDIB$
If FastSymbol(A$, ",") Then IsStrExp bstackstr, A$, AskStrInput$: AskInput = True

olamazi

If Form3.NeoASK(bstackstr) Then
r$ = AskResponse$
Else
r$ = AskResponse$
End If
AskInput = False
    IsString = FastSymbol(A$, ")", True)
End If
Exit Function
    Case "LOCALE$(", "ΤΟΠΙΚΟ$("
         If IsExp(bstackstr, A$, p) Then

    r$ = GetlocaleString(CLng(p))
     IsString = FastSymbol(A$, ")")
       End If
       
        Exit Function
 
    Case "SHORTDIR$(", "ΜΙΚΡΟΣ.ΚΑΤΑΛΟΓΟΣ$("
         If IsStrExp(bstackstr, A$, q$) Then
      

    r$ = GetDosPath(q$)
     IsString = FastSymbol(A$, ")")
       End If
       
        Exit Function
 
     Case "FILTER$(", "ΦΙΛΤΡΟ$("
     If IsStrExp(bstackstr, A$, q$) Then
       If FastSymbol(A$, ",") And IsStrExp(bstackstr, A$, q1$) Then
       
     IsString = True
    r$ = CleanStr(q$, q1$)
    
       End If
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
        Case "ΛΟΓΟΣ$(", "SPEECH$("
           If IsExp(bstackstr, A$, p) Then
                       
                        r$ = VoiceName(p)
                       
                        End If
                        IsString = FastSymbol(A$, ")")
             
                Exit Function
   
    
     Case "ΑΡΧΕΙΟ$(", "FILE$("
     If Left$(UCase(q$), 1) = "F" Then
DialogSetupLang 1

Else
DialogSetupLang 0

End If
        If IsStrExp(bstackstr, A$, r$) Then
                       If IsSelectorInUse Then
 IsString = False
MyErMacro A$, "File/Folder Selector in Use", "Ο επιλογέας αρχείων/φακέλων είναι σε χρήση"
Exit Function
End If

If r$ = "" Then
r$ = LoadFileCaption
End If
If FastSymbol(A$, ",") Then
If IsStrExp(bstackstr, A$, q1$) Then
' ok
Else
 IsString = False
MissParam A$
Exit Function
End If
Else
q1$ = "GSB"
End If
                        r$ = mylcasefILE(GetFile(bstackstr, r$, mcd, q1$))
                       Else
                       
                        r$ = mylcasefILE(GetFile(bstackstr, r$, mcd, "GSB"))
                        End If
                        IsString = FastSymbol(A$, ")")
             
                Exit Function
Case "PARAM$(", "ΠΑΡΑΜ$("
q1$ = ""
If IsStrExp(bstackstr, A$, q2$) Then

Do
w1 = Len(q2$)
      If IsNumberD2(q2$, p) Then
      If q1$ = "" Then Exit Do Else q1$ = q1$ + "," + CStr(p)
      
      Else
             ISSTRINGA q2$, s$
        If q1$ = "" Then
                r$ = s$
        q1$ = ","
        Else
        q1$ = q1$ + ",{" + s$ + "}"
        End If
    End If
    FastSymbol q2$, ","
Loop Until Trim$(q2$) = "" Or w1 = Len(q2$)
End If
    IsString = FastSymbol(A$, ")", True)
    A$ = Mid$(q1$, 2) + A$
    Exit Function
Case "LAZY$(", "ΟΚΝ$("
   If FastSymbol(A$, "&") Then
           

            If Abs(IsLabelBig(bstackstr, A$, q2$, par)) < 5 Then    ''IsLabelDot(HERE$, A$, q2$)
            
            Exit Function
            End If
            par = False
         '   MakeThisSubNum bstackstr, q2$
             If GetSub(q2$ + ")", w1) Then
             If sbf(w1).sbgroup = "" Then
             r$ = sbf(w1).sb + "}"
             Else
                    r$ = sbf(w1).sb + "}" + sbf(w1).sbgroup
                    
                    par = True
                    End If
                    End If
                
            If Not FastSymbol(A$, ")") Then
                    IsString = False
                    MyErMacro A$, "No parameters allowed here ()", "Δεν επιτρέπονται παράμετροι εδώ ()"
                    Exit Function
            End If
            If Left$(r$, 10) = "'11001EDIT" Then
                s$ = GetNextLine(r$) + vbCrLf
            Else
                s$ = ""
            End If
            q2$ = ""
    Else
    par = False
         w = 1
         q1$ = aheadstatus(A$, , w)
         If w > 0 Then q2$ = Left$(A$, w - 1) Else q2$ = "0"
         A$ = Mid$(A$, w)
         While FastSymbol(A$, ",")
            w = 1
            q1$ = aheadstatus(A$, , w)
            If w > 0 Then q2$ = q2$ + "," + Left$(A$, w - 1) Else q2$ = q2$ + ",0"
            A$ = Mid$(A$, w)
         Wend
         
         r$ = "=" + q2$: q2$ = "}" + bstackstr.UseGroupname
         s$ = ""
   End If
 
If Trim$(r$ + q2$) <> "" Then
   ' r$ = "{ΤΜΗΜΑ " + Chr(34) + HERE$ & Chr(34) + vbCrLf + r$ + q2$
          If par Then
    
            r$ = "{" + s$ + r$ + q2$
    
       Else
   If q$ = "ΟΚΝ$(" Then

   If here$ = "" Then
    r$ = "{" + s$ + "ΤΜΗΜΑ {}" + vbCrLf + r$ + q2$
   Else
    r$ = "{" + s$ + "ΤΜΗΜΑ " + here$ + vbCrLf + r$ + q2$
    End If
    Else
    If here$ = "" Then
    r$ = "{" + s$ + "MODULE {}" + vbCrLf + r$ + q2$
   Else
    r$ = "{" + s$ + "MODULE " + here$ + vbCrLf + r$ + q2$
    End If
    End If
    End If
    Else
    r$ = "{}"
    End If
     IsString = FastSymbol(A$, ")")
       
       
        Exit Function
    Case "INPUT$(", "ΕΙΣΑΓΩΓΗ$("
      IsSymbol3 A$, "#"  ' drop it
    If IsExp(bstackstr, A$, p) Then
    p = CLng(MyMod(Abs(p), 512))
    PP = FLEN(p)
    If Uni(p) And PP = 1 Then PP = 2
    
    If FastSymbol(A$, ",") Then
    If Not IsExp(bstackstr, A$, PP) Then
    MyErMacro A$, "missing parameter for length in chars", "λείπει πράμετρος για μήκος σε χαρακτήρες"
    IsString = False: Exit Function
    End If
    End If
    r$ = Space$(PP)
    On Error Resume Next
    If Uni(p) Then
    getUniString CLng(p), r$
    Else
    Get #p, , r$   ' reading aS ansi
    End If
    End If
    If Err.Number = 0 Then
    IsString = FastSymbol(A$, ")")
    End If
     Exit Function
    Case "MEMBER.TYPE$(", "ΜΕΛΟΥΣ.ΤΥΠΟΣ$("
     If Abs(IsLabel(bstackstr, A$, s$)) = 1 Then
            If GetVar(bstackstr, s$, w1) Then
                If Typename(var(w1)) = "Group" Then
                If FastSymbol(A$, ",") Then
                If IsExp(bstackstr, A$, p) Then
                Set ms = var(w1).PrepareSoros(var(), "")
                If p < 1 Or p > ms.Total Then
                OutOfLimit
                Exit Function
                
                End If
                s$ = ms.StackItem(CLng(p))
                If Left$(s$, 1) = "*" Then s$ = Mid$(s$, 2)
                q1$ = Split(s$)(1)
                s$ = Split(s$)(0)
                If Right$(s$, 2) = "()" Then
                    
                    If varhash.ExistKey(Left$(s$, Len(s$) - 1)) Then
                        If Right$(s$, 3) = "$()" Then
                            r$ = "Array String"
                        ElseIf Right$(s$, 3) = "%()" Then
                            r$ = "Array Integer"
                        Else
                             r$ = "Array Double"
                            
                        End If
                    End If
                Else
                W3 = val(q1$)
                
                    r$ = Typename(var(W3))
                If r$ = "mHandler" Then
                       Select Case var(W3).T1
                       Case 1
                           r$ = "Inventory"
                       Case 2
                           r$ = "Buffer"
                       Case Else
                         r$ = Typename(var(W3).objref)
                       End Select
                     End If
                    End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else

                MissingGroup
                Exit Function
                End If
 
                IsString = FastSymbol(A$, ")", True)
                Exit Function
            Else
        
            Nosuchvariable s$
            End If
        Else
         MissingGroup
       End If
       Exit Function
    Case "MEMBER$(", "ΜΕΛΟΣ$("
     If Abs(IsLabel(bstackstr, A$, s$)) = 1 Then
            If getvar2(bstackstr, s$, w1) Then   '' we need s$ if this is a "THIS"
                  If Typename(var(w1)) = "Group" Then
                If FastSymbol(A$, ",") Then
                If IsExp(bstackstr, A$, p) Then
                If here$ <> "" Then
                Set ms = var(w1).PrepareSoros(var(), here$ + "." + Left$(s$, Len(s$) - Len(var(w1).GroupName) + 1))
                Else
                Set ms = var(w1).PrepareSoros(var(), Left$(s$, Len(s$) - Len(var(w1).GroupName) + 1))
                End If
                If p < 1 Or p > ms.Total Then
                OutOfLimit
                Exit Function
                
                End If
                 s$ = ms.StackItem(CLng(p))
                If Left$(s$, 1) = "*" Then s$ = Mid$(s$, 2)
                         r$ = Split(s$)(0)
                 If InStr(r$, ChrW(&HFFBF)) > 0 Then r$ = Replace$(r$, ChrW(&HFFBF), "")
                Else
                MissNumExpr
                Exit Function
                End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else

                MissingGroup
                Exit Function
                End If
 
                IsString = FastSymbol(A$, ")", True)
                Exit Function
            Else
        
            Nosuchvariable s$
            End If
        Else
         MissingGroup
       End If
       Exit Function
    
    
     Case "PIPENAME$(", "ΑΥΛΟΣ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = validpipename(r$)
                        IsString = True
                ElseIf IsExp(bstackstr, A$, p) Then  ' χρήση του p, από εδώ αρχίζουν οι απανωτές κλήσεις
                                                    ' μπορούν να κληθούν συναρτήσεις αλλά όχι τμήματα!
                                                    '
                        r$ = validpipename("M" & Trim$(Str$(p)))
                        IsString = True
                End If
                If Not FastSymbol(A$, ")") Then IsString = False
                Exit Function
    Case "FILE.TYPE$(", "ΤΥΠΟΣ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = ExtractType(r$)
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
       Case "FILE.NAME.ONLY$(", "ΟΝΟΜΑ.ΑΡΧΕΙΟΥ.ΜΟΝΟ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = ExtractNameOnly(r$)
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
       Case "FILE.NAME$(", "ΟΝΟΜΑ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = ExtractName(r$)
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
    Case "FILE.PATH$(", "ΤΟΠΟΣ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = ExtractPath(r$)  ' δίνει χωρίς να κοιτάει αν υπάρχει!
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
    Case "ΟΔΗΓΟΣ$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = DriveType(Left$(r$, 3))  'greek response
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
    Case "DRIVE$("
                If IsStrExp(bstackstr, A$, r$) Then
                        r$ = DriveTypee(Left$(r$, 3))
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
                Exit Function
    Case "ΤΙΛΤΟΣ.ΑΡΧΕΙΟΥ$(", "FILE.TITLE$("
                If IsStrExp(bstackstr, A$, r$) Then
                        If r$ <> "" Then r$ = FileNameType(r$)
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
    Case "ΕΦΑΡΜΟΓΗ.ΑΡΧΕΙΟΥ$(", "FILE.APP$("
                If IsStrExp(bstackstr, A$, r$) Then
                        If r$ <> "" Then r$ = myRegister(r$)
                        IsString = True
                        If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                End If
    Case "HIDE$(", "ΚΡΥΦΟ$("
                If IsStrExp(bstackstr, A$, r$) Then
                    If FastSymbol(A$, ",") Then
                        If IsStrExp(bstackstr, A$, q$) Then
                            If FastSymbol(A$, ",") Then
                                If IsExp(bstackstr, A$, p) Then
                                    r$ = mycoder.encryptline(r$, q$, CLng(p))
                                    IsString = True
                                    If Not FastSymbol(A$, ")") Then IsString = False
                                    Exit Function
                                End If
                            End If
                        End If
                    End If
                End If
                Exit Function
    Case "LEFTPART$(", "ΑΡΙΣΤΕΡΟΜΕΡΟΣ$("
     IsString = False
    If IsStrExp(bstackstr, A$, s$) Then
    If FastSymbol(A$, ",") Then
    If IsStrExp(bstackstr, A$, q$) Then
    r$ = GetStrUntil(q$, s$)
   
    IsString = FastSymbol(A$, ")")
    ElseIf IsExp(bstackstr, A$, p) Then
    r$ = GetStrUntil(ChrW$(Abs(p) And &HFFFF&), s$)
    IsString = FastSymbol(A$, ")")
    
    End If
    End If
    End If

    Exit Function
        Case "RIGHTPART$(", "ΔΕΞΙΜΕΡΟΣ$("
     IsString = False
    If IsStrExp(bstackstr, A$, s$) Then
    If FastSymbol(A$, ",") Then
    If IsStrExp(bstackstr, A$, q$) Then
    DropLeft q$, s$
    r$ = s$
        IsString = FastSymbol(A$, ")")
    ElseIf IsExp(bstackstr, A$, p) Then
    DropLeft ChrW$(Abs(p) And &HFFFF&), s$
    r$ = s$
        IsString = FastSymbol(A$, ")")
    
    End If
    End If
    End If

    Exit Function
    Case "ARRAY$(", "ΠΙΝΑΚΑΣ$("
    
    If IsStrExp(bstackstr, A$, s$) Then
       If FastSymbol(A$, ",") Then
                            w = InStr("!" & s$, "(")
                        If w > 0 And w <= Len(s$) Then
                        s$ = Left$(s$, w - 2)
                        End If
                        If Right$("!" & s$, 1) = "$" Then
                        
                        Else
                        
                        s$ = s$ & "$"
                        End If
                     s$ = s$ + "("
                        If neoGetArray(bstackstr, s$, pppp) Then
                             IsString = NeoGetArrayItem(pppp, bstackstr, s$, w, A$)
                     
                         r$ = pppp.item(w)
                         Else
                         MyErMacro A$, "Can't find array " & s$, "Δεν βρίσκω πίνακα " & s$
                         End If
                             Else
            IsString = False
            End If
            Else
            IsString = False
    End If
    Exit Function
    Case "TYPE$(", "ΤΥΠΟΣ$("
    w1 = Abs(IsLabel(bstackstr, A$, s$))
    If w1 > 4 Then
    If neoGetArray(bstackstr, s$, pppp) Then
    w2 = 0
                    If Not NeoGetArrayItem(pppp, bstackstr, s$, w2, A$) Then Exit Function
                    If pppp.Arr Then
                        r$ = Typename(pppp.item(w2))
                        If r$ = "mHandler" Then
                        
                            Select Case pppp.item(w2).T1
                                 Case 1
                                     r$ = "Inventory"
                                 Case 2
                                     r$ = "Buffer"
                                 Case 3
                                w1 = pppp.item(w2).Indirect
                                If w1 > -1 Or w1 <= var2used Then
                                r$ = Typename(var(w1))
                                Else
                                r$ = Typename(w1)
                                End If
                                 Case Else
                                     r$ = Typename(pppp.item(w2).objref)
                             End Select
                         End If
                    Else
                    If Typename(pppp.GroupRef) = "mHandler" Then
                    
                        Set bstackstr.lastobj = pppp.GroupRef.objref
                        With bstackstr.lastobj
                        If pppp.GroupRef.T1 = 1 Then
                        If .IsObj Then
                            r$ = Typename(.ValueObj)
                            If r$ = "mHandler" Then
                                Select Case .ValueObj.T1
                                    Case 1
                                        r$ = "Inventory"
                                    Case 2
                                        r$ = "Buffer"
                                        Case 3
                                     w1 = .ValueObj.Indirect
                                        If w1 > -1 Or w1 <= var2used Then
                                        r$ = Typename(var(w1))
                                        Else
                                        r$ = Typename(w1)
                                        End If
                                    Case Else
                                        r$ = Typename(.ValueObj.objref)
                                End Select
                             End If
                        Else
                        
                            r$ = Typename(.Value)
                        End If
                        Else ' assume t1=2 ' may change if we introduce new object for mhandler
                        Select Case .ItemSize
                        Case 1
                            r$ = "Byte"
                        Case 2
                            r$ = "Integer"
                        Case 4
                            r$ = "Long"
                        Case Else
                            r$ = "Fault"
                        End Select
                        End If
                        End With
                        Set bstackstr.lastobj = Nothing
                    
                    Else
                    r$ = Typename(pppp.GroupRef)
                    End If
                    
                    
                    End If
                  
                    IsString = FastSymbol(A$, ")")
    Else
    Nosuchvariable s$
    End If
    ElseIf w1 > 0 Then
    If GetVar(bstackstr, s$, w1) Then
                    r$ = Typename(var(w1))
                    If r$ = "mHandler" Then
                    Select Case var(w1).T1
                        Case 1
                        r$ = "Inventory"
                        Case 2
                        r$ = "Buffer"
                        Case 3
                                     w1 = var(w1).Indirect
                                        If w1 > -1 Or w1 <= var2used Then
                                        r$ = Typename(var(w1))
                                        Else
                                        r$ = Typename(w1)
                                        End If
                        Case Else
                        
                        r$ = Typename(var(w1).objref)
                     End Select
                     End If
                   
                    IsString = FastSymbol(A$, ")")
                    
    Else
    Nosuchvariable s$
    End If
    ElseIf IsStrExp(bstackstr, A$, s$) Then
                r$ = strProgIDfromSrting(s$)
                    IsString = FastSymbol(A$, ")")
    
    Else
    
    SyntaxError
    End If
    Exit Function
    Case "PARAGRAPH$(", "ΠΑΡΑΓΡΑΦΟΣ$("
 
        w1 = Abs(IsLabel(bstackstr, A$, s$))
        If w1 = 3 Then
            If GetVar(bstackstr, s$, w1) Then
                    ' GET PARAGRAPH ORDER NUMBER
                    If Not FastSymbol(A$, ",") Then
                        MissParam A$
                        Exit Function
                    End If
                    If FastSymbol(A$, "(") Then
                    
                    W3 = Abs(IsLabel(bstackstr, A$, s$))
                    If W3 = 1 Or W3 = 4 Then
                    If Not GetVar(bstackstr, s$, W3) Then Nosuchvariable s$: Exit Function
                    If Not FastSymbol(A$, ")") Then SyntaxError: Exit Function
                    dd = 1
                    Else
                    MissingnumVar
                     Exit Function
                    End If
                    ElseIf Not IsExp(bstackstr, A$, p) Then
                      MissNumExpr
                      Exit Function
                    End If
                        If Typename(var(w1)) = doc Then
                        r$ = var(w1).TextParagraphOrder(CLng(p))
                        If FastSymbol(A$, ",") Then
                            If Not IsExp(bstackstr, A$, PP) Then MissNumExpr: Exit Function
                            If PP < 0 Then
                                If dd = 1 Then
                                        dd = var(W3)
                                        p = dd
                                             If var(w1).InvalidPara(CLng(p)) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                         If var(w1).BackMove Then
                                        var(W3) = var(w1).BackStep(dd)
                                        Else
                                        var(W3) = var(w1).Advance(dd)
                                        End If
                                 
                                        
                                        r$ = var(w1).RemoveDocParaIndex(CLng(p))
                                Else
                                        r$ = var(w1).TextParagraphOrderRemove(CLng(p))
                                End If
                            Else
                                 If dd = 1 Then
                                    dd = var(W3)
                                            p = dd
                                      If var(w1).InvalidPara(dd) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                            If var(w1).BackMove Then
                                            var(W3) = var(w1).BackStep(dd)
                                            Else
                                            var(W3) = var(w1).Advance(dd)
                                            End If
                                            
                                                r$ = Mid$(var(w1).TextParagraph(CLng(p)), CLng(PP))
                                    Else
                                
                                r$ = Mid$(var(w1).TextParagraphOrder(CLng(p)), CLng(PP))
                                End If
                            End If
                        Else
                                        If dd = 1 Then
                                    dd = var(W3)
                                            p = dd
                                               If var(w1).InvalidPara(dd) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                            If var(w1).BackMove Then
                                            var(W3) = var(w1).BackStep(dd)
                                            Else
                                            var(W3) = var(w1).Advance(dd)
                                            End If
                                                r$ = var(w1).TextParagraph(CLng(p))
                                    Else
                        
                        r$ = var(w1).TextParagraphOrder(CLng(p))
                        End If
                        End If
                        Else
                            MissingDoc
                            Exit Function
                        End If
                    
                    IsString = FastSymbol(A$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro A$
                    Exit Function
            End If
        ElseIf w1 = 6 Then
            If neoGetArray(bstackstr, s$, pppp) Then
                    If Not NeoGetArrayItem(pppp, bstackstr, s$, w2, A$) Then Exit Function
                    If Not FastSymbol(A$, ",") Then
                    MissParam A$
                    Exit Function
                    End If
                    
                    If FastSymbol(A$, "(") Then
                    
                    W3 = Abs(IsLabel(bstackstr, A$, s$))
                    If W3 = 1 Or W3 = 4 Then
                    If Not GetVar(bstackstr, s$, W3) Then Nosuchvariable s$: Exit Function
                     If Not FastSymbol(A$, ")") Then SyntaxError: Exit Function
                    dd = 1
                    Else
                    MissingnumVar
                     Exit Function
                    End If
                    ElseIf Not IsExp(bstackstr, A$, p) Then
                      MissNumExpr
                      Exit Function
                    End If
                        If Typename(pppp.item(w2)) = doc Then
                         If FastSymbol(A$, ",") Then
                            If Not IsExp(bstackstr, A$, PP) Then MissNumExpr: Exit Function
                                If PP < 0 Then
                                        If dd = 1 Then
                                                dd = var(W3)
                                                p = dd
                                                   If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                                If pppp.item(w2).BackMove Then
                                                var(W3) = pppp.item(w2).BackStep(dd)
                                                Else
                                                var(W3) = pppp.item(w2).Advance(dd)
                                                End If
                                                r$ = pppp.item(w2).RemoveDocParaIndex(CLng(p))
                                        Else
                                                r$ = pppp.item(w2).TextParagraphOrderRemove(CLng(p))
                                        End If
                                Else
                                   If dd = 1 Then
                                    dd = var(W3)
                                            p = dd
                                                 If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                            If pppp.item(w2).BackMove Then
                                            var(W3) = pppp.item(w2).BackStep(dd)
                                            Else
                                            var(W3) = pppp.item(w2).Advance(dd)
                                            End If
                                        r$ = Mid$(pppp.item(w2).TextParagraph(CLng(p)), CLng(PP))
                                    Else
                                r$ = Mid$(pppp.item(w2).TextParagraphOrder(CLng(p)), CLng(PP))
                                End If
                                End If
                            Else
                            If dd = 1 Then
                                    dd = var(W3)
                                            p = dd
                                                 If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                            If pppp.item(w2).BackMove Then
                                            var(W3) = pppp.item(w2).BackStep(dd)
                                            Else
                                            var(W3) = pppp.item(w2).Advance(dd)
                                            End If
                                r$ = pppp.item(w2).TextParagraph(CLng(p))
                                            Else
                                r$ = pppp.item(w2).TextParagraphOrder(CLng(p))
                                End If
                            End If
                        Else
                            MissingDoc
                            Exit Function
                        End If
                    
                    IsString = FastSymbol(A$, ")", True)
            Else
                    MissParam A$
            End If
        End If
    Exit Function
Case "UNION.DATA$(", "ΕΝΩΣΗ.ΣΕΙΡΑΣ$("


  
  Do
  If IsStrExp(bstackstr, A$, s) Then
  
  ElseIf IsExp(bstackstr, A$, p) Then
  s = ChrW(p)
  Else
  s = ChrW(0)
  End If
  r$ = r$ + s
  
  Loop Until Not FastSymbol(A$, ",") Or A$ = ""

    IsString = FastSymbol(A$, ")", True)

    Exit Function
Case "MAX.DATA$(", "ΜΕΓΑΛΟ.ΣΕΙΡΑΣ$("

  If IsStrExp(bstackstr, A$, r$) Then
  
  Do While FastSymbol(A$, ",")
  If Not IsStrExp(bstackstr, A$, s) Then MissStringExpr: Exit Function
  If r$ < s Then r$ = s
  
  Loop

    IsString = FastSymbol(A$, ")", True)
        Else
      MissStringExpr
        End If
    Exit Function
Case "MIN.DATA$(", "ΜΙΚΡΟ.ΣΕΙΡΑΣ$("
 IsString = False
  If IsStrExp(bstackstr, A$, r$) Then
  
  Do While FastSymbol(A$, ",")
  If Not IsStrExp(bstackstr, A$, s) Then MissStringExpr: Exit Function
  If r$ > s Then r$ = s
  
  Loop

    IsString = FastSymbol(A$, ")", True)
        Else
      MissStringExpr
        End If
    Exit Function
    Case "FUNCTION$(", "ΣΥΝΑΡΤΗΣΗ$("
    If IsStrExp(bstackstr, A$, s$) Then
        If IsSymbolBracket(s$) Then
            PushStage bstackstr, False
            GlobalSub "A$()", block(s$)
            IsSymbol3 A$, ","
              A$ = "A$(@" & A$
            IsString = IsStrExp(bstackstr, A$, r$)
            
            PopStage bstackstr
            Else
            If MaybeIsSymbol(A$, ".") Then
                dd = 1
                      q1$ = aheadstatus(A$, , dd)
                s$ = s$ + Left$(A$, dd - 1)
                A$ = Mid$(A$, dd)
            End If
                 If FastSymbol(A$, ",") Then
                End If
                
              
                    If Right$(s$, 1) = ")" Then
                        A$ = Left$(s$, Len(s$) - 1) & A$
                   ElseIf InStr(s$, ").") > 0 Then     ''''''Or A$ Like ".*"
                   FastSymbol A$, ")"
                     A$ = s$ & A$
                    Else
               If Right$("!" & s$, 1) = "$" Then
                    A$ = s$ & "(@" & A$  '' w1 put a @ from 102
                Else
                 A$ = s$ & "$(" & A$
                    End If
                End If
        IsString = IsStrExp(bstackstr, A$, r$)
     End If
     End If
    Exit Function
    Case "HEX$(", "ΔΕΚΑΕΞ$("
    If IsExp(bstackstr, A$, p) Then
    r$ = PACKLNG$(p)
    If FastSymbol(A$, ",") Then
    If Not IsExp(bstackstr, A$, p) Then
      MyErMacro A$, "missing parameter 1 to 4 (bytes)", "λείπει πράμετρος 1 έως 4"
        IsString = False: Exit Function
    ElseIf Int(p) < 1 Or Int(p) > 4 Then
         MyErMacro A$, "parameter 1 to 4 (bytes)", "πράμετρος 1 έως 4"
        IsString = False: Exit Function
Else
    r$ = Right$(r$, p * 2)
    End If
    End If
     IsString = True
                         If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
    End If
    Case "SHOW$(", "ΦΑΝΕΡΟ$("
    If IsStrExp(bstackstr, A$, r$) Then
        If FastSymbol(A$, ",") Then
            If IsStrExp(bstackstr, A$, q$) Then
                If FastSymbol(A$, ",") Then
                    If IsExp(bstackstr, A$, p) Then
                        r$ = mycoder.decryptline(r$, q$, CLng(p))
                        IsString = True
                         If Not FastSymbol(A$, ")") Then IsString = False
                        Exit Function
                    End If
                End If
            End If
        End If
    End If
    Exit Function
    Case "MENU$(", "ΕΠΙΛΟΓΗ$(", "ΕΠΙΛΟΓΕΣ$("
    If IsExp(bstackstr, A$, p) Then
    p = Abs(CLng(p))
    With Form1.List1
        If p > 0 And .listcount >= p Then
            r$ = .list(CLng(p) - 1)
            IsString = True
        End If
    End With
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
    Case "REPLACE$(", "ΑΛΛΑΓΗ$("
    
    If IsStrExp(bstackstr, A$, q$) Then
       If FastSymbol(A$, ",") And IsStrExp(bstackstr, A$, q1$) Then
            If FastSymbol(A$, ",") And IsStrExp(bstackstr, A$, q2$) Then
     IsString = True
    r$ = Replace$(q2$, q$, q1$)    'ReplaceStr(Q$, q1$, Q2$)
       End If
       End If
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
    Case "PATH$(", "ΤΟΠΟΣ$("
      If IsExp(bstackstr, A$, p) Then
    IsString = True
    r$ = GetSpecialfolder(CLng(p))
    AddDirSep r$
    ElseIf IsStrExp(bstackstr, A$, q$) Then
     IsString = True
     
    r$ = ExtractPath$(q$)
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
    Case "UCASE$(", "ΚΕΦ$("
    If IsStrExp(bstackstr, A$, q$) Then
      IsString = True
      If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
            If p <> 0 Then
            r$ = kUpper(Convert3(q$, CLng(p)), p)
            Else
            r$ = kUpper(Convert3(q$, CLng(cLid)), CDbl(cLid))
            End If
      Else
     r$ = myUcase$(q$)
     
     End If
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
    Case "LCASE$(", "ΠΕΖ$("
     If IsStrExp(bstackstr, A$, q$) Then
   IsString = True
      If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
      If p <> 0 Then
      r$ = klower(Convert3(q$, CLng(p)), p)
      Else
      r$ = klower(Convert3(q$, CLng(cLid)), CDbl(cLid))
      End If
      Else
     r$ = myLcase$(q$)
     
     End If
    
    End If
    
    
    If Not FastSymbol(A$, ")") Then IsString = False
    Exit Function
    Case "STRING$(", "ΕΠΑΝ$("
    If IsStrExp(bstackstr, A$, q$) Then
    If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
    p = Int(Abs(p))
    r$ = ""
    While p > 0
    r$ = r$ & q$
    p = p - 1
    Wend
     IsString = True
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
     Exit Function
    End If
       IsString = False
    Exit Function
    Case "MID$(", "ΜΕΣ$("
 
    If IsStrExp(bstackstr, A$, q$) Then
    If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
    p = Abs(p)
    If p = 0 Then
    MyEr "Zero pos in mid$ not allowed", "Μηδενικη θέση στην ΜΕΣ$ δεν επιτρέπεται)"
    IsString = False
    Exit Function
    Else
    r$ = Mid$(q$, p)
    IsString = True
    End If
    End If
    If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
    p = Abs(p)
    r$ = Left$(r$, p)
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    End If
    IsString = True
    Exit Function
    
    Case "LEFT$(", "ΑΡΙΣ$("
 
    If IsStrExp(bstackstr, A$, q$) Then
    If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
    p = Abs(p)
    r$ = Left$(q$, p)
     IsString = True
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    End If
    Exit Function
    Case "RIGHT$(", "ΔΕΞΙ$("

    If IsStrExp(bstackstr, A$, q$) Then
    If FastSymbol(A$, ",") And IsExp(bstackstr, A$, p) Then
    p = Abs(p)
    r$ = Right$(q$, p)
     IsString = True
    End If
    If Not FastSymbol(A$, ")") Then IsString = False
    End If
    Exit Function
    Case "SND$(", "ΗΧΟ$("
     If IsStrExp(bstackstr, A$, q$) Then
        r$ = CFname(q$ & ".WAV")
         If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else
        IsString = False
    Exit Function
    End If
    Case "BMP$(", "ΕΙΚ$("
     If IsStrExp(bstackstr, A$, q$) Then
        r$ = CFname(q$ & ".BMP")
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else
        IsString = False
    Exit Function
    End If
     Case "JPG$(", "ΦΩΤΟ$("
     If IsStrExp(bstackstr, A$, q$) Then
        r$ = CFname(q$ & ".JPG")
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else
        IsString = False
    Exit Function
    End If
    Case "TRIM$(", "ΑΠΟΚ$("
    If IsStrExp(bstackstr, A$, q$) Then
        r$ = Trim$(q$)
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else

        IsString = False
    Exit Function
    End If
Case "QUOTE$(", "ΠΑΡΑΘΕΣΗ$("

r$ = ""
q1$ = ""
Do
If IsStrExp(bstackstr, A$, q$) Then
 r$ = r$ & q1$ & Chr(34) + q$ & Chr(34)
ElseIf IsExp(bstackstr, A$, p) Then
        r$ = r$ & q1$ & Trim(Str$(p))
        Else
        IsString = False: Exit Function
        End If
        If Not FastSymbol(A$, ",") Then Exit Do
        q1$ = ","
        Loop
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
 
Case "ΣΩΡΟΣ$(", "STACK$("
r$ = ""
Do
If IsStrExp(bstackstr, A$, q$) Then
 r$ = r$ & Sput(q$)
ElseIf IsExp(bstackstr, A$, p) Then
        r$ = r$ & " " & Trim$(Str$(p))
        Else
        IsString = False: Exit Function
        End If
        If Not IsSymbol3(A$, ",") Then Exit Do
        Loop
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
Case "ADD.LICENCE$(", "ΒΑΛΕ.ΑΔΕΙΑ$("
If IsStrExp(bstackstr, A$, q$) Then
If FastSymbol(A$, ",") Then
If IsStrExp(bstackstr, A$, q1$) Then
Err.Clear
On Error Resume Next
        If q1$ = "" Then
        r$ = Licenses.Add(q$)
        Else
        r$ = Licenses.Add(q$, q1$)
        End If
        If Err.Number > 0 And Err.Number <> 732 Then MissLicence
        Err.Clear
       If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
End If
Else
Err.Clear
On Error Resume Next
        r$ = Licenses.Add(q$)
        If Err > 0 And Err.Number <> 732 Then MissLicence
        Err.Clear
        
       If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True


End If
End If

        Exit Function
Case "ENVELOPE$(", "ΦΑΚΕΛΟΣ$("
If IsStrExp(bstackstr, A$, q$) Then
    If FastSymbol(A$, ",") Then
            If Not IsStrExp(bstackstr, A$, q1$) Then IsString = False: Exit Function
            Else
            q1$ = ""
            End If
            If VALIDATE(q$, UCase$(q1$), q2$) Then ' Only S and N
               r$ = q2$
               Else
               r$ = ""
               End If
    Else
' STACK$(BSTACKSTR)
                If FastSymbol(A$, ",") Then
                If Not IsStrExp(bstackstr, A$, q1$) Then IsString = False: Exit Function
                Else
                q1$ = ""
                End If

                If VALIDATEmStiva(bstackstr, UCase$(q1$), q2$) Then
                   r$ = q2$
                   Else
                   r$ = ""
                   End If

    End If
         If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
Case "FIELD$(", "ΠΕΔΙΟ$("
    If IsStrExp(bstackstr, A$, q$) Then
        If FastSymbol(A$, ",") Then
           If Not IsExp(bstackstr, A$, p) Then
           IsString = False
           Exit Function
           End If
           p = Abs(p)
        Else
           IsString = False
           Exit Function
        End If
        r$ = Left$(Trim$(q$), p)
        r$ = r$ & Space$(p - Len(r$))
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else

        IsString = False
    Exit Function
    End If
    
    Case "DRW$(", "ΣΧΔ$("
    If IsStrExp(bstackstr, A$, q$) Then
        r$ = CFname(q$ & ".WMF")
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else

        IsString = False
    Exit Function
    End If
    Case "TIME$(", "ΧΡΟΝΟΣ$("
    If IsExp(bstackstr, A$, p) Then
       r$ = Format(p, "SHORT TIME")
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else

        IsString = False
    Exit Function
    End If
    Case "DATE$(", "ΗΜΕΡΑ$("
    If IsExp(bstackstr, A$, p) Then

        r$ = Format(CDbl(CDate(p)), "SHORT DATE")
        
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
        IsString = True
        Exit Function
    Else

        IsString = False
    Exit Function
    End If
    Case "STR$(", "ΓΡΑΦΗ$("
    If IsExp(bstackstr, A$, p) Then
        If FastSymbol(A$, ",") Then
            If IsStrExp(bstackstr, A$, q$) Then
            r$ = Format(p, q$)
            If Not NoUseDec Then
            If InStr(r$, NowDec$) > 0 And InStr(q$, ".") > 0 Then
                r$ = Replace$(r$, NowDec$, Chr(2))
                r$ = Replace$(r$, NowThou$, ",")
                r$ = Replace$(r$, Chr(2), ".")
            
            End If
            End If
            If FastSymbol(A$, ",") Then
            If IsExp(bstackstr, A$, PP) Then
            If PP > 0 Then
            r$ = Left$(r$ + Space$(PP), PP)
            Else
            r$ = Right$(Space$(Abs(PP)) + r$, Abs(PP))
            End If
            Else
            IsString = False
            Exit Function
            End If
            End If
            
            ElseIf IsExp(bstackstr, A$, PP) Then
            
            If PP > 0 Then
            r$ = Left$(Trim$(Str(p)) + Space$(PP), PP)
            Else
            r$ = Right$(Space$(Abs(PP)) + Trim$(Str(p)), Abs(PP))
            End If
            Else
            IsString = False
            Exit Function
            End If
        Else
        r$ = Str(p)
        
        End If
        
        If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
    IsString = True
    Exit Function
    ElseIf IsStrExp(bstackstr, A$, r$) Then
        If FastSymbol(A$, ",") Then
            If IsStrExp(bstackstr, A$, q$) Then
            r$ = Format(r$, q$)
                        ElseIf IsExp(bstackstr, A$, PP) Then
                        If PP = 0 Then
                        r$ = Convert2(r$, cLid)
                        Else
            r$ = Convert2(r$, CLng(PP))
            End If
            Else
            IsString = False
            Exit Function
            End If
        Else
        r$ = StrConv(r$, vbFromUnicode)
        End If
            If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
    IsString = True
    Exit Function
    Else
    IsString = False
    Exit Function
    End If
    Case "CHRCODE$(", "ΧΑΡΚΩΔ$("
    If IsExp(bstackstr, A$, p) Then
    r$ = ChrW$(cUint(p))
    If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
    IsString = True
    Exit Function
    Else
    IsString = False
    Exit Function
    End If
    Case "CHR$(", "ΧΑΡ$("
    If IsExp(bstackstr, A$, p) Then
        If FastSymbol(A$, ",") Then
                If IsExp(bstackstr, A$, PP) Then
                
                     r$ = ChrW$(AscW(StrConv(ChrW$(p Mod 256), 64, CLng(PP))))
                Else
                        IsString = False: Exit Function
                End If
        Else

                 r$ = ChrW$(AscW(StrConv(ChrW$(p Mod 256), 64, cLid)))

        End If
        If InStr(r$, ChrW(&HFFFFF8FB)) > 0 Then r$ = Replace(r$, ChrW(&HFFFFF8FB), ChrW(&H2007))
    If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
    IsString = True
    Exit Function
    ElseIf IsStrExp(bstackstr, A$, q$) Then 'CONVERT TO ASCII
            If FastSymbol(A$, ",") Then
                If IsExp(bstackstr, A$, PP) Then
                If PP = 0 Then
                   r$ = Convert3(q$, LCID_DEF)
                ElseIf LCID_DEF <> 1033 Then
                  r$ = Convert3(Convert2(q$, LCID_DEF), CLng(PP))
                Else
                     r$ = Convert3(q$, CLng(PP))
                     End If
                Else
                        IsString = False: Exit Function
                End If
        Else
        r$ = StrConv(q$, vbUnicode)
        End If
    If Not FastSymbol(A$, ")") Then IsString = False: Exit Function
    IsString = True
    Exit Function
    Else
    IsString = False
    Exit Function
    End If
    Case Else
    
itisarrayorfunction:
    MakeThisSubNum bstackstr, q$
    q1$ = q$
    
    If Right$(q1$, 1) <> ")" Then q1$ = q1$ + ")"
    
            If IsSymbol(A$, "@") Then
            'is a function allways...
            If GetlocalSub(q1$, w1&) Then
                GoTo contStrFun
            ElseIf GetSub(q1$, w1&) Then
                GoTo contStrFun
            Else
                GoTo skiperrorStr
            End If
            
            Else
            If neoGetArray(bstackstr, q$, pppp, , , True) Then
                GoTo contStrArr
            ElseIf GetlocalSub(q1$, w1&) Then
                GoTo contStrFun
            ElseIf neoGetArray(bstackstr, q$, pppp, , True) Then
                GoTo contStrArr
            ElseIf GetSub(q1$, w1&) Then
                GoTo contStrFun
            Else
            If bstackstr.UseGroupname <> "" Then
            If InStr(q1$, bstackstr.UseGroupname) = 1 Then
            
            q1$ = bstackstr.UseGroupname + ChrW(&HFFBF) + Mid$(q1$, Len(bstackstr.UseGroupname) + 1)
            If GetSub(q1$, w1&) Then GoTo contStrFun
            End If
            End If

            
                GoTo skiperrorStr
            End If
            End If

    
        If GetSub(q1$, w1&) Then
contStrFun:
    If bstackstr.NoFuncError Then
    A$ = q$ + A$
                CallNext bstackstr, A$, par, p, r$
                    If par Then
                        IsString = True
                    Else
                        r$ = ""
                        IsString = False
                    End If
                Else
                Set nBstack = New basetask
                nBstack.reflimit = varhash.count
                Set nBstack.Parent = bstackstr
                Set nBstack.Owner = bstackstr.Owner
                nBstack.UseGroupname = sbf(w1&).sbgroup
                nBstack.OriginalCode = w1&
                If GoFunc(nBstack, q1$, A$, s$, , , True) Then
                    If Not nBstack.StaticCollection Is Nothing Then
                        bstackstr.SetVarobJ "%_" + q1$, nBstack.StaticCollection
                    End If
                    Set bstackstr.lastobj = nBstack.lastobj
                    r$ = s$
                    IsString = True
                Else
                    IsString = False
                End If
                End If
            Exit Function
        ElseIf neoGetArray(bstackstr, q$, pppp) Then
contStrArr:
            If FastSymbol(A$, ")") Then
                IsString = True
                p = 0
                Set bstackstr.lastobj = pppp
                Exit Function
            End If
            If pppp.Arr Then
            dn = 0
            pppp.SerialItem (0), dd, 5
            dd = dd - 1
            p = 0
            PP = 0
        IsString = True
        w2 = 0
        Do While dn <= dd
        pppp.SerialItem W3, dn, 6
        If IsExp(bstackstr, A$, p) Then
        If dn < dd Then
            If Not FastSymbol(A$, ",") Then MyErMacro A$, "need index for " & q$ & ")", "χρειάζομαι δείκτη για το πίνακα " & q$ & ")": IsString = False: Exit Do
            Else
            If FastSymbol(A$, ",") Then
            IsString = False
            MyErMacro A$, "too many indexes for array " & q$ & ")", "πολλοί δείκτες για το πίνακα " & q$ & ")"
        Exit Function
        End If
            If Not FastSymbol(A$, ")") Then MissSymbol A$, ")": IsString = False: Exit Function
        End If
            On Error Resume Next
        If Not pppp.PushOffset(w2, dn, CLng(p)) Then
        
            MyErMacro A$, "index too high for array " & q$ & ")", "δείκτης υψηλός για το πίνακα " & q$ & ")"
            IsString = False: Exit Function
        Else
            End If
              Else
        IsString = False
        
          MyErMacro A$, "missing index for array " & q$ & ")", "χάθηκε δείκτης για το πίνακα " & q$ & ")"
        Exit Function
    
        End If
        dn = dn + 1
        Loop
        If IsObject(pppp.item(w2)) Then
    If FastSymbol(A$, "(") Then
    
    If Typename(pppp.item(w2)) = "lambda" Then
contlambdastr:
    PushStage bstackstr, False
     w1 = GlobalVar("A_" + CStr(Abs(w2)), 0)
     Set var(w1) = pppp.item(w2)
                If here$ = "" Then
                        dd = GlobalSub("A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & CStr(w1))
                    Else
                        dd = GlobalSub(here$ & "." & bstackstr.GroupName & "A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & CStr(w1))
                End If
             
                A$ = "A_" + CStr(Abs(w2)) + "$(" + A$
             IsString = IsString(bstackstr, A$, r$)
             Set var(w1) = Nothing
         
    PopStage bstackstr
    ElseIf Typename(pppp.item(w2)) = "mHandler" Then
       Set bstackstr.lastobj = pppp.item(w2)
               Set pppp = New mArray
                pppp.Arr = False
                Set pppp.GroupRef = bstackstr.lastobj
                Set bstackstr.lastobj = Nothing
                GoTo contStrArr
         ElseIf Typename(pppp.item(w2)) = "mArray" Then
       Set pppp = pppp.item(w2)
      
                GoTo contStrArr

                
    End If
    
    Else
    r$ = pppp.item(w2)
    End If
    Else
    
    
                r$ = pppp.item(w2)
                End If
            IsString = True
        Exit Function
        Else
        If Typename(pppp.GroupRef) = "mHandler" Then
        If pppp.GroupRef.T1 <> 1 Then
            SyntaxError
            IsString = False
            Exit Function
        End If
        ' only for Inventory
        With pppp.GroupRef.objref
            If IsExp(bstackstr, A$, p) Then
            If FastSymbol(A$, "!") Then
              If p >= 0 And p < .count Then
                .index = p
                Else
                MyEr "Index out of limits", "Δείκτης εκτός ορίων"
                Exit Function
                End If
            Else
                .Find p
                End If
            ElseIf IsStrExp(bstackstr, A$, r$) Then
                .Find r$
            End If
            If .Done Then
            If .IsObj Then
            If TypeOf .ValueObj Is lambda Then
            w2 = -.index - 1
            If FastSymbol(A$, ")(", , 2) Then GoTo contlambdastr
            ElseIf TypeOf .ValueObj Is mArray Then
            Set pppp = .ValueObj
             If FastSymbol(A$, ")(", , 2) Then GoTo contStrArr
            ElseIf TypeOf .ValueObj Is mHandler Then
                        Set pppp.GroupRef = .ValueObj
            If FastSymbol(A$, ")(", , 2) Then GoTo contStrArr
            ElseIf TypeOf .ValueObj Is Document Then
            r$ = .ValueObj.textDoc
            Else
            MyEr "This kind of object not supported", "Αυτού του είδους το αντικείμενο δεν υποστηρίζεται"
            End If
            Else
            Call .ValueType(0, p, r$)
                               
                                  
         '   r$ = .Value
            End If
            End If
            End With
        Else
            If IsExp(bstackstr, A$, p) Then
                pppp.GroupRef.index = p
            ElseIf IsStrExp(bstackstr, A$, r$) Then
                pppp.GroupRef.index = r$
            End If
        
        r$ = pppp.GroupRef.Value
        End If
          IsString = FastSymbol(A$, ")")
        Exit Function
        
        End If
            Else  '......
            

            
            
            
skiperrorStr:
            If Right$(q1$, 1) = ")" Then
            If here$ Like "*." + q1$ Then
            subHash.ItemCreator q1$, bstackstr.OriginalCode, True
            
 GoTo contStrFun
        ElseIf q1$ = "LAMBDA$()" Then
            If bstackstr.IamLambda Then
             q1$ = bstackstr.FuncRec
             GoTo contStrFun
             Else
                MyEr "Only in lambda function", "Μόνο σε λάμδα συνάρτηση"
             End If
        ElseIf q1$ = "ΛΑΜΔΑ$()" Then
            If bstackstr.IamLambda Then
             q1$ = bstackstr.FuncRec
             GoTo contStrFun
             Else
                MyEr "Only in lambda function", "Μόνο σε λάμδα συνάρτηση"
             End If
        End If
End If

         If FindNameForGroup(bstackstr, q$) Then
 MyErMacro A$, "unknown method/array  " & q$, "’γνωστη μέθοδος/πίνακας " & q$
 Else
     MyErMacro A$, "unknown function/array " & q$, "’γνωστη συνάρτηση/πίνακας " & q$

End If
    Exit Function
    End If
            
    End Select
Case Else
contstr:
w = 0
If q$ <> "" Then A$ = q$ & " " & A$
q$ = ""
End Select
If A$ = "" Then IsString = False: Exit Function
Select Case AscW(A$)
Case 1
q$ = Chr(1)
Case 2
'
r$ = Mid$(A$, 2, 8)
r$ = Mid$(A$, 10, UNPACKLNG(r$))
A$ = Mid$(A$, Len(r$) + 10)
IsString = True
Exit Function
Case 34
q$ = Chr(34)

End Select
If q$ = "" Or Len(A$) < 2 Then IsString = False: Exit Function

w = InStr(2, A$, q$)
If w = 0 And Len(q$) = 1 Then
MyErMacro A$, "No closed string, open with " & q$, "Ανοιχτό αλφαριθμητικό, με " & q$
IsString = False: Exit Function
End If

If w = 0 Then IsString = False: Exit Function
r$ = Mid$(A$, 2, w - 2)
A$ = NLtrim$(Mid$(A$, w + 1))
IsString = True

End Function
Function ISSTRINGA(bb$, r$) As Boolean
'
Dim q$, w As Long, A$
A$ = NLtrim$(bb$)
r$ = ""
If A$ = "" Then Exit Function
Select Case AscW(A$)
Case 1
q$ = Chr(1)
Case 2
r$ = Mid$(A$, 2, 8)
r$ = Mid$(A$, 10, UNPACKLNG(r$))
bb$ = Mid$(A$, Len(r$) + 10)
ISSTRINGA = True
Exit Function
Case 34
q$ = Chr(34)
End Select
If q$ = "" Or Len(A$) < 2 Then ISSTRINGA = False: Exit Function

w = InStr(2, A$, q$, vbBinaryCompare)
If w = 0 Then ISSTRINGA = False: Exit Function
r$ = Mid$(A$, 2, w - 2)
bb$ = NLtrim$(Mid$(A$, w + 1))

ISSTRINGA = True

End Function
Function IsOperator(A$, c$, Optional cl As Long = 1) As Boolean
IsOperator = False
Dim n$
  If A$ <> "" Then
If Left$(A$, cl) = c$ Then  ' no letters in operator so no UCASE
' check next charcter
n$ = Left$(Mid$(A$, cl + 1, 1) & " ", 1)
    If Not InStr(novalidstr, n$) > 0 Then
    
    A$ = NLtrim$(Mid$(A$, cl + 1))
    IsOperator = True
    End If
End If
End If
End Function
Function codeW(A$) As Long
If A$ <> "" Then
If AscW(A$) < 128 Then codeW = 1
End If
End Function
Function placeme$(gre$, Eng$, code As Long)
If code = 1 Then placeme$ = Eng$ Else placeme$ = gre$
End Function

Function IsSymbol(A$, c$, Optional l As Long = 1, Optional mis As Boolean = False) As Boolean
Dim i As Long, j As Long
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i <= j Then

If myUcase(Mid$(A$, i, l)) = c$ Then
A$ = NLtrim$(Mid$(A$, l + i))
IsSymbol = True

 Else
 If mis Then
 MyErMacro A$, "missing " & c$, "λείπει " & c$
 ElseIf i > 1 Then
 A$ = Mid$(A$, i)
 End If
IsSymbol = False
End If
Else
 If mis Then
 MyErMacro A$, "missing " & c$, "λείπει " & c$
 Else
 A$ = ""
 End If
IsSymbol = False
End If
End Function

Function IsSymbolBracket(A$) As Boolean
Dim i As Long, j As Long
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i > j Then Exit Function
If Mid$(A$, i, 1) = "{" Then
A$ = Mid$(A$, i + 1)
IsSymbolBracket = True
End If
End Function


Function IsSymbol3(A$, c$, Optional mis As Boolean = False, Optional l As Long = 1) As Boolean
' SAME AS FASTSYMB WITHOUT
Dim i As Long, j As Long
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i > j Then Exit Function
If j - i >= l - 1 Then
If InStr(c$, Mid$(A$, i, l)) > 0 Then
A$ = Mid$(A$, i + l)
IsSymbol3 = True
ElseIf mis Then
MyErMacro A$, "missing " & c$, "λείπει " & c$
End If
End If
End Function
'
Function Fast2Label(A$, c$, cl As Long, d$, dl As Long, e$, el As Long, ahead&) As Boolean
Dim i As Long, Pad$, j As Long
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i > j Then Exit Function
Pad$ = myUcase(Mid$(A$, i, ahead&)) + " "
If j - i >= cl - 1 Then
If InStr(c$, Left$(Pad$, cl)) > 0 Then
If Mid$(Pad$, cl + 1, 1) Like "[0123456789+-\( @]" Then
A$ = Mid$(A$, MyTrimLi(A$, i + cl))
Fast2Label = True
End If
Exit Function
End If
End If
If j - i >= dl - 1 Then
If InStr(d$, Left$(Pad$, dl)) > 0 Then
If Mid$(Pad$, dl + 1, 1) Like "[0123456789+-\( @]" Then
A$ = Mid$(A$, MyTrimLi(A$, i + dl))
Fast2Label = True
End If
Exit Function
End If
End If
If j - i >= el - 1 Then
If InStr(e$, Left$(Pad$, el)) > 0 Then
If Mid$(Pad$, el + 1, 1) Like "[0123456789+-\( @]" Then
A$ = Mid$(A$, MyTrimLi(A$, i + el))
Fast2Label = True
End If
Exit Function
End If
End If
End Function

Function Fast2Symbol(A$, c$, k As Long, d$, l As Long) As Boolean
Dim i As Long, j As Long
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i > j Then Exit Function
If j - i >= k - 1 Then
    If InStr(c$, Mid$(A$, i, k)) > 0 Then
    A$ = Mid$(A$, MyTrimLi(A$, i + k))
    Fast2Symbol = True
    Exit Function
    End If
End If
If j - i >= Len(d$) - 1 Then
    If InStr(d$, Mid$(A$, i, l)) > 0 Then
    A$ = Mid$(A$, MyTrimLi(A$, i + l))
    Fast2Symbol = True
    Exit Function
    End If

End If
End Function

Function FastSymbol(A$, c$, Optional mis As Boolean = False, Optional cl As Long = 1) As Boolean
Dim i As Long, j As Long
''If Len(c$) <> cl Then Stop
j = Len(A$)
If j = 0 Then Exit Function
i = MyTrimL(A$)
If i > j Then Exit Function
If j - i < cl - 1 Then
If mis Then MyErMacro A$, "missing " & c$, "λείπει " & c$
Exit Function
End If
If InStr(c$, Mid$(A$, i, cl)) > 0 Then
A$ = Mid$(A$, MyTrimLi(A$, i + cl))
FastSymbol = True
ElseIf mis Then
MyErMacro A$, "missing " & c$, "λείπει " & c$
End If
End Function
Function NocharsInLine(A$) As Boolean
Dim i As Long, j As Long
j = Len(A$)
If j = 0 Then NocharsInLine = True: Exit Function
i = MyTrimL(A$)
If i > j Then NocharsInLine = True: Exit Function

End Function

Function MaybeIsTwoSymbol(A$, c$, Optional l As Long = 2) As Boolean
Dim i As Long
If A$ = "" Then Exit Function
i = MyTrimL(A$)
If i > Len(A$) Then Exit Function
MaybeIsTwoSymbol = InStr(c$, Mid$(A$, i, 2)) > 0

End Function
Function MaybeIsSymbol(A$, c$) As Boolean
Dim i As Long
If A$ = "" Then Exit Function
i = MyTrimL(A$)
If i > Len(A$) Then Exit Function
MaybeIsSymbol = InStr(c$, Mid$(A$, i, 1)) > 0

End Function

Function MaybeIsSymbolNoSpace(A$, c$) As Boolean
MaybeIsSymbolNoSpace = Left$(A$, 1) Like c$
End Function
Function IsLabelSymbolNew(A$, gre$, Eng$, code As Long, Optional mis As Boolean = False, Optional ByVal ByPass As Boolean = False, Optional checkonly As Boolean = False, Optional Free As Boolean = True) As Boolean
' code 2  gre or eng, set new value to code 1 or 0
' 0 for gre
' 1 for eng
' return true if we have label
Dim what As Boolean, drop$
Select Case code
Case 0
IsLabelSymbolNew = IsLabelSymbol3(1032, A$, gre$, drop$, mis, ByPass, checkonly, Free)
Case 1
IsLabelSymbolNew = IsLabelSymbol3(1033, A$, Eng$, drop$, mis, ByPass, checkonly, Free)
Case 2
what = IsLabelSymbol3(1032, A$, gre$, drop$, mis, ByPass, checkonly, Free)
If what Then
code = 0
IsLabelSymbolNew = what
Exit Function
End If
what = IsLabelSymbol3(1033, A$, Eng$, drop$, mis, ByPass, checkonly, Free)
If what Then code = 1
IsLabelSymbolNew = what
End Select
End Function

Function IsLabelSymbolNewExp(A$, gre$, Eng$, code As Long, usethis$) As Boolean
' code 2  gre or eng, set new value to code 1 or 0
' 0 for gre
' 1 for eng
' return true if we have label
If Len(usethis$) = 0 Then
Dim what As Boolean
Select Case code
Case 0
IsLabelSymbolNewExp = IsLabelSymbol3(1032, A$, gre$, usethis$, False, False, False, True)
Case 1
IsLabelSymbolNewExp = IsLabelSymbol3(1033, A$, Eng$, usethis$, False, False, False, True)
Case 2
what = IsLabelSymbol3(1032, A$, gre$, usethis$, False, False, False, True)
If what Then
code = 0
IsLabelSymbolNewExp = what
Exit Function
End If
what = IsLabelSymbol3(1033, A$, Eng$, usethis$, False, False, False, True)
If what Then code = 1
IsLabelSymbolNewExp = what
End Select
Else
Select Case code
Case 0, 2
IsLabelSymbolNewExp = gre$ = usethis$
Case 1
IsLabelSymbolNewExp = Eng$ = usethis$
End Select
If IsLabelSymbolNewExp Then A$ = Mid$(A$, MyTrimL(A$) + Len(usethis$))
End If
If IsLabelSymbolNewExp Then
usethis$ = ""
End If
End Function


Function IsLabelSymbol3(ByVal code As Double, A$, c$, useth$, Optional mis As Boolean = False, Optional ByVal ByPass As Boolean = False, Optional checkonly As Boolean = False, Optional needspace As Boolean = False) As Boolean
Dim test$, what$, pass As Long
If ByPass Then Exit Function

If A$ <> "" And c$ <> "" Then
    test$ = A$
    If Right$(c$, 1) <= "9" Then
        If FastSymbol(test$, c$, , Len(c$)) Then
            If needspace Then
                If test$ = "" Then
                ElseIf AscW(test$) < 36 Then
                ElseIf InStr(":;\',", Left$(test$, 1)) > 0 Then ' : ; ,
                Else
                    Exit Function
                End If
            End If
            If Not checkonly Then A$ = test$
            IsLabelSymbol3 = True
        Else
            If mis Then MyErMacro A$, "missing " & c$, "λείπει " & c$
        End If
        Exit Function
    Else
        pass = 1000 ' maximum
        IsLabelSymbol3 = IsLabelSYMB33(test$, what$, pass)
   
      If Len(what$) <> Len(c$) Then
               If code = 1032 Then
                useth$ = myUcase(what$, True)
            Else
                useth$ = UCase(what$)
            End If
      IsLabelSymbol3 = False
         If mis Then GoTo theremiss
        Exit Function
      End If
    End If
    If what$ = "" Then
    
        If mis Then GoTo theremiss
        Exit Function
    End If
    If code = 1032 Then
        what$ = myUcase(what$, True)
    Else
        what$ = UCase(what$)
    End If
    If what$ = c$ Then
    
        test$ = Mid$(test$, pass)
        If needspace Then
            If test$ = "" Then
            ElseIf AscW(test$) < 36 Then
            ElseIf InStr(":;\',", Left$(test$, 1)) > 0 Then
            ' : ; ,
            Else
                IsLabelSymbol3 = False
                Exit Function
            End If
        End If
        If checkonly Then
          '  A$ = what$ & TEST$
          Else
           A$ = test$
        End If
  
       Else
             If mis Then
theremiss:
           ''  MyErMacro a$, "missing " & c$, "λείπει " & c$
                 MyEr "missing " & c$, "λείπει " & c$
                 Else
                 useth$ = what$
              End If
            IsLabelSymbol3 = False
            End If

End If
End Function
Function IsLabelSymbol(A$, c$, Optional mis As Boolean = False, Optional ByVal ByPass As Boolean = False, Optional checkonly As Boolean = False) As Boolean
Dim test$, what$, pass As Long
If ByPass Then Exit Function

  If A$ <> "" And c$ <> "" Then
test$ = A$
pass = Len(c$)

IsLabelSymbol = IsLabelSYMB33(test$, what$, pass)
If Len(what$) <> Len(c$) Then IsLabelSymbol = False
If Not IsLabelSymbol Then
     If mis Then
                 MyErMacro A$, "missing " & c$, "λείπει " & c$
              End If
Exit Function
End If

        If myUcase(what$) = c$ Then
        If checkonly Then
     '   A$ = what$ & " " & TEST$
        Else
                    A$ = Mid$(test$, pass)
          End If
  
             Else
             If mis Then
                 MyErMacro A$, "missing " & c$, "λείπει " & c$
              End If
            IsLabelSymbol = False
            End If

End If
End Function
Function IsLabelSymbolLatin(A$, c$, Optional mis As Boolean = False, Optional ByVal ByPass As Boolean = False, Optional checkonly As Boolean = False) As Boolean
Dim test$, what$, pass As Long
If ByPass Then Exit Function

  If A$ <> "" And c$ <> "" Then
test$ = A$
pass = Len(c$)
IsLabelSymbolLatin = IsLabelSYMB33(test$, what$, pass)
If Len(what$) <> Len(c$) Then IsLabelSymbolLatin = False
If Not IsLabelSymbolLatin Then
             If mis Then
                 MyErMacro A$, "missing " & c$, "λείπει " & c$
              End If
            Exit Function
End If
        If UCase(what$) = c$ Then
        If checkonly Then
      '  A$ = what$ & " " & TEST$
        Else
                    A$ = Mid$(test$, pass)
          End If
  
             Else
             If mis Then
                 MyErMacro A$, "missing " & c$, "λείπει " & c$
              End If
            IsLabelSymbolLatin = False
            End If

End If
End Function
Function IsLabelSymbolOLD(A$, c$, Optional mis As Boolean = False, Optional ByVal ByPass As Boolean = False, Optional checkonly As Boolean = False) As Boolean
Dim test$, what$, pass As Long
If ByPass Then Exit Function

  If A$ <> "" And c$ <> "" Then
test$ = A$
IsLabelSymbolOLD = IsLabelSYMB(test$, what$)
        If UCase(what$) = c$ Then
        If checkonly Then
        A$ = UCase(what$) & " " & test$
        Else
                    A$ = test$
          End If
  
             Else
             If mis Then
                 MyErMacro A$, "missing " & c$, "λείπει " & c$
              End If
            IsLabelSymbolOLD = False
            End If

End If
End Function

Function interpret(bstack As basetask, b$) As Boolean
Dim di As Object, myobject As Object, i As Long
Set di = bstack.Owner
Dim prive As basket
'b$ = Trim$(b$)
Dim w$, ww#, LLL As Long, sss As Long, v As Long, p As Double, ss$, ohere$
Dim pppp As mArray, i1 As Long, lang As Long
Dim r1 As Long, r2 As Long
' uink$ = ""
di.FontTransparent = True
ohere$ = here$
here$ = ""

sss = Len(b$)
Do While Len(b$) <> LLL

If LastErNum <> 0 Then Exit Do
LLL = Len(b$)


If FastSymbol(b$, "{") Then
If Not interpret(bstack, block(b$)) Then interpret = False: here$ = ohere$: Exit Function
If FastSymbol(b$, "}") Then
sss = Len(b$)
GoTo loopcontinue1
'LLL = Len(b$)


Else
interpret = False: here$ = ohere$: Exit Function
End If
End If
jumpforCR1:
If FastSymbol(b$, vbCrLf, , 2) Then
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
        UINK$ = ""
        sss = LLL
        End If

While MaybeIsSymbol(b$, "\'")
 SetNextLine b$
    sss = Len(b$)
    LLL = sss
Wend
If FastSymbol(b$, ":") Then
sss = LLL
UINK$ = ""
End If
If NOEXECUTION Then interpret = False: here$ = ohere$: Exit Function

If NocharsInLine(b$) Then interpret = True: here$ = ohere$: Exit Function
If IsSymbol(b$, "@") Then
i1 = IsLabelAnew(here$, b$, w$, lang)
w$ = "@" + w$
GoTo PROCESSCOMMAND   'IS A COMMAND
Else
i1 = IsLabelAnew(here$, b$, w$, lang)
End If
  If trace And (bstack.Process Is Nothing) Then
    Form2.Label1(0) = here$
    Form2.Label1(1) = w$
    Form2.Label1(2) = GetStrUntil(vbCrLf, b$ & vbCrLf, False)
 TestShowSub = ""
 TestShowStart = 0
    Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
    Form1.Show , Form5   'OK
    End If

    If STbyST Then
        STbyST = False
        If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        Do
        MyDoEvents1 Form1
        BLOCKkey = False
        MyDoEvents
        Loop Until STbyST Or STq Or STEXIT Or NOEXECUTION Or myexit(bstack)
            If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        STq = False
        If STEXIT Then
        NOEXECUTION = True
        trace = False
        STEXIT = False
        Exit Function
        End If
    End If
Sleep 5
   '' SleepWaitNO 5
    If STEXIT Then
    
    trace = False
    STEXIT = False
    Exit Function
    Else
    
    End If
End If
Select Case i1
Case 1234
GoTo jumpforCR1
Case 2
MyEr "No with reference in left side of assignment", "Όχι με αναφορά στην εκχώρηση τιμής"
interpret = False
Exit Function
Case 1

    If sss = LLL Then
    ss$ = ""
    If MaybeIsSymbol(b$, "=-+*/<~") Then
            If FastSymbol(b$, "=") Then
                If GetVar(bstack, w$, v) Then
                    If IsExp(bstack, b$, p) Then
            If Typename(var(v)) = "Group" Then             '' Group 2 Group
                        If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                  Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
      
                                Else

                                
                                  interpret = False
                                End If
                        Else  '' make an upgrade
                               interpret = False

                        End If
                        ElseIf VarType(var(v)) = vbLong Then
                                If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                      Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                    UnFloatGroup bstack, w$, v, myobject  ' global??
                                    Set myobject = Nothing
                             
                                Else
                                interpret = False
                                End If
                                Else
                                var(v) = CLng(p)
                                End If
                    Else
                    
                    var(v) = p
                    End If
                    Else
                    If LastErNum <> -2 Then NoValueForvariable w$
                    
                    Exit Do
                    End If
                ElseIf IsExp(bstack, b$, p) Then
                interpret = True
                 If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                    
                                        
                                GlobalMoveGroup bstack, w$
                                Else
                                
                                SyntaxError
                                End If
                Else
                    GlobalVar w$, p
                    End If
                    
                ElseIf LastErNum = 0 Then
                ' I have to place here new error no value for
                ' see lastErNum
                ' Να βάλω αυτό εδώ σε όλα τα άλλα...θυμήσου το LastErNum
                SyntaxError
                interpret = False
                Exit Function
                Else
               Exit Do
                End If
                w$ = " "
                   interpret = True
                                
            ElseIf FastSymbol(b$, "+=", , 2) Then
                 ss$ = "+"
                 ElseIf FastSymbol(b$, "/=", , 2) Then
                 ss$ = "/"
                 ElseIf FastSymbol(b$, "-=", , 2) Then
                 ss$ = "-"
                 ElseIf FastSymbol(b$, "*=", , 2) Then
                 ss$ = "*"
                 ElseIf IsOperator(b$, "++", 2) Then
                 ss$ = "++"
                 ElseIf IsOperator(b$, "--", 2) Then
                 ss$ = "--"
                 ElseIf IsOperator(b$, "-!", 2) Then
                 ss$ = "-!"
                    ElseIf IsOperator(b$, "~") Then
                    ss$ = "!!"
                 ElseIf FastSymbol(b$, "<=", , 2) Then
                 ss$ = "="
                 End If
    End If
    If ss$ <> "" Then
            If GetVar(bstack, w$, v) Then
                If Len(ss$) = 1 Then
                            If IsExp(bstack, b$, p) Then
                                    On Error Resume Next
                            If VarType(var(v)) = vbLong Then
                               Select Case ss$
                                Case "="
                                var(v) = CLng(p)
                                Case "+"
                                var(v) = CLng(p) + var(v)
                                Case "*"
                                 var(v) = CLng(p) * var(v)
                                Case "-"
                                var(v) = var(v) - CLng(p)
                                Case "/"
                                If p = 0 Then
                                   interpret = False
                                   Exit Do
                                End If
                                ' only
                                 var(v) = var(v) \ CLng(p)
                                            
                                                    
                            End Select
                                        If Err.Number = 6 Then
                                        ' υπερχείλιση
                                                                interpret = False
                                                                Exit Function
                                                    End If
                            Else
                                    Select Case ss$
                                        Case "="
                                        var(v) = p
                                        Case "+"
                                        var(v) = p + var(v)
                                        Case "*"
                                         var(v) = p * var(v)
                                        Case "-"
                                        var(v) = var(v) - p
                                        Case "/"
                                                    If p = 0 Then
                                                            interpret = False
                                                            Exit Function
                                                    End If
                                        
                                                    var(v) = var(v) / p
                                                    
                                              
                              
                                    End Select
                                    End If
                                        
                            Else
                            If LastErNum <> -2 Then
                                      NoValueForvariable w$
                                           interpret = False
                                         Exit Function
                                    Else
                          interpret = True
                          Exit Do
                                        End If
                            End If
                Else
                If ss$ = "++" Then
                var(v) = 1 + var(v)
                ElseIf ss$ = "--" Then
                var(v) = var(v) - 1
                  ElseIf ss$ = "-!" Then
                var(v) = -var(v)
                  Else
           
                      var(v) = -1 - (var(v) <> 0)

                End If
                End If
        sss = Len(b$)
                Else
                               interpret = False
                    Exit Function
                End If
            Else
          '**********************************************************
PROCESSCOMMAND:
       
            If Trim(w$) <> "" Then
      
            Select Case w$
        Dim x1 As Long, y1 As Long
        Dim x2 As Long, y2 As Long, SBR$, nd&
            Case " ", ChrW(160)
            ' nothing
          '  SSS = Len(B$)
            Case "SLOW", "ΑΡΓΑ"
            extreme = False
            SLOW = True
            interpret = True
            here$ = ohere$
            Exit Function
            Case "FAST", "ΓΡΗΓΟΡΑ"
            If FastSymbol(b$, "!") Then extreme = True Else extreme = False
            SLOW = False
            interpret = True
            here$ = ohere$
            Exit Function
            Case "USER", "ΧΡΗΣΤΗΣ"
      
               ss$ = PurifyPath(GetStrUntil("\", Trim$(GetNextLine(b$) + "\")))
               
                 If ss$ <> "" Then
                    dset
                    
                    userfiles = GetSpecialfolder(CLng(26)) & "\M2000_USER\"
                    
                    If Not isdir(userfiles) Then MkDir userfiles
                
                    
                    ss$ = AddBackslash(userfiles + ss$)
                    
                    If PathMakeDirs(ss$) Or isdir(ss$) Then
                    userfiles = ss$
                    mcd = userfiles
                    Original bstack, "CLS"
                    Else

                    PlainBaSket di, players(GetCode(di)), "Bad User Name"
                    End If
                    Else
                    ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
                    If ss$ = "" Then
                    
                    Else
                    
                    PlainBaSket di, players(GetCode(di)), GetStrUntil("\", ss$)
                    End If
                    End If
                     interpret = True
            Exit Function
            Case "TARGET", "ΣΤΟΧΟΣ"
           ' If di.name <> "DIS" And di.name <> "dSprite" Then interpret = False: here$ = OHERE$: Exit Function
                If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                    If Not GetVar(bstack, w$, v) Then 'getvar
                     v = GlobalVar(w$, 0)
                  ''  x1 = GetVar(bstack, W$, v)
                      End If
                Else
                    interpret = False
                   here$ = ohere$: Exit Function
                End If
                If Not FastSymbol(b$, ",") Then
                  interpret = False
                  Exit Do
                ElseIf IsStrExp(bstack, b$, ss$) Then  ' COMMAND
                If ss$ = "" Then interpret = False: here$ = ohere$: Exit Function
                x1 = 1
                y1 = 1
                x2 = -1
                y2 = -1
                nd& = 0
                SBR$ = ""
                  With players(GetCode(di))
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x1 = Abs(p) Mod (.mx + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y1 = Abs(p) Mod (.My + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then nd& = Abs(p)
                If FastSymbol(b$, ",") Then If Not IsStrExp(bstack, b$, SBR$) Then interpret = False: here$ = ohere$: Exit Function
                Targets = False
             
             
                ReDim Preserve q(UBound(q()) + 1)
              
                q(UBound(q()) - 1) = BoxTarget(bstack, x1, y1, x2, y2, SBR$, nd&, ss$, .Xt, .Yt, .uMineLineSpace)
                End With
                var(v) = UBound(q()) - 1
                Targets = True
                ElseIf IsExp(bstack, b$, p) Then
                  q(var(v)).enable = Not (p = 0)
                  RTarget bstack, q(var(v))
                Else
                interpret = False
                here$ = ohere$:             Exit Function
                End If
                Case "ΔΙΑΚΟΠΤΕΣ", "SWITCHES"
                    If IsStrExp(bstack, b$, ss$) Then
                    Switches ss$
                End If
                Case "MONITOR", "ΕΛΕΓΧΟΣ"
                    If IsSupervisor Then
                    prive = players(GetCode(di))
                    wwPlain bstack, prive, "Default Code Page:" & GetACP, bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, "App Path", bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, PathFromApp("m2000"), bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, "Register gsb", bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, myRegister("gsb"), bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, "Temporary", bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, LONGNAME(strTemp), bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, "Current directory", bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, mcd, bstack.Owner.Width, 1000, True
                    wwPlain bstack, prive, "Setting for Function Recursion " + CStr(funcdeep), bstack.Owner.Width, 1000, True
                    players(GetCode(di)) = prive
                    Else
                    BadCommand
                    End If
                Case "ΣΕΝΑΡΙΟ", "SCRIPT"
                If IsLabelOnly(b$, ss$) Then
                 If GetSub(myUcase(ss$, True), nd&) Then
                           b$ = vbCrLf + sbf(nd&).sb & b$
                   Else
                   b$ = ss$ + " " + b$
                   If IsStrExp(bstack, b$, w$) Then
                           b$ = vbCrLf + w$ + b$
                   Else
                   ' skip
                   End If
                   End If
                ElseIf IsStrExp(bstack, b$, w$) Then
                           b$ = vbCrLf + w$ + b$
                   End If
        
                Case "ΤΕΛΟΣ", "END"
   
                    If NORUN1 Then NORUN1 = False: interpret = True: b$ = "": Exit Function   ' send environment....to hell
                    ExTarget = True: INK$ = Chr(27):   UINK$ = Chr(27)     ' send escape...for any good reason...
                Case Else
                    LastErNum = 0 ' LastErNum1 = 0
                    LastErName = ""   ' every command from Query call identifier
                    LastErNameGR = ""  ' interpret is like execute without if for repeat while select structures
                    If comhash.Find2(w$, i, v) Then
                        If v <> 0 Then
                          
                            MyEr "No proper command for command line interpreter", "Δεν είναι η κατάλληλη εντολή για τον διερμηνευτή γραμμής"
                            interpret = False
                          
                            here$ = ohere$: Exit Function
                            End If
                    If i <> 0 Then
                     If Not IsBadCodePtr(i) Then
                        If Not CallByPtr(i, bstack, b$, lang) Then
                               If NOEXECUTION Then
                                    MyEr "", ""
                                    interpret = False
                                    End If
                                    here$ = ohere$: Exit Function
                        End If
                        End If
                    Else
                            If Not Identifier(bstack, w$, b$, Not comhash.Find(w$, i1), lang) Then
                            
                                    If NOEXECUTION Then
                                    MyEr "", ""
                                    interpret = False
                                    End If
                                    here$ = ohere$: Exit Function
                            End If
                    End If
                    
                    ElseIf Not Identifier(bstack, w$, b$, Not comhash.Find(w$, i1), lang) Then
                    
                            If NOEXECUTION Then
                            MyEr "", ""
                            interpret = False
                            End If
                            here$ = ohere$: Exit Function
                    End If
                    
                End Select
                End If
            End If
        Else
        If w$ <> "" Then
        b$ = w$ & " " & b$
        If Abs(IsLabel(bstack, b$, w$)) Then
        b$ = w$ & " " & b$
         If FindNameForGroup(bstack, w$) Then
 MyEr "Unknown Property " & w$, "’γνωστη ιδιότητα " & w$
 Else
MyEr "Unknown Variable " & w$, "’γνωστη μεταβλητή " & w$
End If

        
        Else

       SyntaxError
        End If
        b$ = ""
        interpret = False
        Exit Function
        End If
    End If
Case 3

ss$ = ""
         If MaybeIsSymbol(b$, "=<") Then
            If FastSymbol(b$, "<=", , 2) Then
                ss$ = "g"  'global
            ElseIf FastSymbol(b$, "=") Then
            ss$ = "="
            ElseIf IsOperator(b$, "[") Then
            ' for documents
            ' a$[10]  for documents means the paragraph order numaner
            ' a$[10,5] then 5th char in 10 paragraph
            ' for normal string is an error
            ss$ = "" ' closed for now
            End If
        End If
       

If ss$ <> "" Then
            If ss$ = "=" Then
                If GetVar(bstack, w$, v) Then
                    If IsStrExp(bstack, b$, ss$) Then
                         CheckVar var(v), ss$
                    Else
                       NoValueForvariable w$
                    Exit Do  '???
                    End If
                ElseIf IsStrExp(bstack, b$, ss$) Then
                    GlobalVar w$, ss$
                ElseIf LastErNum = 0 Then
                                    
                    SyntaxError
                    interpret = False
                    Exit Function
                    Else
                   Exit Do  '???
                End If
          
            Else
            ' one now option
                If GetVar(bstack, w$, v) Then
                        If IsStrExp(bstack, b$, ss$) Then
                             CheckVar var(v), ss$
                        Else
                            NoValueForvariable w$
                        Exit Do
                        End If
                Else
                    Nosuchvariable w$
                End If
        End If
End If
          
Case 4
If FastSymbol(b$, "=") Then '................................
           
            If GetVar(bstack, w$, v) Then
                If IsExp(bstack, b$, p) Then
                var(v) = Int(p)
                Else
                  MissNumExpr
                Exit Do
                End If
            ElseIf IsExp(bstack, b$, p) Then
                GlobalVar w$, p
                ElseIf LastErNum = 0 Then
                                
                SyntaxError
                interpret = False
                Exit Function
                Else
               Exit Do
            End If
 Else
    If FastSymbol(b$, "+=", , 2) Then
    ss$ = "+"
    ElseIf FastSymbol(b$, "/=", , 2) Then
    ss$ = "/"
    ElseIf FastSymbol(b$, "-=", , 2) Then
    ss$ = "-"
    ElseIf FastSymbol(b$, "*=", , 2) Then
    ss$ = "*"
    ElseIf IsOperator(b$, "++", 2) Then
    ss$ = "++"
    ElseIf IsOperator(b$, "--", 2) Then
    ss$ = "--"
    ElseIf IsOperator(b$, "-!", 2) Then
    ss$ = "-!"
         ElseIf IsOperator(b$, "~") Then
        ss$ = "!!"
    ElseIf FastSymbol(b$, "<=", , 2) Then
    ss$ = "="
    End If
        If ss$ = "" Then
                 MyEr "No value for variable " & w$, "Χωρίς τιμή η μεταβλητή " & w$
                    interpret = False
                     Exit Function
    End If
    If GetVar(bstack, w$, v) Then
        If Len(ss$) = 1 Then
                    If IsExp(bstack, b$, p) Then
                            On Error Resume Next
                            Select Case ss$
                            Case "="
                            var(v) = Int(p)
                                Case "+"
                                var(v) = Int(p) + var(v)
                                Case "*"
                                 var(v) = Int(Int(p) * var(v))
                                Case "-"
                                var(v) = var(v) - Int(p)
                                Case "/"
                                If p = 0 Then
                                   interpret = False
                                 Exit Function
                                End If
                                 var(v) = var(v) \ Int(p)
                                 Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            If Err.Number = 6 Then
                            interpret = False
                            Exit Function
                            End If
                If VarType(var(v)) <> vbLong Then var(v) = MyRound(var(v), 13)
                    Else
                                   interpret = False
                                 Exit Function
                    End If
        Else
        If ss$ = "++" Then
        var(v) = 1 + var(v)
        ElseIf ss$ = "--" Then
        var(v) = var(v) - 1
        ElseIf ss$ = "-!" Then
        var(v) = -var(v)
        Else

                      var(v) = -1 - (var(v) <> 0)
        End If
        End If
    Else
                   interpret = False
        Exit Function
    End If
End If
Case 5

If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsExp(bstack, b$, p) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
            interpret = False
            Exit Function
        End If
        End If
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: Exit Function
On Error Resume Next
If MaybeIsSymbol(b$, ":+-*/!") Then
With pppp
        If IsOperator(b$, "++", 2) Then
            .item(v) = .item(v) + 1
            GoTo loopcontinue1
        ElseIf IsOperator(b$, "--", 2) Then
            .item(v) = .item(v) - 1
            GoTo loopcontinue1
        ElseIf IsOperator(b$, "+=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
            .item(v) = .item(v) + p
        ElseIf IsOperator(b$, "-=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
            .item(v) = .item(v) - p
        ElseIf IsOperator(b$, "*=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
            .item(v) = .item(v) * p
        ElseIf IsOperator(b$, "/=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
            If p = 0 Then
             MyEr "division by zero", "διαίρεση με το μηδέν"
             Else
             .item(v) = pppp.item(v) / p
            End If
        ElseIf IsOperator(b$, "-!", 2) Then
            .item(v) = -.item(v)
            GoTo loopcontinue1
        ElseIf IsOperator(b$, "~") Then
            .item(v) = -1 - (.item(v) <> 0)
            GoTo loopcontinue1
      ElseIf FastSymbol(b$, ":=", , 2) Then

    If IsExp(bstack, b$, p) Then
        .item(v) = p
    ElseIf IsStrExp(bstack, b$, ss$) Then
      If Not IsObject(.item(v)) Then
          .item(v) = ss$
          Else
        CheckVar .item(v), ss$
        
        End If

    Else
        Exit Do
    End If
    If FastSymbol(b$, ",") Then v = v + 1: GoTo contarr1
    GoTo loopcontinue1
        End If
.item(v) = MyRound(.item(v), 13)
GoTo loopcontinue1
End With
End If


If IsOperator(b$, ".") Then

If Typename(pppp.item(v)) = "Group" Then
interpret = SpeedGroup(bstack, pppp, "", w$, b$, v)
GoTo loopcontinue1
End If

ElseIf Not FastSymbol(b$, "=") Then
here$ = ohere$: Exit Function
End If

If Not IsExp(bstack, b$, p) Then here$ = ohere$: Exit Function
pppp.item(v) = p
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then here$ = ohere$: Exit Function
pppp.item(v) = p
Else
Exit Do
End If
Loop
Else
interpret = False: here$ = ohere$: Exit Function
End If
Case 6
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, ss$) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
               interpret = False
            Exit Function
        End If
        End If
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: Exit Function
On Error Resume Next
If Not FastSymbol(b$, "=") Then
    If FastSymbol(b$, ":=", , 2) Then
contarr1:
    ss$ = Left$(aheadstatus(b$), 1)
        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: Exit Function
        Else
        If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
        ss$ = Trim$(Str$(p))
        End If
             If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
          ss$ = Left$(aheadstatus(b$), 1)
                        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: Exit Function
        Else
        If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
        ss$ = Trim$(Str$(p))
        End If
        
                If Not IsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
   
     
        
    Else
    interpret = False: here$ = ohere$: Exit Function
    End If
Else
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: Exit Function
        
        
        If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
                If Not IsStrExp(bstack, b$, ss$) Then here$ = ohere$: Exit Function
        
                If Not IsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
End If
Else
interpret = 0: here$ = ohere$: Exit Function
End If
Case 7
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, ss$) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
              interpret = False
            Exit Function
        End If
        End If
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: Exit Function
On Error Resume Next
If MaybeIsSymbol(b$, "+-*/!") Then
If IsOperator(b$, "++", 2) Then
pppp.item(v) = pppp.item(v) + 1
ElseIf IsOperator(b$, "--", 2) Then
pppp.item(v) = pppp.item(v) - 1
ElseIf IsOperator(b$, "+=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
pppp.item(v) = pppp.item(v) + Int(p)
ElseIf IsOperator(b$, "-=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
pppp.item(v) = pppp.item(v) - Int(p)
ElseIf IsOperator(b$, "*=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
pppp.item(v) = pppp.item(v) * Int(p)
ElseIf IsOperator(b$, "/=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: Exit Function
If p = 0 Then
 MyEr "division by zero", "διαίρεση με το μηδέν"
 Else
 pppp.item(v) = Int(pppp.item(v) / Int(p))
End If
ElseIf IsOperator(b$, "-!", 2) Then
pppp.item(v) = -pppp.item(v)
ElseIf IsOperator(b$, "~") Then
pppp.item(v) = -1 - (pppp.item(v) <> 0)
End If
GoTo loopcontinue1
End If
If Not FastSymbol(b$, "=") Then here$ = ohere$: Exit Function
If Not IsExp(bstack, b$, p) Then here$ = ohere$: Exit Function
p = Int(p)
If Err.Number > 0 Then interpret = False: here$ = ohere$: Exit Function
pppp.item(v) = p
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then here$ = ohere$: Exit Function
pppp.item(v) = p
Else
Exit Do
End If
Loop
Else
interpret = False: here$ = ohere$: Exit Function
End If
Case Else
If MaybeIsSymbol(b$, ",-+*/_!@()[];<>|~`'\") Then
SyntaxError
End If
End Select
loopcontinue1:
Loop
here$ = ohere$
If LastErNum = -2 Then
sss = CLng(Execute(bstack, b$, True))
b$ = ""
interpret = False

Exit Function
ElseIf LastErNum <> -0 Then
b$ = " "
End If
interpret = b$ = ""
End Function
Function StaticNew(bstack As basetask, b$, w$) As Boolean
'If bstack.UseGroupname <> "" Then
 '       MyErMacro b$, "No static variable for group module " + w$, "Όχι στατική μεταβλητή για τμήμα ομάδας"
'Exit Function
'End If
Dim p As Double, ii As Long, ss$
If bstack.StaticCollection Is Nothing Then

Set bstack.StaticCollection = New FastCollection
End If
Do
    Select Case IsLabel(bstack, b$, w$)
    Case 1
        If Not bstack.ExistVar(w$) Then
            If FastSymbol(b$, "=") Then If Not IsExp(bstack, b$, p) Then SyntaxError: Exit Function
            bstack.SetVar w$, p
        ElseIf FastSymbol(b$, "=") Then
  ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
            
        End If
        StaticNew = True
    Case 3
            If Not bstack.ExistVar(w$) Then
            If FastSymbol(b$, "=") Then If Not IsStrExp(bstack, b$, ss$) Then SyntaxError: Exit Function
            bstack.SetVar w$, ss$
        ElseIf FastSymbol(b$, "=") Then
        ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
    End If
        StaticNew = True
    Case 4
        If Not bstack.ExistVar(w$) Then
            If FastSymbol(b$, "=") Then If Not IsExp(bstack, b$, p) Then SyntaxError: Exit Function
            bstack.SetVar w$, Int(p)
        ElseIf FastSymbol(b$, "=") Then
 ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)

    End If
        StaticNew = True
        
    Case Else
        MyErMacro b$, "No static for that type " + w$, "Όχι στατική για αυτό το τύπο " + w$
        Exit Function
    End Select
 Loop Until Not FastSymbol(b$, ",")
End Function

Sub ConnectStatic(bstack As basetask, ByVal what$)
''what$ = "%_" + what$
Dim vvv As Variant, Parent As basetask, parent1 As basetask
Set Parent = bstack.Parent
Do While Not Parent Is Nothing
If Parent.StaticInUse$ = what$ Then

   Set bstack.StaticCollection = Parent.StaticCollection
    bstack.StaticInUse$ = what$
     bstack.OriginalCode = Parent.OriginalCode
    Exit Do
End If
Set Parent = Parent.Parent
Loop
Set Parent = Nothing
End Sub
Function Execute(bstack As basetask, b$, Once As Boolean, Optional linebyline As Boolean, Optional loopthis As Boolean = False) As Long
Dim di As Object
If mybreakkey Then
        ModalId = 0
                TaskMaster.Dispose
             NOEXECUTION = False
             MOUT = False
            
           b$ = "@Start : error {},{} "
           ' '{Break},{Διακοπή}"
           Once = False
           k1 = 0
                MyDoEvents0 bstack.Owner
               MyEr "", ""
End If
Set di = bstack.Owner
Dim myobject As Object
Dim pppp As mArray, bb$, Us$, ec$, i As Long, jump As Boolean, ohere$, slct As Long, sp As Double, sw$, ok As Boolean, IFCTRL As Long
If linebyline Then IFCTRL = bstack.IFCTRL: jump = bstack.jump
Dim w$, LLL As Long, sss As Long, v As Long, p As Double, ss$, lbl As Boolean, DUM As Boolean, st As Double, bs As basetask
Dim y As Double, sx As Double, VarStat As Boolean, NewStat As Boolean
Dim x1 As Long, y1 As Long, x2 As Long, y2 As Long, sbb$, nd&, lang As Long, kolpo As Boolean, iscom As Boolean
ohere$ = here$   ' here$ is global but i want to include to the basetask class some day...
UINK$ = ""  ' εδώ θέλω να σβήνω...τι;
If loopthis Then Execute = 2 Else Execute = 1
If NocharsInLine(b$) Then
checkrefresh:
Exit Function

End If
sss = Len(b$): lbl = True
' This is the main loop, if we consume commands then Len(B$) will be smaller.
' We have to change LLL if we put inline code
Do While Len(b$) <> LLL

        If NOEXECUTION Then
            MyEr "", ""
            k1 = 0
            REFRESHRATE = 40
            SLOW = False
            extreme = False
            If MOUT Then
                        TaskMaster.Dispose
                        NOEXECUTION = False
                        MOUT = False
                        
                        b$ = "@Start : error {},{} "
                        Once = False
                        MyDoEvents0 bstack.Owner
                        MyEr "", ""
                        LLL = 0
                Else
                        MyErMacro b$, "Escape", "Διακοπή εκτέλεσης"
                        If Once Then
                                    b$ = vbCrLf + b$   ' this cause troubles...
                                    Execute = 0
                        Else
                                    Once = True
                                    Execute = 1
                        End If
                        Exit Function
                End If
        End If


If trace Or SLOW Then
refreshGui
If trace Then
''Sleep 10
MyDoEvents0 di   ' change from simple to version 2\ change to mydoevents0


Else
MyDoEvents1 di
End If

End If
AGAIN1:
LLL = Len(b$)
If MaybeIsSymbol(b$, "=") Then
b$ = Mid$(Trim$(b$), 2)
If (InStr(bstack.OriginalName$, "(") > 1) Then   ' return from a function no error checking
x1 = 0
Do
    If IsExp(bstack, b$, p) Then
    If x1 = 0 Then If MaybeIsSymbol(b$, ",") Then x1 = 1: Set pppp = New mArray: pppp.PushDim (1): pppp.PushEnd
    If x1 = 0 Then
            If Len(bstack.OriginalName$) > 3 Then
                    If Mid$(bstack.OriginalName$, Len(bstack.OriginalName$) - 2, 1) = "$" Then
                        MissStringExpr
                        Exit Do
                    End If
                End If
             If Right$(bstack.OriginalName$, 3) = "%()" Then p = Int(p)
             Set bstack.FuncObj = bstack.lastobj
             Set bstack.lastobj = Nothing
             bstack.FuncValue = p
    Else
            pppp.SerialItem 0, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = p
            Else
                If Typename(bstack.lastobj) = "mHandler" Then
                                                 If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                End If
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            bstack.FuncValue = p
            x1 = x1 + 1
                         
    End If
    ElseIf IsStrExp(bstack, b$, ss$) Then
        If x1 = 0 Then If MaybeIsSymbol(b$, ",") Then x1 = 1: Set pppp = New mArray: pppp.PushDim (1): pppp.PushEnd
        If x1 = 0 Then
            If Len(bstack.OriginalName$) > 3 Then
                If Mid$(bstack.OriginalName$, Len(bstack.OriginalName$) - 2, 1) <> "$" Then
                     MissNumExpr
                     Execute = False
                     Exit Function
                End If
            Else
                MissNumExpr
                Execute = 0
                Exit Function
            End If
            Set bstack.FuncObj = bstack.lastobj
            Set bstack.lastobj = Nothing
            bstack.FuncValue = ss$
        Else
            pppp.SerialItem 0, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = ss$
            Else
                If Typename(bstack.lastobj) = "mHandler" Then
                                                 If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                    End If
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            x1 = x1 + 1
            bstack.FuncValue = ss$
                        
        End If
    End If
    Loop Until Not FastSymbol(b$, ",")
    If x1 > 0 Then
     pppp.SerialItem 0, x1, 9
     Set bstack.FuncObj = pppp
     Set pppp = New mArray
     Set bstack.lastobj = Nothing
     If VarType(bstack.FuncValue) = 5 Then
     bstack.FuncValue = 0
     Else
     bstack.FuncValue = ""
     End If
    End If
    x1 = 0
    If Once Then Exit Function
End If
ElseIf MaybeIsSymbol(b$, "{") Then
b$ = Mid$(Trim$(b$), 2)
If MaybeIsSymbol(b$, "}") Then
b$ = Mid$(Trim$(b$), 2)
sss = Len(b$)
 GoTo AGAIN1
''GoTo loopcontinue
End If

If executeblock(Execute, bstack, b$, Once, kolpo) Then Exit Function
If Execute = 4 Then b$ = "{" + b$: Exit Function
If kolpo Then ec$ = block(b$)
If Execute = 2 And b$ <> "" Then Exit Function

If Not FastSymbol(b$, "}") Then Execute = 0: Exit Function

If NocharsInLine(b$) Then Exit Function
sss = LLL  'basic...


    
    End If
contVarNew:
If MaybeIsSymbol(b$, "\'") Then
    NewStat = False
    VarStat = False
SetNextLine b$
 sss = Len(b$)
lbl = True
 GoTo AGAIN1
End If
jumpforCR:

If FastSymbol(b$, vbCrLf, , 2) Then
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    If NocharsInLine(b$) Then GoTo jumphere
    NewStat = False
    VarStat = False
    sss = LLL: lbl = True: jump = False
    If IsNumberLabel(b$, w$) Then sss = Len(b$): sss = LLL: lbl = False: jump = False:  If sss = 0 Then sss = 2: b$ = vbCrLf
    UINK$ = ""
Else
    If lbl Then If IsNumberLabel(b$, w$) Then sss = Len(b$): sss = LLL: jump = False: If sss = 0 Then sss = 2: b$ = vbCrLf
End If
If VarStat Or NewStat Then


If FastSymbol(b$, ",") Then sss = LLL: lbl = False: jump = False
iscom = True
Select Case IsLabelDotSub(here$, b$, w$, ss$, lang)
Case 1234, 0
VarStat = False
NewStat = False
GoTo contconthere
Case 1
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
End If
GoTo varonly
Case 2
MyEr "No with reference (&)", "Όχι με αναφορά (&)"
Execute = 0
Exit Function
Case 3
GoTo contcase3
Case 4
GoTo contcase4
Case 5
GoTo contcase5
Case 6
GoTo contcase6
Case 7
GoTo contcase7
Case Else
GoTo errstat
End Select
ElseIf FastSymbol(b$, ":") Then
If linebyline Then Exit Do
contconthere:
NewStat = False: VarStat = False: sss = LLL: lbl = False: jump = False:  If sss = 0 Then sss = 2: b$ = vbCrLf
End If

again2:
If MaybeIsSymbol(b$, "@") Then w$ = "": GoTo parsecommand
again3:

Select Case IsLabelDotSub(here$, b$, w$, ss$, lang)
Case 1234
GoTo jumpforCR
Case 2
MyEr "No with reference in left side of assignment", "Όχι με αναφορά στην εκχώρηση τιμής"
Execute = 0
Exit Function
Case 1

    If sss = LLL Then
If lbl And IsOperator(b$, ":") Then
''If VarStat Or NewStat Then b$ = w$ + " :" + b$: sss = Len(b$): GoTo again1
sw$ = GetNextLine(b$)
If Trim$(sw$) <> "" Then
If MaybeIsSymbol(sw$, "\'") Then
LLL = Len(b$): sss = LLL: GoTo AGAIN1
Else
b$ = ": " + sw$ + vbCrLf + b$
End If
Else
LLL = Len(b$): sss = LLL: GoTo AGAIN1
End If

End If
       'If lang <> codeW(w$) Then Stop  ' lang = codeW(w$)

        '' w$ = myUcase(w$)
        If Trim(w$) = "" Then
        Execute = 1
        Exit Function
        End If
      
 ' trace here...And Not bstack.IamAnEvent And Not bstack.IamThread
 If trace Then
  If (bstack.Process Is Nothing) Then
    Form2.Label1(0) = here$
    Form2.Label1(1) = w$
    Form2.Label1(2) = GetStrUntil(vbCrLf, b$ & vbCrLf, False)
    sbb$ = GetNextLine((sbf(bstack.OriginalCode).sb))
    If Left$(sbb$, 10) = "'11001EDIT" Then
    
    TestShowSub = Mid$(sbf(bstack.OriginalCode).sb, Len(sbb$) + 3)
    Else
    If bstack.OriginalCode <> 0 Then
     TestShowSub = sbf(bstack.OriginalCode).sb
     Else
     TestShowSub = b$
     End If
     End If

    If bstack.addlen Then
        If Len(TestShowSub) - bstack.addlen > 0 Then
       TestShowStart = rinstr(Left$(TestShowSub, Len(TestShowSub) - bstack.addlen), Mid$(b$, 2)) - 1
        Else
        TestShowStart = 1
        End If
     Else
        TestShowStart = rinstr(TestShowSub, b$)
        End If
  If TestShowStart <= 0 Then
  TestShowStart = rinstr(TestShowSub, Mid$(b$, 2)) - 1
  End If
    
    Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
    Form1.Show , Form5   'OK
    End If

    If STbyST Then
    
        STbyST = False
        If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        Do
        BLOCKkey = False
         If di.Visible Then di.Refresh
        ProcTask2 bstack
        
        Loop Until STbyST Or STq Or STEXIT Or NOEXECUTION Or myexit(bstack)
        If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        STq = False
        If STEXIT Then
        NOEXECUTION = True
        trace = False
        STEXIT = False
        Execute = 0
        Exit Function
        End If

    End If
    If STEXIT Then
    trace = False
    STEXIT = False
    Execute = 0
    Exit Function
    End If
    Else
             Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
    Form1.Show , Form5   'OK
    End If
    End If
ElseIf Form2.Visible Then
 
         Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
    Form1.Show , Form5   'OK
    End If
End If
iscom = False
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
iscom = True
GoTo varonly
ElseIf Not NoOptimum Then

      '
      v = 0
    ' If Not comhash.Find(w$, i) Then
If Not comhash.Find2(w$, i, v) Then
                iscom = True
                GoTo varonly

          ElseIf v > 0 Then
              ' If VarStat Or NewStat Then GoTo errstat
                Select Case v
                Case 50
                GoTo contif
                Case 51
                GoTo ContElse
                Case 52
                GoTo contElseIf
                Case 53
                GoTo contSelect
                Case 60
                GoTo ContTry
                Case 100 ' For
                GoTo ForCont
                Case 199
                GoTo contNext
                Case 200
                GoTo contRefr
                Case 300
                GoTo contWhile
                Case 301
                GoTo ContRepeat
                Case 400
                GoTo ContGoto
                Case 401
                GoTo contSub
                Case 402
                GoTo autogosub
                Case 403
                GoTo ContOn
                Case 600
                GoTo contLoop
                Case 601
                GoTo contBreak
                Case 602
                GoTo ContContinue
                Case 603
                GoTo ContRestart
                Case 604
                GoTo ContReturn
                Case 605
                GoTo ContEnd
                Case 606
                GoTo ContExit
                Case 650
                GoTo ContInline
                Case 651
                GoTo contUpdate
                Case 700
                GoTo contThread
                Case 701
                GoTo contAfter
                Case 702
                GoTo contPart
                Case 800
                GoTo contStatic
                Case 850
                GoTo contEvery
                Case 851
                GoTo contTask
                Case 900
                GoTo ContScan
                Case 1000
                GoTo contTarg
                End Select
             ElseIf v < 0 Then
             Select Case v
                Case -100  ' local
                GoTo contNegLocal
                Case -200
                GoTo contNegGlobal
                
             End Select
             ElseIf i <> 0 Then
             If Not IsBadCodePtr(i) Then
             On Error GoTo myerr1
                        If CallByPtr(i, bstack, b$, lang) Then
                            LLL = 0 ' maybe b$ changed inside the call if LLL=len(b$) then we exit from loop
                            GoTo conthere222
                        Else
myerr1:

                             If LastErNum1 = -1 And bstack.IamThread Then Execute = 1 Else Execute = 0
                             If Err Then GoTo errstat0 Else Exit Function
                         End If
                    On Error GoTo errstat0
               Else
              GoTo parsecommand
               End If
               Else
                If lbl And MaybeIsSymbol(b$, "<=") Then GoTo varonly
                If GetlocalVar(w$, nd&) Then GoTo varonly
               GoTo parsecommand
             End If

             
End If

        Select Case w$

            Case "TARGET", "ΣΤΟΧΟΣ"
contTarg:
           ' If VarStat Or NewStat Then GoTo errstat
                  If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                    If Not GetVar(bstack, w$, v) Then
                     v = GlobalVar(w$, 0, , VarStat)

                               
                    End If
                Else
                    Execute = 0
                    Exit Function
                End If
                If Not FastSymbol(b$, ",") Then
                    Execute = 0
                    Exit Function
                ElseIf IsStrExp(bstack, b$, bb$) Then
                If NocharsInLine(bb$) Then Execute = 0: Exit Function
                With players(GetCode(di))
               '' SetTextSZ di, Sz
               '' LCT di, yPos, xPos
                x1 = 1
                y1 = 1
                x2 = -1
                y2 = -1
                nd& = 0
                sbb$ = ""
         
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x1 = Abs(p) Mod (.mx + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y1 = Abs(p) Mod (.My + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then nd& = Abs(p)
                If FastSymbol(b$, ",") Then If Not IsStrExp(bstack, b$, sbb$) Then Execute = 0: Exit Function
                Targets = False
                MyDoEvents1 Form1
       
                ReDim Preserve q(UBound(q()) + 1)
                q(UBound(q()) - 1) = BoxTarget(bstack, x1, y1, x2, y2, sbb$, nd&, bb$, .Xt, .Yt, .uMineLineSpace)
                End With
                var(v) = UBound(q()) - 1
                Targets = True
                ElseIf IsExp(bstack, b$, p) Then
                  q(var(v)).enable = Not (p = 0)
                  RTarget bstack, q(var(v))
                Else
                  Execute = 0
                  Exit Function
                End If
          
        Case "SCAN", "ΣΑΡΩΣΕ"
ContScan:
             ClearJoyAll
             PollJoypadk
             
            If Not Targets Then
            If IsExp(bstack, b$, p) Then
            End If
            Sleep 10: MyDoEvents0 di
            Else
                If di.Visible = False Then di.Visible = True
                NoAction = False
                nomore = True
                If IsExp(bstack, b$, p) Then
                y = Timer + p
                x1 = Form1.lockme
                Form1.lockme = False
                Do
                x1 = BLOCKkey
                 BLOCKkey = True
                MyDoEvents0 Form1
                BLOCKkey = x1
                If exWnd <> 0 Then
                ss$ = MyTitle$(bstack)
          
                
               
                End If
                If FKey > 0 Then
                If FK$(FKey) <> "" Then
                b$ = FK$(FKey) + b$
                FKey = 0
                Exit Do
                End If
                End If
                Loop Until NoAction Or Timer > y Or myexit(bstack) Or bstack.IamThread
                Form1.lockme = x1

                Else
                Do
                MyDoEvents0 Form1

                If exWnd <> 0 Then
                ss$ = MyTitle$(bstack)
                End If
                If FKey > 0 Then
                If FK$(FKey) <> "" Then
                b$ = FK$(FKey) + b$
                FKey = 0
                Exit Do
                End If
                End If
                Loop Until NoAction Or myexit(bstack)
                End If
                nomore = False
                End If
        Case "REFRESH", "ΑΝΑΝΕΩΣΗ"
contRefr:
        If IsLabelSymbolNew(b$, "ΔΟΚΙΜΗ", "TEST", lang) Then
        MyDoEvents1 di
        ElseIf IsExp(bstack, b$, p) Then
                If p = 0 Then
                k1 = uintnew(timeGetTime + REFRESHRATE)
                    Else
                    
                       REFRESHRATE = uintnew(p)
                    k1 = 0
MyDoEvents1 di

                     End If
                Else
                
    ' k1 = 0
      '          MyDoEvents1 di
     ' RRCOUNTER = 1
      If di.Visible Then di.Refresh
      
                  MyDoEvents
        
            End If
       
                         If exWnd <> 0 Then
                    ss$ = MyTitle$(bstack)
                End If
       
                          If FKey > 0 Then
                    If FK$(FKey) <> "" Then
                    MKEY$ = MKEY$ & FK$(FKey)
                         ''   b$ = vbcrlf + "set " + FK$(FKey) + vbCrLf + b$
                    End If
                End If
                FKey = 0
Case "ΣΤΑΤΙΚΗ", "ΣΤΑΤΙΚΕΣ", "STATIC"
contStatic:
 StaticNew bstack, b$, w$
Case "ΝΗΜΑ", "THREAD"
contThread:
Us$ = ""
If IsLabelSymbolNewExp(b$, "ΘΕΣΕ", "SET", lang, Us$) Then
If bstack.Process Is Nothing Then GoTo dothesame
If Not StaticNew(bstack, b$, w$) Then Execute = 0: Exit Function
ElseIf IsLabelSymbolNewExp(b$, "ΑΥΤΟ", "THIS", lang, Us$) Then
      If bstack.Process Is Nothing Then
dothesame:
                b$ = ""
                MyEr "Clause This can't used outside a thread", "Ο όρος ΑΥΤΟ δεν μπορεί να χρησιμοποιηθεί έξω από ένα νήμα"
                Execute = 0: Exit Function
                Once = False
            ElseIf IsLabelSymbolNewExp(b$, "ΣΒΗΣΕ", "ERASE", lang, Us$) Then
         Set bstack.Process.Process = Nothing

                b$ = "" ' get lost now
            ElseIf IsLabelSymbolNewExp(b$, "ΚΡΑΤΑ", "HOLD", lang, Us$) Then
                bstack.Process.busy = True
         
            ElseIf IsLabelSymbolNewExp(b$, "ΞΕΚΙΝΑ", "RESTART", lang, Us$) Then
                bstack.Process.busy = False
                b$ = ""
            ElseIf IsLabelSymbolNewExp(b$, "ΚΑΘΕ", "INTERVAL", lang, Us$) Then
                                 If IsExp(bstack, b$, p) Then
                                     If p < 2 Then p = 2
                                     
                                     bstack.Process.Interval = p
                                     Else
                                     b$ = ""
                                     MyEr "Expected number for interval, miliseconds", "Περίμενα αριθμό για ορισμό τακτικού διαστήματος εκκίνησης νήματος (χρόνο σε χιλιοστά δευτερολέπτου)"
                                     Execute = 0: Exit Function
                                End If
               Else
                                    b$ = ""
                                    MyEr "can't find ERASE or HOLD or RESTART or INTERVAL clause", "Δεν μπορώ να βρω όρο όπως το ΣΒΗΣΕ ή το ΚΡΑΤΑ ή το ΞΕΚΙΝΑ ή το ΚΑΘΕ"
                                    Execute = 0: Exit Function
            End If
            
   
            Else
                       If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
            If Not MyThread(bstack, b$, lang) Then Execute = 0: Exit Function
               If Left$(here$ & "#", 1) = "!" Then here$ = Mid$(here$, 2): ohere$ = here$
            End If
        Case "LOOP", "ΚΥΚΛΙΚΑ"
contLoop:
    
        If Once = True Then Execute = 0: Exit Function
            loopthis = True
            Execute = 2
        If myexit(bstack) Then Execute = 1: b$ = "": Exit Function
       Case "BREAK", "ΔΙΕΚΟΨΕ"
contBreak:
     
                  b$ = "BREAK"
           Once = True
        Execute = 2
        Exit Function
     If myexit(bstack) Then Execute = 1: b$ = ""
       Case "CONTINUE", "ΣΥΝΕΧΙΣΕ"
ContContinue:

           If Execute <> 2 Then
              b$ = "CONTINUE"
           Once = True
           Execute = 3
         
           Else
           b$ = ""
           
        End If
                If myexit(bstack) Then Execute = 1: b$ = ""
          Exit Function
       Case "RESTART", "ΞΕΚΙΝΑ"
ContRestart:

         b$ = ""
        
        Execute = 2
       If myexit(bstack) Then Execute = 1
       Exit Function

       Case "RETURN", "ΕΠΙΣΤΡΟΦΗ"
ContReturn:
    LastErNum = 0
       If IsExp(bstack, b$, p) Then
       If bstack.lastobj Is Nothing Then
          MyEr "Wrong Use of Return", "Κακή χρήση της επιστροφής"
       Execute = 0
       Exit Function
       ElseIf Typename(bstack.lastobj) = "mHandler" Then
       If bstack.lastobj.T1 = 1 Then
              If ChangeValues(bstack, b$) Then GoTo loopcontinue
        Else
                If ChangeValuesMem(bstack, b$, lang) Then GoTo loopcontinue
        End If
       
       End If
       MyEr "Wrong Use of Return", "Κακή χρήση της επιστροφής"
       Execute = 0
       Exit Function
       ElseIf IsStrExp(bstack, b$, ss$) Then
            append_table bstack, ss$, b$, True, lang
        Else
        If LastErNum <> 0 Then
        
        LLL = Len(b$) - 1
        Else
                Once = False
                b$ = Chr$(0)
                Execute = 2
                
                Exit Function
                End If
    End If
       Case "END", "ΤΕΛΟΣ"
ContEnd:
               If IsLabelSymbolNew(b$, "ΡΟΥΤΙΝΑΣ", "SUB", lang) Then
                Once = False
                b$ = Chr$(0)
                Execute = 2
                Exit Function
                Else
                b$ = ""   ' no more syntax error
                Execute = 1
                
            '     If Not App.StartMode = vbSModeStandalone Then
                 MOUT = True
                 
                 'ProcTitle bstack, Chr$(34) + Chr$(34) + ",0", 0
'End If
                Exit Function
                End If
        Case "ΕΞΟΔΟΣ", "EXIT"
         ''\\"SUB", "ΡΟΥΤΙΝΑ"
ContExit:
        Us$ = ""
        If IsLabelSymbolNewExp(b$, "ΡΟΥΤΙΝΑΣ", "SUB", lang, Us$) Then
                Once = False
                b$ = Chr$(0)
                Execute = 2
                Exit Function
        ElseIf IsLabelSymbolNewExp(b$, "ΓΙΑ", "FOR", lang, Us$) Then
         Once = False
                b$ = "NEXT"
        Execute = 2
                Exit Function
        ElseIf IsLabelSymbolNewExp(b$, "ΕΚΤΥΠΩΣΗΣ", "PRINTING", lang, Us$) Then
        If bstack.toprinter Then
                    pnum = 0
                    oprinter.ClearUp
                    Form1.PrinterDocument1.Picture = LoadPicture("")
                    Set bstack.Owner = Form1.DIS
                    bstack.toprinter = False
                    SetNormal bstack.Owner
        
        End If
                    b$ = ""
           Once = True
             Else
 If Execute <> 2 Then Execute = 1 Else Execute = 3
            b$ = ""
           Once = True
           Exit Function
           End If
           
           
        Case "FOR", "ΓΙΑ"
ForCont:
                  If linebyline Then
                  If AscW(b$) <> 32 Then
                
          b$ = w$ + " " + b$
          Else
          b$ = w$ + b$
          End If
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
        
               If Once = True Then Execute = 0: Exit Function
               If IsStrExp(bstack, b$, w$) Then
               b$ = w$ + " " + b$
               End If
        x1 = Abs(IsLabelBig(bstack, b$, w$, , sbb$))
nd& = x1
        Select Case x1
        Case 1, 4 'FLOATING POINT
        
        If MaybeIsSymbol(b$, "<=") Then
         If FastSymbol(b$, "=") Then
         If bstack.StaticCollection Is Nothing Then GoTo cont10456
         
        If bstack.ExistVar(w$) Then
            x2 = -1
            x1 = nd&
            If IsExp(bstack, b$, p) Then
            
                If nd& = 4 Then p = Int(p) Else p = MyRound(p, 13)
                bstack.SetVar w$, p
                GoTo eos
            Else
            Execute = 0
            Exit Function
            End If
            Else
cont10456:
            x1 = Abs(GetlocalVar(w$, x2)) * x1
        End If
         ElseIf FastSymbol(b$, "<=", , 2) Then
  x1 = Abs(GetVar(bstack, w$, x2, True)) * x1
         End If
         If x1 Then
            If VarType(var(x2)) = vbLong Then
            x1 = 8
             If IsExp(bstack, b$, p) Then
             On Error Resume Next
              If x2 < 0 Then
                bstack.SetVar w$, CLng(p)
            Else
               var(x2) = CLng(p)
            End If
          
             If Err.Number = 6 Then
                 Execute = 0
        MyEr "OverFlow Long", "Yπερχείλιση μακρύ"
        Exit Function
             End If
             End If
            Else
             If IsExp(bstack, b$, p) Then
             If x1 = 1 Then var(x2) = MyRound(p, 13) Else var(x2) = Int(p)
             End If
             End If
            ElseIf IsExp(bstack, b$, p) Then
            If nd& > 1 Then p = Int(p)
              x2 = GlobalVar(w$, p, , VarStat)
                x1 = nd&
        Else
        
        Execute = 0
        Exit Function
        End If
eos:
        If IsLabelSymbolNew(b$, "ΕΩΣ", "TO", lang) Then
        If IsExp(bstack, b$, sp) Then
       sp = MyRound(sp, 13)
        p = MyRound(p, 13)
            If x1 > 1 Then sp = Int(sp)
                st = Sgn(sp - p)
                
        If IsLabelSymbolNew(b$, "ΑΝΑ", "STEP", lang) Then
        If IsExp(bstack, b$, st) Then
         If x1 > 1 Then st = Int(st)
         If Sgn(sp - p) = 0 Or st = 0 Then
        
         Else
         st = Abs(st)
         If sp < p Then

         If Fix(st) = st Then
         sp = sp - 1 + st / 2
         Else
              sx = Abs(((sp - p) / st))
               If sx = MyRound(sx) Then
                 sp = sp - MyRound(st / 2)
               ElseIf st < 1 Then
         sp = sp - 1 / EXP(18 - (Log(st + Abs(sp - p))) / Log(10))
         Else

         sp = p - Fix(sx) * st - st / 2
         End If
     
         End If
       Else
         If Fix(st) = st Then
         Else
         sx = Abs(((sp - p) / st))
         If sx = MyRound(sx) Then
         
         sp = sp + MyRound(st / 2)
         ElseIf st < 1 Then
         sp = sp + 1 / EXP(18 - (Log(st + Abs(sp - p))) / Log(10))
         Else
         sp = p + Fix(sx) * st + st / 2
         End If
         End If
        End If
         st = Sgn(sp - p) * st
         
         End If
     
        
     
        Else
        Execute = 0
        Exit Function
        End If
        End If
        If st = 0 Then sp = p
        If Not FastSymbol(b$, "{") Then
        '' this is the old like Basic For
        sw$ = b$
        ss$ = b$
          sx = p
    y1 = True
      bstack.RetStack.PushVal 0  ' RETURN LENGTH FROM END OF B$
      bstack.RetStack.PushStr w$   ' for check if is the right variable
  nd& = bstack.addlen
   slct = nd&
      GoTo contfor:
        Else
        y1 = False
        ss$ = block(b$) + "}"
        sw$ = ss$
        TraceStore bstack, nd&, b$, 1, slct  ' reusing slct variable
      
        If FastSymbol(b$, "}") Then
contfor:
        Execute = 1
        ok = False
        v = Len(b$)
        y2 = 0
If x1 = 1 Then
        Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, Once, ok) Then
                    TraceRestore bstack, nd&
                    If Execute <> 1 Then
                        
                            b$ = ss$ + b$: Exit Function
                    End If
            Else
                    TraceRestore bstack, nd&
                    If Execute = 2 And ss$ <> "" And Not ok Then
                            If y1 And ss$ = "NEXT" Then
                                    If sx = p Then
                                            If lang Then ss$ = "NEXT " + sbb$ Else ss$ = "ΕΠΌΜΕΝΟ " + sbb$
                                            If search2KIND(b$, ss$, x1, True) Then
                                                          b$ = Mid$(b$, x1 + Len(w$))
                                                          bstack.RetStack.drop 2
                                                          sp = 0
                                                          y1 = 0
                                                          v = -1
                                                        ''  Set pppp = Nothing'     '''why
                                                          GoTo AGAIN1
                                             ElseIf Not lang Then ss$ = "ΕΠΟΜΕΝΟ " + sbb$
                                                    If search2KIND(b$, ss$, x1, True) Then
                                                          b$ = Mid$(b$, x1 + Len(w$))
                                                          bstack.RetStack.drop 2
                                                          sp = 0
                                                          y1 = 0
                                                          v = -1
                                                        ''  Set pppp = Nothing'     '''why
                                                          GoTo AGAIN1
                                                    Else
                                                            Execute = 0
                                                            MyEr "Can't find " + w$, "Δεν μπορώ να βρω τo " + w$
                                                            Exit Function
                                                    End If
                                            End If
                                    End If
                                    Execute = 1: Exit Do
                            End If
                            b$ = ss$
                            Exit Function
                    End If
            End If
        
        If Not (ok Or MOUT) Or Execute = 3 Then
        Execute = 1
        ss$ = sw$
        p = p + st
        Else
        Exit Do
        End If
        If myexit(bstack) Then Execute = 1: Exit Do
        If x2 < 0 Then
        bstack.SetVar w$, MyRound(p, 10)
        Else
        var(x2) = MyRound(p, 10)
        End If
        If st > 0 Then
        If p > sp Then Exit Do
        ElseIf st < 0 Then
        If p < sp Then Exit Do
        Else
        Exit Do
        End If
        Loop
ElseIf x1 > 4 Then
On Error GoTo LONGERR
y2 = p
x1 = sp
sss = st
sp = sss
Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, Once, ok) Then
            TraceRestore bstack, nd&
            If Execute <> 1 Then
            
            b$ = ss$ + b$: Exit Function
            End If
            Else
            TraceRestore bstack, nd&
            If Execute = 2 And ss$ <> "" And Not ok Then
            If y1 And ss$ = "NEXT" Then
            If sx = p Then
            If lang Then ss$ = "NEXT " + sbb$ Else ss$ = "ΕΠΟΜΕΝΟ " + sbb$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sss = sp
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo AGAIN1
            ElseIf Not lang Then ss$ = "ΕΠΌΜΕΝΟ " + sbb$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sss = sp
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo AGAIN1
            Else
            Execute = 0
            MyEr "Can't find " + w$, "Δεν μπορώ να βρω τo " + w$
            Exit Function
            End If
            End If
            End If
            Execute = 1: Exit Do
            
            End If
            b$ = ss$
            
            Exit Function
            End If
            End If
            
            If Not (ok Or MOUT) Or Execute = 3 Then
            Execute = 1
            ss$ = sw$
            y2 = y2 + sss
        
            Else
            Exit Do
            End If
            If myexit(bstack) Then Execute = 1: Exit Do
            On Error Resume Next
            var(x2) = y2
         If st > 0 Then
            If y2 > x1 Then Exit Do
            ElseIf st < 0 Then
            If y2 < x1 Then Exit Do
            Else
            Exit Do
            End If
            Loop
On Error Resume Next
sss = sp
Else
Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, Once, ok) Then
            TraceRestore bstack, nd&
            If Execute <> 1 Then
            
            b$ = ss$ + b$: Exit Function
            End If
            Else
            TraceRestore bstack, nd&
            If Execute = 2 And ss$ <> "" And Not ok Then
            If y1 And ss$ = "NEXT" Then
            If sx = p Then
            If lang Then ss$ = "NEXT " + sbb$ Else ss$ = "ΕΠΟΜΕΝΟ " + sbb$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo AGAIN1
            ElseIf Not lang Then ss$ = "ΕΠΌΜΕΝΟ " + sbb$
                        If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo AGAIN1
            Else
            Execute = 0
            MyEr "Can't find " + w$, "Δεν μπορώ να βρω τo " + w$
            Exit Function
            End If
            End If
            End If
            Execute = 1: Exit Do
            
            End If
            b$ = ss$
            
            Exit Function
            End If
            End If
            
            If Not (ok Or MOUT) Or Execute = 3 Then
            Execute = 1
            ss$ = sw$
            p = p + st
            Else
            Exit Do
            End If
            If myexit(bstack) Then Execute = 1: Exit Do
            If x2 < 0 Then
             bstack.SetVar w$, p
            Else
            var(x2) = p
            End If
            If st > 0 Then
            If p > sp Then Exit Do
            ElseIf st < 0 Then
            If p < sp Then Exit Do
            Else
            Exit Do
            End If
            Loop
End If
        
        If Execute = 1 And y1 Then
        bstack.RetStack.drop 1
        b$ = Right$(b$, bstack.RetStack.PopVal)
        ' now NEXT is responsible to get rid the stack (else stack is flushing with bstack)
        End If
        x2 = 0  ' need to erased - because reused
        y2 = 0
        
         If MOUT Then Execute = 0: Exit Function
        ok = True
        End If
        ''' ELSE MAKE AN OTHER FOR NEXT
        
        End If
        End If
        End If
      
        Else
        v = -1
        Set pppp = Nothing
        GoTo startwithgroup


        End If
        Case 5
  

                    If neoGetArray(bstack, w$, pppp) Then

                            If NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
                             
                                    If Typename$(pppp.item(v)) = "Group" Then
startwithgroup:

                                      Execute = SpeedGroup(bstack, pppp, "FOR", w$, b$, v)
                                      If Execute = 0 Then
                                      Exit Function
                                      ElseIf Execute <> 1 And b$ <> "" Then
                                     Once = False
                                      Exit Function
                                     End If
                                        sss = Len(b$)
                                        GoTo loopagain
                     
                                    End If
                                MissingGroup
                                Else
                                NotExistArray
                            End If
                                Execute = 0
                                Exit Function
                                Else
                                
                                Execute = 0
                                Exit Function
                    End If
        
        End Select
        If Not ok Then
        Execute = 0
        Exit Function
        End If
        Case "NEXT", "ΕΠΟΜΕΝΟ"
contNext:
        If IsLabel(bstack, b$, w$) Then
        If bstack.RetStack.StackItemType(1) = "S" Then
        ss$ = bstack.RetStack.PopStr
        If ss$ <> w$ Then
         bstack.RetStack.PushStr ss$
        MyEr "Missing the right NEXT", "Έχασα το σωστό ΕΠΟΜΕΝΟ"
        Execute = 0
        Exit Function
        Else
            With bstack.RetStack
                .drop 1
                .PushVal Len(b$)
                .PushStr ss$
            End With
         End If
               Exit Function
  
        End If
        Else
              MyEr "NEXT without FOR", "ΕΠΟΜΕΝΟ χωρίς ΓΙΑ"
        Execute = 0
        Exit Function
        End If
        
        Case "INLINE", "ΕΝΘΕΣΗ"
ContInline:
               If Once = True Then Execute = 0: Exit Function
        If IsLabelSymbolNew(b$, "ΚΩΔΙΚΑ", "CODE", lang) Then
        If IsLabelDot(here$, b$, sw$) = 1 Then
                If GetSub(myUcase(sw$, True), nd&) Then
                                b$ = vbCrLf + sbf(nd&).sb & b$
                   sss = Len(b$)
                   GoTo AGAIN1
                    ElseIf GetSub(here$ + sw$, nd&) Then
                                b$ = vbCrLf + sbf(nd&).sb & b$
                   sss = Len(b$)
                        GoTo AGAIN1
                    End If
            Else
            GoTo errstat1
            End If
        Else
        If IsStrExp(bstack, b$, ss$) Then
        b$ = vbCrLf + ss$ & b$
           sss = Len(b$)
                
                GoTo AGAIN1
        End If
        End If
        Case "UPDATE", "ΕΠΙΚΑΙΡΟ"
contUpdate:
        If bstack.UseGroupname <> "" Then
        
        b$ = ": set " + Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1) + "=" + Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1) + vbCrLf + b$
             sss = Len(b$)
             Else
             MyEr "Only in a group", "Μόνο σε μια ομάδα"
             Execute = 0
             Exit Function
                End If
                GoTo AGAIN1
        Case "AFTER", "ΜΕΤΑ"
contAfter:
                 If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
               If Once = True Then Execute = 0: Exit Function
        If IsExp(bstack, b$, p) Then
        If FastSymbol(b$, "{") Then
        ss$ = block(b$) + vbCrLf & "thread this erase"
        sp = GetTaskId + 20000
        b$ = NLtrim$(Mid$(b$, 2))
            Set bs = New basetask
            bs.reflimit = bstack.reflimit
                        Set bs.Parent = bstack
         bstack.PushThread CLng(sp), "after"
        sThreadInternal bs, sp, 0, ss$, uintnew(p), here$, True
        Set bs = Nothing
       LLL = 0
       Execute = 1
       
        Else
        LLL = 0
        b$ = vbCrLf & "WAIT " & CStr(p) & ": " & b$
        Execute = 1
        End If
        End If
        
        Case "ΜΕΡΟΣ", "PART"
contPart:
                 If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If

               If Once = True Then Execute = 0: Exit Function
        Execute = 0
        If FastSymbol(b$, "{") Then
        ss$ = block(b$)
        b$ = NLtrim$(Mid$(b$, 2))  ' cut the code...
          If IsLabelSymbolNew(b$, "ΩΣ", "AS", lang) Then
          ' search for variable name only
            If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                If GetlocalVar(w$, v) Then ' exist...
                LLL = 0
                    If var(v) = 0 Then var(v) = True: b$ = vbCrLf + ss$ & vbCrLf + "let " + w$ & "=false : " & b$
                ' we have the name
                ElseIf GetVar(bstack, w$, v) Then ' exist...
                LLL = 0
                    If var(v) = 0 Then var(v) = True: b$ = vbCrLf + ss$ & vbCrLf + "let " + w$ & "=false : " & b$
                Else
                v = True
                GlobalVar w$, v, , VarStat
                LLL = 0
                b$ = vbCrLf + ss$ & vbCrLf + "let " + w$ & "=false : " & b$
                End If
                Execute = 1
                Else
            Exit Function
            End If
            Else
             Exit Function
        End If
            Else
            Exit Function
        End If

        
        Case "DO", "REPEAT", "ΕΠΑΝΑΛΑΒΕ", "ΕΠΑΝΕΛΑΒΕ"
ContRepeat:
                   If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
               If Once = True Then Execute = 0: Exit Function
        If FastSymbol(b$, "{") Then
        v = Len(b$)
                  ss$ = block(b$) + "}"
                  TraceStore bstack, x1, b$, 1, y1
                  b$ = NLtrim$(Mid$(b$, 2))
                  ok = False
                      sss = Len(b$)
                    ec$ = ss$
                 ' FIND UNTIL
                 If IsLabelSymbolNew(b$, "ΜΕΧΡΙ", "UNTIL", lang) Then
                      Execute = 1
                      TraceRestore bstack, y1
           Call executeblock(Execute, bstack, ss$, Once, ok)
           TraceRestore bstack, x1
                         If Execute = 0 Then
                            b$ = Space$(v - (Len(ec$) - Len(ss$)))  ' κόλπο για να έχω τα μηνύματα λάθους σωστά!
                            '
                            Execute = 0: Exit Function
                            ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                            
                            
                        End If
                        If Execute = 3 Then ok = False
                 If ok Or MOUT Then
                 If ok Then
                    ok = True
                    ss$ = GetNextLine(b$)  'FORGET ANY CODE TO THE RIGHT
                 Else
                     Exit Function
                 End If
                 Else
                 
                     
        sss = Len(b)
        
        w$ = b$
        If IsExp(bstack, b$, p) Then
         w$ = Left$(w$, Len(w$) - Len(b$))
        If Not p Then
        bb$ = w$
        ok = False
              Do
                 ss$ = ec$
                 w$ = bb$
                      Call executeblock(Execute, bstack, ss$, Once, ok)
                         If Execute = 0 Then
                    b$ = Space$(v - (Len(ec$) - Len(ss$)))
                 Execute = 0: Exit Function
                                      ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                            
                 End If
                  If Execute = 3 Then ok = False
                 If ok Or MOUT Then Exit Do
                          DUM = IsExp(bstack, w$, p)
          Loop Until p = True
        End If
              End If
              End If
                 Else
                 ' play always
                 If IsLabelSymbolNew(b$, "ΠΑΝΤΑ", "ALWAYS", lang) Then
                      Do
                 ss$ = ec$
                        Call executeblock(Execute, bstack, ss$, Once, ok)
                         If Execute = 0 Then
                    b$ = Space$(v - (Len(ec$) - Len(ss$)))
                 Execute = 0: Exit Function
                                             ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                 End If
                 If ok Or MOUT Then Exit Do
                  Loop
 
                 
                 
                 
                 Else
                 
                 Execute = 0
                 Exit Function
                 End If
                 End If
            End If
            
        Case "ΕΝΩ", "WHILE"
contWhile:
                   If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
               If Once = True Then Execute = 0: Exit Function
        w$ = b$
        If IsExp(bstack, b$, p) Then
         w$ = Left$(w$, Len(w$) - Len(b$))
                If p = 0 Then
                 If FastSymbol(b$, "{") Then
                 w$ = block(b$)
                 b$ = NLtrim$(b$)
           If FastSymbol(b$, "}") Then
                b$ = NLtrim(b$)
                 If b$ = "" Then Exit Function
                 GoTo AGAIN1
                 Else
                 b$ = NLtrim$(b$)
                 If b$ = "" Then Exit Function
                 GoTo AGAIN1
                 End If
                 Else
                 Exit Do
                 End If
                Else
                 If FastSymbol(b$, "{") Then
                 ss$ = block(b$) + "}"
                 TraceStore bstack, x1, b$, 1, y1
                 
                 ec$ = ss$
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
                 bb$ = w$
                         Execute = 1
                         ok = False
                 Do
                 ss$ = ec$
                 w$ = bb$

                 TraceRestore bstack, y1
           If executeblock(Execute, bstack, ss$, Once, ok) Then
              TraceRestore bstack, x1
            b$ = ss$ & b$
           Exit Function
           Else
           TraceRestore bstack, x1
            If Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                            End If
           End If
                 If Execute = 3 Then ok = False
                 If ok Or MOUT Then Exit Do
        
                 DUM = IsExp(bstack, w$, p)
                 Loop Until p = 0 Or NOEXECUTION
                 
                 If MOUT Then Execute = 0: Exit Function
                 Else
                 sss = Len(b$)
                 End If
                 
                End If
        End If
        Case "ΚΑΘΕ", "EVERY"
contEvery:
        If Once = True Then Execute = 0: Exit Function
                   If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
        If IsExp(bstack, b$, p) Then
              If p <= 0 Then
                 If FastSymbol(b$, "{") Then
                 w$ = block(b$)
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
                 Else
                 Exit Do
                 End If
                Else
                 If FastSymbol(b$, "{") Then
                 ss$ = block(b$) + "}"
                 ec$ = ss$
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
      
                         Execute = 1
                         ok = False
                ' GET A TICK HERE
                sx = p
                 p = p + uintnew(timeGetTime)
                 Do
                 ss$ = ec$
               ''''''''''  w$ = bb$
                 Call executeblock(Execute, bstack, ss$, Once, ok)
                 If Execute = 0 Then   '''Execute(bstack, ss$, ok) = 0
                            If NOEXECUTION Then
                                            b$ = "START"
                                            Execute = 1
                                            ok = True
                                            Exit Do
                            End If
                              b$ = ss$ & b$
                            Execute = 0: Exit Function
                 End If
                 If ok Or MOUT Then Exit Do
                 If p < timeGetTime Then
                 p = (sx - (uintnew(timeGetTime) - p) \ sx) + uintnew(timeGetTime)
                 End If
 
            If bstack.IamThread Then k1 = uintnew(timeGetTime + REFRESHRATE)
                If p > uintnew(timeGetTime) Then


             ProcTask2 bstack
                   While p > uintnew(timeGetTime)
         ProcTask2 bstack
                    Wend
                    End If
                   p = sx + uintnew(timeGetTime)
                 Loop
                  If NOEXECUTION Then
                b$ = "START"
                Execute = 1
                ok = True
                Exit Do
                End If
                 If MOUT Then Execute = 0: Exit Function
                 Else
                 sss = Len(b$)
                 End If
                 
                End If
        End If
        Case "ΚΥΡΙΟ.ΕΡΓΟ", "MAIN.TASK", "TASK.MAIN"
contTask:
               If Once = True Then Execute = 0: Exit Function
              If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
         Exit Do
        End If
        ' only one task main
        If taskmainonly = True Then Execute = 0: Exit Function
        taskmainonly = True
        w$ = b$
        Execute = 1
         If IsExp(bstack, b$, p) Then
         If FastSymbol(b$, "{") Then
         ss$ = block(b$)
         sp = GetTaskId + 20000
            Set bs = New basetask
            bs.reflimit = bstack.reflimit
                        Set bs.Parent = bstack
              bstack.PushThread CLng(sp), "_multi"
         sThreadInternal bs, sp, 10, ss$, uintnew(-1), here$, True
         TaskMaster.Message CLng(sp), 3, CLng(uintnew(p))
      On Error Resume Next
        bstack.TaskMain = True
                Do
                
                TaskMaster.TimerTick
               '' mydoevents1 form1
               MyDoEvents0 di
          ''     MyDoEvents2 di
                ''TaskMaster.RestEnd1
                 bstack.TaskMain = bstack.Exist(CLng(sp), "_multi") = False
                
               
             Loop Until MOUT Or bstack.TaskMain Or NOEXECUTION Or TaskMaster.QueueCount < 2
            
     bstack.TaskMain = False
   If TaskMaster.PlayMusic Then mute = True
         End If
         If FastSymbol(b$, "}") Then
         End If
         End If
         taskmainonly = False
        If MOUT Then Execute = 0: Exit Function
        
        Case "ELSE", "ΑΛΛΙΩΣ"
ContElse:
        If Once = True Then Execute = 0: Exit Function
        If IFCTRL = 0 Then
        SyntaxError
        Execute = 0
        Exit Function
        Else
                If (Not jump) Or IFCTRL = 2 Then
                 If FastSymbol(b$, "{") Then
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
                SetNextLine b$
                lbl = True
                End If
                jump = False
                Else
                lbl = False
                End If
                End If
                   IFCTRL = 0 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
            
                sss = Len(b$)
        Case "TRY", "ΔΕΣ"
ContTry:
                If IsLabelSymbolNew(b$, "ΡΕΥΜΑ", "STREAM", lang) Then
 'Debug.Print bstack.CallW
 'Debug.Print bstack.fHere
    If bstack.CallW <> "" Then
        ss$ = here$
        i = bstack.soros.Total
         here$ = bstack.fHere
        If bstack.strg Then
            If IsStrExp(bstack, (bstack.CallW), ec$) Then
                 bstack.soros.DataStr ec$
            Else
               ' Stop
            End If
        Else
       
            If IsExp(bstack, (bstack.CallW), p) Then
               bstack.soros.DataVal p
            Else
          '      Stop
            End If
        End If
        
        here$ = ss$
        End If
      GoTo loopagain
      
      
                End If
               
               
               
               If Once = True Then Execute = 0: Exit Function
                 If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, Once, False)
        bstack.nokillvars = False
         Exit Do
        End If
        ' ΜΕΤΑΒΛΗΤΗ
        i = Abs(IsLabel(bstack, b$, w$))
        
        Select Case i
        Case 0  ' new
          If FastSymbol(b$, "{") Then
  
         Execute = 1
         ss$ = "{" + block(b$) + "}"
        
            
            
       TraceStore bstack, x1, b$, 1
         
         b$ = NLtrim$(Mid$(b$, 2))
                On Error Resume Next
                     Call executeblock(Execute, bstack, ss$, Once, ok)
          TraceRestore bstack, x1
   bstack.nokillvars = False
         Once = False
         NOEXECUTION = False
         NERR = False
         LastErNum = 0
         If LastErName <> "" Then LastErName = Chr(0) + LastErName
         If LastErNameGR <> "" Then LastErNameGR = Chr(0) + LastErNameGR
            Execute = 1
         End If
        
        
        Case 1, 4
        If FastSymbol(b$, "{") Then
        p = 0
         If Not GetlocalVar(w$, v) Then
         If Not GetVar(bstack, w$, v) Then
         v = GlobalVar(w$, p, , VarStat) '': GetlocalVar W$, v
         End If
         End If
         Execute = 1
         ss$ = "{" & block(b$) & "}"
          b$ = NLtrim$(Mid$(b$, 2))
                     Call executeblock(Execute, bstack, ss$, Once, ok)
     var(v) = Execute = 1
                 
         NOEXECUTION = False
         NERR = False
         LastErNum = 0
         End If
         Execute = 1
        End Select
        If MOUT Then Execute = 0: Exit Function
        Execute = 1
         Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
contElseIf:
        If Once = True Then Execute = 0: Exit Function
        If IFCTRL = 0 Then
        SyntaxError
        Else
        
         If (Not jump) Or IFCTRL = 2 Then
         ' LOOK AHEAD...DO NOT PLAY THE LOGICAL EXPRESSION
         IFCTRL = 1
         ss$ = aheadstatus(b$, False, IFCTRL)
         b$ = Mid$(b$, IFCTRL)
                   If FastSymbol(b$, "{") Then
               w$ = block(b$)
             b$ = NLtrim$(Mid$(b$, 2))
              Else
                SetNextLine b$
                lbl = True
                End If
               jump = False
          
        Else   ' ONLY FOR NOT JUMP
        If IsExp(bstack, b$, p) Then
        IFCTRL = 1
        jump = (p = 0)
        Select Case Abs(IsLabel(bstack, b$, w$))  ' now w$ is Ucase
            Case 1
            Select Case w$
                Case "THEN", "ΤΟΤΕ"
                'If VarStat Or NewStat Then GoTo errstat
                       If Once = True Then Execute = 0: Exit Function
                             If jump Then
                    If FastSymbol(b$, "{") Then
                    w$ = block(b$)
                    b$ = NLtrim$(Mid$(b$, 2))
                    
                    Else
                    SetNextLine b$
                    lbl = True
                    End If
                    Else
                    IFCTRL = 2 ' NONEED ANYTHING BUT NOT ERROR FOR IF.ELSE AND ELSE
              End If
                
               Case "ELSE", "ΑΛΛΙΩΣ"
              ' If VarStat Or NewStat Then GoTo errstat
                      If Once = True Then Execute = 0: Exit Function
                   '  IFCTRL = 1
                If Not jump Then      ' JUMP FALSE SKIP ELSE
                If FastSymbol(b$, "{") Then
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
                 SetNextLine b$
                lbl = True
                End If
                IFCTRL = 0 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
                End If
                sss = Len(b$)
                            Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
                            
                          '  If VarStat Or NewStat Then GoTo errstat
                                   If Once = True Then Execute = 0: Exit Function
                   '  IFCTRL = 1
                b$ = w$ & b$
                     
            Case Else
           
           Execute = 0
           Exit Function
            End Select
           Case Else
           Execute = 0
           Exit Function
        End Select
        Else
        ' error
        Execute = 0
         Exit Function
        End If
                End If
                End If
        sss = Len(b$)
        
        Case "IF", "ΑΝ"
contif:
        If IsExp(bstack, b$, p) Then
          IFCTRL = 1           ' NEED THEN OR ELSE OR ELSE.IF
        jump = (p = 0)                    ' JUMP TRUE GOTO ELSE
        Select Case Abs(IsLabel(bstack, b$, w$))
            Case 1
            Select Case w$
                Case "THEN", "ΤΟΤΕ"
              '  If VarStat Or NewStat Then GoTo errstat
                If jump Then
                    If FastSymbol(b$, "{") Then
                     If Once = True Then Execute = 0: Exit Function
                    w$ = block(b$)
                    b$ = NLtrim$(Mid$(b$, 2))
                    
                    Else
                    If Once Then
                    w$ = GetStrUntil(vbCrLf, b$, False)
                    Exit Function
                    Else
                    SetNextLine b$
                    lbl = True
                    End If
                   
                    End If
                    
                    Else
                    
                    IFCTRL = 2 ' NONEED ANYTHING BUT NOT ERROR FOR IF.ELSE AND ELSE
                    If Once Then
                    sss = Len(b$): GoTo AGAIN1
           
                    End If
              End If
        
                
                Case "ELSE", "ΑΛΛΙΩΣ"
               ' If VarStat Or NewStat Then GoTo errstat
                   '  IFCTRL = 1
                If Not jump Then      ' JUMP FALSE SKIP ELSE
                If FastSymbol(b$, "{") Then
                 If Once = True Then Execute = 0: Exit Function
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
                 SetNextLine b$
                lbl = True
                End If
                IFCTRL = 0 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
                End If
                sss = Len(b$)
                            Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
                          '  If VarStat Or NewStat Then GoTo errstat
                          
                   '  IFCTRL = 1
                b$ = w$ & b$
                
           Case Else
           
           Execute = 0
           Exit Function
            End Select
           Case Else
           Execute = 0
           Exit Function
        End Select
        Else
        ' error
        If LastErNum = -2 Then
        Execute bstack, b$, True

        Else
        MissNumExpr
       
         End If
          Execute = 0
         Exit Function
        End If
        sss = Len(b$)
        Case "SELECT", "ΕΠΕΛΕΞΕ", "ΕΠΙΛΕΞΕ"  '*************************************** SELECT CASE
contSelect:
         If Once = True Then Execute = 0: Exit Function
        x1 = 0 ' mode numbers using p, sp and st
                ' x1=2 using sw$ w$ ss$
                Us$ = ""
            If IsLabelSymbolNew(b$, "ΜΕ", "CASE", lang) Then
                        If IsExp(bstack, b$, sp) Then
                        x1 = 1
                        ElseIf IsStrExp(bstack, b$, sw$) Then
                        x1 = 2
                        End If
                    If x1 > 0 Then ' SELECT CASE NUMBER or STRING
                        SetNextLine b$
                    slct = 1
                        Do
                        If NocharsInLine(b$) Then Exit Do
                                If IsLabelSymbolNew(b$, "ΜΕ", "CASE", lang) Then  ' WE HAVE CASE
                                If slct > 0 Then         ' WE ARE IN SEARCH
                                Do
                                ' εδώ κοιτάμε τα CASE
                                x2 = 0
                                If x1 = 1 Then
                                If IsExp(bstack, b$, p) Then x2 = 1
                                Else
                                If IsStrExp(bstack, b$, w$) Then x2 = 2
                                End If
                                       If x2 > 0 Then 'WE HAVE NUMBER OR STRING
                                            If IsLabelSymbolNew(b$, "ΕΩΣ", "TO", lang) Then   ' range ?
                                            y1 = 0
                                               If x1 = 1 Then
                                                    If IsExp(bstack, b$, st) Then y1 = 1

                                                Else
                                                    If IsStrExp(bstack, b$, ss$) Then y1 = 2
                                                End If
                                                If y1 > 0 Then
                                                y2 = 0
                                                   If x1 = 1 Then
                                                    If (sp >= p And sp <= st) Then y2 = 1

                                                Else
                                                    If sw$ >= w$ And sw$ <= ss$ Then y2 = 2
                                                End If
                                                    If y2 > 0 Or slct = -1 Then 'slct=-1 from break
                                                   If slct = 1 Then slct = 0   ' slct=0 we found
                                                        SetNextLine b$
                                                         v = Len(b$)  ' for the error system shift+f1 jumps to error
                                                        If FastSymbol(b$, "{") Then  ' block
                                                            v = Len(b$)
                                                            ss$ = block(b$)
                                                            DUM = False
                                                            i = 1
                                                             Call executeblock(i, bstack, ss$, False, DUM)
                                                              b$ = ss$ & b$
                                                            If i = 0 Then
                                                               
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 2 Then  ' break
                                                                If DUM = True And b$ <> "" Then slct = -1
                                                            ElseIf i = 3 Then  ' continue
                                                                If DUM = True And b$ <> "" Then slct = 0 ' we found leave structure
                                                            End If
                                                        Else
                                                        DUM = True
                                
                                                            i = 1
                             
                                                             Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Then
                                                                b$ = Space$(v)
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 1 And b$ = "" Then 'this is an exit ΟΚ2
                                                          
                                                            Execute = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                                   
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                        Execute = i
                                                                         Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0
                                                            End If
        
                                                        End If
                
                                                        
                                                        Exit Do
                                                    End If
                                                Else
                                                    Execute = 0
                                                    Exit Function
                                                End If
                                            Else
                                            ' NO WE HAVE ONE VALUE...X1 MASTER, X2 ONE VALUE  Y2 FOR LAST CHECK
                                            y2 = 0
                                                   If x1 = 1 Then
                                                    If sp = p Then y2 = 1

                                                Else
                                                    If w$ = sw$ Then y2 = 2
                                                End If
                                                If y2 > 0 Or slct = -1 Then ' ONE VALUE
                                                 If slct = 1 Then slct = 0
                                                    SetNextLine b$
                                                         v = Len(b$)
                                                        If FastSymbol(b$, "{") Then  ' block
                                                          v = Len(b$)
                                                          ss$ = block(b$)
                                                            DUM = False
                                                            i = 1
                                                            Call executeblock(i, bstack, ss$, False, DUM)
                                                            b$ = ss$ & b$
                                                            If i = 0 Then
                                                         
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                If DUM = True And b$ <> "" Then slct = -1
                                                            ElseIf i = 3 Then
                                                               If DUM = True And b$ <> "" Then slct = 0
                                                            End If
                                                        Else   ' or line
                                                            DUM = True
                                                        
                                                            i = 1
                                                            Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Then
                                                                b$ = Space$(v)
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 1 And b$ = "" Then 'this is an exit ΟΚ3
                                                           '' B$ = ss$
                                                            Execute = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                                       
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                        Execute = i
                                                                         Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                           ''     If DUM = True And B$ <> "" Then slct = 0: B$ = GetNextLine(ss$) 'ok
                                                                If DUM = True And b$ <> "" Then slct = 0  '': B$ = GetNextLine(ss$) 'ok
                                                            End If
                                                       'ΟΚ
                                                        End If
                                                        Exit Do
                                                End If
                                            End If
                                        Else
                                     
                                     
                                                    If x1 = 1 Then
                                                    b$ = Str$(sp) & " " & b$
                                                
                                                Else
                                                ' HERE............................IS A PROBLEM IF SW$ HAS <3 ASCII CODE
                                                b$ = Sput(sw$) + b$
                                                
                                              
                                                End If
                                        
                                        If IsExp(bstack, b$, p) Then
                                            If p <> 0 Or slct = -1 Then
                                             If slct = 1 Then slct = 0
                                                        SetNextLine b$
                                                         v = Len(b$)
                                                        If FastSymbol(b$, "{") Then  ' block
                                                          v = Len(b$)
                                                            ss$ = block(b$)
                                                            DUM = False
                                                            i = 1
                                               Call executeblock(i, bstack, ss$, False, DUM)
                                                         b$ = ss$ & b$
                                                            If i = 0 Then
                                                            
                                                            Execute = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                If DUM = True And b$ <> "" Then slct = -1
                                                            ElseIf i = 3 Then
                                                              If DUM = True And b$ <> "" Then slct = 0
                                                            End If
                                                        Else
                                                          DUM = True
                                                  
                                                            i = 1
                                                            Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Then
                                                                b$ = Space$(v)
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 1 And b$ = "" Then  'this is an exit  ΟΚ1
                            
                                                            Execute = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                           
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                            Execute = i
                                                                            Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0
                                                            End If
        
                                                        End If
                
                                                        
                                                        Exit Do
                                            End If
                                        Else
                                        Execute = 0
                                        Exit Function
                                        End If
                                        End If
                                    Loop While FastSymbol(b$, ",")
                                     End If
                                SetNextLine b$
        
                                ' drop case
        
                                If IsLabelSymbolNew(b$, "ΜΕ", "CASE", lang, , , True) Then
                               
                                ElseIf IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", lang, , , True) Then
                            
                                ElseIf IsLabelSymbolNew(b$, "ΤΕΛΟΣ", "END", lang, , , True) Then
                             
                                Else
                                         v = Len(b$)
                                    If FastSymbol(b$, "{") Then
                                           If slct >= 0 Then
                                                    ss$ = block(b$) + "}"
                                                    b$ = NLtrim$(Mid$(b$, 2))
                                            Else
                                                    v = Len(b$)
                                                    ss$ = block(b$)
                                                    DUM = False
                                                    i = 1
                                                            Call executeblock(i, bstack, ss$, False, DUM)

                                                    b$ = ss$ & b$
                                                    If i = 0 Then
                                                       
                                                        Execute = 0: Exit Function
                                                    ElseIf i = 2 Then
                                                            If DUM = True And b$ <> "" Then slct = -1
                                                   
                                                     ElseIf i = 3 Then
                                                            If DUM = True And b$ <> "" Then slct = 0

                                                     End If
                                                            
                                            End If
                                     
                                        SetNextLine b$
                                      ElseIf slct < 0 Then
                                                        DUM = True
                                                   
                                                            i = 1
                                                            Call executeblock(i, bstack, b$, True, DUM)
                        
                                                            If i = 0 Then   ' where is exit
                                                                b$ = Space$(v)
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                    
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                            Execute = i
                                                                            Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0: b$ = GetNextLine(ss$)
                                                            End If
        
                                    SetNextLine b$
                                    Else
                                    SetNextLine b$
                                
                                        End If
                                    
                                End If
                                
                                ElseIf IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", lang) Then
                                    SetNextLine b$
                                    v = Len(b$)
                                    If FastSymbol(b$, "{") Then
                                    v = Len(b$)
                                        ss$ = block(b$)
                                        b$ = NLtrim$(Mid$(b$, 2))
                                        If slct > 0 Then
                                                    v = Len(b$)
                                                    DUM = False
                                                    i = 1
                                                       Call executeblock(i, bstack, ss$, False, DUM)
                              b$ = ss$ & b$
                                                                 If i = 0 Then
                                                        
                                                        Execute = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                            Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0: b$ = GetNextLine(ss$)
                                                            End If
                                        End If
                                    Else
                                    If slct > 0 Then
                                                                       DUM = True
                                             
                                                            i = 1
                                                            Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Then
                                                                b$ = Space$(v)
                                                                Execute = 0: Exit Function
                                                            ElseIf i = 1 And b$ = "" Then 'this is an exit
                                             
                                                            Execute = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                              
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            Execute = 2
                                                                            Once = False
                                                                             Exit Function
                                                                          Else
                                                                          Execute = i
                                                                            Once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                    If DUM = True And b$ <> "" Then slct = 0
                                              End If
                                    End If
                                End If
                                SetNextLine b$
                                slct = 0
                        ElseIf IsLabelSymbolNew(b$, "ΤΕΛΟΣ", "END", lang) Then
                            If IsLabelSymbolNew(b$, "ΕΠΙΛΟΓΗΣ", "SELECT", lang) Then
                                slct = 0
                                Exit Do
                            Else
                                Execute = 0
                                Exit Function
                            End If
                        Else
                             b$ = Space$(v)
                            Execute = 0
                            Exit Function
                        End If
  
                        Loop
                        If slct > 0 Then
                        b$ = Space$(v)
                        Execute = 0: Exit Function
                        End If
                        
                    '-----------ENDIF ---------------
                       Else
                        Execute = 0
                        Exit Function
                    End If
        Else
           Execute = 0
           Exit Function
        End If
      sss = Len(b$)
        Case "ΑΠΟ", "ON"                 '************************************* ON NUMBER GOTO LABELS
ContOn:
        If IsExp(bstack, b$, p) Then
        y1 = IsLabelSymbolNew(b$, "ΠΡΟΣ", "GOTO", lang)
        y2 = False
        If Not y1 Then
        y1 = IsLabelSymbolNew(b$, "ΔΙΑΜΕΣΟΥ", "GOSUB", lang, True)
        y2 = True
        End If
            If y1 Then
                p = CLng(p)
                If p <= 0 Then ' no exit
                SetNextLine b$
                If Execute <> 2 Then Execute = 1 Else Execute = 3
            b$ = ""
           Once = True
           Exit Function
          '' SetNextLine B$
                '' sss = Len(B$)
               ''  lbl = True
                
                Else
                w$ = ""
                i = 0
                Do
                i = 1
                 x1 = Abs(IsLabelOnly(b$, w$))
                    If x1 = 0 Then
                    If Not IsNumberLabel(b$, w$) Then p = 1000: Exit Do
                    
                    ElseIf x1 > 1 Then
                        p = 1000
                        Exit Do
                    End If
                    i = 0
                    p = p - 1
                    If Not FastSymbol(b$, ",") Then Exit Do
                    
                Loop Until p = 0
                If p <> 0 Then
                
                If i = 0 Then
                Execute = 1: w$ = GetNextLine$(b$): sss = Len(b$):
                End If
                w$ = ""
                'Exit Do
                Else
                If i > 0 Then
                MyEr "Missing label/Number line", "Λείπει Ετικέτα/Αριθμός γραμμής"
                sss = LLL
                  Execute = 0
                Exit Function
                Else
                If y2 Then
                If bstack.SubLevel > deep And deep <> 0 Then
' GO BACK TO FIRST CALL
If bstack.RetStackTotal >= 9 * deep Then
             MyEr "No more " + CStr(deep) + " levels gosub allowed", "Δεν επιτρέπονται πάνω από " + CStr(deep) + " επίπεδα για εντολή ΔΙΑΜΕΣΟΥ"

             Execute = 0
             Exit Function

            
Else
bstack.RetStack.drop bstack.RetStackTotal
 End If
  MyEr "Internal Error", "Εσωτερικό Λάθος"
 NOEXECUTION = True
 Execute = 0
Exit Function
 
End If
               
               If p = 1000 Then Exit Function
                SetNextLine b$
               If x1 = 1 Then
               i = 1
               GoTo contHereFromOn
               Else
               GoTo contHere2FromOn
               End If
               
                
                End If
                b$ = w$
                Execute = 2
                Exit Function
                End If
                End If
                End If
            Else
              sss = LLL
            End If
        Else
            MissParam b$
            Execute = 0
            Exit Function
        End If
          
        Case "SUB", "ΡΟΥΤΙΝΑ"
contSub:
           If Once = True Then Execute = 0: Exit Function
   If Execute <> 2 Then
              b$ = w$
           Once = True
           Execute = 3
         
           Else
           b$ = ""
           
        End If
           Exit Function
        Case "GOSUB", "ΔΙΑΜΕΣΟΥ"
autogosub:

If myexit(bstack) Then Execute = 1: Exit Function

If bstack.SubLevel > deep And deep <> 0 Then
' GO BACK TO FIRST CALL
If bstack.RetStackTotal >= 9 * deep Then
             MyEr "No more " + CStr(deep) + " levels gosub allowed", "Δεν επιτρέπονται πάνω από " + CStr(deep) + " επίπεδα για εντολή ΔΙΑΜΕΣΟΥ"

             Execute = 0
             Exit Function

            
Else
bstack.RetStack.drop bstack.RetStackTotal
 End If
  MyEr "Internal Error", "Εσωτερικό Λάθος"
 NOEXECUTION = True
 Execute = 0
Exit Function
 
End If
        i = Abs(IsLabelOnly(b$, w$))
contHereFromOn:
                If i = 5 Then
                Once = False
                
                PushParamGeneral bstack, b$
                If FastSymbol(b$, ")") Then
                
                 PushStage bstack, False
                bstack.RetStack.PushVal Len(b$)
                 
                If lang Then
                bstack.RetStack.PushStr "SUB " + w$
                Else
                bstack.RetStack.PushStr "ΡΟΥΤΙΝΑ " + w$
                End If
                    b$ = Chr$(0)
                    '' here is the fault...execute 2 means loop...
                    '' it is known only here...
                    loopthis = Execute = 2
                    Execute = 2
                  Exit Function
                Else
                MissSymbol b$, ")"
                Execute = 0
                Exit Function
                End If
                ElseIf i = 1 Then
                Once = False
        
                PushStage bstack, True
                bstack.RetStack.PushVal Len(b$)
                bstack.RetStack.PushStr "S " + w$
                b$ = Chr$(0)

                Execute = 2
                Exit Function
                ElseIf i = 0 Then
                
                If IsNumberLabel(b$, w$) Then
contHere2FromOn:
                      Once = False
                              PushStage bstack, True  ' CORRECT FROM REV 45 - VER 8
                      bstack.RetStack.PushVal Len(b$)
                     bstack.RetStack.PushStr "* " + w$
                b$ = Chr$(0)
                
                Execute = 2
                Exit Function
                Else
                 b$ = w$ & b$
                End If
                Else
                b$ = w$ & b$
                
                Exit Do
                End If
        Case "GOTO", "ΠΡΟΣ"               '**************************************** This is the GOTO statement
ContGoto:
        If myexit(bstack) Then Execute = 1: Exit Function
        If Trim$(b$) = "" Or FastSymbol(b$, ":") Then
                Execute = 0
                MyEr "No Label or Number in GOTO", "Χωρίς όνομα ή αριθμό η ΠΡΟΣ"
                Exit Function
        Else
        i = Abs(IsLabelOnly(b$, w$))
                If i = 1 Then
                Once = False
                b$ = w$
                Execute = 2
                Exit Function
                ElseIf i = 0 Then
                If IsNumberLabel(b$, w$) Then
                      Once = False
                b$ = w$
                Execute = 2
                Exit Function
                Else
                 b$ = w$ & b$
                End If
                Else
                b$ = w$ & b$
                
                Exit Do
                End If
              End If
              Case "LOCAL", "ΤΟΠΙΚΑ", "ΤΟΠΙΚΗ", "ΤΟΠΙΚΕΣ"
contNegLocal:
                    NewStat = True
                    sss = Len(b$)
                GoTo AGAIN1
                
                Case "GLOBAL", "ΓΕΝΙΚΟ", "ΓΕΝΙΚΗ", "ΓΕΝΙΚΕΣ"
contNegGlobal:
                If NewStat Then MyEr "Global and local together;", "Γενική και τοπική μαζί!": Execute = 0: Exit Function
                If Not VarStat Then
             
                If IsLabelSymbolNew(b$, "ΟΜΑΔΑ", "GROUP", lang) Then
               If Not ProcGroup(1, bstack, b$, lang) Then Execute = 0: Exit Function
               ElseIf IsLabelSymbolNew(b$, "ΓΕΓΟΝΟΣ", "EVENT", lang) Then
                If Not GlobalEVENT(bstack, b$, lang) Then Execute = 0: Exit Function
                ElseIf IsLabelSymbolNew(b$, "ΚΑΤΑΣΤΑΣΗ", "INVENTORY", lang) Then
                If Not GlobalHandler(bstack, b$, lang, 1) Then Execute = 0: Exit Function
                ElseIf IsLabelSymbolNew(b$, "ΔΙΑΡΘΡΩΣΗ", "BUFFER", lang) Then
                If Not GlobalHandler(bstack, b$, lang, 2) Then Execute = 0: Exit Function
               End If
                Else
                End If
                VarStat = True
                sss = Len(b$)
                
                GoTo AGAIN1
                

        Case Else
If Not NoOptimum Then
    If Not iscom Then GoTo parsecommand
Else
iscom = False
End If

varonly:


        If Len(w$) > 3 Then
            
            If lang = 1 Then
            If Left$(w$, 4) = "THIS" Then
            ss$ = ".DELETEME"
                    If IsLabel(bstack, ss$, bb$) < 0 Then
                            If Len(bb$) = 8 Then Execute = 0: Exit Function
                    w$ = Left$(bb$, Len(bb$) - 9) + Mid$(w$, 5)
                    End If
            End If
            Else
            If Left$(w$, 4) = "ΑΥΤΟ" Then
            ss$ = ".DELETEME"
            If IsLabel(bstack, ss$, bb$) < 0 Then
                    If Len(bb$) = 8 Then Execute = 0: Exit Function
            w$ = Left$(bb$, Len(bb$) - 9) + Mid$(w$, 5)
            End If
            End If
        End If
    End If
     If FastSymbol(b$, "=") Then
     
            If Not VarStat Then
              If GetlocalVar(w$, v) And Not NewStat Then
   
                        If IsExp(bstack, b$, p) Then
                        
                        If Typename$(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, ss$) Then
                        var(v).index = ss$: ss$ = ""
                        End If
                         var(v).UseIndex = True
                        End If
                        
                        var(v).Value = p
                        
                        ElseIf Typename$(var(v)) = "Group" Then            '' Group 2 Group
                        If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                  Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                    
                                       ss$ = bstack.GroupName
                                      If Len(var(v).GroupName) > Len(w$) Then
                                        
                                        UnFloatGroupReWriteVars bstack, w$, v, myobject
                          
                                        Else
                                        bstack.GroupName = Left$(w$, Len(w$) - Len(var(v).GroupName) + 1)
                                        w$ = Left$(var(v).GroupName, Len(var(v).GroupName) - 1)
                                          UnFloatGroupReWriteVars bstack, w$, v, myobject
                                        End If
                                   Set myobject = Nothing
                                        bstack.GroupName = ss$

                             
                                Else
                                '' maybe a block of itemd''
                                
                                  Execute = 0
                                End If
                        Else  '' make an upgrade
                                Execute = 0

                        End If
                        ElseIf Typename$(var(v)) = "mHandler" Then
                        If var(v).ReadOnly Then
                        MyEr "Read Only", "Μόνο για ανάγνωση"
                        Execute = 0: Exit Function
                        End If
                        If bstack.lastobj Is Nothing Then
                         MyEr "Missing Object", "Δεν βρήκα αντικείμενο"
                        Execute = 0: Exit Function
                        ElseIf Typename(bstack.lastobj) = "mHandler" Then
                            bstack.lastobj.CopyTo myobject
                                                               If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                            
                            Set var(v) = myobject
                        Else
                         Set myobject = var(v)
                         myobject.T1 = 0
                         Set myobject.objref = bstack.lastobj
                        End If
                        Set bstack.lastobj = Nothing
                        Set myobject = Nothing
                        
                        Else
                        If Typename(var(v)) = "Long" Then
                                If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        UnFloatGroup bstack, w$, v, myobject  ' global??
                                        Set myobject = Nothing
                                Else
                                        Execute = 0
                                End If
                                Else
                                    var(v) = CLng(p)
                                End If
                        Else
                                If Not bstack.lastobj Is Nothing Then
                                    If TypeOf bstack.lastobj Is Group Then
                                            Set myobject = bstack.lastobj
                                            Set bstack.lastobj = Nothing
                                            UnFloatGroup bstack, w$, v, myobject  ' global??
                                            Set myobject = Nothing
                                    ElseIf TypeOf bstack.lastobj Is lambda Then
                                            Set var(v) = bstack.lastobj
                                            Set bstack.lastobj = Nothing
                                    Else
                                             var(v) = 0
                                    End If
                                Else

                                 var(v) = p
                                                 
                    End If
                            End If
                        End If
                        End If
                ElseIf Not bstack.StaticCollection Is Nothing Then
                If bstack.ExistVar(w$) Then
                If NewStat Then
                
                MyEr "Only Static needed", "Μόνο το αναγνωριστικό Στατική χρειάζεται"
                    Execute = 0: Exit Function
                End If
                If IsExp(bstack, b$, p) Then bstack.SetVar w$, p Else GoTo aproblem1
                ElseIf IsExp(bstack, b$, p) Then
                GoTo cont5689
                End If

                ElseIf IsExp(bstack, b$, p) Then
cont5689:
                            If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                        If NewStat Then
                                            MyEr "No New statement for groups", "Όχι δήλωση νέου για ομάδες"
                                            Exit Function
                                        Else
                                            If Not GetVar(bstack, w$, x1, True) Then x1 = GlobalVar(w$, p, , VarStat)
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                            If Typename(var(x1)) = "Group" Then
                                            ''crosscopy - look if we have  a float group
                                            
                                            UnFloatGroupReWriteVars bstack, w$, x1, myobject
                                            Else

                                                UnFloatGroup bstack, w$, x1, myobject   ' global??
                                                Set myobject = Nothing
                                          
                                            End If
                                            ''I have to recreate all items...As names.
                                            ''  Also Functions / Modules and
                                            
                                            
                                        End If
                                        
                                ElseIf TypeOf bstack.lastobj Is mEvent Then
                                If NewStat Then
                                            MyEr "No New statement for events", "Όχι δήλωση νέου για γεγονότα"
                                            Exit Function
                                        Else
                                            If Not GetVar(bstack, w$, x1, True) Then x1 = GlobalVar(w$, p, , VarStat)
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                          Set var(x1) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
                                ElseIf TypeOf bstack.lastobj Is lambda Then
                                If NewStat Then
                                            MyEr "No New statement for lambda", "Όχι δήλωση νέου για λαμδα"
                                            Exit Function
                                        Else
                                            If Not GetVar(bstack, w$, x1, True) Then x1 = GlobalVar(w$, p, , VarStat)
                                            If here$ = "" Or VarStat Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(x1)
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & CStr(x1)
                                            End If
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                          Set var(x1) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
                                ElseIf Typename(bstack.lastobj) = "mHandler" Then
                                 If NewStat Then
                                 If bstack.lastobj.T1 = 1 Then
                                            MyEr "No New statement for inventory", "Όχι δήλωση νέου για κατάσταση"
                                            Else
                                            MyEr "No New statement for buffer", "Όχι δήλωση νέου για Διάρθρωση"
                                            End If
                                            Exit Function
                                        Else
                                            If Not GetVar(bstack, w$, x1, True) Then x1 = GlobalVar(w$, p, , VarStat)
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        If myobject.Indirect > -1 Then
                                          Set var(x1) = var(myobject.Indirect)
                                        Else
                                          Set var(x1) = myobject
                                          End If
                                                Set myobject = Nothing
                                           
                                            
                                        End If
                                Else
                                
                                SyntaxError
                                  End If
                             Else
                   
                                GlobalVar w$, p, , VarStat
                           
                            End If
                    Else
                    ' error in execute ?
                   If LastErNum <> -2 Then
                   NoValueForvariable w$
                    Execute = 0
                     Exit Function
                                       
                     End If
                     
                End If
                ElseIf IsExp(bstack, b$, p) Then
                    GlobalVar w$, p, , VarStat
                    Else
                    ' error in execute ?
                   If LastErNum <> -2 Then
                   NoValueForvariable w$
                    Execute = 0
                     Exit Function
                          ElseIf Once Then
                MyEr "Need a Number or Object", "Χρειάζομαι έναν αριμθό ή ένα αντικείμενο"
                     End If
          
                End If
               
        Else
        If VarStat Or NewStat Then
        p = 0
            GlobalVar w$, p, , VarStat
          '   If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
                    sss = Len(b$)
                GoTo contVarNew
        End If
        
        
        ss$ = ""
        
         If MaybeIsSymbol(b$, "-+*/<~") Then
            If IsOperator(b$, "--", 2) Then
                ss$ = "--"
            ElseIf IsOperator(b$, "-!", 2) Then
                ss$ = "-!"
            ElseIf IsOperator(b$, "~") Then
                ss$ = "!!"
            ElseIf IsOperator(b$, "++", 2) Then
                ss$ = "++"
            ElseIf FastSymbol(b$, "+=", , 2) Then
                ss$ = "+"
            ElseIf FastSymbol(b$, "/=", , 2) Then
                ss$ = "/"
            ElseIf FastSymbol(b$, "-=", , 2) Then
                ss$ = "-"
            ElseIf FastSymbol(b$, "*=", , 2) Then
                ss$ = "*"
            ElseIf FastSymbol(b$, "<=", , 2) Then
                ss$ = "g"
            Else
            GoTo parsecommand
            End If
again123456:
        If GetVar(bstack, w$, v, ss$ = "g") Then
  
        If Len(ss$) = 1 Then
                    If IsExp(bstack, b$, p) Then
                        '    On Error Resume Next
                        If Typename(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, ss$) Then
                        var(v).index = ss$: ss$ = ""
                        End If
                         var(v).UseIndex = True
                        End If
                        var(v).Value = p
                        ElseIf Typename(var(v)) = "Group" Then
                            Select Case ss$
                                Case "g"
                                  If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                  Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                             ss$ = here$
                                  here$ = ""
                                    UnFloatGroupReWriteVars basestack1, w$, v, myobject
                                    here$ = ss$

                             
                                Else

                                  Execute = 0
                                End If
                        Else  '' make an upgrade
                                Execute = 0

                        End If
                            Case "="
                                  If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                  Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                    ss$ = bstack.UseGroupname
                                      bstack.UseGroupname = var(v).GroupName
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
                                    bstack.UseGroupname = ss$
                             
                                Else
                              
                                  Execute = 0
                                End If
                        Else
                                Execute = 0

                        End If
                                Case Else
                                Execute = 0
                                Exit Do
                             End Select
                             
                            ElseIf VarType(var(v)) = vbLong Then
                               Select Case ss$
                                Case "=", "g"
                                   If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is Group Then
                                  Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        UnFloatGroup bstack, w$, v, myobject
                                        Set myobject = Nothing
                                    ElseIf TypeOf bstack.lastobj Is lambda Then
                                GoTo contlambda
                                   Else
                                   MissNumExpr
                                   Execute = 0
                                   End If
                                
                                   Else
                                var(v) = CLng(p)
                                End If
                                      Case "+"
                                var(v) = CLng(p) + var(v)
                                Case "*"
                                 var(v) = CLng(p) * var(v)
                                Case "-"
                                var(v) = var(v) - CLng(p)
                                Case "/"
                                If p = 0 Then
                                   Execute = 0
                                   Exit Do
                                End If
                                ' only for long
                                 var(v) = var(v) \ CLng(p)
                               Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            
                            ElseIf Not bstack.lastobj Is Nothing Then
                             If TypeOf bstack.lastobj Is lambda Then
contlambda:
                                Set var(v) = bstack.lastobj
                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(v)
                                Set bstack.lastobj = Nothing
                                Else
                                BadObjectDecl
                                   Execute = 0
                                   Exit Function
                            End If
                            Else
                            Select Case ss$
                                Case "=", "g"
                                var(v) = p
                                Case "+"
                                var(v) = p + var(v)
                                Case "*"
                                 var(v) = p * var(v)
                                Case "-"
                                var(v) = var(v) - p
                                Case "/"
                                If p = 0 Then
                                   Execute = 0
                                   Exit Do
                                End If
                                 var(v) = var(v) / p
                                         Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                                 End Select
                                  var(v) = MyRound(var(v), 13)
                            End If
                         
                            If Err.Number = 6 Then
                                Exit Do   'why ?
                          
                                             
                               End If
                               On Error GoTo 0
                    Else
        
                        If LastErNum <> -2 Then
                         NoValueForvariable w$
                         Execute = 0
                          Exit Do
                    
      
                    End If
              End If
        Else
        If ss$ = "++" Then
        var(v) = 1 + var(v)
        ElseIf ss$ = "--" Then
        var(v) = var(v) - 1
             ElseIf ss$ = "-!" Then
                    var(v) = -var(v)
                Else
                          var(v) = -1 - (var(v) <> 0)
        End If
     
        End If
        GoTo loopcontinue
        Else
        If v = -1 Then
         If Len(ss$) = 1 Then If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
                    
             If Not bstack.AlterVar(w$, p, ss$, False) Then Execute = 0: Exit Function
            GoTo loopcontinue
        Else
         If ss$ = "g" Then ss$ = "=":   GoTo again123456
        MyEr "", ""
        b$ = w$ + b$
        MyErMacro b$, "No such variable", "Δεν υπάρχει τέτοια μεταβλητή"
        sss = LLL
            End If
        End If


        Else
parsecommand:
            'If VarStat Or NewStat Then GoTo errstat
            
               If Not Identifier(bstack, w$, b$, iscom, lang) Then
conthere111:
               If LastErNum1 = -1 And bstack.IamThread Then Execute = 1 Else Execute = 0
               Exit Function
               Else
               iscom = False
   
            
conthere222:
          If bstack.connectnow Then
            ohere$ = here$
           ' ConnectStatic bstack, HERE$
             bstack.connectnow = False
          End If
          If NocharsInLine(b$) Then Exit Do Else lbl = AscW(b$) = 13

               End If
           
        End If
    End If
        End Select
      '  End If
    Else
   b$ = w$ & b$
    Execute = 0
         If FindNameForGroup(bstack, w$) Then
                 MyEr "Unknown Property " & w$, "’γνωστη ιδιότητα " & w$
                 Else
                MyEr "Unknown Variable " & w$, "’γνωστη μεταβλητή " & w$
                End If

    Exit Function
    End If

Case 2
If Not lbl Then b$ = w$ & b$: Exit Do
b$ = Mid$(b$, 2)
lbl = False
sss = Len(b$)
Case 3
contcase3:
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
End If

        ss$ = ""
        If FastSymbol(b$, ".") Then
        If GetVar(bstack, w$, v) Then  'GetlocalVar(w$, V) Then
             If MaybeIsSymbol(b$, "-+*/<~") Then
             b$ = var(v) + b$
             ElseIf MaybeIsSymbol(b$, "=") Then
             If Right$(var(v), 1) = ")" Then
              b$ = var(v) + b$
             Else
              b$ = var(v) + "<" + b$
              End If
             Else
             ' maybe is a
             b$ = var(v) + "." + b$
             IsLabelDot here$, b$, w$
            
              If MaybeIsSymbol(b$, "=") Then
              b$ = w$ + "<" + b$
              ElseIf MaybeIsSymbol(b$, "-+*/<~") Then
               b$ = w$ + b$
              Else
               b$ = w$ + " " + b$
              End If
             End If
              GoTo again3
        Else
         MyEr "Unknown Weak " & w$, "’γνωστη ισχνή " & w$
        End If
        End If
         If MaybeIsSymbol(b$, "=<") Then
            If FastSymbol(b$, "<=", , 2) Then
                ss$ = "g"  'global
            ElseIf FastSymbol(b$, "=") Then
            ss$ = "="
         End If
        End If
       

If ss$ <> "" Then

    If ss$ = "=" Then
    If VarStat Then
            If IsStrExp(bstack, b$, ss$) Then
                    GlobalVar w$, ss$, , VarStat
            Else
                    NoValueForvariable w$
                    Execute = 0
                    Exit Function
         End If
    Else
            If NewStat Then
                    If IsStrExp(bstack, b$, ss$) Then GlobalVar w$, ss$, , VarStat
            Else
             If GetlocalVar(w$, v) Then
            
            
                If IsStrExp(bstack, b$, ss$) Then
                  If Typename(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, sw$) Then
                        var(v).index = sw$: sw$ = ""
                        End If
                         var(v).UseIndex = True
                        End If
                  var(v).Value = ss$
                  ElseIf Typename$(bstack.lastobj) = "lambda" Then
                  Set var(v) = bstack.lastobj
                  Set bstack.lastobj = Nothing
                  Else
                CheckVar var(v), ss$
                End If
                End If
                ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
           If IsStrExp(bstack, b$, ss$) Then bstack.SetVar w$, ss$ Else GoTo aproblem1
            
            ElseIf IsStrExp(bstack, b$, ss$) Then
            GoTo cont184575
            End If
            ElseIf IsStrExp(bstack, b$, ss$) Then
cont184575:
            If bstack.lastobj Is Nothing Then
              GlobalVar w$, ss$, , VarStat
            Else
            If Typename$(bstack.lastobj) = "lambda" Then
                  If NewStat Then
                                            MyEr "No New statement for lambda", "Όχι δήλωση νέου για λαμδα"
                                            Exit Function
                                        Else
                                            If Not GetVar(bstack, w$, x1, True) Then x1 = GlobalVar(w$, p, , VarStat)
                                            If here$ = "" Or VarStat Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(x1) ' & " : = NUMBER"
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & CStr(x1) '& " : = NUMBER"
                                            End If
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                          Set var(x1) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
            End If
            End If
              
            
            End If
            End If
    End If
    Else    ' g
again12345:
          If GetVar(bstack, w$, v, ss$ = "g") Then
          
               If IsStrExp(bstack, b$, ss$) Then
                 If Typename(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                            ElseIf IsStrExp(bstack, b$, sw$) Then
                            var(v).index = sw$: sw$ = ""
                            End If
                             var(v).UseIndex = True
                        End If
                        var(v).Value = ss$
                        
                   ElseIf Not bstack.lastobj Is Nothing Then
                            If TypeOf bstack.lastobj Is lambda Then
                             Set var(v) = bstack.lastobj
                             GlobalSub w$ + "()", "CALL EXTERN " & CStr(v)
                             Set bstack.lastobj = Nothing
                            
                    Else
                        NoValueForvariable w$
                    End If
                Else
               CheckVar var(v), ss$
               End If
               Else
               NoValueForvariable w$
               End If
            Else
            If ss$ = "g" Then ss$ = "":   GoTo again12345
            Nosuchvariable w$
          End If
    End If
Else
        If VarStat Or NewStat Then
            
            GlobalVar w$, ss$, , VarStat
           ' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
          
                    sss = Len(b$)
                GoTo contVarNew
                
        End If

                 NoValueForvariable w$
                    Execute = 0
                    Exit Function
End If
Case 4
contcase4:
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
End If
If MaybeIsSymbol(b$, "=-+*/<~") Then
    If FastSymbol(b$, "=") Then
    If VarStat Then
    
    If IsExp(bstack, b$, p) Then
                                       
                GlobalVar w$, p, , VarStat
                Else
                      If LastErNum <> -2 Then
                     NoValueForvariable w$
                    Execute = 0
                     Exit Function
                     End If
            
            End If
    Else
            If GetlocalVar(w$, v) Then
            
                If IsExp(bstack, b$, p) Then
                If Typename(var(v)) = "PropReference" Then
                  If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, ss$) Then
                        var(v).index = ss$: ss$ = ""
                        End If
                         var(v).UseIndex = True
                        End If
                        var(v).Value = Int(p)
                ElseIf Not bstack.lastobj Is Nothing Then
                        If TypeOf bstack.lastobj Is lambda Then
                              
                                        Set var(v) = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                Else
                                NoValueForvariable w$
                            Execute = 0
                            Exit Function
                         End If
                 Else
                 var(v) = Int(p)
                 End If
                If Err.Number = 6 Then Execute = 0: Exit Do
                On Error GoTo 0
                End If
            ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
            If IsExp(bstack, b$, p) Then bstack.SetVar w$, Int(p) Else GoTo aproblem1
            
            ElseIf IsExp(bstack, b$, p) Then
            GoTo abc2345
            End If
            
            ElseIf IsExp(bstack, b$, p) Then
abc2345:
            If Not bstack.lastobj Is Nothing Then
            If TypeOf bstack.lastobj Is lambda Then
                            v = GlobalVar(w$, p, , VarStat)
                            If NewStat Then  '' ???
                                            MyEr "No New statement for lambda", "Όχι δήλωση νέου για λαμδα"
                                            Exit Function
                                        Else
                                               If here$ = "" Or VarStat Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(v)
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & CStr(v)
                                            End If
                                        End If
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                Else
                                     NoValueForvariable w$
                            Execute = 0
                            Exit Function
                                End If
           Else
            p = Int(p)
            
            GlobalVar w$, p, , VarStat
    End If
          
                Else
                      If LastErNum <> -2 Then
aproblem1:
                     NoValueForvariable w$
                    Execute = 0
                     Exit Function
                     End If
            
            End If
    End If
    Else
        ss$ = ""
        If FastSymbol(b$, "+=", , 2) Then
        ss$ = "+"
        ElseIf FastSymbol(b$, "/=", , 2) Then
        ss$ = "/"
        ElseIf FastSymbol(b$, "-=", , 2) Then
        ss$ = "-"
        ElseIf FastSymbol(b$, "*=", , 2) Then
        ss$ = "*"
        ElseIf IsOperator(b$, "++", 2) Then
        ss$ = "++"
        ElseIf IsOperator(b$, "--", 2) Then
        ss$ = "--"
        ElseIf IsOperator(b$, "-!", 2) Then
        ss$ = "-!"
        ElseIf IsOperator(b$, "~") Then
        ss$ = "!!"
        ElseIf FastSymbol(b$, "<=", , 2) Then
        ss$ = "g"
        End If
again1234567:
        If GetVar(bstack, w$, v, ss$ = "g") Then
        'NOT YET FOR PropReference
      If Typename(var(v)) = "PropReference" Then
      Execute = 0: Exit Function
      End If
            If Len(ss$) = 1 Then
                        If IsExp(bstack, b$, p) Then
                        
                                On Error Resume Next
                                Select Case ss$
                                Case "=", "g"
                                    var(v) = Int(p)
                                Case "+"
                                    var(v) = Int(p) + var(v)
                                Case "*"
                                    var(v) = Int(Int(p) * var(v))
                                Case "-"
                                    var(v) = var(v) - Int(p)
                                Case "/"
                                    If p = 0 Then Execute = 0: Exit Do
                                    var(v) = Int(var(v) / Int(p))
                                    
         
                   
                                End Select
                                If Err.Number = 6 Then Execute = 0: Exit Do
                                On Error GoTo 0
                        Else
                                Execute = 0: Exit Do
                        End If
            Else
                If ss$ = "++" Then
                    var(v) = 1 + var(v)
                ElseIf ss$ = "--" Then
                    var(v) = var(v) - 1
                ElseIf ss$ = "-!" Then
                    var(v) = -var(v)
                Else
                          var(v) = -1 - (var(v) <> 0)
                End If
  
            End If
            GoTo loopcontinue
     Else
        If v = -1 Then
         If Len(ss$) = 1 Then If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
                    
             If Not bstack.AlterVar(w$, p, ss$, True) Then Execute = 0: Exit Function
            
     GoTo loopcontinue
    Else
        If ss$ = "g" Then ss$ = "=":   GoTo again1234567
          MyEr "No value for variable " & w$, "Χωρίς τιμή η μεταβλητή " & w$
       Execute = 0: Exit Function
       End If
      End If
   
    End If
Else
    If VarStat Or NewStat Then
        p = 0
        GlobalVar w$, p, , VarStat
       ' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): GoTo contVarNew
    Else
        MyEr "No value for variable " & w$, "Χωρίς τιμή η μεταβλητή " & w$
        Execute = 0: Exit Function
    End If
End If
    
    

Case 5
contcase5:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
If VarStat Or NewStat Then

MakeArray bstack, w$, 5, b$, pppp, NewStat, VarStat

' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): GoTo contVarNew
End If

If neoGetArray(bstack, w$, pppp) Then
againarray:
If FastSymbol(b$, ")") Then
'need to found an expression
If FastSymbol(b$, "=") Then
    If IsExp(bstack, b$, p) Then
        If Not bstack.lastobj Is Nothing Then
        
            bstack.lastobj.CopyArray pppp
            Set bstack.lastobj = Nothing
            GoTo loopcontinue
        End If
    Else
        SyntaxError
    End If
    Execute = 0
    Exit Function
End If

ElseIf Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
''MyEr "Error too", "Λάθος"
If LastErNum = -2 Then

Execute bstack, b$, True
Execute = 0: Exit Function
Else
Execute = 0
Exit Do
End If
End If
On Error Resume Next

If MaybeIsSymbol(b$, ":+-*/~") Then
With pppp

If IsOperator(b$, "++", 2) Then
.item(v) = .item(v) + 1
GoTo loopcontinue
ElseIf IsOperator(b$, "--", 2) Then
.item(v) = .item(v) - 1
GoTo loopcontinue
ElseIf FastSymbol(b$, "+=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) + p
ElseIf FastSymbol(b$, "-=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) - p
ElseIf FastSymbol(b$, "*=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) * p
ElseIf FastSymbol(b$, "/=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
If p = 0 Then
 MyEr "division by zero", "διαίρεση με το μηδέν"
 Else
 .item(v) = .item(v) / p
End If
ElseIf IsOperator(b$, "-!", 2) Then
.item(v) = -.item(v)
GoTo loopcontinue
ElseIf IsOperator(b$, "~") Then
.item(v) = -1 - (.item(v) <> 0)
GoTo loopcontinue
ElseIf FastSymbol(b$, ":=", , 2) Then

    If IsExp(bstack, b$, p) Then
        .item(v) = p
    ElseIf IsStrExp(bstack, b$, ss$) Then
      If Not IsObject(.item(v)) Then
          .item(v) = ss$
          Else
        CheckVar .item(v), ss$
        
        End If

    Else
        Exit Do
    End If
    If FastSymbol(b$, ",") Then v = v + 1: GoTo contarr
    GoTo loopcontinue
End If
.item(v) = MyRound(.item(v), 13)

End With
GoTo loopcontinue

End If
If IsOperator(b$, ".") Then

If Typename(pppp.item(v)) = "Group" Then
Execute = SpeedGroup(bstack, pppp, "", w$, b$, v)
If Execute = 0 Then
Exit Function

End If
GoTo loopcontinue
End If
ElseIf IsOperator(b$, "(") Then
If Typename(pppp.item(v)) = "mArray" Then
Set pppp = pppp.item(v)
GoTo againarray
End If
ElseIf Not FastSymbol(b$, "=", True) Then


sss = 0
GoTo loopagain
End If
If Not IsExp(bstack, b$, p) Then
If LastErNum = -2 Then
Execute bstack, b$, True
Else
MissNumExpr
End If
Execute = 0: Exit Function
End If
     If Not bstack.lastobj Is Nothing Then
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then
             bstack.soros.PushObj bstack.lastobj
            If Typename(pppp.item(v)) = "Empty" Then
            Set pppp.item(v) = New Group
            End If
            
            SpeedGroup bstack, pppp, "@READ", w$, "", v
            
               
            
            Set pppp.item(v).LinkRef = myobject
     Else
            If Typename(bstack.lastobj) = "mHandler" Then


                                        If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                                
                          Set pppp.item(v) = bstack.lastobj
     
            Else
                   If Not bstack.lastobj Is Nothing Then
                          If TypeOf bstack.lastobj Is mArray Then
                                 If bstack.lastobj.Arr Then
                                         Set pppp.item(v) = CopyArray(bstack.lastobj)

                                 Else
  
   
                                            Set pppp.item(v) = bstack.lastobj
                                            If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                                 End If
                          Else
                          
                                  Set pppp.item(v) = bstack.lastobj
                                  If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                          End If
                   Else
                  
                          Set pppp.item(v) = bstack.lastobj
                          If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                   End If
            End If
        End If
     
     Set bstack.lastobj = Nothing
     Else
     If pppp.Arr Then
     pppp.item(v) = p
     ElseIf Typename(pppp.GroupRef) Like "Pro*" Then
    
     pppp.GroupRef.Value = p
     End If
    End If
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1

If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
  If Not bstack.lastobj Is Nothing Then
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then
     bstack.soros.PushObj bstack.lastobj
     SpeedGroup bstack, pppp, "@READ", w$, "", v
     Else
                                      If Typename(bstack.lastobj) = "mHandler" Then
                                                              If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                                        End If
     Set pppp.item(v) = bstack.lastobj
     End If
     Set pppp.item(v).LinkRef = myobject
     Set bstack.lastobj = Nothing
     Else
pppp.item(v) = p
End If
Else
Exit Do
End If
Loop
Else
If GetSub(w$ + ")", i) Then
Else
b$ = ss$ + b$
GoTo autogosub
MyEr "Can't find array " & w$ & ")", "Δεν βρίσκω πίνακα " & w$ & ")"
Execute = 0: Exit Function
End If
End If
Case 6
contcase6:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
If VarStat Or NewStat Then
MakeArray bstack, w$, 6, b$, pppp, NewStat, VarStat
 If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): GoTo contVarNew
End If
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression - HEREHERE
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, w$) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue
                End If
            Else
                SyntaxError
            End If
            Execute = 0
            Exit Function
        End If
        End If
againstrarr:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then Execute = 0: Exit Function
On Error Resume Next
If Typename(pppp.item(v)) = "mArray" And Not pppp.Arr Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againstrarr
End If
End If
If Not FastSymbol(b$, "=") Then
  If FastSymbol(b$, ":=", , 2) Then
contarr:
    ss$ = Left$(aheadstatus(b$), 1)
        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then Execute = 0:   Exit Function
        Else
        If Not IsExp(bstack, b$, p) Then Execute = 0:   Exit Function
        ss$ = Trim$(Str$(p))
        End If
             If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
          ss$ = Left$(aheadstatus(b$), 1)
                        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then Execute = 0:   Exit Function
        Else
        If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
        ss$ = Trim$(Str$(p))
        End If
        
                If Not IsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                  
                  
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
   
    Else
        Execute = 0: Exit Function
    End If
Else
If Not IsStrExp(bstack, b$, ss$) Then
     Execute = 0: Exit Function
     End If
    If Not IsObject(pppp.item(v)) Then
    If pppp.Arr Then
    If bstack.lastobj Is Nothing Then
        pppp.item(v) = ss$
    
    Else
    If Typename(bstack.lastobj) = "mArray" Then
    If bstack.lastobj.Arr Then
        Set pppp.item(v) = bstack.lastobj
    Else
                                     If Typename(bstack.lastobj.GroupRef) = "mHandler" Then
                                        If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
                                        End If
    
    
        Set pppp.item(v) = bstack.lastobj.GroupRef
    End If
    Else
    If Typename(bstack.lastobj) = "mHandler" Then
                                        If bstack.lastobj.Indirect = -1 Then
                                        If Not GarbageCollector.ExistKey(objptr(bstack.lastobj.objref)) Then
                                        GarbageCollector.AddKey objptr(bstack.lastobj.objref), bstack.lastobj.objref
                                        End If
                                        Else
                                           If Not GarbageCollector.ExistKey(objptr(var(bstack.lastobj.Indirect).objref)) Then
                                        GarbageCollector.AddKey objptr(var(bstack.lastobj.Indirect).objref), var(bstack.lastobj.Indirect)
                                        End If
                                        End If
    End If
    
        Set pppp.item(v) = bstack.lastobj
        End If
        Set bstack.lastobj = Nothing
        End If
        Else
        pppp.GroupRef.Value = ss$
        End If
    Else
        CheckVar pppp.item(v), ss$
    End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
        If Not IsStrExp(bstack, b$, ss$) Then Execute = 0: Exit Function
        
        If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Else
        Exit Do
        End If
        Loop
End If
Else
Execute = 0: Exit Function
End If
Case 7
contcase7:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
If VarStat Or NewStat Then
MakeArray bstack, w$, 7, b$, pppp, NewStat, VarStat
 'If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): GoTo contVarNew
End If
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsExp(bstack, b$, p) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue
                End If
            Else
                SyntaxError
            End If
            Execute = 0
            Exit Function
        End If
        End If
againintarr:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then Execute = 0: Exit Function
On Error Resume Next
If Typename(pppp.item(v)) = "mArray" And Not pppp.Arr Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againintarr
End If
End If
If MaybeIsSymbol(b$, "+-*/~") Then
With pppp
If IsOperator(b$, "++", 2) Then
.item(v) = .item(v) + 1
ElseIf IsOperator(b$, "--", 2) Then
.item(v) = .item(v) - 1
ElseIf FastSymbol(b$, "+=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) + Int(p)
ElseIf FastSymbol(b$, "-=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) - Int(p)
ElseIf FastSymbol(b$, "*=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
.item(v) = .item(v) * Int(p)
ElseIf FastSymbol(b$, "/=", , 2) Then
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
If Int(p) = 0 Then
 MyEr "division by zero", "διαίρεση με το μηδέν"
 Else
 .item(v) = Int(.item(v) / Int(p))
End If
ElseIf IsOperator(b$, "-!", 2) Then
.item(v) = -.item(v)
ElseIf IsOperator(b$, "~") Then
.item(v) = -1 - (.item(v) <> 0)
End If
End With
GoTo loopcontinue
End If
If Not FastSymbol(b$, "=") Then Execute = 0: Exit Function
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
p = Int(p)
If Err.Number > 0 Then Execute = 0: Exit Function
pppp.item(v) = p
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then Execute = 0: Exit Function
pppp.item(v) = p
Else
Exit Do
End If
Loop
Else
Execute = 0: Exit Function
End If
Case Else

If MaybeIsSymbol(b$, ".") Then
b$ = NLtrim$(b$)
        nd& = Len(b$)
        If bstack.GetDot(b$, (1)) Then
            
                   
           sss = (Len(b$) - nd&) + sss
           LLL = (Len(b$) - nd&) + LLL
        End If
        GoTo again2
End If
If MaybeIsSymbol(b$, ",-+*/_!@()[];<>|~`0123456789") Then
SyntaxError
Execute = 0
Exit Function
End If
End Select
loopcontinue:
here$ = ohere$
If Once And Not jump Then Exit Do
loopagain:
If linebyline Then Exit Do
Loop
jumphere:
If linebyline Then
With bstack
.IFCTRL = IFCTRL
.jump = jump
End With
End If
Exit Function
errstat0:
MyEr Err.Description, Err.Description
Err.Clear
     Execute = 0: Exit Function
errstat1:
MyEr "Missing module name", "Λείπει όνομα τμήματος"
     Execute = 0: Exit Function
errstat:
MyEr "Missing variable name", "Λείπει όνομα μεταβλητής"
     Execute = 0: Exit Function
LONGERR:
    If Err.Number = 6 Then
            Execute = 0
            MyEr "OverFlow Long", "Yπερχείλιση μακρύ"
            
            End If
End Function
Function GoFunc(mystack As basetask, what$, rest$, vl As Variant, Optional recursive As Long, Optional ByVal choosethis As Long = -1, Optional ByVal strg As Boolean = False) As Boolean
Dim p As Double, i As Long, f As Long, it As Long, pa$
Dim x1 As Long, frm$, par As Boolean, ohere$, w$
Dim Vars As Long, vname As Long, subs As Long, snames As Long
Dim threads As Long, vvv As Variant

Dim basestack As basetask
' get a reference to Parent task
Set basestack = mystack.Parent
ohere$ = here$

If iRVAL(here$, 1) > funcdeep Then
    MyEr "Function's Stack is Full - 15", "Η στοίβα των συναρτήσεων έχει γεμίσει - 15"
    Set basestack = Nothing
    GoFunc = False: Exit Function
End If
' get parameters here
' if we can expose Rest$ to functions in functions then we can programmaticaly
' change how to interpret the parameter list or whatever is...Maybe. Is a think
pa$ = mystack.UseGroupname
mystack.UseGroupname = basestack.UseGroupname
'' CHECK THIS -- WHY ??
mystack.StaticInUse = basestack.StaticInUse
Set mystack.StaticCollection = basestack.StaticCollection
mystack.Look2Parent = True  ' new workaround for passing &this to function
 If Not PushParamGeneralV7(mystack, rest$) Then
 mystack.Look2Parent = False
 Exit Function
 End If
 mystack.strg = strg
 
 mystack.fHere = here$
 mystack.Look2Parent = False
  mystack.UseGroupname = pa$
If choosethis >= 0 Then
x1 = choosethis
'ohere$ = HERE$
''If what$ = "" Then here$ = RVAL(here$, 1) + mystack.OriginalName

If what$ = "" Then
here$ = RVAL(here$, 1) + mystack.OriginalName
Else
'here$ = RVAL(here$, 1)
End If
Else
If InStr(what$, "(") > 0 Then
If GetSub(what$, x1) Then  'get the reference x1 for function (functions and modules are in an array)
    ' here we change NameSpace
    If here$ = "" Then  ' from the command line
If ohere$ = "" Then here$ = what$
    Else  ' from other...maybe the same... so make an increment by 1 to an index in the name.
    

    here$ = RVAL(here$, 1) & "." & Trim$(what$)
    End If
End If
Else
If here$ = "" Then
If GetSub(what$, x1) Then
  here$ = RVAL(here$, 1)
End If
ElseIf GetlocalSub(what$, x1) Then
 here$ = RVAL(here$, 1)
 ElseIf GetSub(what$, x1) Then
  here$ = RVAL(here$, 1)
 ElseIf recursive > 0 Then
  here$ = RVAL(here$, 1)
  x1 = recursive
End If
End If
End If
If Not basestack.StaticCollection Is Nothing Then
If what$ <> mystack.StaticInUse Then
If StripRVAL(here$) & "." & mystack.StaticInUse = what$ Then
    Set mystack.StaticCollection = basestack.StaticCollection
     mystack.StaticInUse$ = what$
    
Else
    Set mystack.StaticCollection = Nothing
            If basestack.ExistVar("%_" + what$) Then
            If basestack.StaticCollection.IsObj Then
                Set mystack.StaticCollection = basestack.StaticCollection.ValueObj
                   
             End If
             
            
        End If
       
                mystack.StaticInUse$ = what$
End If
Else
    Set mystack.StaticCollection = Nothing
            If basestack.ExistVar("%_" + what$) Then
            If basestack.StaticCollection.IsObj Then
                Set mystack.StaticCollection = basestack.StaticCollection.ValueObj
                   
             End If
             
            
        End If
       
                mystack.StaticInUse$ = what$
End If
 End If
If here$ <> ohere$ Or mystack.IamChild Then     ' so now we check that we are in an new namespace...

' this system must change.. and become member of a basetask

' these are for safety
vname = varhash.count
Vars = var2used
subs = sb2used: snames = subHash.count
i = 1: FK$(13) = ""


Dim ok As Boolean, nokillvars As Boolean
nokillvars = basestack.nokillvars: basestack.nokillvars = False

If Mid$(sbf(x1).sb, i) = "" Then
GoFunc = True
GoTo emptyfunc
End If
   mystack.OriginalName$ = here$
If FastSymbol(rest$, ")") Then GoFunc = True
    If FastSymbol(rest$, "<<", , 2) Then
     f = 1
         w$ = aheadstatus(rest$, True, f)
         w$ = Left$(rest$, f - 1)
                rest$ = Mid$(rest$, f)
                f = 1
        While FastSymbol(rest$, "<<", , 2)
         pa$ = aheadstatus(rest$, True, f)
         w$ = w$ + " << " + Left$(rest$, f - 1)
                rest$ = Mid$(rest$, f)
                f = 1
        Wend
      mystack.CallW = w$
     mystack.NoFuncError = True
par = True
End If
Do
If choosethis >= 0 Then
 mystack.UseGroupname = pa$
Else
    mystack.UseGroupname = sbf(x1).sbgroup
    End If
    frm$ = Mid$(sbf(x1).sb, i)
    it = 1
againstream:
Call executeblock(it, mystack, frm$, False, ok)
    Select Case it ''Execute(mystack, frm$, False)
    Case 0
    Set mystack.lastobj = Nothing
Set mystack.FuncObj = Nothing
        mystack.ThrowThreads  ' always throw threads
    If Not NERR Then   ' Nerr = true from command ERROR 0 means Fatal Error, shows a message and act as a crash!
            If mystack.UseGroupname <> "" Then
If InStr(mystack.UseGroupname, ChrW(&H1FFF)) > 0 Then
pa$ = GetNextLine((sbf(mystack.OriginalCode).sb))
FK$(13) = Mid$(pa$, 7) + "-" + CStr(Len(NLtrim$(frm$)) - 2)
MyErMacro rest$, "Problem in class", "Πρόβλημα στη κλάση"
GoFunc = True
GoTo there1234
End If

        End If
    ''pa$ = "EDIT " & what$ & ", 1" ''& CStr(Len(sbf(x1).sb))
     pa$ = "EDIT " & StripRVAL(here$) & ", " + CStr(Len(sbf(x1).sb))
        If Left$(sbf(x1).sb, 10) = "'11001EDIT" Then
          pa$ = Mid$(GetNextLine(sbf(x1).sb), 7) ''+ "+1"
             sbf(x1).sb = Mid$(sbf(x1).sb, 3) ' needed because we measure length...look the preparation of Shift F1 below
            If InStrRev(here$, ".") > 0 Then
            ' any fucntion defined inside module or function has this direction
                MyEr "in function " & Mid$(what$, InStrRev(what$, ".") + 1), "στη συνάρτηση " & Mid$(what$, InStrRev(what$, ".") + 1)
            Else
                MyEr "in function " & what$, "στη συνάρτηση " & what$
            End If
        Else
        If Right$(here$, 1) = ")" Then
        MyEr "in function " & Left$(what$, Len(what$) - 1), "στη συνάρτηση " & Left$(what$, Len(what$) - 1)
        Else
        MyEr "in module " & here$, "στο τμημα " & here$
        End If
        
        End If
        If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then ' Maybe in a galaxy far away
            FK$(13) = pa$
        Else  ' Or in Earth
            If pa$ = "" Then
            ' no we have nothig....??? when??

            Else
                ' prepare Shift F1 for a jump to the point of interest..the faulty one
                '
             
                If InStr(FK$(13), ",") > 0 Then
                 GoTo there1234
                    If Left$(pa$, InStr(pa$, ",")) = Left$(FK$(13), InStr(FK$(13), ",")) Then GoTo there1234
                 ''pa$ = pa$ + "+2"
                 ''''DropLeft ",", FK$(13)
                   '' If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                    
                End If

                    If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then
                    FK$(13) = pa$
                    Else
                    DropLeft ",", FK$(13)
                    If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                               If sbf(x1).sbgroup <> "" Then
                    FK$(13) = pa$ & "-" & CStr(Len(frm$) - 2) + FK$(13)
                    Else
                    FK$(13) = pa$ & "-" & CStr(Len(frm$)) + FK$(13)
                    End If
                   
                    End If
 
 
            End If
        End If
there1234:
       If LastErNum = 0 Then MyErMacro rest$, "", ""
    End If
    GoFunc = False
  If what$ <> mystack.StaticInUse Then
  ElseIf Not mystack.StaticCollection Is Nothing Then
   basestack.SetVarobJ "%_" + mystack.StaticInUse, mystack.StaticCollection
   End If

    here$ = ohere$

    var2used = Vars
         varhash.ReduceHash vname, var()
If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
On Error Resume Next
    
    ReDim Preserve var(UBound(var()) / 2 + 1) As Variant
Err.Clear
End If
 
 sb2used = subs
 subHash.ReduceHash snames, sbf()
  If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
            ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
    End If
  
   If Not basestack.soros Is mystack.soros Then
   End If
    basestack.soros.MergeTop mystack.soros


    Exit Do
Case 1, 3
If Len(w$) > 0 Then
pa$ = block(frm$)
If FastSymbol(frm$, "}") Then GoTo againstream
End If
emptyfunc:
here$ = mystack.OriginalName$
  mystack.ThrowThreads
''''  If Not mystack.FuncObj Is Nothing Then
Set mystack.lastobj = mystack.FuncObj
Set mystack.FuncObj = Nothing
''End If
    If IsObject(mystack.lastobj) Then
                 If mystack.lastobj Is Nothing Then
                 vl = mystack.FuncValue
                 Else
                Set basestack.lastobj = mystack.lastobj
                 End If
    Else
              vl = mystack.FuncValue
    End If

    here$ = ohere$
    ''If FastSymbol(rest$, ")") Then GoFunc = True
     If Not nokillvars Then
    var2used = Vars
 varhash.ReduceHash vname, var()
If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
On Error Resume Next
    ReDim Preserve var(UBound(var()) / 2 + 1) As Variant
    Err.Clear
End If

      sb2used = subs
 subHash.ReduceHash snames, sbf()
  If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
  On Error Resume Next
  ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
  Err.Clear
    End If
    End If

    Exit Do
Case 2
  mystack.ThrowThreads  ' for safety...
    i = 1

                        If frm$ <> "" Then
                             If frm$ = Chr$(0) Then
                                     If basestack.IsInRetStackNumber(p) Then i = Len(sbf(x1).sb) - CLng(p) + 1
                             Else
                                 If InStr(frm$, vbCr) > 0 Then
                                         i = rinstr(sbf(x1).sb, frm$)
                                         If i = 0 Then i = Len(sbf(x1).sb) + 1
                                          Else
                                          i = PosLabel(frm$, sbf(x1).sb)
                                         End If
                             End If
                             Else
                             GoTo emptyfunc
                     End If
 
    
End Select

Loop
Else
rest$ = what$ & " " & rest$
GoFunc = False
End If
End Function
Sub stackshow(b As basetask)
Dim p As Double, r$, AL$, s$, dl$, dl2$  ', X As Index
Static Once As Boolean, ok As Boolean
If Once Then Exit Sub
Once = True
If TestShowCode Then
With Form2.testpad
.enabled = True
.SelectionColor = rgb(255, 64, 128)
.nowrap = True
.Text = TestShowSub
.mdoc.WrapAgainColor
If AscW(Form2.Label1(1)) = 8191 Then
.SelStartSilent = TestShowStart - 1 ''Len(Mid$(Form2.Label1(1), 7)) - 1
.SelLength = Len(Mid$(Form2.Label1(1), 7))
Else
.SelStartSilent = TestShowStart - Len(Form2.Label1(1)) - 1
.SelLength = Len(Form2.Label1(1))
End If

.enabled = False
If .SelLength > 1 And Not AscW(Form2.Label1(1)) = 8191 Then
If Not myUcase(.SelText, True) = Form2.Label1(1) Then

End If
End If
''Debug.Print b.addlen
'MyDoEvents
End With

Once = False
Exit Sub
Else
Form2.testpad.nowrap = False
End If




Dim Stack As mStiva
Set Stack = b.soros

If Form2.compute <> "" Then
dl$ = Form2.compute
With Form2.testpad
.enabled = True
.ResetSelColors
''
.nowrap = False
''
End With
Do
dl2 = dl$
ok = False
If FastSymbol(dl$, ")") Then
ok = True
ElseIf IsExp(b, dl$, p) Then

    AL$ = Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & CStr(p) & "," & AL$
    ok = True
    ElseIf IsStrExp(b, dl$, s$) Then
    AL$ = Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & Chr(34) + s$ & Chr(34) & "," & AL$
    ok = True
    ElseIf InStr(dl$, ",") > 0 Then
       If InStr(dl$, Chr(2)) > 0 Then
     r$ = GetStrUntil(Chr(2), dl$, False)
     s$ = "<"
If ISSTRINGA(dl$, r$) Then If pagio$ <> "GREEK" Then s$ = s$ & r$
If ISSTRINGA(dl$, r$) Then If pagio$ = "GREEK" Then s$ = s$ & r$
AL$ = s$ & ">" & AL$
ok = True
Else
AL$ = AL$ & " " & GetStrUntil(",", dl$)
    
     dl$ = ""
  
End If
    
    ok = True
    ElseIf dl$ <> "" Then
      If InStr(dl$, Chr(2)) > 0 Then
     r$ = GetStrUntil(Chr(2), dl$, False)
     s$ = "<"
If ISSTRINGA(dl$, r$) Then If pagio$ <> "GREEK" Then s$ = s$ & r$
If ISSTRINGA(dl$, r$) Then If pagio$ = "GREEK" Then s$ = s$ & r$
AL$ = s$ & ">" & AL$
ok = True
Else
     AL$ = AL$ & " " & dl$
     dl$ = ""
  
End If

    End If
    
DropLeft ",", dl$

Loop Until Not ok
End If
If AL$ <> "" Then AL$ = AL$ & vbCrLf
If pagio$ = "GREEK" Then
AL$ = AL$ & "ΣΩΡΟΣ "
Else
AL$ = AL$ & "STACK "
End If
Dim i As Long

Do
i = i + 1
If Stack.Total < i Then Exit Do
If Stack.StackItemType(i) = "N" Then
AL$ = AL$ & CStr(Stack.StackItem(i)) & " "
ElseIf Stack.StackItemType(i) = "S" Then
r$ = Stack.StackItem(i)
    If Len(r$) > 78 Then
    AL$ = AL$ & Chr(34) + Left$(r$, 75) & "..." & Chr(34)
    Else
    AL$ = AL$ & Chr(34) + r$ & Chr(34)
    End If
Else
AL$ = AL$ & Stack.StackItemTypeObjectType(i) & " "
End If
Loop
With Form2
    .gList1.BackColor = &H3B3B3B
        .Label1(2) = .Label1(2)
    
        .testpad.enabled = True
        .testpad.Text = AL$
        .testpad.SetRowColumn 1, 1
        .testpad.enabled = False
End With
Once = False
End Sub
Function RepPara(basestack As basetask, rest$) As Boolean
Dim x1 As Long, y1 As Long, i As Long, j As Long
Dim x As Double, y As Double, ss$, s$, what$
Dim pppp As mArray
RepPara = True
        If Not IsExp(basestack, rest$, y) Then
            MissNumExpr
            RepPara = False
            Exit Function
        Else
         If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then
                        x = Int(x)
                        If x < 1 Then
                        MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
                        Exit Function
                        End If
                     
                    End If
            Else
                x = 0
            End If
        
           
            x1 = Abs(IsLabel(basestack, rest$, what$))
            If x1 = 3 Then
                    If GetVar(basestack, what$, i) Then
                            If Typename(var(i)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                        MissSymbolMyEr "="
                                        RepPara = False
                                        Exit Function
                                    Else
                                            If Not IsStrExp(basestack, rest$, what$) Then
                                                MissStringExpr
                                                RepPara = False
                                                Exit Function
                                            Else
                                            
                                            s$ = GetNextLine(what$)
                                                 j = var(i).ParagraphFromOrder(y)
                                                 If j = -1 Then
                                                        
                                                           MyErMacro rest$, "no such paragraph " & CStr(y), "δεν υπάρχει τέτοια παράγραφος " & CStr(y)
                                                         Exit Function
                                                Else
                                                If x > 1 Then
                                                If what$ = "" Then
                                                
                                                ss$ = var(i).TextParagraph(j)
                                                
                                                s$ = Left(ss$ + Space$(x - 1), x - 1) + s$ + Mid$(ss$, Len(s$) + x)
                                                Else
                                                
                                                s$ = Left(var(i).TextParagraph(j) + Space$(x - 1), x - 1) + s$
                                                
                                                End If
                                            
                                                End If
                                                ''var(i).ReWritePara j, s$
                                                var(i).TextParagraph(j) = s$
                                                SetNextLine what$
                                                While what$ <> ""
                                                    s$ = GetNextLine(what$)
                                                    y = y + 1
                                                    j = var(i).ParagraphFromOrder(y)
                                                    If j = -1 Then
                                                        var(i).AppendParagraph s$
                                                    Else
                                                        If what$ = "" Then s$ = s$ + Mid$(var(i).TextParagraph(j), Len(s$) + 1)
                                                        ''var(i).ReWritePara j, s$
                                                        var(i).TextParagraph(j) = s$
                                                    End If
                                                    SetNextLine what$
                                                Wend
                                                
                                                End If
                                            End If
                                    End If
                            Else
                                 MissingDoc   ' only doc not string var
                                 RepPara = False
                                Exit Function
                            End If
                    Else
                        Nosuchvariable what$
                        RepPara = False
                        Exit Function
                    End If
            ElseIf x1 = 6 Then
                    If neoGetArray(basestack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, basestack, what$, i, rest$) Then RepPara = False: Exit Function
                        If Typename(pppp.item(i)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                            MissSymbolMyEr "="
                                            RepPara = False
                                            Exit Function
                                            Else
                                If IsStrExp(basestack, rest$, what$) Then
                                            s$ = GetNextLine(what$)
                                                 j = pppp.item(i).ParagraphFromOrder(y)
                                                 
                                                If j = -1 Then
                                            
                                               MyErMacro rest$, "no such paragraph " & CStr(y), "δεν υπάρχει τέτοια παράγραφος " & CStr(y)
                                             Exit Function
                                             Else
                                                If x > 1 Then
                                                    If what$ = "" Then
                                                        ss$ = pppp.item(i).TextParagraph(j)
                                                        s$ = Left(ss$ + Space$(x - 1), x - 1) + s$ + Mid$(ss$, Len(s$) + x)
                                                    Else
                                                        s$ = Left(pppp.item(i).TextParagraph(j) + Space$(x - 1), x - 1) + s$
                                                    End If
                                                End If
                                                ''pppp.item(i).ReWritePara j, s$
                                                pppp.item(i).TextParagraph(j) = s$
                                                SetNextLine what$
                                                While what$ <> ""
                                                    s$ = GetNextLine(what$)
                                                    
                                                    y = y + 1
                                                    j = pppp.item(i).ParagraphFromOrder(y)
                                                    If j = -1 Then
                                                    
                                                    pppp.item(i).AppendParagraph s$
                                                    Else
                                                    
                                                    If what$ = "" Then s$ = s$ + Mid$(pppp.item(i).TextParagraph(j), Len(s$) + 1)
                                                    
                                                   '' pppp.item(i).ReWritePara j, s$
                                                     pppp.item(i).TextParagraph(j) = s$
                                                    End If
                                                    SetNextLine what$
                                                Wend
                                                
                                              End If
                                Else
                                    MissStringExpr
                                    RepPara = False
                                    Exit Function
                                
                                End If

                            End If
                        Else
                             MissingDoc   ' only doc not string var
                             RepPara = False
                            Exit Function
                        End If
                    End If
            Else
                MissingDoc   ' only doc not string var
                RepPara = False
                Exit Function
            End If
        End If
End Function
Function IdPara(basestack As basetask, rest$, lang As Long) As Boolean
Dim x1 As Long, y1 As Long, i As Long, it As Long, vvl As Variant
Dim x As Double, y As Double, s$, what$, W3 As Long, W4 As Long
Dim xa As Long, ya As Long
Dim pppp As mArray


IdPara = True
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
        If Not IsExp(basestack, rest$, y) Then
            MissNumExpr
            IdPara = False
            Exit Function
        Else
        
          y = y - 1
                     If y < 0 Then y = -1
         If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then
                        x = Int(x)
                        If x < 1 Then
                        MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
                        ' not needed to change idpara must be true because macro embed an ERROR command
                        Exit Function
                        End If
                   
                    End If
                    
            Else
                x = 0
            End If
        
            x1 = Abs(IsLabel(basestack, rest$, what$))
            If x1 = 3 Then
                    If GetVar(basestack, what$, i) Then
                        If Typename(var(i)) = doc Then
                                If Not FastSymbol(rest$, "=") Then
                                    MissSymbolMyEr "="
                                    IdPara = False
                                    Exit Function
                                Else
                                    If Not IsStrExp(basestack, rest$, s$) Then
                                        MissStringExpr
                                        IdPara = False
                                        Exit Function
                                    Else
                                    If y = -1 Then
                                    y = var(i).DocParagraphs
                                    End If
                                   If var(i).ParagraphFromOrder(y + 1) = -1 Then
                                   CheckVar var(i), s$
                                    ElseIf y < 1 Then
                        
                                    var(i).InsertDoc var(i).ParagraphFromOrder(1), CLng(x), s$
                                    Else
                                    var(i).InsertDoc var(i).ParagraphFromOrder(y + 1), CLng(x), s$
                                    End If
                                    End If
                                End If
                        Else
                             MissingDoc   ' only doc not string var
                             IdPara = False
                            Exit Function
                        End If
                    Else
                        Nosuchvariable what$
                        IdPara = False
                        Exit Function
                    End If
            ElseIf x1 = 6 Then
                    If neoGetArray(basestack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then IdPara = False: Exit Function
                        If Typename(pppp.item(it)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                            MissSymbolMyEr "="
                                            IdPara = False
                                            Exit Function
                                            Else
                                If IsStrExp(basestack, rest$, s$) Then
                                
                                
                                    If pppp.item(it).ParagraphFromOrder(y + 1) = -1 Then
                                       CheckVar pppp.item(it), s$
                                        ElseIf y < 1 Then
                                      
                                        pppp.item(it).InsertDoc pppp.item(it).ParagraphFromOrder(1), CLng(x), s$
                                        Else
                                        pppp.item(it).InsertDoc pppp.item(it).ParagraphFromOrder(y + 1), CLng(x), s$
                                        End If
                                
                                
                                
                                Else
                                    MissStringExpr
                                    IdPara = False
                                    Exit Function
                                
                                End If

                            End If
                        Else
                             MissingDoc   ' only doc not string var
                             IdPara = False
                            Exit Function
                        End If
                    End If
            Else
                MissingDoc   ' only doc not string var
                IdPara = False
                Exit Function
            End If
        End If
 ElseIf IsExp(basestack, rest$, x) Then
    x = Int(x)
    If x < 1 Then
    MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
    ' not needed to change idpara must be true because macro embed an ERROR command
    Exit Function
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, y) Then
        MissNumExpr
        IdPara = False
        Exit Function
        End If
        y = Int(y)
        If y < 0 Then
            MyErMacro rest$, "number to delete chars must positive or zero", "ο αριθμός για να διαγράψω πρέπει να είναι θετικός ή μηδέν"
            Exit Function
        End If
    Else
    y = 0  ' only insert
    End If

     x1 = Abs(IsLabel(basestack, rest$, what$))
        If x1 = 3 Then
            If GetVar(basestack, what$, i) Then
        
                If Typename(var(i)) = doc Then
                    If Not FastSymbol(rest$, "=") Then
                    MissSymbolMyEr "="
                    IdPara = False
                    Exit Function
                    Else
                            If Not IsStrExp(basestack, rest$, s$) Then
                                MissStringExpr
                                IdPara = False
                                Exit Function
                            Else
                                    If y = 0 Then
                                           var(i).FindPos 1, 0, CLng(x), x1, y1, W3, W4
                                           If W4 = 0 Then
                                          ' ' merge to previous
                                           End If
       
                                    Else
                                             var(i).FindPos 1, 0, x + y, x1, y1, W3, W4
                                            ' so now we now the paragraph w3 and the position w4
                                            var(i).BackSpaceNchars W3, W4, y
                                    End If
                                    If s$ <> "" Then var(i).InsertDoc W3, W4, s$
                            End If
                     End If
                Else
                    If Not FastSymbol(rest$, "=") Then
                    MissSymbolMyEr "="
                    IdPara = False
                    Exit Function
                    Else
                    If Not IsStrExp(basestack, rest$, s$) Then
                                MissStringExpr
                                IdPara = False
                                Exit Function
                            Else
                                    If y = 0 Then
                                        var(i) = Left$(var(i), x - 1) & s$ & Mid$(var(i), x)
                                    Else
                                        If s$ = "" Then
                                        var(i) = Left$(var(i), x - 1) & Mid$(var(i), x + y)
                                        Else
                                        If Len(s$) = y Then
                                        Mid$(var(i), x, y) = s$
                                        ElseIf Len(s$) < y Then
                                        Mid$(var(i), x, y) = s$ + Space$(y - Len(s$))
                                        Else
                                        var(i) = Left$(var(i), x - 1) & s$ & Mid$(var(i), x + y)
                                        End If
                                        End If
                                    End If
                            End If
                    End If
                
                End If
            Else
            Nosuchvariable what$
            IdPara = False
            Exit Function
            
            End If
        ElseIf x1 = 6 Then
        
        
        If neoGetArray(basestack, what$, pppp) Then
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then IdPara = False: Exit Function
                If Typename(pppp.item(it)) = doc Then
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                      If y = 0 Then
                                     pppp.item(it).FindPos 1, 0, CLng(x), xa, ya, W3, W4
                                           If W4 = 0 Then
                                          ' ' merge to previous
                                           End If

                      Else
                                     pppp.item(it).FindPos 1, 0, x + y, xa, ya, W3, W4
                                            ' so now we now the paragraph w3 and the position w4
                                            pppp.item(it).BackSpaceNchars W3, W4, y
                      End If
                       If s$ <> "" Then pppp.item(it).InsertDoc W3, W4, s$
                        Else
                            MissStringExpr
                            IdPara = False
                        End If
                    End If
                Else
                If FastSymbol(rest$, "=") Then
                If IsStrExp(basestack, rest$, s$) Then
                If y = 0 Then
                    pppp.item(it) = Left$(pppp.item(it), x - 1) & s$ & Mid$(var(i), x)
                Else
                                                        If s$ = "" Then
                                        pppp.item(it) = Left$(pppp.item(it), x - 1) & Mid$(pppp.item(it), x + y)
                                        Else
                                      vvl = pppp.item(it)
                                       If Len(vvl) = y Then
                                      
                                        Mid$(vvl, x, y) = s$
                                        ElseIf Len(s$) < y Then
                                            Mid$(vvl, x, y) = s$ + Space$(y - Len(s$))
                                        Else
                                        vvl = Left$(vvl, x - 1) & s$ & Mid$(vvl, x + y)
                                        End If
                                        pppp.item(it) = vvl
                                        End If
                End If
                Else
                     MissStringExpr
                            IdPara = False
                End If
                End If
                End If
        Else
            IdPara = True
        End If
        
        
        
        Else
        MissingStrVar
        IdPara = False
        ' wrong parameter
        End If


 
 
End If

End Function
Function Identifier(basestack As basetask, what$, rest$, Optional nocom As Boolean = False, Optional lang As Long = 1) As Boolean
Dim x1 As Long, y1 As Long, it As Long, ohere$, s$, par As Boolean
If Not TaskMaster Is Nothing Then
If TaskMaster.PlayMusic Then
    TaskMaster.OnlyMusic = True
    TaskMaster.TimerTick
    TaskMaster.OnlyMusic = False
End If
End If
''Debug.Print what$
On Error GoTo NERR
ohere$ = here$

If what$ = "" Then
    Identifier = IsLabel(basestack, rest$, what$)
     
    If Not Identifier Then Exit Function
    what$ = myUcase(what$)
    lang = codeW(what$)
Else
    '' If what$ <> myUcase(what$) Then Stop
    Identifier = True
    x1 = Len(rest$)
    If Left$(what$, 1) <> "@" Then
        If nocom Then GoTo JUMPHEREFORMODULESFAST
    Else
        what$ = Mid$(what$, 2)
    End If
End If
Select Case what$
Case "ΑΝΑΛΥΤΗΣ", "PROFILER"  ' no Neo...
Identifier = True
prof.MARKONE
Exit Function
Case "WAIT", "ΑΝΑΜΟΝΗ"  '' copy to NeoWait
Identifier = MyDelay(basestack, rest$)
Exit Function
Case "REPORT", "ΑΝΑΦΟΡΑ"
Identifier = MyReport(basestack, rest$, lang)
Exit Function
Case "LET", "ΣΤΗ", "ΣΤΗΝ", "ΣΤΟ"  'ok
Identifier = MyLet(basestack, rest$, lang)
Exit Function
Case "EVENT", "ΓΕΓΟΝΟΣ"
 Identifier = myEvent(basestack, rest$, lang)
 Exit Function
Case "GROUP", "ΟΜΑΔΑ"
  Identifier = ProcGroup(0, basestack, rest$, lang)
  Exit Function
Case "CALL", "ΚΑΛΕΣΕ"
' CHECK FOR NUMBER...
NeoCall objptr(basestack), rest$, lang, Identifier
Case "COMMIT", "ΑΝΕΘΕΣΕ"
Identifier = MyRead(3, basestack, rest$, lang)
Exit Function
Case "ICON", "ΕΙΚΟΝΙΔΙΟ"
Identifier = MyIcon(basestack, rest$)
Exit Function
Case "TITLE", "ΤΙΤΛΟΣ"
Identifier = ProcTitle(basestack, rest$, lang)
Exit Function
Case "ESCAPE", "ΔΙΑΦΥΓΗ"
Identifier = MyEscape(rest$, lang)
Case "HIDE", "ΣΒΗΣΕ"
newHide basestack
Exit Function
Case "SHOW", "ΑΝΑΨΕ"
newshow basestack
Exit Function
Case "WRITE", "ΓΡΑΨΕ"
Identifier = MyWrite(basestack, rest$, lang)
Exit Function
Case "TEXT", "ΚΕΙΜΕΝΟ", "HTML"  'ok
Identifier = ProcText(basestack, what$ = "HTML", rest$)
Exit Function
Case "STRUCTURE", "ΔΟΜΗ"  ' ok
Identifier = myStructure(basestack, rest$, lang)
Exit Function
Case "ΒΑΣΗ", "BASE"   'ok
' ΝΕΑ ΒΑΣΗ
NewBase basestack, rest$
Exit Function
Case "ΑΡΧΕΙΟ", "TABLE"   'ok
NewTable basestack, rest$
' ΝΕΟΣ ΠΙΝΑΚΑΣ ΣΤΗΝ ΒΑΣΗ
Exit Function
Case "ΕΚΤΕΛΕΣΗ", "EXECUTE"   'ok
 If IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", lang) Then
Identifier = ExecCode(basestack, rest$)
 Else
    CommExecAndTimeOut basestack, rest$
    Identifier = True
End If
' ΝΕΑ ΛΙΣΤΑ
Case "ΑΝΑΚΤΗΣΗ", "RETRIEVE"  'ok
getrow basestack, rest$, , , lang
Exit Function
Case "ΑΝΑΖΗΤΗΣΗ", "SEARCH"  'ok
getrow basestack, rest$, , "", lang
Exit Function
Case "ΠΡΟΣΘΗΚΗ", "APPEND"  'ok
' ΒΑΣΗ,ΠΙΝΑΚΑΣ,ΣΤΟΙΧΕΙΑ
par = Appfields(basestack, rest$)
Exit Function
Case "ΑΦΑΙΡΕΣΗ", "DELETE"  'ok
' ΒΑΣΗ, ΠΙΝΑΚΑΣ,ΠΟΙΟ , ΤΙ
par = DELfields(basestack, rest$)
Exit Function
Case "ΤΑΞΗ", "ORDER"  'ok
MyOrder basestack, rest$
Exit Function
Case "ΕΠΙΣΤΡΟΦΗ", "RETURN"  ' no need here
' ΒΑΣΗ,"SELECT ΠΙΝΑΚΑΣ",ΣΤΟΙΧΕΙΑ
If IsStrExp(basestack, rest$, s$) Then
append_table basestack, s$, rest$, True, lang
End If
Exit Function
Case "ΣΥΜΠΙΕΣΗ", "COMPRESS"  'ok
BaseCompact basestack, rest$
Exit Function
Case "LAYER", "ΕΠΙΠΕΔΟ" ' ok
Identifier = ProcLayer(basestack, rest$)
Exit Function
Case "PRINTER", "ΕΚΤΥΠΩΤΗΣ"  ' ok
Identifier = ProcPrinter(basestack, rest$)
Exit Function
Case "MOTION", "ΚΙΝΗΣΗ"
Identifier = ProcMotion(basestack, rest$, lang)
Exit Function
Case "PAGE", "ΣΕΛΙΔΑ" 'ok
ProcPage basestack, rest$, lang
Exit Function
Case "PRINTING", "ΕΚΤΥΠΩΣΗ"
 Identifier = ProcPrinting(basestack, rest$, lang)
 Exit Function
Case "FORMLABEL", "ΕΤΙΚΕΤΑ.ΦΟΡΜΑΣ"
Identifier = ProcLabel(basestack, rest$)
Exit Function
Case "LEGEND", "ΕΠΙΓΡΑΦΗ"
' NEW JUSTIFY...1 RIGHT,2 CENTER ,3 LEFT
Identifier = ProcLegend(basestack, rest$)
Exit Function
Case "MEDIA", "MOVIE", "ΤΑΙΝΙΑ", "MUSIC", "ΜΟΥΣΙΚΗ"  ' μόνο ένα και μπορεί να περιμένει ή να το διώξει για άλλο
Identifier = ProcMedia(basestack, rest$, lang)
Exit Function
Case "PUT", "ΔΩΣΕ"
Identifier = MyPut(basestack, rest$)
Exit Function
Case "ΦΟΡΜΑ", "FORM"
Kform = True
Identifier = MakeForm(basestack, rest$)
Exit Function
Case "SUBDIR", "ΥΠΟΚΑΤΑΛΟΓΟΣ"
    Identifier = ProcSubDir(basestack, rest$, lang)
Exit Function
Case "DIR", "ΚΑΤΑΛΟΓΟΣ"
    Identifier = ProcDir(basestack, rest$, lang)
Exit Function
Case "START", "ΑΡΧΗ"
newStart basestack, rest$
Exit Function
Case "REMOVE", "ΔΙΑΓΡΑΦΗ"
    Identifier = ProcRemove(basestack, rest$, lang)
Exit Function
Case "CLASS", "ΚΛΑΣΗ"
    Identifier = ProcClass(basestack, rest$, lang)
Exit Function
Case "DEF", "ΚΑΝΕ"
    Identifier = ProcDef(basestack, rest$)
    Exit Function
Case "FUNCTION", "ΣΥΝΑΡΤΗΣΗ"
    Identifier = MyFunction(0, basestack, rest$, lang)
    Exit Function
Case "MODULE", "ΤΜΗΜΑ"
    Identifier = MyModule(basestack, rest$, lang)
    Exit Function
Case "LOAD", "ΦΟΡΤΩΣΕ" '
Identifier = ProcLoad(basestack, rest$)
Exit Function
Case "SAVE", "ΣΩΣΕ"
Identifier = ProcSave(basestack, rest$, lang)
Exit Function
Case "OVERWRITE", "ΚΑΤΑΧΩΡΗΣΗ"
Identifier = RepPara(basestack, rest$)
Exit Function
Case "INSERT", "ΠΑΡΕΜΒΟΛΗ"
Identifier = IdPara(basestack, rest$, lang)
Exit Function
Case "LONG", "ΜΑΚΡΥΣ"
Identifier = MyLong(basestack, rest$, lang)
Exit Function
Case "DOCUMENT", "ΕΓΓΡΑΦΟ"
Identifier = MyDocument(basestack, rest$, lang)
Exit Function
Case "STOCK", "ΣΤΟΚ"
Identifier = StockValues(basestack, rest$, lang)
Exit Function
Case "LINK", "ΕΝΩΣΕ"
Identifier = MyLink(basestack, rest$, lang)
Exit Function
Case "REFER", "ΑΠΕΔΩΣΕ"
Identifier = MyRead(2, basestack, rest$, lang)
Exit Function
Case "READ", "ΔΙΑΒΑΣΕ"
Identifier = MyRead(1, basestack, rest$, lang)
Exit Function
Case "DOUBLE", "ΔΙΠΛΑ"
SetDouble basestack.Owner
Exit Function
Case "NORMAL", "ΚΑΝΟΝΙΚΑ"
SetNormal basestack.Owner
Exit Function
Case "ERROR", "ΛΑΘΟΣ"
Identifier = MyError(basestack, rest$, lang)
Exit Function
Case "DIM", "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ"
    Identifier = MyDim(basestack, rest$, lang)
    Exit Function
Case "SET", "ΘΕΣΕ"
    Identifier = interpret(basestack, GetNextLine(rest$))
    Exit Function
Case "NEW", "ΝΕΟ"
    Identifier = MyNew(basestack, rest$, lang)
    Exit Function
Case "EDIT", "ΣΥΓΓΡΑΦΗ", "Σ"
    Identifier = ProcEdit(basestack, rest$, lang)
    Exit Function
Case "SCAN", "ΣΑΡΩΣΕ"
    Identifier = MyScan(basestack, rest$)
    Exit Function
Case "ΠΕΝΑ", "PEN"
    Identifier = ProcPen(basestack, rest$)
    Exit Function
Case "ΟΘΟΝΗ", "CLS"
    Identifier = ProcCls(basestack, rest$)
    Exit Function
Case "HEX", "ΔΕΚΑΕΞ"
    Identifier = RevisionPrint(basestack, rest$, 1, lang)
    Exit Function
Case "PRINT", "ΤΥΠΩΣΕ", "?"
    Identifier = RevisionPrint(basestack, rest$, 0, lang)
    Exit Function
Case "BACK", "BACKGROUND", "ΠΕΡΙΘΩΡΙΟ"
    ProcBackGround basestack, rest$, lang, Identifier
    Exit Function
Case "PUSH", "ΒΑΛΕ"
    par = MyPush(basestack, rest$)
    Exit Function
Case "DATA", "ΣΕΙΡΑ"
    par = MyData(basestack, rest$)
    Exit Function
Case "SWAP", "ΑΛΛΑΞΕ"
    Identifier = MySwap(basestack, rest$, lang)
    Exit Function
Case "CLOSE", "ΚΛΕΙΣΕ"
    Identifier = MyClose(basestack, rest$, lang)
    Exit Function
Case "SEEK", "ΜΕΤΑΘΕΣΗ"
    Identifier = MySeek(basestack, rest$)
    Exit Function
Case "APPEND.DOC", "ΠΡΟΣΘΕΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcSaveDoc(1, basestack, rest$)
    Exit Function
Case "SAVE.DOC", "ΣΩΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcSaveDoc(0, basestack, rest$)
    Exit Function
Case "MERGE.DOC", "ΣΥΓΧΩΝΕΥΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcLoadDoc(1, basestack, rest$)
    Exit Function
Case "LOAD.DOC", "ΦΟΡΤΩΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcLoadDoc(0, basestack, rest$)
    Exit Function
Case "FIND", "ΕΥΡΕΣΗ"
    Identifier = ProcFind(basestack, rest$)
    Exit Function
Case "WORDS", "ΛΕΞΕΙΣ"
    Identifier = ProcWords(basestack, rest$)
    Exit Function
Case "SORT", "ΤΑΞΙΝΟΜΗΣΗ"
    Identifier = ProcSort(basestack, rest$, lang)
    Exit Function
Case "OVER", "ΠΑΝΩ"  'ΑΝΤΙΓΡΑΦΕΙ ΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcOver(basestack, rest$)
    Exit Function
Case "SHIFTBACK", "ΦΕΡΕΠΙΣΩ"  'ΜΕΤΑΚΙΝΕΙ ΑΠΟ ΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcShiftBack(basestack, rest$)
    Exit Function
Case "SHIFT", "ΦΕΡΕ"  'ΜΕΤΑΚΙΝΕΙ ΣΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcShift(basestack, rest$)
    Exit Function
Case "DROP", "ΠΕΤΑ"
    Identifier = ProcDrop(basestack, rest$)
    Exit Function
Case "SCREEN.PIXELS", "ΑΝΑΛΥΣΗ.ΟΘΟΝΗΣ"
    Identifier = ProcScreenRes(basestack, rest$)
    Exit Function
Case "SOUNDREC", "ΗΧΟΓΡΑΦΗΣΗ"
    Identifier = ProcSoundRec(basestack, rest$, lang)
    Exit Function
Case "KEYBOARD", "ΠΛΗΚΤΡΟΛΟΓΙΟ"
    Identifier = ProcKeyboard(basestack, rest$)
    Exit Function
Case "JOYPAD", "ΛΑΒΗ"
    Identifier = ProcJoypad(basestack, rest$)
    Exit Function
Case "PIPE", "ΑΥΛΟΣ"
    Identifier = ProcPipe(basestack, rest$)
    Exit Function
Case "GET", "ΠΑΡΕ"
    Identifier = ProcGet(basestack, rest$)
    Exit Function
Case "ΝΗΜΑ", "THREAD"
    Identifier = MyThread(basestack, rest$, lang)
    Exit Function
Case "HOLD", "ΚΡΑΤΗΣΕ"
    Identifier = ProcHold()
    Exit Function
Case "RELEASE", "ΑΦΗΣΕ"
    Identifier = ProcRelease()
    Exit Function
Case "USE", "ΧΡΗΣΗ"
    Identifier = ProcUSE(basestack, rest$, lang)
    Exit Function
Case "OPEN.FILE", "ΑΝΟΙΓΜΑ.ΑΡΧΕΙΟΥ"
    Identifier = ProcOpenFile(basestack, rest$, lang)
    Exit Function
Case "OPEN.IMAGE", "ΑΝΟΙΓΜΑ.ΕΙΚΟΝΑΣ"
    Identifier = ProcOpenImage(basestack, rest$, lang)
    Exit Function
Case "FLUSH", "ΑΔΕΙΑΣΕ"
    Identifier = ProcFlush(basestack, rest$, lang)
    Exit Function
Case "PROPERTIES", "ΙΔΙΟΤΗΤΕΣ"  ''for printer
    Identifier = ProcPropeties(basestack, rest$)
    Exit Function
Case "SPEECH", "ΛΟΓΟΣ"
    Identifier = ProcSpeech(basestack, rest$)
    Exit Function
Case "DOS", "ΚΟΝΣΟΛΑ"
    Identifier = ProcDos(basestack, rest$)
    Exit Function
Case "WIN", "ΣΥΣ", "ΣΥΣΤΗΜΑ"
    Identifier = ProcWin(basestack, rest$)
    Exit Function
Case "WINDOW", "ΠΑΡΑΘΥΡΟ"
    Kform = True
    ProcWindow basestack, rest$, basestack.Owner, Identifier
    Exit Function
Case "FIELD", "ΠΕΔΙΟ"
    Identifier = ProcField(basestack, rest$, lang)
    Exit Function
Case "TEST", "ΔΟΚΙΜΗ"
    Identifier = procTestMe(basestack, rest$, what$)
    Exit Function
Case "MOUSE.ICON", "ΔΕΙΚΤΗ.ΜΟΡΦΗ"
    i3MouseIcon basestack, rest$, lang
    Exit Function
Case "MOTION.W", "ΚΙΝΗΣΗ.Π"
    Identifier = procMotionW(basestack, rest$)
    Exit Function
Case "CLIPBOARD", "ΠΡΟΧΕΙΡΟ"
    Identifier = MyClipboard(basestack, rest$)
    Exit Function
Case "ΒΟΗΘΕΙΑ", "HELP"
    Identifier = MyHelp(basestack, rest$, lang)
    Exit Function
Case "CLEAR", "ΚΑΘΑΡΟ"
    Identifier = MyClear(basestack, rest$)
    Exit Function
Case "DECLARE", "ΟΡΙΣΕ"  'OBJECT
    Identifier = MyDeclare(basestack, rest$, lang)
    Exit Function
Case "REM", "ΣΗΜ"
    NeoRem 0, rest$, 0, Identifier
    Exit Function
Case "VOLUME", "ΕΝΤΑΣΗ"
    Identifier = MyVol(basestack, rest$)
    Exit Function
Case "ABOUT", "ΠΕΡΙ"
    ProcAbout basestack, rest$, lang
    Exit Function
Case "OPTIMIZATION", "ΒΕΛΤΙΣΤΟΠΟΙΗΣΗ"  '' not a
        If IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", lang) Then
        NoOptimum = True
        ElseIf IsLabelSymbolNew(rest$, "ΝΑΙ", "ON", lang) Then
        NoOptimum = False
        End If
    Exit Function
Case "LINESPACE", "ΔΙΑΣΤΙΧΟ"  'ok
    Identifier = procLineSpace(basestack, rest$)
    Exit Function
Case "BOLD", "ΦΑΡΔΙΑ"      'ok
    ProcBold basestack, rest$
    Exit Function
Case "MODE", "ΤΥΠΟΣ"
    Identifier = ProcMode(basestack, rest$)
    Exit Function
Case "GRADIENT", "ΦΟΝΤΟ"
    Identifier = ProcGradient(basestack, rest$)
    Exit Function
Case "CHOOSE.OBJECT", "ΕΠΕΛΕΞΕ.ΑΝΤΙΚΕΙΜΕΝΟ", "ΕΠΙΛΕΞΕ.ΑΝΤΙΚΕΙΜΕΝΟ"
    ProcChooseObj basestack, rest$, lang
    Exit Function
Case "CHOOSE.FONT", "ΕΠΕΛΕΞΕ.ΓΡΑΜΜΑΤΟΣΕΙΡΑ", "ΕΠΙΛΕΞΕ.ΓΡΑΜΜΑΤΟΣΕΙΡΑ"
    ProcChooseFont basestack, lang
    Exit Function
Case "INPUT", "ΕΙΣΑΓΩΓΗ"   ' ok
    Identifier = MyInput(basestack, rest$, lang)
    Exit Function
Case "ΝΗΜΑΤΑ", "THREADS"
    procthreads basestack.Owner, basestack, rest$, lang
    Exit Function
Case "ΟΡΙΟ.ΑΝΑΔΡΟΜΗΣ", "RECURSION.LIMIT"
    Identifier = ProcRecursionLimit(basestack, rest$, lang)
    Exit Function
Case "LOCALE", "ΤΟΠΙΚΟ"
    Identifier = ProcSalata(3, basestack, rest$)
    Exit Function
Case "CODEPAGE", "ΚΩΔΙΚΟΣΕΛΙΔΑ"
    Identifier = ProcSalata(2, basestack, rest$)
    Exit Function
Case "CHARSET", "ΧΑΡΑΚΤΗΡΕΣ"
    Identifier = ProcSalata(1, basestack, rest$)
    Exit Function
Case "STEP", "ΒΗΜΑ"
    Identifier = ProcStep(basestack, rest$, lang)
    Exit Function
Case "MOVE", "ΘΕΣΗ"
    Identifier = ProcMove(basestack, rest$)
    Exit Function
Case "ΠΟΛΥΓΩΝΟ", "POLYGON"
    Identifier = ProcPoly(basestack, rest$, lang)
    Exit Function
Case "CIRCLE", "ΚΥΚΛΟΣ"
    Identifier = ProcCircle(basestack, rest$, lang)
    Exit Function
Case "PLAYER", "ΠΑΙΚΤΗΣ"
    Identifier = ProcPlayer(basestack, rest$, lang)
    Exit Function
Case "IMAGE", "ΕΙΚΟΝΑ"
    Identifier = ProcImage(basestack, rest$, lang)
    Exit Function
Case "SPRITE", "ΔΙΑΦΑΝΟ", "ΔΙΑΦΑΝΕΙΑ"
    ' ok NeoSprite exist
    If IsStrExp(basestack, rest$, s$) Then sprite basestack, s$, rest$
    Exit Function
Case "COPY", "ΑΝΤΕΓΡΑΨΕ", "ΑΝΤΙΓΡΑΨΕ"
    Identifier = MyCopy(basestack, rest$, lang)
    Exit Function
Case "ΠΑΙΞΕ", "PLAY"
    Identifier = MyPlayScore(basestack, rest$)
    Exit Function
Case "SCORE", "ΦΩΝΗ"
    Identifier = MyScore(basestack, rest$)
    Exit Function
Case "TARGETS", "ΣΤΟΧΟΙ"
    Identifier = ProcTargets(basestack, rest$, lang)
    Exit Function
Case "LATIN", "ΛΑΤΙΝΙΚΑ"
    LATIN basestack '****************************************************************
    Exit Function
Case "GREEK", "ΕΛΛΗΝΙΚΑ"
    GREEK basestack
    Exit Function
Case "MODULES", "ΤΜΗΜΑΤΑ"
    Identifier = MyModules(basestack, rest$, lang)
    Exit Function
Case "FILES", "ΑΡΧΕΙΑ"
    Identifier = ProcFiles(basestack, rest$, lang)
    Exit Function
Case "CAT", "ΚΑΤΑΛΟΓΟΙ", "ΚΑΤ"
    Identifier = ProcCat(basestack, rest$, lang)
    Exit Function
Case "DRAWINGS", "ΣΧΕΔΙΑ"
    Identifier = MyDrawings(basestack, rest$, lang)
    Exit Function
Case "BITMAPS", "ΕΙΚΟΝΕΣ"
    Identifier = MyBitmaps(basestack, rest$, lang)
    Exit Function
Case "MOVIES", "ΤΑΙΝΙΕΣ"
    Identifier = MyMovies(basestack, rest$, lang)
    Exit Function
Case "SOUNDS", "ΗΧΟΙ"
    Identifier = MySounds(basestack, rest$, lang)
    Exit Function
Case "WRITER", "ΣΥΓΓΡΑΦΕΑΣ"
    Identifier = ProcWriter(basestack, rest$, lang)
    Exit Function
Case "LIST", "ΛΙΣΤΑ"
    Identifier = ProcList(basestack, rest$, lang)
    Exit Function
Case "FRAME", "ΠΛΑΙΣΙΟ" ' BOX X1,Y1,COL,BOX
    Identifier = MyFrame(basestack, rest$)
    Exit Function
Case "MARK", "ΣΗΜΑΔΙ"
    Identifier = MyMark(basestack, rest$)
    Exit Function
Case "LINE", "ΓΡΑΜΜΗ"
    Identifier = MyLineInput(basestack, rest$, lang)
    Exit Function
Case "CURSOR", "ΔΡΟΜΕΑΣ" ' CURSOR X,Y
    Identifier = MyCursor(basestack, rest$)
    Exit Function
Case "FILL", "ΒΑΨΕ"
    Identifier = ProcFill(basestack, rest$)
    Exit Function
Case "FLOODFILL", "ΓΕΜΙΣΕ"
    Identifier = ProcFLOODFILL(basestack, rest$, lang)
    Exit Function
Case "ΧΑΡΑΞΕ", "DRAW"   ' LINE X1,Y1,COL
    Identifier = ProcDraw(basestack, rest$, lang)
    Exit Function
Case "WIDTH", "ΠΑΧΟΣ"
    Identifier = ProcDrawWidth(basestack, rest$)
    Exit Function
Case "ΚΑΜΠΥΛΗ", "CURVE"
    Identifier = ProcCurve(basestack, rest$, lang)
    Exit Function
Case "PATH", "COLOR", "ΧΡΩΜΑ", "ΙΧΝΟΣ"
    Identifier = ProcPath(basestack, rest$, lang)
    Exit Function
Case "DESKTOP", "ΕΠΙΦΑΝΕΙΑ"
    Identifier = ProcDesktop(basestack, rest$, lang)
    Exit Function
Case "CHOOSE.COLOR", "ΕΠΕΛΕΞΕ.ΧΡΩΜΑ", "ΕΠΙΛΕΞΕ.ΧΡΩΜΑ"
    Identifier = ProcChooseColor(basestack, rest$, lang)
    Exit Function
Case "SAVE.AS", "ΑΠΟΘΗΚΕΥΣΗ.ΩΣ"
    Identifier = ProcSaveAs(basestack, rest$, lang)
    Exit Function
Case "ΑΛΛΑΓΗ", "CHANGE"
    Identifier = ProcCHANGE(basestack, rest$, lang)
    Exit Function
Case "STACK", "ΣΩΡΟΣ"
    Identifier = ProcStack(basestack, rest$, lang)
    Exit Function
Case "ΕΚΔΟΣΗ", "VERSION"
    Identifier = ProcVersion(basestack)
    Exit Function
Case "FONT", "ΓΡΑΜΜΑΤΟΣΕΙΡΑ"
    Identifier = ProcFont(basestack, rest$)
    Exit Function
Case "SCROLL", "ΚΥΛΙΣΗ"
    Identifier = ProcSrcoll(basestack, rest$, lang)
    Exit Function
Case "EDIT.DOC", "ΔΙΟΡΘΩΣΕ"
    Identifier = ProcEditDoc(basestack, rest$, lang)
    Exit Function
Case "ITALIC", "ΠΛΑΓΙΑ"   '.......................
    Identifier = ProcItalic(basestack, rest$)
    Exit Function
Case "ΚΛΕΙΔΙ", "FKEY"
    Identifier = ProcFKey(basestack, rest$, lang)
    Exit Function
Case "OPEN", "ΑΝΟΙΞΕ"
    Identifier = ProcOpen(basestack, rest$, lang)
    Exit Function
Case "NAME", "ΟΝΟΜΑ"
    Identifier = ProcName(basestack, rest$, lang)
    Exit Function
Case "WITH", "ΜΕ"
    Identifier = MyWith(basestack, rest$, lang)
    Exit Function
Case "METHOD", "ΜΕΘΟΔΟΣ"
    Identifier = MyMethod(basestack, rest$, lang)
    Exit Function
Case "TUNE", "ΜΕΛΩΔΙΑ"
    Identifier = ProcTune(basestack, rest$)
    Exit Function
Case "ΗΧΟΣ", "SOUND"
    Identifier = ProcSound(basestack, rest$)
    Exit Function
Case "DB.USER", "ΒΑΣΗ.ΧΡΗΣΤΗΣ"
    Identifier = ProcDBUSER(basestack, rest$, lang)
    Exit Function
Case "DB.PROVIDER", "ΒΑΣΗ.ΠΑΡΟΧΟΣ"
    Identifier = ProcDBprovider(basestack, rest$, lang)
    Exit Function
Case "TONE", "ΤΟΝΟΣ"
    Identifier = ProcTone(basestack, rest$)
    Exit Function
Case "VIEW", "ΔΕΙΞΕ"
    Identifier = ProcView(basestack, rest$, lang)
    Exit Function
Case "CHOOSE.ORGAN", "ΕΠΕΛΕΞΕ.ΟΡΓΑΝΟ", "ΕΠΙΛΕΞΕ.ΟΡΓΑΝΟ"
    Identifier = ProcChooseOrgan(basestack, rest$, lang)
    Exit Function
Case "BROWSER", "ΑΝΑΛΟΓΙΟ"
    Identifier = ProcBrowser(basestack, rest$, lang)
    Exit Function
Case "ΜΠΙΠ", "BEEP"
    Identifier = ProcBeep(basestack, rest$)
    Exit Function
Case "MENU", "ΕΠΙΛΟΓΗ"
    Identifier = MyMenu(0, basestack, rest$, lang)
    Exit Function
Case "THREAD.PLAN", "ΣΧΕΔΙΟ.ΝΗΜΑΤΩΝ"
    Identifier = ProcThreadPlan(basestack, rest$, lang)
    Exit Function
Case "ΡΥΘΜΙΣΕΙΣ", "SETTINGS"
    Identifier = ProcSettings(basestack, rest$, lang)
    Exit Function
Case "ΚΑΤΑΣΤΑΣΗ", "INVENTORY"
    Identifier = ProcInventory(basestack, rest$, lang)
    Exit Function
Case "ΔΙΑΡΘΡΩΣΗ", "BUFFER"
    Identifier = ProcBuffer(basestack, rest$, lang)
    Exit Function
Case Else
    x1 = Len(rest$)
    Identifier = True
JUMPHEREFORMODULESFAST:
          If GetSub(what$, y1) Then
               it = 0
            ElseIf GetSub(ohere$ & "." & what$, y1) Then
                    it = 1
            ElseIf basestack.UseGroupname <> "" Then
             If what$ Like basestack.UseGroupname + "*" Then
            what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
            If GetSub(what$, y1) Then
                it = 0
            ElseIf GetSub(ohere$ & "." & what$, y1) Then
            it = 1
            Else
            GoTo conthereplease
            End If
            Else
            GoTo conthereplease
            End If
            Else
conthereplease:
                rest$ = what$ + rest$
                   MyEr "unknown module " & what$, "’γνωστο τμήμα " & what$
                   
                   Identifier = False
                   Exit Function
              End If
                 
                If NORUN1 Then rest$ = "": Exit Function
                par = PushParamGeneral(basestack, rest$)
                If LastErNum = -2 Then
               If Left$(rest$, 12) <> " : ERROR -2" Then rest$ = ""
        
                Identifier = True
                
                Exit Function
                Else
                If Not par Then Identifier = False: Exit Function
            End If
            x1 = y1
            If Len(what$) = 0 Then Identifier = False: Exit Function
            what$ = myUcase(what$):   MakeThisSub basestack, what$
            
            If it = 0 Then
                here$ = what$
            Else
                here$ = ohere$ & "." & what$
            End If
            
            If here$ <> ohere$ Then

            If Not ProcModuleEntry(basestack, ohere$, x1, rest$) Then GoTo NERR
   
    
            Else
NERR:
          
                        If Err.Number = 6 Then
                                Err.Clear
                                MyErMacro rest$, "Overflow long, expect lower than (2147483648)", "Υπερχείλιση ακεραίου, περιμένω μικρότερο από (2147483648)"
                        Else
                                Err.Clear
                                MyErMacro rest$, "unknown identifier " & what$, "’γνωστο αναγνωριστικό " & what$
                        End If
                        Identifier = True
            End If
End Select


End Function
Private Function IfierVal()
If LastErNum <> 0 Then LastErNum = 0: IfierVal = True
End Function
Private Sub OutOfLimit()
  MyEr "Out of limit", "Εκτός ορίου"
End Sub

Private Sub MissCdib()
  MyEr "Missing IMAGE", "Λείπει εικόνα"
End Sub
Private Sub BadObjectDecl()
  MyEr "Bad object declaration - use Clear Command for Gui Elements", "Λάθος όρισμα αντικειμένου - χρησιμοποίησε Καθαρό για να καθαρίσεις τυχόν στοιχεία του γραφικού περιβάλλοντος"
End Sub

Private Sub MissCdibStr()
  MyEr "Missing IMAGE in string", "Λείπει εικόνα στο αλφαριθμητικό"
End Sub
Private Sub MissStackStr()
  MyEr "Missing string value from stack", "Λείπει αλφαριθμητικό από το σωρό"
End Sub
Private Sub MissStackItem()
 MyEr "Missing item from stack", "Λείπει κάτι από το σωρό"
End Sub
Private Sub MissStackNumber()
 MyEr "Missing number value from stack", "Λείπει αριθμός από το σωρό"
End Sub
Private Sub MissNumExpr()
MyEr "Missing number expression", "Λείπει αριθμητική παράσταση"
End Sub
Private Sub MissLicence()
MyEr "Missing Licence", "Λείπει ’δεια"
End Sub
Private Sub MissStringExpr()
MyEr "Missing string expression", "Λείπει αλφαριθμητική παράσταση"
End Sub
Public Sub BadFilename()
MyEr "Bad filename", "Λάθος στο όνομα αρχείου"
End Sub
Public Sub MissDir()
MyEr "Missing directory name", "Λείπει όνομα φακέλου"
End Sub
Public Sub BadPath()
MyEr "Bad Path name", "Λάθος στο όνομα φακέλου (τόπο)"
End Sub
Public Sub BadReBound()
MyEr "Can't commit a reference here", "Δεν μπορώ να αναθέσω εδώ μια αναφορά"
End Sub
Public Sub oxiforPrinter()
MyEr "Not allowed this command for printer", "Δεν επιτρέπεται αυτή η εντολή για τον εκτυπωτή"
End Sub
Public Sub ResourceLimit()
MyEr "No more Graphic Resource for forms - 100 Max", "Δεν έχω άλλο χώρο για γραφικά σε φόρμες - 100 Μεγιστο"
End Sub
Public Sub oxiforforms()
MyEr "Not allowed this command for forms", "Δεν επιτρέπεται αυτή η εντολή για φόρμες"
End Sub
Public Sub SyntaxError()
If LastErName = "" Then
MyEr "Syntax Error", "Συντακτικό Λάθος"
Else
If LastErNum = 0 Then LastErNum = -1 ' general
LastErNum1 = LastErNum
End If
End Sub
Public Sub MissingnumVar()
MyEr "missing numeric variable", "λείπει αριθμητική μεταβλητή"
End Sub
Public Sub BadGraphic()
MyEr "Can't operate graphic", "δεν μπορώ να χειριστώ το γραφικό"
End Sub
Public Sub SelectorInUse()
MyEr "File/Folder Selector in Use", "Ο επιλογέας αρχείων/φακέλων είναι σε χρήση"
End Sub
Public Sub MissingDoc()  ' this is for identifier or execute part
MyEr "missing document type variable", "λείπει μεταβλητή τύπου εγγράφου"
End Sub
Sub MissFuncParammeterdOCVar(ar$)
MyErMacro ar$, "Not a Document variable", "Δεν είναι μεταβλητή τύπου εγγράφου"
End Sub
Public Sub MissingBlock()  ' this is for identifier or execute part
MyEr "missing block {} or string expression", "λείπει κώδικας σε {} η αλφαριθμητική έκφραση"
End Sub
Public Sub ErrNum()
MyEr "Error in number", "Λάθος στον αριθμό"
End Sub
Public Sub NotArray()  ' this is for identifier or execute part
MyEr "Expected Array", "Περίμενα πίνακα"
End Sub
Public Sub NotExistArray()  ' this is for identifier or execute part
MyEr "Array not exist", "Δεν υπάρχει τέτοιος πίνακας"
End Sub
Public Sub MissingGroup()  ' this is for identifier or execute part
MyEr "missing group type variable", "λείπει μεταβλητή τύπου ομάδας"
End Sub
Public Sub BadGroupHandle()  ' this is for identifier or execute part
MyEr "group isn't variable", "η ομάδα δεν είναι μεταβλητή"
End Sub
Public Sub MissingDocRef()  ' this is for identifier or execute part
MyEr "invalid document pointer", "μη έγκυρος δείκτης εγγράφου"
End Sub
Public Sub MissingObj()
MyEr "missing object type variable", "λείπει μεταβλητή τύπου αντικειμένου"
End Sub
Public Sub BadGetProp()
MyEr "Can't Get Property", "Δεν μπορώ να διαβάσω αυτή την ιδιότητα"
End Sub
Public Sub BadLetProp()
MyEr "Can't Let Property", "Δεν μπορώ να γράψω αυτή την ιδιότητα"
End Sub
Public Sub MissingObjRef()
MyEr "invalid object pointer", "μη έγκυρος δείκτης αντικειμένου"
End Sub
Public Sub MissingStrVar()  ' this is for identifier or execute part
MyEr "missing string variable", "λείπει αλφαριθμητική μεταβλητή"
End Sub
Public Sub NoSwap(nameOfvar$)
MyEr "Can't swap ", "Δεν μπορώ να αλλάξω τιμές "
End Sub
Public Sub Nosuchvariable(nameOfvar$)
MyEr "No such variable " + nameOfvar$, "δεν υπάρχει τέτοια μεταβλητή " + nameOfvar$
End Sub
Public Sub NameConflict()
   MyEr "Group Name Has Module name ", "Το όνομα ομάδας είναι και όνομα του τμήματος"
End Sub
Public Sub NoReference()
   MyEr "No reference exist", "Δεν υπάρχει αναφορά"
End Sub
Public Sub NoSecReF()
MyEr "No reference allowed - use new variable", "Δεν δέχεται αναφορά - χρησιμοποίησε νέα μεταβλητή"
End Sub
Public Sub NoValueForvariable(nameOfvar$)
 MyEr "No value for variable " & nameOfvar$, "Χωρίς τιμή η μεταβλητή " & nameOfvar$
 End Sub
Sub MissSymbolMyEr(wht$)   ' not the macro one
MyEr "missing " & wht$, "λείπει " & wht$
End Sub
Sub BadCommand()
 MyEr "Command for supervisor rights", "Εντολή μόνο για επόπτη"
End Sub
Sub FilePathNotForUser()
MyEr "Filepath is not valid for user", "Ο τόπος του αρχείου δεν είναι έγκυρος για τον χρήστη"
End Sub

' used to isnumber
Sub MyErMacro(wher$, en$, gr$)
LastErNum = -2
wher$ = " : ERROR -2" & Sput(en$) + Sput(gr$) + wher$
 
End Sub
Sub ZeroParam(ar$)   ' we use MyErMacro in isNumber and isString
MyErMacro ar$, "Empty parameter", "Μηδενική παράμετρος"
End Sub
Sub MissPar()
MyEr "missing parameter", "λείπει παράμετρος"
End Sub
Sub MissParam(ar$)
MyErMacro ar$, "missing parameter", "λείπει παράμετρος"
End Sub
Sub MissFuncParameterStringVar()
MyEr "Not a string variable", "Δεν είναι αλφαριθμητική μεταβλητή"
End Sub
Sub MissFuncParameterStringVarMacro(ar$)
MyErMacro ar$, "Not a string variable", "Δεν είναι αλφαριθμητική μεταβλητή"
End Sub
Sub NoSuchFolder(ar$)
MyErMacro ar$, "No such folder", "Δεν υπάρχει τέτοιος φάκελος"
End Sub
Sub MissSymbol(ar$, wht$)
MyErMacro ar$, "missing " & wht$, "λείπει " & wht$
End Sub
Sub SpaceForVar(j As Long)
var2used = var2used + 1
If UBound(var()) <= var2used + 20 Then
On Error Resume Next
    ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
    If Err.Number > 0 Then
    If UBound(var()) <= var2used Then
    ' space for 20 variables because maybe sometimne we have locked the array,
    ' so we do the preserve another time
    Err.Clear
    Else
    NOEXECUTION = True
    MyEr Err.Description, Err.Description
    Err.Clear
    Exit Sub
    End If
    End If
End If
j = var2used
End Sub
Function ReboundArr(bstack As basetask, name$, arrcode As Long) As Boolean
On Error GoTo 0
Dim ss$
name$ = myUcase(name$)
If Left$(name$, 5) = "ΑΥΤΟ." Or Left$(name$, 5) = "THIS." Then
    ss$ = bstack.UseGroupname & Mid(name$, 6)
Else
    If here$ = "" Then
        ss$ = name$
    Else
        ss$ = here$ & "." & name$
    End If
End If

ReboundArr = varhash.findRebound(ss$, arrcode, var())

End Function
Function ReboundVar(bstack As basetask, name$, q As Long) As Boolean
On Error GoTo 0
Dim ss$
name$ = myUcase(name$)
If Left$(name$, 5) = "ΑΥΤΟ." Or Left$(name$, 5) = "THIS." Then
    ss$ = bstack.UseGroupname & Mid(name$, 6)
Else
    If here$ = "" Then
        ss$ = name$
    Else
        ss$ = here$ & "." & name$
    End If
End If

ReboundVar = varhash.findRebound(ss$, q, var())

End Function
Function GlobalVar(name$, q As Variant, Optional Link As Boolean = False, Optional makeitglobal As Boolean = False) As Long
On Error GoTo 0
Dim j As Long

If Not Link Then
        
       j = AllocVar()
            If Right$(name$, 1) = "%" Then
                On Error Resume Next
                q = Int(q)
                If Err.Number = 6 Then q = 0
                On Error GoTo 0
            End If

        var(j) = q

Else
If CStr(q) = "" Then
j = 0
Else
    j = CLng(q)
End If
End If
If here$ = "" Or makeitglobal Then
varhash.ItemCreator myUcase(name$), j, Link
Else
varhash.ItemCreator here$ & "." & myUcase(name$), j, Link
End If
GlobalVar = j
End Function
Function GlobalVarRefOnly(name$, Optional gl As Boolean = False) As Long
On Error GoTo 0
Dim j As Long
j = AllocVar() ' var2used
 var(j) = CLng(0)  ' like an empty...
If here$ = "" Or gl Then
varhash.ItemCreator myUcase(name$), j
Else
varhash.ItemCreator here$ & "." & myUcase(name$), j

End If
GlobalVarRefOnly = j
End Function
Function LinkGroup(ByVal name$, q As Variant, Optional usefinal As Boolean = False) As Boolean
Dim i As Long, Vlist As Boolean, FList, f$, aa$, v As Long
Dim s() As String
If Typename(q) <> "Group" Then Exit Function
'Debug.Print "link to ", name$
If Not usefinal Then
If here$ = "" Then
name$ = myUcase(name$) + "."
Else
 name$ = here$ & "." & myUcase(name$) + "."
End If
End If
With q


FList = .FunclistTotal(var(), True)
With q.soros
For i = 1 To .Total
aa$ = .StackItem(i)

v = Split(aa$)(1)
Vlist = True
Select Case Typename(var(v))
Case "Group"
    If Left$(Split(aa$)(0), 1) = "*" Then
       varhash.ItemCreator name$ + Mid$(Split(aa$)(0), 2), CLng(val(v)), True
   LinkGroup name$ + Mid$(Split(aa$)(0), 2) + ".", var(val(Split(aa$)(1))), True
        
    Else
    varhash.ItemCreator name$ + Split(aa$)(0), CLng(val(v)), True
    LinkGroup name$ + Split(aa$)(0) + ".", var(val(Split(aa$)(1))), True
    End If
 
Case Else

    varhash.ItemCreator name$ + Split(aa$)(0), CLng(val(v)), True
End Select

Next
End With



Dim subname$
If FList <> "" Then
subname$ = Replace(Replace(FList, Chr$(3), name$), Chr$(2), name$)
s() = Split(subname$, Chr$(1))
For i = LBound(s$()) + 1 To UBound(s$())
If s(i) <> "" Then
 subHash.ItemCreator CStr(Split(s(i))(0)), val(Split(s(i))(1)), True
End If
Next i

End If
LinkGroup = Vlist Or FList <> ""
End With

End Function

Sub GlobalArr(bstack As basetask, name$, rst$, items As Long, q As Long, Optional useglobalname As Boolean = False, Optional reverse As Boolean = False)
' new mArray..
Dim afto As New mArray, NewKey As Long
If rst$ = "" And q = -1 Then
' Make an empty array
GoTo dummyarray
End If


Dim j As Long, i As Long, p As Double, aa As Boolean
items = 1
i = 0

Do
If IsExp(bstack, rst$, p) Then
i = i + 1
items = items * Int(Abs(p))
afto.PushDim CLng(p)
aa = True
End If
If i > 9 Then Exit Do
Loop Until Not FastSymbol(rst$, ",")

If aa And FastSymbol(rst$, ")") Then
afto.RevOrder = reverse
 afto.PushEnd

   
dummyarray:
    NewKey = AllocVar()  ' version 8.1
    ' check if is already in ucase
    name$ = myUcase(name$)
    If here$ = "" Or useglobalname Then
        varhash.ItemCreator bstack.GroupName + name$, NewKey
        afto.arrname = name$
    Else
        varhash.ItemCreator here$ + "." + bstack.GroupName + name$, NewKey
        afto.arrname = here$ & "." & name$
    End If
    If q = -1 Then
' Stop
q = NewKey
 ''   rst$ = CStr(newkey) 'a way to return the handler
    End If
    Set var(NewKey) = afto
    
Else
If FastSymbol(rst$, ",") Then
items = 0
MyEr "No more 10 dimensions allowed", "Μέχρι 10 διαστάσεις επιτρέπονται)"
Else

    items = -1
    rst$ = ":?" & rst$
    End If
End If
End Sub
Sub GlobalArrResize(afto As mArray, bstack As basetask, name$, rst$, items As Long)
' new mArray..

Dim j As Long, i As Long, p As Double, aa As Boolean
items = 1
i = 0
afto.StartResize
Do
If IsExp(bstack, rst$, p) Then
If afto.IHaveGui And p <> 0 Then GoTo noredim
i = i + 1
items = items * Int(Abs(p))
afto.PushDim CLng(p)
aa = True
End If
If i > 9 Then Exit Do
Loop Until Not FastSymbol(rst$, ",")
afto.PushEnd
If aa And FastSymbol(rst$, ")") Then
    

Else
     If FastSymbol(rst$, ",") Then
items = 0
MyEr "No more 10 dimensions allowed", "Μέχρι 10 διαστάσεις επιτρέπονται"
Else
    items = -1
    rst$ = ":?" & rst$
    End If
End If
Exit Sub
noredim:
MyEr "No Redim allowed, use Declare Over/Under ", "Δεν επιτρέπονται αλλαγές, χρησιμοποίησε την ΟΡΙΣΕ ΠΑΝΩ/ΥΠΟ"
End Sub


Function neoGetArray(bstack As basetask, ByVal nm$, ga As mArray, Optional searchonly As Boolean = False, Optional useglobalname As Boolean = False, Optional useLocalOnly As Boolean = False) As Boolean
Dim k As Long
Dim n$
nm$ = myUcase(nm$)

'If Right$(nm$, 1) = "(" Then nm$ = nm$ + ")"
If useglobalname Or here$ = "" Then
n$ = bstack.GroupName + nm$

ElseIf Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
GoTo here12
Else
n$ = here$ & "." + bstack.GroupName + nm$

End If


If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
here12:
    If useLocalOnly Then Exit Function
    If bstack.UseGroupname <> "" Then
    n$ = bstack.UseGroupname + Mid$(nm$, 6)
     If Not varhash.Find(n$, k) Then
     n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
     varhash.Find n$, k
     End If
     If k = 0 Then
     ' check for inventory
     n$ = bstack.UseGroupname + Mid$(nm$, 6)
      If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find(n$, k) Then
            If TypeOf var(k) Is mHandler Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
            End If
            Exit Function
        End If
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
              If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find(n$, k) Then
            If TypeOf var(k) Is mHandler Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
            End If
            Exit Function
        End If
     
     End If
    Else
    n$ = Mid$(nm$, 5)
      If bstack.GetDot(n$, 1) Then varhash.Find here$ + "." + n$, k Else Exit Function
    End If

ElseIf varhash.Find(n$, k) = False Then
If useLocalOnly Then
If bstack.UseGroupname <> "" Then
        If InStr(nm$, bstack.UseGroupname) = 1 Then
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, Len(bstack.UseGroupname) + 1)
        varhash.Find n$, k
End If
Else
If n$ Like "*[$%](" Then
n$ = Mid$(n$, 1, Len(n$) - 2)
Else
n$ = Mid$(n$, 1, Len(n$) - 1)
End If
If varhash.Find(n$, k) Then
    If TypeOf var(k) Is mHandler Then
    Set ga = New mArray
    Set ga.GroupRef = var(k)
    ga.Arr = False
    neoGetArray = True
    End If
    Exit Function
End If
End If
Else
            If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find(n$, k) Then
            If TypeOf var(k) Is mHandler Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
                 Exit Function
                Else
                k = -1
                n$ = bstack.GroupName + nm$
                ' not a mhandler
            End If
           
        End If

End If
End If
If k <= 0 Then

            If searchonly Then Exit Function
            If Not useLocalOnly Then
                        n$ = nm$
                        varhash.Find n$, k
        Else
      
     Exit Function
        
            End If
End If


If k > 0 Then
If Typename(var(k)) = "Empty" Then
Set ga = New mArray: neoGetArray = True
Else

Set ga = var(k)

End If
  neoGetArray = True
           
ElseIf k = 0 Then
 If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find(n$, k) Then
            If TypeOf var(k) Is mHandler Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
            End If
            Exit Function
        End If



        nm$ = Mid$(n$, 1, Len(n$) - 1)
        If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
    If useLocalOnly Then Exit Function
    If bstack.UseGroupname <> "" Then
    n$ = bstack.UseGroupname + Mid$(nm$, 6)
     If Not varhash.Find(n$, k) Then
     n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
     varhash.Find n$, k
     End If
    Else
    n$ = Mid$(nm$, 5)
      If bstack.GetDot(n$, 1) Then varhash.Find here$ + "." + n$, k Else Exit Function
    End If
End If
        If varhash.Find(n$, k) Then
        If TypeOf var(k) Is mHandler Then
        Set ga = New mArray
        Set ga.GroupRef = var(k)
        ga.Arr = False
        neoGetArray = True
        Exit Function
        End If
        End If
End If


End Function
Function neoGetArrayLinkOnly(bstack As basetask, ByVal nm$, Link As Long, Optional useglobalname As Boolean = False, Optional useLocalOnly As Boolean = False) As Boolean
Dim k As Long
Dim n$
nm$ = myUcase(nm$)
If Len(nm$) > 5 And False Then
           ' not used any more
                If Left$(nm$, 5) = "THIS." Then
               
                    n$ = StripThis2(here$)
                    If n$ <> "" Then n$ = n$ & "." & bstack.GroupName & Mid(nm$, 6) Else n$ = here$ & "." & nm$
                ElseIf Left$(nm$, 5) = "ΑΥΤΟ." Then
           
                    n$ = StripThis2(here$)
                    If n$ <> "" Then n$ = n$ & "." & bstack.GroupName & Mid(nm$, 6) Else n$ = here$ & "." & nm$
                Else
                If useglobalname Then
                    n$ = nm$
                    Else
                    n$ = here$ & "." & bstack.GroupName & nm$
                    End If
                End If

Else
If useglobalname Then
n$ = bstack.GroupName + nm$

Else
If here$ = "" Then
n$ = bstack.GroupName & nm$
Else
n$ = here$ & "." & bstack.GroupName & nm$
End If
End If
End If

If varhash.Find(n$, k) = False And bstack.UseGroupname <> "" Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
        If useLocalOnly Then Exit Function
        If StripThis2(bstack.UseGroupname) = "" Then
            n$ = bstack.UseGroupname + Mid$(nm$, 6)
        Else
            n$ = StripThis2(bstack.UseGroupname) + "." + Mid$(nm$, 6)
        End If
        varhash.Find n$, k
    End If
End If
If k = 0 Then
    If Not useLocalOnly Then
        n$ = myUcase(nm$)
        varhash.Find n$, k
    End If
End If
If k > 0 Then
    Link = k
    neoGetArrayLinkOnly = True
    
End If

End Function

Function CopyArrayItems(bstack As basetask, nm$) As String
Dim k As Long
If neoGetArrayLinkOnly(bstack, nm$, k) Then CopyArrayItems = CStr(k)

End Function

Function CopyArrayItemsNoFormated(bstack As basetask, nm$) As Long
Dim k As Long
If varhash.Find(nm$ + "(", k) Then
CopyArrayItemsNoFormated = k
End If
End Function

Function GlobalSub(name$, q As String, Optional sbgroupname As String = "") As Long
Dim j As Long, n$, where As Long
n$ = myUcase(name$, True)
j = AllocSub()
With sbf(j)
    .sb = q
    .sbc = 0
    .sbgroup = sbgroupname
End With
If comhash.Find(n$, where) Then
comhash.RenameKey n$, "_" + n$

End If
subHash.ItemCreator n$, j

GlobalSub = j
End Function

Function GetGlobalVar(nm$, i As Long) As Boolean

If varhash.Find(myUcase(nm$), i) Then
GetGlobalVar = True
End If
End Function

Function StripThis(ByVal n$) As String

Dim A$, b$, i&

A$ = StripRVAL(n$)  ' we need that
If A$ = n$ Then
StripThis = ""
Exit Function
Else
b$ = A$
End If
i& = InStr(n$, ".")
If i& > 0 Then

DropLeft ".", n$
i& = InStrRev(n$, ".") - 1
If i& > 0 Then
StripThis = b$ & "." & Left$(n$, i&)
Else
StripThis = b$
End If
Else
StripThis = b$
End If
End Function
Function StripThis2(ByVal n$) As String

Dim A$, b$, i&

If StripRVAL2(n$, A$) Then
StripThis2 = A$
Exit Function
End If
If A$ = n$ Then
StripThis2 = ""
Exit Function
Else
b$ = A$
End If
i& = InStr(n$, ".")
If i& > 0 Then

DropLeft ".", n$
i& = InStrRev(n$, ".") - 1
If i& > 0 Then
StripThis2 = b$ & "." & Left$(n$, i&)
Else
StripThis2 = b$
End If
Else
StripThis2 = b$
End If
End Function

Function GetVar(bstack As basetask, ByVal nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False) As Boolean
If skip Then Exit Function
If Not bstack.StaticCollection Is Nothing Then
If bstack.ExistVar(nm$) Then i = -1: Exit Function
End If
Dim n$, cc As Long

If Len(nm$) > 5 Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
        If bstack.UseGroupname <> "" Then
                  n$ = bstack.UseGroupname + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
                
                  n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
        Else
        
            n$ = StripThis2(here$)
            If n$ <> "" Then
                n$ = n$ & "." & Mid(nm$, 6)
            
            Else
                If IsLabel(bstack, Mid$(nm$, 6), n$) Then ' NO NEED DOT ANY MORE..(WE USE DOTNEW)
                        n$ = here$ & "." & n$
                Else
                        n$ = here$ & "." & nm$
                End If
            End If
        End If
    Else
    If lookglobalonly Then
     n$ = nm$
    Else
        n$ = here$ & "." & nm$
        End If
    End If
Else
If nm$ = "THIS" Or nm$ = "ΑΥΤΟ" Then
  n$ = ".DELETEME"
    If IsLabel(bstack, (n$), n$) < 0 Then
        If Len(n$) = 8 Then GetVar = False: Exit Function
    nm$ = Left$(n$, Len(n$) - 9)
    End If
End If
    If lookglobalonly Then
         n$ = nm$
        Else

   n$ = here$ & "." & bstack.GroupName & nm$
    End If
End If

If varhash.Find(n$, cc) Then
there12:
    GetVar = True
    i = cc
ElseIf Not looklocalonly Then

    n$ = nm$
    If bstack.UseGroupname <> "" Then
        If InStr(n$, bstack.UseGroupname) = 1 Then
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(n$, Len(bstack.UseGroupname) + 1)
        If varhash.Find(n$, cc) Then
                i = cc
                GetVar = True
                nm$ = n$
        End If
        End If
    End If
    If Not GetVar Then
    If varhash.Find(nm$, cc) Then
    i = cc
    GetVar = True
    End If
    End If
    
End If

'***********************

End Function
Function getvar2(bstack As basetask, nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False) As Boolean
If skip Then Exit Function
If Not bstack.StaticCollection Is Nothing Then
If bstack.ExistVar(nm$) Then i = -1: Exit Function
End If
Dim n$, cc As Long

If Len(nm$) > 5 Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
        If bstack.UseGroupname <> "" Then
                  n$ = bstack.UseGroupname + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
                
                    n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
        Else
        
            n$ = StripThis2(here$)
            If n$ <> "" Then
                n$ = n$ & "." & Mid(nm$, 6)
            
            Else
            If IsLabel(bstack, Mid$(nm$, 6), n$) Then ' NO NEED DOT ANY MORE..(WE USE DOTNEW)
                    n$ = here$ & "." & n$
            Else
                    n$ = here$ & "." & nm$
            End If
            End If
        End If
    Else
    If lookglobalonly Then
     n$ = nm$
    Else
        n$ = here$ & "." & nm$
        End If
    End If
Else
If nm$ = "THIS" Or nm$ = "ΑΥΤΟ" Then
  n$ = ".DELETEME"
    If IsLabel(bstack, (n$), n$) < 0 Then
        If Len(n$) = 8 Then getvar2 = False: Exit Function
    nm$ = Left$(n$, Len(n$) - 9)
    End If
End If
    If lookglobalonly Then
         n$ = nm$
        Else

   n$ = here$ & "." & bstack.GroupName & nm$
    End If
End If

If varhash.Find(n$, cc) Then
there12:
    getvar2 = True
    i = cc
ElseIf Not looklocalonly Then
    If varhash.Find(nm$, cc) Then
    i = cc
    getvar2 = True
    ElseIf bstack.UseGroupname <> "" Then
        If InStr(nm$, bstack.UseGroupname) = 1 Then
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, Len(bstack.UseGroupname) + 1)
        If varhash.Find(n$, cc) Then
        i = cc
        getvar2 = True
    End If
    End If
    End If
End If

'***********************

End Function
Function GetlocalVar(nm$, i As Long) As Boolean
If varhash.Find(here$ & "." & myUcase(nm$), i) Then
GetlocalVar = True
End If
End Function
Function RVAL2(ByVal s$, v As Long) As String
Dim ss$
If InStr(s$, "[") = 0 Then
RVAL2 = s$
Else
ss$ = GetStrUntil("[", s$)
If val(s$) + v <= 0 Then
RVAL2 = ss$ + "."
Else
RVAL2 = ss$ & "[" & CStr(val(s$) + v) & "]."
End If
End If
End Function

Function RVAL(ByVal s$, v As Long) As String
Dim ss$
If InStr(s$, "[") = 0 Then
RVAL = s$ & "[" & CStr(v) & "]"
Else
ss$ = GetStrUntil("[", s$)

RVAL = ss$ & "[" & CStr(val(s$) + v) & "]"
End If
End Function
Function TheSame(ByVal s$, ByVal q$) As Boolean
Dim part1 As String
part1 = StripRVAL(s$)
If part1 <> "" Then
    If InStr(part1, ".") > 0 Then
    ' all in part1
    Else
    DropLeft ".", s$
    part1 = part1 & "." & s$
    End If
    End If
TheSame = part1 = q$
End Function
Function StripRVAL2(s$, result$) As Boolean
' return s$ number as string
' return function name...
'
Dim bb$, VarName$
bb$ = s$
If InStr(s$, "[") = 0 Then
' look varlist to find group
Dim i As Long
i = InStrRev(s$, ".")
If i > 1 Then s$ = Left$(s$, i - 1)
If InStrRev(VarName$, "." + s$ + " ") < 1 Then Exit Function
s$ = Mid$(VarName$, InStrRev(VarName$, Chr$(1), InStrRev(VarName$, "." + s$ + " ")) + 1)
result$ = GetStrUntil(" ", s$)
StripRVAL2 = True
If Not Typename(var(val(s$))) = "Group" Then StripRVAL2 = False: s$ = bb$: result$ = ""
Else
result$ = GetStrUntil("[", s$)
End If

End Function
Function StripRVAL(ByVal s$) As String
If InStr(s$, "[") = 0 Then
' do not delete this.....
StripRVAL = s$
Else
StripRVAL = GetStrUntil("[", s$)
End If
End Function
Function iRVAL(ByVal s$, v As Long) As Long
If InStr(s$, "[") = 0 Then
iRVAL = v
Else
DropLeft "[", s$
iRVAL = val(s$) + v
End If
End Function
Function LookFastForModule(w$) As Boolean
Dim A As Long
If Len(here$) = 0 Then
LookFastForModule = subHash.Find(w$, A)
Else
LookFastForModule = subHash.Find(here$ + w$, A)
End If
End Function
Function GetSubFullName(nm$, fullname$) As Boolean

If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
            GetSubFullName = subHash.ExistKey(nm$)
          fullname = nm$: Exit Function
        End If
    End If
End If

If here$ <> "" Then
     GetSubFullName = subHash.ExistKey(here$ & "." & nm$)
  If GetSubFullName Then fullname$ = here$ & "." & nm$: Exit Function
End If

    GetSubFullName = subHash.ExistKey(nm$)
 If GetSubFullName Then fullname$ = nm$





End Function
Function GetSubFullName2(nm$, fullname$, retnum As Long) As Boolean
Dim dummy As Long
If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
            GetSubFullName2 = subHash.Find2(nm$, retnum, dummy)
          fullname = nm$: Exit Function
        End If
    End If
End If

If here$ <> "" Then
     GetSubFullName2 = subHash.Find2(here$ & "." & nm$, retnum, dummy)
  If GetSubFullName2 Then fullname$ = here$ & "." & nm$: Exit Function
End If

    GetSubFullName2 = subHash.Find2(nm$, retnum, dummy)
 If GetSubFullName2 Then fullname$ = nm$





End Function


Function GetSubFullNameB(nm$, fullname$) As Boolean
Dim i&, n$
Dim subname$  '
subname$ = subHash.Show
If Len(here$) > 0 Then
If Len(here$) > Len(nm$) Then
If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
n$ = "." & nm$ & " "
i& = InStr(subname$, n$)
Dim j&
If i& > 0 Then
j& = InStrRev(subname$, Chr$(1), i&)
nm$ = Mid$(subname$, j& + 1, Len(nm$) + i& - j&)
n$ = Mid$(subname$, j&, Len(nm$) + 1)
i& = j&
 
End If
End If

End If
End If

If i& = 0 Then
n$ = Chr(1) + here$ & "." & nm$ & " "
i& = InStr(subname$, n$)
End If
If i& = 0 Then
n$ = Chr(1) + nm$ & " "
i& = InStr(subname$, n$)
End If

If i& > 0 Then
GetSubFullNameB = True
fullname$ = RTrim$(Mid$(n$, 2))


Else
GetSubFullNameB = False

End If

End Function
Function GetSub(nm$, i&) As Boolean
i& = 0
If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
                
            GetSub = subHash.Find(StripRVAL(here$) + "." + nm$, i&)
       
        End If
   ElseIf Right$(here$, 1) = "]" Then
   GetSub = subHash.Find(StripRVAL(here$) + "." + nm$, i&)
    End If
End If

If i& = 0 And here$ <> "" Then
     GetSub = subHash.Find(here$ & "." & nm$, i&)
ElseIf i& <> 0 Then
    Exit Function
End If
If i& = 0 Then
    GetSub = subHash.Find(nm$, i&)
Else
    Exit Function
End If
If i& = 0 Then
   
Else
    Exit Function
End If

End Function

Function GetlocalSub(nm$, i&) As Boolean

If subHash.Find(here$ & "." & nm$, i&) Then GetlocalSub = True

End Function
Function GetGlobalSubAfterHere(basestack As basetask, nm$, i&) As Boolean
Dim j&
If Not subHash.Find(here$, j&) Then

If basestack.OriginalName <> "" Then
If Not subHash.Find(basestack.OriginalName + "." + nm$, j&) Then Exit Function
End If

End If
If Not subHash.Find(nm$, i&) Then
Exit Function
End If


GetGlobalSubAfterHere = i& > j&
End Function

Function GetlocalSubExtra(nm$, i&) As Boolean
Dim n$
Dim subname$
subname$ = subHash.Show
n$ = "." & nm$ & " "
i& = InStr(subname$, n$)
If i& > 0 Then

GetlocalSubExtra = True
i& = val(Mid$(subname$, i& + Len(n$)))
Else
GetlocalSubExtra = False
End If
End Function
Function PosLabel(ByVal w$, ByVal b$) As Long
Dim i As Long, j As Long, jmp As Boolean
On Error Resume Next
If val(Left$(w$, 1)) = 0 Then w$ = w$ & ":": jmp = True

PosLabel = Len(b$) + 1

If Left$(b$, Len(w$)) = w$ Then
    i = 1
Else
i = InStr(b$, Chr(10) + w$)
If i = 0 Then

    Do
    i = InStr(i + 1, b$, " " & w$)
    If i = 0 Then Exit Do
    j = Len(RTrim(Left$(b$, i)))
    If j = 0 Then Exit Do
    If Mid$(b$, j, 1) = Chr(10) Then Exit Do
    Loop
    If i = 0 Then
    Do
    i = InStr(i + 1, b$, "0" & w$)
    If i = 0 Then Exit Do

    j = Len(RTrim(Left$(b$, i)))
    If j = 0 Then Exit Do
    
    While j > 1 And Mid$(b$, j, 1) = "0"
            j = j - 1
    Wend
    
    If Mid$(b$, j, 1) = Chr(10) Then Exit Do
    Loop
    End If
End If

End If
If jmp Then
If i > 0 Then PosLabel = i + 1
Else
If i > 1 Then PosLabel = i + 1 '' Else PosLabel = 1
End If
End Function

Function logical(basestack As basetask, s$, d As Double) As Boolean
Dim b$, s2$, s3$ ' , OSTAC$
Dim ah As String

ah = aheadstatus(s$, False)    '
If InStr(ah, "l") = 0 Then
If InStr(ah, "N") > 0 Then

''If MaybeIsSymbol(s$, "#0123456789") Then
'logical = IsNumberCheck(s$, d)
''Else
logical = IsNumber(basestack, s$, d)
''End If
Else
logical = False
End If
Exit Function
End If

On Error Resume Next

If Err.Number > 0 Then Exit Function
s2$ = s$

If Left$(ah, 1) <> "N" Then
 IsStrExp basestack, s$, b$
logical = False
If FastSymbol(s$, "=") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ = s2$ Then d = -1 Else d = 0
    Exit Function
    Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<>", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ <> s2$ Then d = -1 Else d = 0
    Exit Function
        Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ <= s2$ Then d = -1 Else d = 0
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ < s2$ Then d = -1 Else d = 0
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ >= s2$ Then d = -1 Else d = 0
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ > s2$ Then d = -1 Else d = 0
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "~") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    If b$ Like s2$ Then d = -1 Else d = 0
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
End If

If LastErNum <> -2 Then s$ = s2$

Else

s$ = s2$
If IsNumber(basestack, s$, d) Then
logical = True
Else

End If
End If
End Function
Function BlockParam(s$) As String
' need to be open
Dim i As Long, j As Long
j = 1
For i = 1 To Len(s$)
Select Case AscW(Mid$(s$, i, 1))
Case 0
Exit For
Case 34
i = InStr(i + 1, s$, Chr(34))
If i = 0 Then Exit Function
Case 40
j = j + 1
Case 41
j = j - 1
If j = 0 Then Exit For
Case 123
i = InStr(i + 1, s$, Chr$(125))
If i = 0 Then Exit Function
End Select
Next i
If j = 0 Then
BlockParam = Left$(s$, i - 1)
End If
End Function
Function block(s$) As String
Dim i As Long, j As Long, c As Long
Dim a1 As Boolean
Dim jump As Boolean
If Trim(s$) = "" Then Exit Function
c = Len(s$)
a1 = True
i = 1
Do
Select Case AscW(Mid$(s$, i, 1))
Case 32
' nothing
Case 34
Do While i < c
i = i + 1
If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
Loop
Case 39, 92
Do While i < c
i = i + 1
If Mid$(s$, i, 2) = vbCrLf Then Exit Do
Loop
Case 61
jump = True
Case 123


If jump Then
jump = False
' we have a multiline text
Dim target As Long
target = j
    Do
    Select Case AscW(Mid$(s$, i, 1))
    Case 34
    Do While i < c
    i = i + 1
    If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
    Loop
    Case 123
    j = j - 1
    Case 125
    j = j + 1: If j = target Then Exit Do
    End Select
    i = i + 1
    Loop Until i > c
    If j <> target Then Exit Do
    Else
j = j - 1
End If


Case 125
j = j + 1: If j = 1 Then Exit Do
Case Else
jump = False

End Select
i = i + 1
Loop Until i > c
If j = 1 Then
block = Left$(s$, i - 1)
s$ = Mid$(s$, i)
'DoEvents
Else
block = "" '' "Error " & chr(34) & "missing }" & chr(34)
End If



End Function
Function block2(s$) As String
Dim i As Long, j As Long, c As Long
Dim a1 As Boolean
Dim jump As Boolean
Dim alter As Boolean
If Trim(s$) = "" Then Exit Function

c = Len(s$)
a1 = True
i = 1
Do
Select Case AscW(Mid$(s$, i, 1))
Case 32
' nothing
Case 34
Do While i < c
i = i + 1
If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
Loop
Case 39, 92
Do While i < c
i = i + 1
If Mid$(s$, i, 2) = vbCrLf Then Exit Do
Loop
Case 61
jump = True
Case 123


If jump Then
jump = False
' we have a multiline text
Dim target As Long
target = j
    Do
    Select Case AscW(Mid$(s$, i, 1))
    Case 34
    Do While i < c
    i = i + 1
    If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
    Loop
    Case 123
    j = j - 1
    Case 125
    j = j + 1: If j = target Then Exit Do
    End Select
    i = i + 1
    Loop Until i > c
    If j <> target Then Exit Do
    Else
j = j - 1
End If


Case 125
j = j + 1: If j = 1 Then Exit Do
Case Else
jump = False

End Select
i = i + 1
Loop Until i > c
If j = 1 Then
block2 = Left$(s$, i - 1)
s$ = Mid$(s$, i)
'DoEvents
Else
block2 = "" '' "Error " & chr(34) & "missing }" & chr(34)
End If



End Function
Function blockString(s$) As String
Dim i As Long, j As Long, c As Long
Dim a1 As Boolean
c = Len(s$)
a1 = True
i = 1
Do
Select Case AscW(Mid$(s$, i, 1))
Case 34
Do While i < c
i = i + 1
If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
Loop
Case 123
j = j - 1
Case 125
j = j + 1: If j = 1 Then Exit Do
End Select
i = i + 1
Loop Until i > c
If j = 1 Then
blockString = Left$(s$, i - 1)
s$ = Mid$(s$, i)
Else
blockString = "Error " & Chr(34) & "missing }" & Chr(34)
End If
If Right$(blockString, 1) = " " Then
i = Len(blockString) - Len(RTrim(blockString))
If i > 0 Then blockString = ReplaceStr(Chr$(10) + Space(i), Chr$(10), blockString)
End If

End Function
Sub SetNextLine(c$)
Dim i
i = InStr(c$, vbCrLf)
If i = 0 Then c$ = "" Else c$ = Mid$(c$, i + 2)
End Sub
Sub SetNextLineNL(c$)
Dim i
i = InStr(c$, vbCrLf)
If i = 0 Then c$ = "" Else c$ = Mid$(c$, i)
End Sub
Function GetNextLine(c$) As String
Dim i, j$
i = InStr(c$, vbCrLf)
If i = 0 Then GetNextLine = Trim$(c$): c$ = "" Else GetNextLine$ = Trim$(Left$(c$, i - 1)): c$ = Mid$(c$, i)
End Function

Sub NoLines(c$)
Dim i
c$ = Trim(c$)
Do While Left$(c$, 2) = vbCrLf
c$ = Trim$(Mid$(c$, 3))
Loop
End Sub

Sub RTarget(ddd As Object, tar As target)
' RENDER TARGET
Dim xl&, yl&, b As Long, f As Long, Tag$, Id&
Dim x&, y&, ox&, oy&
Dim prive As basket, d As Object
Set d = ddd.Owner
prive = players(GetCode(d))
With tar
Id& = .Id
Tag$ = .Tag
x& = .Lx
y& = .ly
xl& = .tx + 1
yl& = .ty
b = .back
f = .fore
prive.mypen = .Pen

Dim dd As Object
If .layer = 0 Then
Set dd = Form1.DIS
ElseIf .layer = -1 Then
Set dd = Form1
ElseIf .layer > 0 Then
Set dd = Form1.dSprite(.layer)
End If

prive.Xt = .Xt
prive.Yt = .Yt
prive.uMineLineSpace = .sUAddTwipsTop
prive.mx = 100
prive.My = 100
prive.SZ = .SZ
End With
dd.FontSize = prive.SZ
LCTbasket dd, prive, y&, x&
If f <> -1 Then BoxBigNew dd, prive, xl& - 1, yl&, f
If b <> -1 Then BoxColorNew dd, prive, xl& - 1, yl&, b
If Id& < 100 Then

    Tag$ = Left$(Tag$, xl& - x&)
    If Tag$ <> "" Then
    '1
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    
    Select Case Id& Mod 10
    Case 2, 5, 8
   
    x& = (xl& + x& - Len(Tag$)) \ 2
    Case 3, 6, 9
    x& = xl& - Len(Tag$)
    
    Case Else
    End Select
    If (Id& Mod 10) > 0 Then
    LCTbasket dd, prive, y&, x&
    dd.FontTransparent = True
    dd.ForeColor = mycolor(prive.mypen)
    ' Εδώ πρέπει να δώ σε ποιο basetask θα τυπώνει ο στόχος...
       PlainBaSket dd, prive, Tag$, True, True
    End If
    End If
Else
        If Tag$ <> "" Then
    Id& = Id& Mod 100
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    f = 3
    Select Case Id& Mod 10
    Case 2, 5, 8
    f = 2
    Case 3, 6, 9
    f = 1
    Case Else
    End Select
    
    If (Id& Mod 10) > 0 Then
    LCTbasket dd, prive, y&, x&
    dd.FontTransparent = True
    dd.CurrentX = dd.CurrentX - dv15 * 2
    wwPlain ddd, prive, Tag$, xl& - x&, 10000, , True, f, , , True
  
    End If
End If
    

End If
PlaceBasket dd, players(GetCode(dd))
End Sub
Private Function textDel(ByVal ThisFile As String) As Boolean
Dim chk As String
ThisFile = strTemp + ThisFile
chk = CFname(ThisFile)
textDel = (chk <> "")
If chk <> "" Then KillFile chk
End Function
Private Function textPUT(bstack As basetask, ByVal ThisFile As String, THISBODY As String, c$, mode2save As Long) As Boolean
Dim chk As String, b$, j As Long, PREPARE$, VR$, s$, v As Double, buf$, i As Long
ThisFile = strTemp + ThisFile
chk = GetDosPath(ThisFile)
If chk <> "" And c$ = "new" Then KillFile GetDosPath(chk)
On Error GoTo HM
textPUT = True
Do
j = InStr(THISBODY, "##")
If j = 0 Then PREPARE$ = PREPARE$ & THISBODY: Exit Do
If j > 1 Then PREPARE$ = PREPARE$ & Mid$(THISBODY, 1, InStr(THISBODY, "##") - 1)
THISBODY = Mid$(THISBODY, j + 2)
j = InStr(THISBODY, "##")
If j = 0 Then PREPARE$ = PREPARE$ & THISBODY: Exit Do
If j > 1 Then VR$ = Mid$(THISBODY, 1, InStr(THISBODY, "##") - 1)
THISBODY = Mid$(THISBODY, j + 2)
'
If IsExp(bstack, VR$, v) Then
buf$ = Trim$(Str$(v))
ElseIf IsStrExp(bstack, VR$, s$) Then
buf$ = s$
Else
buf$ = VR$
End If
PREPARE$ = PREPARE$ & buf$
Loop
           If Not WeCanWrite(ThisFile) Then GoTo HM

textPUT = SaveUnicode(ThisFile, PREPARE$, mode2save, Not (c$ = "new"))
Exit Function
HM:
textPUT = False
End Function
Public Sub DropLeft(ByVal uStr As String, fromStr As String)
Dim i As Long
i = InStr(fromStr, uStr)
If i > 0 Then
fromStr = Mid$(fromStr, i + Len(uStr))
Else
fromStr = ""
End If
End Sub
Public Function GetStrUntil(ByVal sStr As String, fromStr As String, Optional RemoveSstr As Boolean = True) As String
Dim i As Long

If fromStr = "" Then GetStrUntil = "": Exit Function
i = InStr(fromStr, sStr)
If i < 2 Then
GetStrUntil = ""
fromStr = ""
Else
GetStrUntil = Left$(fromStr, i - 1)
If RemoveSstr Then
fromStr = Mid$(fromStr, Len(sStr) + i)
Else
fromStr = Mid$(fromStr, i)
End If
End If
End Function

Function RESOURCES() As String
'ON ERROR GoTo r1
 '   r1 = GetFreeResources(GFSR_GDIRESOURCES)
  '  r2 = GetFreeResources(GFSR_SYSTEMRESOURCES)
   ' r3 = GetFreeResources(GFSR_USERRESOURCES)
    'If r1 < 12 Or r2 < 12 Or r3 < 12 Then
'    If r1 < 12 Then
'    RESOURCES = "!!GDI!!"
'    ElseIf r2 < 12 Then
'    RESOURCES = "!!SYSTEM!!"
'    Else
'    RESOURCES = "!!USER!!"
'    End If
'    Else
'    RESOURCES = Left$(Format$((r1 + r2 + r3) / 3#, "#0.0"), 2)
'    End If
'    Exit Function
'r1:
    RESOURCES = ""
End Function
Public Function myRegister(tP$) As String
    strTemp = String(MAX_FILENAME_LEN, Chr$(0))
    GetTempPath MAX_FILENAME_LEN, StrPtr(strTemp)
    strTemp = mylcasefILE(Left$(strTemp, InStr(strTemp, Chr(0)) - 1))
Dim i As Long
i = FreeFile
Open strTemp & "tmp." & tP$ For Output As i
Print #i, "test"
Close i
' found me
Dim rl$
rl$ = PCall(strTemp & "tmp." & tP$)
If rl$ <> "" Then
rl$ = GetStrUntil(Chr(34), rl$)
End If
Sleep 10
KillFile strTemp & "tmp." & tP$
myRegister = Trim$(rl$)
End Function
Public Function PCall(ByVal sFile As String) As String
Dim s2 As String, i As Long, bsfile As String, rfile As String, MYNULL$
bsfile = mylcasefILE(sFile)
   s2 = String(MAX_FILENAME_LEN, 32)
   'Retrieve the name and handle of the executable, associated with this file
   i = FindExecutable(StrPtr(sFile), StrPtr(MYNULL$), StrPtr(s2))
   If i > 32 Then
   rfile = mylcasefILE(Left$(s2, InStr(s2, Chr$(0)) - 1))
   If ExtractName(bsfile) = ExtractName(rfile) Then
   ' it is an executable
   PCall = mylcasefILE(bsfile)
   Else
      PCall = rfile & " " & Chr(34) + bsfile + Chr(34)
      End If
      Else
      PCall = ""
End If
End Function
Function PathFromApp(ByVal nap$) As String
Dim ap$
nap$ = nap$ & " "
ap$ = GetStrUntil(" ", nap$)
If ExtractType(ap$) = "" Then ap$ = ap$ & ".exe"
Dim cc As New cRegistry
cc.ClassKey = HKEY_CURRENT_USER
cc.SectionKey = "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\" & ap$
cc.ValueKey = ""
cc.ValueType = REG_SZ
On Error GoTo 1111
If IsEmpty(cc.Value) Then
cc.ClassKey = HKEY_LOCAL_MACHINE
If IsEmpty(cc.Value) Then

PathFromApp = ""
Else
PathFromApp = Trim$(mylcasefILE(cc.Value & " " & nap$))

End If
Else
PathFromApp = Trim$(mylcasefILE(cc.Value & " " & nap$))
End If
Exit Function
1111:
PathFromApp = ""
End Function
Public Function MyShell(ww$, Optional way As VbAppWinStyle = vbNormalFocus) As Long
Dim frm$, exst As Boolean, pexist As Boolean, PP$, EXE$, param$
' logic
'
On Error GoTo 11111
If ExtractType(ww$) <> "" Then

frm$ = ExtractPath(ww$) + ExtractName(ww$)
param$ = Mid$(ww$, Len(frm$) + 1)
ww$ = frm$
ElseIf ExtractPath(ww$) = "" Then
Dim i As Long, j As Long
i = InStr(ww$, Chr(34))
j = InStrRev(ww$, Chr(34))
If j > i Then
param$ = Mid$(ww$, i, j - i + 1)
ww$ = Left$(ww$, i - 1)
End If

End If
If ww$ = "" Then
If param$ <> "" Then
MyShell = Shell(Trim$(param$), way)
Exit Function
End If
End If
If ExtractPath(ww$) = mylcasefILE(ww$) Then
' it is a path
ww$ = "a.@@@ " & ww$
Else
frm$ = CFname(ww$)
If ExtractName(frm$) <> ExtractName(ww$) Then
On Error Resume Next

MyShell = Shell(Trim$(ww$ & " " & param$), way)
If Err.Number > 0 Then
Err.Clear
ww$ = PathFromApp(ww$)
If ww$ <> "" Then
ww$ = ReplaceStr(Chr(34), "", ww$) & " " & param$
MyShell = Shell(Trim$(ww$), way)
End If
End If
Exit Function
End If
If CFname(ww$) <> "" Then ww$ = frm$: exst = True

PP$ = ExtractPath(ww$)
End If
If PP$ <> "" Then
pexist = True
ww$ = Mid$(ww$, Len(PP$) + 1)
End If
ww$ = ww$ & " "
EXE$ = ""
If InStr(ww$, ".") > InStr(ww$, " ") Then
EXE$ = Left$(ww$, InStr(ww$, "."))
ww$ = Mid$(ww$, Len(EXE$) + 1)
End If
ww$ = ww$ & " "
EXE$ = EXE$ & Trim$(GetStrUntil(" ", ww$))
' until now we have all things splitted
EXE$ = mylcasefILE(EXE$)
' until now we have all things splitted
Select Case ExtractType(EXE$)
Case ""
If pexist Then
' this is not normal
' ***************ERROR*************
Else
' so we put exe by default
EXE$ = EXE$ & ".exe"
frm$ = PathFromApp(Trim$(EXE$ & " " & ww$))
If frm$ <> "" Then
MyShell = Shell(frm$, way)
Exit Function
Else
MyShell = Shell(Trim$(EXE$ & " " & ww$ & " " & param$), way)
Exit Function
End If
End If
Case "exe", "bat", "com" ' can be run immediatly
If pexist Then
MyShell = Shell(Trim$(PP$ & EXE$ & " " & ww$), way)
Exit Function
Else
frm$ = PathFromApp(Trim$(EXE$ & " " & ww$))
If frm$ <> "" Then
MyShell = Shell(frm$, vbNormalFocus)
Exit Function
Else
MyShell = Shell(Trim$(EXE$ & " " & ww$), way)
Exit Function
End If
End If
Case "@@@"
MyShell = Shell(RTrim$("explorer " & ww$), way)
Case Else ' its a document
PP$ = ReplaceStr("file:", "", PP$)
frm$ = PCall(PP$ & EXE$)
If frm$ <> "" Then
If AscW(frm$) = 34 Then
frm$ = frm$ & "@"
frm$ = ReplaceStr(Chr(34) & "@", param$ & Chr(34), frm$)
frm$ = ReplaceStr("@", "", frm$)
Else
End If
MyShell = Shell(Trim$(frm$ & " " & ww$ & " " & param$), way)
Exit Function
Else
End If
End Select
11111:
MyShell = 0
' its a document
End Function

Private Function ReplaceStr2(sStr As String, dStr As String, fromStr As String) As String
  ReplaceStr2 = Replace$(fromStr, sStr, dStr, vbTextCompare)
End Function
Function StarSTR(ByVal sStr As String) As String
Dim l As Long, s As Long
l = Len(sStr)
sStr = RTrim(sStr)
s = l - Len(sStr)
StarSTR = String$(l - s, "*") + String$(s, " ")

End Function
Function ReplaceStr(sStr As String, dStr As String, fromStr As String) As String
  ReplaceStr = Replace$(fromStr, sStr, dStr)  ' changed
End Function

Sub mylist(bstack As basetask, Optional tofile As Long = -1, Optional lang As Long)
Dim scr As Object, prive As Long
Set scr = bstack.Owner
prive = GetCode(scr)
Dim p As Double, i As Long, s$, pn&, x As Double, y As Double, it As Long, f As Long, pa$
Dim x1 As Long, y1 As Long, frm$, par As Boolean, ohere$, ss$, w$, sx As Double, sy As Double
Dim pppp As mArray, hlp$, h&, all$
Dim w1 As Long, w2 As Long, DUM As Boolean, virtualtop As Long
pn& = 0
' DELETE ARRNAME$
Dim arrname$
virtualtop = varhash.count - 1
For pn& = virtualtop To 0 Step -1
varhash.ReadVar pn&, s$, h&
If InStr(s$, ChrW(&H1FFF)) = 0 And InStr(s$, ChrW(&HFFBF)) = 0 Then Exit For
virtualtop = virtualtop - 1
Next pn&
pn& = 0
With players(prive)
Do While pn& < varhash.count
varhash.ReadVar pn&, s$, h&

If h& = -1 Then

Else
If InStr(s$, ChrW(&HFFBF)) > 0 Then
GoTo LOOPNEXT
ElseIf InStr(s$, ChrW(&H1FFF)) > 0 Then
' DO NOTHING
GoTo LOOPNEXT
ElseIf Right$(s$, 1) = "(" Then
    If IsObject(var(h&)) Then
        Set pppp = var(h&)
        pppp.SerialItem (0), f, 5
        w1 = 0
        pppp.SerialItem w2, w1, 6
        w1 = w1 + 1

        If f > 1 Then
            If tofile < 0 Then
                If tofile = -1 Then
                            If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & ",") Then crNew bstack, players(prive)
                            PlainBaSket scr, players(prive), s$ & Trim$(Str$(w2)) & ","
                Else
                            all = all + " " + s$ + Trim$(Str$(w2)) + ","
                End If
            Else
                If Uni(tofile) Then
                    putUniString tofile, s$ & Trim$(Str$(w2)) & ","
                Else
                    putANSIString tofile, s$ & Trim$(Str$(w2)) & ","
                End If
            End If
        Else
        If pn& < virtualtop Then
        If tofile < 0 Then
            If tofile = -1 Then
            If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & "), ") Then crNew bstack, players(prive)
            PlainBaSket scr, players(prive), s$ & Trim$(Str$(w2)) & "), "
            Else
            'prop
                all = all + " " + s$ + Trim$(Str$(w2)) + "),"
            End If
            Else
                   If Uni(tofile) Then
        putUniString tofile, s$ & Trim$(Str$(w2)) & "), "
                Else
                putANSIString tofile, s$ & Trim$(Str$(w2)) & "), "
            
            End If
            End If
       Else
        If tofile < 0 Then
                If tofile = -1 Then
          If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & ")") Then crNew bstack, players(prive)
         PlainBaSket scr, players(prive), s$ & Trim$(Str$(w2)) & ")"
         Else
           all = all + " " + s$ + Trim$(Str$(w2)) + ")"
         End If
         Else
                   If Uni(tofile) Then
        putUniString tofile, s$ & Trim$(Str$(w2)) & ")"
                Else
putANSIString tofile, s$ & Trim$(Str$(w2)) & ")"

         End If
         End If
     End If
    End If
x = f - 1

While x > 0
x = x - 1
pppp.SerialItem w2, w1, 6
w1 = w1 + 1
If x > 0 Then
If tofile < 0 Then
    If tofile = -1 Then
    
    If .mx - .curpos < Len(Trim$(Str$(w2)) & ",") Then crNew bstack, players(prive)
    PlainBaSket scr, players(prive), Trim$(Str$(w2)) & ","
    Else
    ' prop
        all = all + " " + s$ + Trim$(Str$(w2)) + ","
    End If
       Else
        If Uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & ","
                Else
         putANSIString tofile, Trim$(Str$(w2)) & ","
        ' Print #tofile, Trim$(str$(w2)) & ",";
         End If
         End If
    
Else
        If pn& < virtualtop Then
         If tofile < 0 Then
            If tofile = -1 Then
            If .mx - .curpos < Len(Trim$(Str$(w2)) & "), ") Then crNew bstack, players(prive)
            PlainBaSket scr, players(prive), Trim$(Str$(w2)) & "), "
            Else
            'prop
                all = all + " " + s$ + Trim$(Str$(w2)) + "),"
            End If
            Else
     If Uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & "), "
                Else
                putANSIString tofile, Trim$(Str$(w2)) & "), "
            'Print #tofile, Trim$(str$(w2)) & "), ";
            End If
            End If
        Else
        If tofile < 0 Then
    If tofile = -1 Then
            If .mx - .curpos < Len(Trim$(Str$(w2)) & ")") Then crNew bstack, players(prive)
            PlainBaSket scr, players(prive), Trim$(Str$(w2)) & ")"
            Else
            ' prop
                                all = all + " " + s$ + Trim$(Str$(w2)) + ")"
            End If
            Else
                               If Uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & ")"
                Else
                putANSIString tofile, Trim$(Str$(w2)) & ")"
            'Print #tofile, scr, Trim$(str$(w2)) & ")";
            End If
            End If
        End If
    End If
Wend

    End If
    GoTo LOOPNEXT
 ElseIf Right$(s$, 1) = "$" Or Right$(s$, 3) = "$()" Then  ' WHY "$()"
    ' h& = Val(Mid$(VarName$, pn&))
        If Typename(var(h&)) = doc Then
            If var(h&).IsEmpty Then
                hlp$ = " [Empty Document]"
            Else
                hlp$ = " [Document " + CStr(var(h&).SizeCRLF) & " chars]"
            End If
        ElseIf Typename(var(h&)) = "PropReference" Then
        hlp$ = " [Object Property]"
        Else
        If IsObject(var(h&)) Then
        If TypeOf var(h&) Is lambda Then
            hlp$ = "[lambda$]"
            Else
            hlp$ = "[" + Typename(var(h&)) + "]"
            End If
        Else
            If Len(var(h&)) > 3 * .mx Then
                hlp$ = " = " & Chr(34) + Left$(CStr(var(h&)), 4) & "..." & Chr(34)
            Else
                hlp$ = " = " & Chr(34) + CStr(var(h&)) + Chr(34)
            End If
        End If
        End If
    s$ = s$ & hlp$
Else

If IsObject(var(h&)) Then
If var(h&) Is Nothing Then
s$ = s$ + "*[Nothing]"
ElseIf TypeOf var(h&) Is mHandler Then
Select Case var(h&).T1
Case 1
    s$ = s$ + "*[Inventory]"
Case 2
    s$ = s$ + "*[Buffer]"
Case Else
    s$ = s$ + "*[" + Typename(var(h&).objref) + "]"
End Select
Else
s$ = s$ & "[" & Typename(var(h&)) & "]"
End If
Else
On Error Resume Next
s$ = s$ & " =" & Str(var(h&))
If Err Then
s$ = s$ & " = " & Chr(34) & var(h&) & Chr(34)
Err.Clear
End If
End If
End If
If pn& < virtualtop Then s$ = s$ & ", "
If tofile < 0 Then
   If tofile = -1 Then
   If .mx - .curpos < Len(s$) Then crNew bstack, players(prive)
    PlainBaSket scr, players(prive), s$
    End If
    ' proportional
    all = all + " " + s$
   Else
   If Uni(tofile) Then
putUniString tofile, s$
   Else
    putANSIString tofile, s$

    End If
    End If
 End If
LOOPNEXT:
pn& = pn& + 1
Loop
s$ = ""
If GarbageCollector.count > 0 Then
If lang = 1 Then
s$ = "Objects for destroy:" + Str$(GarbageCollector.count)
Else
s$ = "Αντικείμενα για καταστροφή:" + Str$(GarbageCollector.count)
End If
End If

    If tofile < -1 Then
        If scr.CurrentX <> 0 Then crNew bstack, players(prive)
        If s$ <> "" Then s$ = vbCrLf + s$
        wwPlain bstack, players(prive), all$ + s$, scr.Width, 1000, True, , 3
    ElseIf tofile = -1 Then
        If s$ <> "" Then
         crNew bstack, players(prive)
        
        PlainBaSket scr, players(prive), s$
        End If
    End If
    
    If tofile < 0 Then crNew bstack, players(prive)
      End With
End Sub

Function NeoGetArrayItem(PP As mArray, bstack As basetask, v$, offset As Long, rst$, Optional noObject As Boolean = False, Optional closepar As Boolean = True) As Boolean
If noObject And PP.IHaveClass Then Exit Function
Dim dn As Long, dd As Long, W3 As Long
Dim p As Double
If Not PP.Arr Then
Dim ppp$
    If TypeOf PP.GroupRef Is mHandler Then
    If PP.GroupRef.T1 <> 1 Then
     If IsExp(bstack, rst$, p) Then
     p = Int(p)
     If p >= 0 Or p < PP.GroupRef.objref.items Then
     
     GoTo conthere
     
     End If
     End If
       MyEr "offset out of limits", "Δείκτης εκτός ορίων"
        Exit Function
    End If
    If IsExp(bstack, rst$, p) Then

    
     With PP.GroupRef.objref
     If Not FastSymbol(rst$, "!") Then ppp$ = CStr(p): GoTo contlabel1
     p = Int(p)
     If p >= 0 And p < .count Then
        .index = p
         offset = -.index - 2
        .Done = True
     Else
        MyEr "Index out of limits", "Δείκτης εκτός ορίων"
     End If
     End With
    ElseIf IsStrExp(bstack, rst$, ppp$) Then
contlabel1:
        With PP.GroupRef.objref
            
            If Not .Find(ppp$) Then
            
               MyEr "Index out of limits", "Δείκτης εκτός ορίων"
               Else
               offset = -.index - 2
            End If
            End With
    End If
    Else
    Dim aprop As PropReference
    Set aprop = PP.GroupRef
    If IsExp(bstack, rst$, p) Then
    aprop.index = p
    ElseIf IsStrExp(bstack, rst$, ppp$) Then
    aprop.index = ppp$
    End If
    aprop.UseIndex = True
     Set aprop = Nothing
     End If
     
conthere:
    If closepar Then If Not FastSymbol(rst$, ")") Then MyEr "missing )", "λείπει )": Exit Function
    
    NeoGetArrayItem = True
ElseIf PP.SerialItem((0), dd, 5) Then
dd = dd - 1
offset = 0
Do While dn <= dd

PP.SerialItem W3, dn, 6
 If IsExp(bstack, rst$, p) Then
 If dn < dd Then
        If Not FastSymbol(rst$, ",") Then MyEr "need index for " & v$ & ")", "χρειάζομαι δείκτη για το πίνακα " & v$ & ")": Exit Function
        Else
        If FastSymbol(rst$, ",") Then MyEr "too many indexes for array " & v$ & ")", "πολλοί δείκτες για το πίνακα " & v$ & ")": Exit Function
        If Not FastSymbol(rst$, ")") Then MyEr "missing )", "λείπει )": Exit Function
    End If
        On Error Resume Next
        If p < 0 Then
         MyEr "negative index in array " & v$ & ")", "αρνητικός δείκτης στο πίνακα " & v$ & ")": Exit Function
    
        End If
        If PP.PushOffset(offset, dn, CLng(p)) Then
        NeoGetArrayItem = True
        Else
          
          MyEr "index too high for array " & v$ & ")", "δείκτης υψηλός για το πίνακα " & v$ & ")": Exit Function
        
            
            End If
        Else
         If LastErNum = -2 Then
         Else
   MyEr "missing index for array " & v$ & ")", "χάθηκε δείκτης για το πίνακα " & v$ & ")"
   End If
   Exit Function
    End If
    dn = dn + 1
Loop
End If
End Function
Sub getfirstpage()
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If
'If pwox > phoy Then mydpi = phoy Else mydpi = pwox
''mydpi = pwox / 4
If pwox <= phoy Then
mydpi = pwox
Else
mydpi = phoy
End If
' DC FROM PRINTER
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then
oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
Form1.PrinterDocument1.Cls
oprinter.needHDC
Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi / 4) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi / 4 + 0.5), 3, 1))
pnum = 0
End If
End Sub
Sub getnextpage()

If oprinter.Height = 0 Then
getfirstpage

Else
pnum = pnum + 1
With players(-2)
.curpos = 0
.currow = 0
.lastprint = False
.XGRAPH = 0
.YGRAPH = 0
End With
With Form1.PrinterDocument1
.CurrentX = 0
.CurrentY = 0
End With
oprinter.CopyPicture Form1.PrinterDocument1
oprinter.ThumbnailPaintPrinter 1, , False, True, True, , , , , , Form3.CaptionW & " " & Str$(pnum)
Form1.PrinterDocument1.Cls
End If
End Sub
Sub getenddoc()
pnum = pnum + 1
oprinter.CopyPicture Form1.PrinterDocument1
oprinter.ThumbnailPaintPrinter 1, 100, False, True, True, , , , , , Form3.CaptionW & " " & Str$(pnum)
oprinter.ClearUp
Form1.PrinterDocument1.Picture = LoadPicture("")
End Sub
Sub Landscape(bstack As basetask)
Dim dummy As Object
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If

'If pwox > phoy Then mydpi = phoy Else mydpi = pwox
mydpi = pwox

If Int(psw / pwox * mydpi + 0.5) / Int(psh / phoy * mydpi + 0.5) < 1 Then ChangeOrientation dummy, Printer.DeviceName, MyDM(): PrinterDim pw, ph, psw, psh, pwox, phoy
If Not bstack.toprinter Then Exit Sub
oprinter.ClearUp
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then
oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
oprinter.needHDC
Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi / 4) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi / 4 + 0.5), 3, 1))

End If


End Sub
Sub Portrait(bstack As basetask)
Dim dummy As Object
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If

'If pwox > phoy Then mydpi = phoy Else mydpi = pwox
mydpi = pwox / 4
If Int(psw / pwox * mydpi + 0.5) / Int(psh / phoy * mydpi + 0.5) > 1 Then ChangeOrientation dummy, Printer.DeviceName, MyDM(): PrinterDim pw, ph, psw, psh, pwox, phoy
If Not bstack.toprinter Then Exit Sub
oprinter.ClearUp
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then

oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
oprinter.needHDC
Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi / 4) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi / 4 + 0.5), 3, 1))

End If

End Sub
Function StripTerminator(ByVal strString As String) As String
    Dim intZeroPos As Long

    intZeroPos = InStr(strString, Chr$(0))
    If intZeroPos > 0 Then
        StripTerminator = Left$(strString, intZeroPos - 1)
    Else
        StripTerminator = strString
    End If
End Function
Sub AddDirSep(strPathName As String)
    If Right(Trim(strPathName), Len(gstrSEP_URLDIR)) <> gstrSEP_URLDIR And _
       Right(Trim(strPathName), Len(gstrSEP_DIR)) <> gstrSEP_DIR Then
        strPathName = RTrim$(strPathName) & gstrSEP_DIR
    End If
End Sub

Function GetWindowsDir() As String
    Dim strBuf As String

    strBuf = Space$(gintMAX_SIZE)

    '
    'Get the windows directory and then trim the buffer to the exact length
    'returned and add a dir sep (backslash) if the API didn't return one
    '
    If GetWindowsDirectory(strBuf, gintMAX_SIZE) > 0 Then
        strBuf = StripTerminator$(strBuf)
        AddDirSep strBuf

        GetWindowsDir = strBuf
    Else
        GetWindowsDir = ""
    End If
End Function
Function GetWindowsfontDir() As String
    Dim strBuf As String

    strBuf = Space$(gintMAX_SIZE)

    '
    'Get the windows directory and then trim the buffer to the exact length
    'returned and add a dir sep (backslash) if the API didn't return one
    '
    If GetWindowsDirectory(strBuf, gintMAX_SIZE) > 0 Then
        strBuf = StripTerminator$(strBuf)
        AddDirSep strBuf
        strBuf = strBuf & "FONT"
        AddDirSep strBuf
    
        GetWindowsfontDir = strBuf
    Else
        GetWindowsfontDir = ""
    End If
End Function

 
Sub nhelp(bstack As basetask, Optional GREEK As Boolean = False)
Dim di As Object
Set di = bstack.Owner
If GREEK Then
Dim bb$
bb$ = "   ΕΛΛΗΝΙΚΑ ή ΛΑΤΙΝΙΚΑ για επιλογή κωδικοσελίδας για το τύπο εμφάνισης βοήθειας " & vbCrLf
bb$ = bb$ & "   Με Esc τερματίζει η εκτέλεση τμημάτων  " & vbCrLf
bb$ = bb$ & "   ctrl + f1 ανοίγει την βοήθεια, γράφοντας και επιλέγοντας βρίσκει" & vbCrLf
bb$ = bb$ & "   ctrl + c Τερματίζει την εκτέλεση και καθαρίζει" & vbCrLf
bb$ = bb$ & "   ctrl + οποιοδήποτε πλήκτρο ανοίγει τη βηματική εκτέλεση" & vbCrLf
bb$ = bb$ & "   pause/break κάνει ψυχρή εκκίνηση / δες ΒΟΗΘΕΙΑ ΑΡΧΗ" & vbCrLf
bb$ = bb$ & "   Σ ονομαΤμηματος ανοίγει τον διορθωτή για να γράψουμε πρόγραμμα" & vbCrLf
bb$ = bb$ & "   Σ ονομαΣυνάρτησης( ανοίγει τον διορθωτή για να γράψουμε συνάρτηση" & vbCrLf
bb$ = bb$ & "   Σ ονομαΣυνάρτησης$( ανοίγει τον διορθωτή για να γράψουμε συνάρτηση$" & vbCrLf
bb$ = bb$ & "   Τμηματα  [μας δείχνει τα τμήματα στη μνήμη και το δίσκο]" & vbCrLf
bb$ = bb$ & "   ΒΟΗΘΕΙΑ κατι  {μας δίνει βοήθεια σε ξεχωριστό παράθυρο)" & vbCrLf
bb$ = bb$ & "   ? ή ΤΥΠΩΣΕ τυπώνει" & vbCrLf
bb$ = bb$ & "   δώσε την εντολή ΡΥΘΜΙΣΕΙΣ η ctrl+U για να αλλάξει την εξ ορισμού γραμματοσειρά και τα χρώματα" & vbCrLf

Else
bb$ = "   GREEK or LATIN for choose the codepage for errors display" & vbCrLf
bb$ = bb$ & "   with LATIN all error messages are in ENGLISH language  " & vbCrLf
bb$ = bb$ & "   Esc escape execution" & vbCrLf
bb$ = bb$ & "   ctrl + f1 open help form, you can write and click for find" & vbCrLf
bb$ = bb$ & "   ctrl + c terminate execution, clear all" & vbCrLf
bb$ = bb$ & "   ctrl + anykey open for test" & vbCrLf
bb$ = bb$ & "   pause/break for break cold reset / look HELP START" & vbCrLf
bb$ = bb$ & "   EDIT modulename     [open editor for writing program]" & vbCrLf
bb$ = bb$ & "   EDIT functionname( [open editor for writing function()]" & vbCrLf
bb$ = bb$ & "   EDIT functionname$( [open editor for writing function$()]" & vbCrLf
bb$ = bb$ & "   MODULES for a list of modules in memory and on dik" & vbCrLf
bb$ = bb$ & "   use HELP writesomething [to find some help, open the help form]" & vbCrLf
bb$ = bb$ & "   ? or PRINT for printing" & vbCrLf
bb$ = bb$ & "   type SETTINGS or ctrl+U to change the default font and colors" & vbCrLf

End If
wwPlain bstack, players(GetCode(bstack.Owner)), bb$, di.Width, 1000, True
crNew bstack, players(GetCode(bstack.Owner))
End Sub
Public Sub EnableMidi()
Dim curDevice As Long, rc As Long

 If hmidi = 0 Then
rc = GetFuncPtr("winmm.dll", "midiOutOpen")
If rc <> 0 Then
    rc = midiOutOpen(hmidi, curDevice, 0, 0, 0)
    If (rc <> 0) Then
        MsgBox "Couldn't open midi device - Error #" & rc
    End If
    End If
    End If
End Sub
Public Sub DisableMidi()
  midiOutClose (hmidi)
  hmidi = 0
End Sub
Public Sub Quit()
  ' An example of an Application Quit routine:
  
  ' The Dispose method must be called to
  ' clean up the queue
  DisableMidi
  TaskMaster.Dispose
  Set TaskMaster = Nothing
  
  ' Insure all but 1 form is unloaded.
  ' (When called from Form_Unload, that form
  '  cannot be removed, so 1 is allowed)
  Do While Forms.count > 1
    Unload Forms(1)
  Loop
  ' Notification if there are problems with demo
  Debug.Assert Forms.count = 1
End Sub


' TASK MASTER TIMING ROUTINE

Public Sub TaskMasterTick()
' This is the TimerFunction that will be
' called when SetTimer times out.

  If Not TaskMaster Is Nothing Then
     ''MasterTimer + CDbl(TaskMaster.Interval)
    '' CDbl(timeGetTime)
    If Abs(MasterTimer - CDbl(timeGetTime)) > 50 Then
  If Not extreme Then Sleep 1: MyDoEvents1 Form1
    MasterTimer = CDbl(timeGetTime)
    End If
   ' Form1.Caption = MasterTimer
    TaskMaster.TimerTick
  End If

End Sub
Public Sub instrument(insID As Long, Channel As Long)
EnableMidi
Dim midimsg As Long
    midimsg = (insID * 256) + &HC0 + Channel
    midiOutShortMsg hmidi, midimsg
End Sub
Public Function VALIDATEmStiva(bs As basetask, p$, s$) As Boolean
Dim st As mStiva, ss$, j As Long

Set st = bs.soros
Dim i As Long, r$
If p$ <> "" Then
    ''s$ = ""
    If st.Total < Len(p$) Then Exit Function
    Do While i < Len(p$)
    i = i + 1
    j = AscW(st.StackItemType(i))
If j <> 62 Then
    Select Case AscW(Mid$(p$, i, 1))
    Case 62
    ' OPTIONAL IS OK ??

    Case 66, 98, 916, 948
        If j <> 42 Then Exit Function
        If Typename$(st.StackItem(i)) = "mHandler" Then
            If st.StackItem(i).T1 <> 2 Then Exit Function
        Else
            Exit Function
        End If
    
    Case 73, 105, 922, 954
        If j <> 42 Then Exit Function
        If Typename$(st.StackItem(i)) = "mHandler" Then
            If st.StackItem(i).T1 <> 1 Then Exit Function
        Else
            Exit Function
        End If
    Case 925, 957, 913, 945, 78, 110 '' number  - use spellunicode to make it
        If j <> 78 Then Exit Function
    Case 923, 955, 70, 102  ' change from L l to F f form lambda
     If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 1))
        If j <> 108 Then Exit Function
    Case 915, 947, 83, 115 '' string
        If j <> 83 Then Exit Function
    Case 928, 960, 65, 97  '' array
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 2))
        If j <> 65 Then Exit Function
    Case 917, 69
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 2))
        If j <> 69 Then Exit Function
    Case 927, 959, 954, 71, 103, 67, 99
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 1))
         If j <> 71 Then Exit Function
    Case 76, 924
    If j <> 76 Then Exit Function
    Case Else
        Exit Function
    End Select
    End If
    
    Loop
    s$ = " "
    VALIDATEmStiva = True
    Exit Function
Else
    Do
    i = i + 1
    If st.Total < i Then Exit Do
        ss$ = st.StackItemType(i)
        If ss$ = "*" Then
        
            ss$ = Left$(Typename(st.StackItem(i)), 2)
            If ss$ = "mA" Then ss$ = "A"
            If ss$ = "mE" Then ss$ = "E"
            If ss$ = "Gr" Then ss$ = "G"
            If ss$ = "la" Then ss$ = "F"
            If ss$ = "mH" Then
                Select Case st.StackItem(i).T1
                Case 1
                ss$ = "I"
                Case 2
                ss$ = "B"
                Case Else
                ss$ = "U"   ' "Undefined"
                End Select
            End If
        End If
    r$ = r$ & Right$("?" + ss$, 1)
    Loop
    s$ = r$
End If
VALIDATEmStiva = r$ <> ""
End Function

Public Function VALIDATE(st$, p$, s$) As Boolean
Dim dummy As Double
Dim i As Long, j As Long, ok As Boolean
If Len(st$) = 0 Then
VALIDATE = True
End If
' NORMALIZE
s$ = ""
ok = True
For i = 1 To Len(st$)
Select Case Mid$(st$, i, 1)
Case " ", ",", ChrW(160)

Case Is = Chr(34)
j = InStr(i + 1, st$, Chr(34), vbBinaryCompare)
If j = 0 Then Exit For
s$ = s$ & "S"
i = j + 1
            If p$ <> "" Then
                Select Case AscW(p$)
                Case 915, 947, 83, 115 '' string
                Case Else
                        ok = False: Exit For
                End Select
                    p$ = Mid$(p$, 2)
                    If p$ = "" Then Exit For
             End If
 Case Is = Chr$(2)
            If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             s$ = s$ & "S"
             If p$ <> "" Then
                Select Case AscW(p$)
                Case 915, 947, 83, 115 '' string
                Case Else
                        ok = False: Exit For
                End Select
             p$ = Mid$(p$, 2)
             If p$ = "" Then Exit For
             End If
             Else
             Exit For
             End If
Case Else
        If IsNumberD3(st$, i, j) Then
                If i = 0 Then i = j + 1
                i = i + j - 2
                s$ = s$ & "N"
                    If p$ <> "" Then
                Select Case AscW(p$)
                 Case 925, 957, 913, 945, 78, 110 '' number
                Case Else
                        ok = False: Exit For
                End Select
                         p$ = Mid$(p$, 2)
                         If p$ = "" Then Exit For
                    End If
      Else
          Exit For
      End If
End Select
      

Next i
 ' TO P$ ΘΑ ΠΑΡΕΙ ΤΟ ΥΠΟΛΟΙΠΟ

   p$ = Mid$(st$, i + 1)
   st$ = Left$(st$, i)
    VALIDATE = ok
End Function

Public Function VALIDATEpart(st$, p$) As Boolean
Dim dummy As Double
Dim i As Long, j As Long, ok As Boolean, s$
If Len(st$) = 0 Then
VALIDATEpart = False   ' reverse logic here...
End If
' NORMALIZE
s$ = ""
ok = True
For i = 1 To Len(st$)
If Mid$(st$, i, 1) = Chr$(2) Then
            If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             Else
             Exit For
             End If
      ElseIf IsNumberD3(st$, i, j) Then
      i = j + i - 2
      Else
      i = i - 1
      Exit For
      End If
      

Next i
p$ = Left$(st$, i)
    st$ = " " & Mid$(st$, i + 1)
    VALIDATEpart = p$ <> ""
End Function

Private Function validateold(st$, p$, s$) As Boolean
Dim counter As Long, MARKSTART As Long, MARKEND As Long, test$, dumy As Double
Dim i As Long, j As Long, ok As Boolean
If Len(st$) = 0 Then
validateold = True
End If
MARKSTART = Len(st$) + 1
s$ = ""
ok = True
For i = 1 To Len(st$)
If i < MARKSTART Then
    MARKSTART = i: MARKEND = i
            If Mid$(st$, i, 1) = Chr$(2) Then
            If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             s$ = s$ & "S"
             Else
             ok = False: Exit For
             End If
            MARKSTART = Len(st$) + 1
            End If
    ElseIf Mid$(st$, i, 1) = Chr$(2) Then
        If MARKEND > MARKSTART Then
            If Mid$(st$, MARKSTART, 1) = " " Then
                test$ = Mid$(st$, MARKSTART, MARKEND - MARKSTART + 1)
                If IsNumberD2(test$, dumy) Then
                If Len(test$) <> 0 Then ok = False: Exit For
                End If
                s$ = s$ & "N"
           '  MARKSTART = Len(ST$) + 1
            Else
                ok = False: Exit For
            End If
         End If
                If p$ <> "" Then
                   If Len(s$) = Len(p$) Then
                   If s$ <> p$ Then ok = False
                   Exit For
                   End If
                   End If
               If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             s$ = s$ & "S"
             Else
             ok = False: Exit For
             End If
        MARKSTART = Len(st$) + 1
    ElseIf Mid$(st$, i, 1) = " " Then
      If MARKEND > MARKSTART Then
            If Mid$(st$, MARKSTART, 1) = " " Then
                test$ = Mid$(st$, MARKSTART, MARKEND - MARKSTART + 1)
                If IsNumberD2(test$, dumy) Then
                If Len(test$) <> 0 Then ok = False: Exit For
                End If
              s$ = s$ & "N"
            Else
                ok = False: Exit For
            End If
         End If
        MARKSTART = i: MARKEND = i
    Else
    MARKEND = MARKEND + 1
End If
If p$ <> "" Then
If Len(s$) = Len(p$) Then
If s$ <> p$ Then ok = False
Exit For
End If
End If
Next i
If Not (ok And s$ = p$ And s$ <> "") Then
 If ok And (MARKEND > MARKSTART) Then
If Mid$(st$, MARKSTART, 1) = " " Then
                test$ = Mid$(st$, MARKSTART, MARKEND - MARKSTART + 1)
                If IsNumberD2(test$, dumy) Then
                If Len(test$) <> 0 Then ok = False
                End If
              s$ = s$ & "N"
            Else
                ok = False
            End If
    End If
    If p$ <> "" Then
If Len(s$) = Len(p$) Then
If s$ <> p$ Then ok = False
End If
End If
    End If
    If ok And p$ <> "" Then
    p$ = Mid$(st$, i)
    st$ = Left$(st$, i - 1)
    End If
    validateold = ok
End Function

Public Function GetTempFileName() As String

   Dim sTmp    As String
   Dim sTmp2   As String
   Dim EXENAME As String
   EXENAME = App.EXENAME

   sTmp2 = GetTempPathgg
   sTmp = Space(Len(sTmp2) + 256)
   Call GetTempFileNameW(StrPtr(sTmp2), StrPtr(EXENAME), UNIQUE_NAME, StrPtr(sTmp))
   GetTempFileName = Left$(sTmp, InStr(sTmp, Chr$(0)) - 1)
    tempList2delete = Sput(GetTempFileName) + tempList2delete
End Function
Public Sub DelTemp()
Dim Tmp$
On Error Resume Next
While tempList2delete <> ""
If Not ISSTRINGA(tempList2delete, Tmp$) Then Exit Sub
KillFile Tmp$
Wend

End Sub

Private Function GetTempPathgg() As String
  
   Dim sTmp       As String
   Dim i          As Long
    Dim EM$
    
   i = GetTempPath(0, StrPtr(EM$))
   sTmp = Space(i)

   Call GetTempPath(i, StrPtr(sTmp))
   GetTempPathgg = AddBackslash(Left$(sTmp, i - 1))

End Function

Private Function AddBackslash(s As String) As String

   If Len(s) > 0 Then
      If Right$(s, 1) <> "\" Then
         AddBackslash = s & "\"
      Else
         AddBackslash = s
      End If
   Else
      AddBackslash = "\"
   End If

End Function


Private Sub olamazi()
If Form4.Visible Then
Form4.Visible = False
If Form1.Visible Then
   
   ' If Form2.Visible Then Form2.ZOrder
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
    End If
    End If
End Sub
Sub mywait(bstack As basetask, PP As Double, Optional SLEEPSHORT As Boolean = False)
Dim p As Boolean, e As Boolean
On Error Resume Next
If bstack.Process Is Nothing Then
''If extreme Then MyDoEvents1 Form1
If PP = 0 Then Exit Sub
Else

Err.Clear
p = bstack.Process.Done
If Err.Number = 0 Then
e = True
If p <> 0 Then
Exit Sub
End If
End If
End If

PP = PP + CDbl(timeGetTime)

Do


If TaskMaster.Processing And Not bstack.TaskMain Then
        If Not bstack.toprinter Then bstack.Owner.Refresh
        TaskMaster.TimerTick
       ' SleepWait 1
        MyDoEvents1 Form1
Else
        ' SleepWait 1
        MyDoEvents1 Form1
End If
If SLEEPSHORT Then Sleep 1
If e Then
p = bstack.Process.Done
If Err.Number = 0 Then
If p <> 0 Then
Exit Do
End If
End If
End If
Loop Until PP <= CDbl(timeGetTime) Or NOEXECUTION

                       If exWnd <> 0 Then
                MyTitle$ bstack
                End If
End Sub
Sub ProcTask(bstack As basetask)
If TaskMaster.Processing Then
           TaskMaster.RestEnd1
 TaskMaster.TimerTick
''TaskMaster.rest
ElseIf Not bstack.IamChild Then
If REFRESHRATE > 25 Then k1 = 0
REFRESHRATE = 40
Sleep 1
ElseIf SLOW Then
Sleep 1
End If
TaskMaster.rest
SleepWaitEdit 1
TaskMaster.RestEnd
End Sub
Sub ProcTask2(bstack As basetask)
If TaskMaster.Processing Then
          TaskMaster.RestEnd1
 TaskMaster.TimerTickNow

ElseIf SLOW Then
Sleep 1

End If
TaskMaster.rest

SleepWaitEdit2 1
TaskMaster.RestEnd
End Sub
Function mybreakkey() As Boolean
If RRCOUNTER = 1 Then
    If KeyPressedLong(&H13) = 1 Then
k1 = 0
mybreakkey = Form1.mybreak1()
End If
End If
RRCOUNTER = RRCOUNTER + 1
If RRCOUNTER > 10000 Then If Not extreme Then MyDoEvents: RRCOUNTER = RRCOUNTER And &HFFFF

End Function
Sub ResetBreak()
Do While KeyPressedLong(&H13) <> 0
MyDoEvents
Loop

End Sub

Function myexit(bstack As basetask) As Boolean
'Static counter As Long
Dim p As Boolean
On Error Resume Next
If Not extreme Then
            If escok Then
                        If KeyPressed(&H1B) Then
                        If ModalId <> 0 Then
                         ModalId = 0
                         ShutEnabledGuiM2000
                         MyDoEvents
                           While KeyPressed(&H1B)
                                            MyDoEvents
                                    Wend
                        Else
                         NOEXECUTION = True
                           ShutEnabledGuiM2000 True
                         MyDoEvents
                                    If AVIRUN Then AVI.GETLOST
                                    NOEXECUTION = True
                                    While KeyPressed(&H1B)
                                            MyDoEvents
                                    Wend
                                    myexit = True
                                    Exit Function
                        End If
                        ElseIf NOEXECUTION Then
                          ShutEnabledGuiM2000 True
                         MyDoEvents
                        End If
             End If
End If
'If counter = 0 Then Sleep 0: counter = 5001
'counter = counter - 1
If bstack Is Nothing Then
myexit = True: Exit Function
End If
If TaskMaster.OnlyMusic Then
TaskMaster.TimerTick
End If
If bstack.IamThread Then

myexit = bstack.Process.Done
Else
myexit = False
End If
End Function

Sub closeAll()
Dim i As Long
For i = 0 To 511
If FLEN(i) > 0 Then
FLEN(i) = 0
Close i
End If
Next i
CloseAllConnections
End Sub
Function MakeitObjectGeneric(Number As Long) As Object
Dim aa As New mHandler, k As Long
aa.T1 = 3
On Error GoTo there
Do While TypeOf var(Number) Is mHandler
If Not var(Number).Indirect < 0 Then Exit Do
If k > 10 Then Exit Do
Number = var(Number).Indirect
k = k + 1
Loop
there:
aa.Indirect = Number

Set aa.objref = Nothing
Set MakeitObjectGeneric = aa
End Function

Sub MakeitObjectInventory(var As Variant)
Dim aa As New mHandler
aa.T1 = 1 ' 1 for Inventory
Set aa.objref = New FastCollection
Set var = aa
End Sub
Sub MakeitObjectBuffer(var As Variant)
Dim aa As New mHandler
aa.T1 = 2 ' 2 for Buffer
Set aa.objref = New MemBlock
Set var = aa
End Sub
Sub MakeitObjectLong(var As Variant)
Dim aa As Long
var = aa
End Sub
Sub MakeitObjectEvent(var As Variant)
Dim aa As New mEvent
Set var = aa
End Sub
Sub MakeitObject(var As Variant)
Dim aa As New Document
Set var = aa
var.textDoc = ""
End Sub
Sub MakeitPropReference(var As Variant)
Dim aa As New PropReference
Set var = aa
End Sub
Sub CreateFormObject(var As Variant, Id As Long)
Dim aa As Object
Select Case Id
Case 1
Set aa = New GuiM2000
Load aa
Case 2  '
Set aa = New GuiButton
Case 3
Set aa = New GuiTextBox
Case 4
Set aa = New GuiCheckBox
Case 5
Set aa = New GuiEditBox
Case 6
Set aa = New GuiListBox
Case 7
Set aa = New GuiDropDown
End Select
Set var = aa
End Sub
Sub CreateFormOtherObject(var As Variant, ThisObject As Object)
Set var = ThisObject
End Sub
Private Function GetShink(ev As ComShinkEvent, v As Long, objname$) As Boolean
Dim aa As Object
    Set ev = New ComShinkEvent
    Set aa = var(v)
                         ev.VarIndex = v
                         If here$ <> "" Then
                         ev.ModuleName = here$ + "." + objname$
                         ev.modulenameonly = here$
                         Else
                         ev.ModuleName = objname$
                         ev.modulenameonly = ""
                         End If
                         ev.Attach aa
   Set aa = Nothing
   GetShink = ev.Attached()
End Function
Sub CreateitObject(var As Variant, THISOjBECT As String, Optional ByVal cc As Variant)
Dim aa As Object, b As GUID
If IsMissing(cc) Then
If Left$(THISOjBECT, 1) = "{" Then
    THISOjBECT = strProgIDfromSrting(THISOjBECT)
End If
On Error Resume Next
Set aa = CreateObject(THISOjBECT)
If Err Then
MyEr Err.Description, Err.Description
End If

Else
Set aa = CreateObject(THISOjBECT, CStr(cc))
End If
Set var = aa
End Sub
Sub CheckVar(var As Variant, s As String)

If Typename(var) = doc Then
If var.IsEmpty Then
var.textDoc = s
Else
var.InsertDoc var.LastParagraph, var.TextParagraphLen(var.LastParagraph) + 1, s
End If
Else
var = s
End If
End Sub
Sub CheckVarLong(var As Variant, l As Long)

If IsObject(var) Then

Set var = Nothing
var = Empty
End If
var = l

End Sub
Sub LATIN(bstack As basetask)
On Error Resume Next
cLid = 1033
UserCodePage = 1252

With Form1
bstack.myCharSet = 0
If bstack.tolayer > 0 Then
    .dSprite(bstack.tolayer).Font.charset = 0
    ElseIf bstack.toback Then
    .Font.charset = 0
    Else
    
    .DIS.Font.charset = bstack.myCharSet
    .TEXT1.Font.charset = bstack.myCharSet
    .List1.Font.charset = bstack.myCharSet
   ' .List2.Font.CharSet = bstack.myCharSet
    End If
End With
pagio$ = "LATIN"
cLid = 1033
DialogSetupLang 1
End Sub
Sub GREEK(bstack As basetask)
On Error Resume Next
cLid = 1032
UserCodePage = 1253
With Form1
   bstack.myCharSet = 161
If bstack.tolayer > 0 Then
    .dSprite(bstack.tolayer).Font.charset = 161
    ElseIf bstack.toback Then
    .Font.charset = 161
    Else
 
    .DIS.Font.charset = bstack.myCharSet
    .TEXT1.Font.charset = bstack.myCharSet
    .List1.Font.charset = bstack.myCharSet
   ' .List2.Font.CharSet = bstack.myCharSet
    End If
End With
pagio$ = "GREEK"
cLid = 1032
DialogSetupLang 0
End Sub
Private Function GetLCIDFromKeyboard() As Long
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      r = GetKeyboardLayout(DWL_ANYTHREAD) And &HFFFF
      r = val("&H" & Right(Hex(r), 4))
        ret = GetLocaleInfoW(r, LOCALE_ILANGUAGE, StrPtr(Buffer), Len(Buffer))
    GetLCIDFromKeyboard = CLng(val("&h" + Left$(Buffer, ret - 1)))
End Function
Public Function GetLCIDFromKeyboardLanguage() As String
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      r = GetKeyboardLayout(DWL_ANYTHREAD) And &HFFFF
      r = val("&H" & Right(Hex(r), 4))
      'LOCALE_SENGLANGUAGE&
      If cLid = 0 Then ''
      ret = GetLocaleInfoW(r, LOCALE_SENGLANGUAGE&, StrPtr(Buffer), Len(Buffer))
      Else
        ret = GetLocaleInfoW(r, LOCALE_SLANGUAGE&, StrPtr(Buffer), Len(Buffer))
        End If
     If shortlang Then If ret > 3 Then ret = 4
     On Error Resume Next
    GetLCIDFromKeyboardLanguage = Left$(Buffer, ret - 1)

End Function
Private Function GetlocaleString(ByVal This As Long) As String
On Error GoTo 1234
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      
        ret = GetLocaleInfoW(cLid, This, StrPtr(Buffer), Len(Buffer))
    GetlocaleString = Left$(Buffer, ret - 1)
    
1234:
    
End Function
Private Function GetDeflocaleString(ByVal This As Long) As String
On Error GoTo 1234
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      
        ret = GetLocaleInfoW(0, This, StrPtr(Buffer), Len(Buffer))
    GetDeflocaleString = Left$(Buffer, ret - 1)
    
1234:
    
End Function

Sub helpBin(f&, n$)
Dim A() As Byte
A() = n$
Put #f, , A
End Sub
Sub MakeitObject2(var As Variant)
Dim aa As Object
Set aa = New Group
Set var = aa
End Sub

Sub prepareGroup(bstack As basetask, ByVal ohere$, vvv As Long, Optional glob As Boolean = False)
Dim hv As Boolean
'' ohere$ = myUcase(ohere$)
If Not glob Then
If here$ = "" Then
    hv = GetVar(bstack, bstack.GroupName & ohere$, vvv)
Else
    hv = GetlocalVar(bstack.GroupName & ohere$, vvv)
 End If
 End If
If hv Then
' so it is an object now
    If Not IsObject(var(vvv)) Then
        MakeitObject2 var(vvv)
    ElseIf Typename(var(vvv)) <> "Group" Then
        MakeitObject2 var(vvv)
    End If
Else
    vvv = GlobalVarRefOnly(bstack.GroupName & ohere$, glob)
    MakeitObject2 var(vvv)
 'If Not glob Then
 var(vvv).GroupName = ohere$ + "."
End If
var(vvv).edittag = ""
End Sub

Function ExecuteVarOnly(bstack As basetask, ohere$, vvv As Long, rest$, lang As Long, Optional glob As Boolean = False) As Long
Dim w$, p As Double, v As Long, ss$, b$, i As Long, lcl As Boolean, j As Long, nm$, x1 As Long, y1 As Long, frm$
Dim prv As Boolean
Const TT$ = "=-+*/<!,{" + vbCr
If Trim(rest$) = "" Then
    var(vvv) = CLng(0)
    ExecuteVarOnly = 1
    Exit Function
End If
Dim myobject As Object

Dim OvarnameLen As Long, OarrnameLen As Long
Dim f$
Dim pppp As mArray


OvarnameLen = varhash.count + 1 ' new way


   
 If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & var(vvv).GroupName '' & "."
  Else
  bstack.GroupName = var(vvv).GroupName ''& "."
  End If


   ExecuteVarOnly = 1
Do
there100:
Do

If Left$(NLtrim$(rest$) + "00", 2) = vbCrLf Or MaybeIsSymbol(rest$, "\'") Then
SetNextLine rest$
lcl = False
Else
Exit Do
End If

Loop
there12345:
If NocharsInLine(rest$) Then Exit Do
v = IsLabelA(here$, rest$, w$)
'Debug.Print w$

If v = 0 Then Exit Do



Select Case w$
Case "PRIVATE", "ΙΔΙΩΤΙΚΟ"
If Not IsOperator(rest$, ":") Then
ExecuteVarOnly = False
Exit Function
End If
prv = True
GoTo there100
Case "PUBLIC", "ΔΗΜΟΣΙΟ"
If Not IsOperator(rest$, ":") Then
ExecuteVarOnly = False
Exit Function
End If
prv = False
GoTo there100
Case "LOCAL", "ΤΟΠΙΚΑ", "ΤΟΠΙΚΗ", "ΤΟΠΙΚΕΣ"
lcl = True
GoTo there12345
Case "CLASS", "ΚΛΑΣΗ"
If IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", lang) Then
MyEr "GLOBAL can't used in a CLASS", "Η κλάση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteVarOnly = False
Exit Function
End If
 If IsLabelA("", rest$, w$) = 1 Then
                     If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", lang) Then
                     MyEr "Use here a Group not a Class", "Χρησιμοποίησε μια Ομάδα και όχι μια Κλάση"
                    ExecuteVarOnly = False
                    Exit Function
                    End If
                If here$ = "" Then
                f$ = bstack.GroupName + w$
                Else
                f$ = w$
                End If
        If lang = 1 Then
               If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
            If Right$("  " + ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
            
            rest$ = f$ + "  {  group " + w$ + " {" + ss$ & "}" + vbCrLf + " try { call! " + w$ + "." + w$ + " }  : =" + w$ + rest$
           
            w$ = ""
            GoTo classcontclass
            Else
             f$ = w$
            w$ = "Group "
            End If
         Else
            If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
            If Right$("  " + ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
            rest$ = f$ + "  {  ΟΜΑΔΑ " + w$ + " {" + ss$ & "}" + vbCrLf + " try { call! " + w$ + "." + w$ + "}  : =" + w$ + rest$
            'If glob Then rest$ = " νεα " + rest$
            w$ = ""
            GoTo classcontclass
            Else
             f$ = w$
            w$ = "ΟΜΑΔΑ "
            End If
            
        End If
        
        Do While FastSymbol(rest$, ",")
         If IsLabelA("", rest$, nm$) <> 1 Then
            SyntaxError
            ExecuteVarOnly = False
            Exit Function
         End If
             f$ = f$ + w$ + nm$ + vbCrLf
        Loop
            If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", lang) Then
                 MyEr "Use here a Group not a Class", "Χρησιμοποίησε μια Ομάδα και όχι μια Κλάση"
                ExecuteVarOnly = False
            Exit Function
            End If
            w$ = Trim$(w$)
            rest$ = f$ + rest$
        GoTo contVar
            Else
            SyntaxError
            ExecuteVarOnly = False
            Exit Function
            
   End If
Case "REM", "ΣΗΜ"
SetNextLine rest$: GoTo there100
Case "FUNCTION", "ΣΥΝΑΡΤΗΣΗ"
If IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", lang) Then
MyEr "GLOBAL can't used in a Group", "Η συνάρτηση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteVarOnly = False
Exit Function
End If
classcontclass:
x1 = Abs(IsLabel(bstack, rest$, f$))
    If prv Then f$ = ChrW(&HFFBF) + f$
''f$ = myUcase$(f$)
If x1 <> 0 Then
  If var(vvv).FuncList <> "" Then  ' maybe we have it
  If InStr(var(vvv).FuncList, Chr$(2) + f$ + "() ") > 0 Then
  IsSymbol3 rest$, "{"
    ss$ = block(rest$)
    If FastSymbol(rest$, "}") Then
             If GetSub(bstack.GroupName + f$ + "()", i) Then
                         If rinstr(sbf(i).sbgroup, bstack.GroupName) + Len(bstack.GroupName) - 1 = Len(sbf(i).sbgroup) Then
                         bstack.IndexSub = i
                          sbf(i).sb = ss$
                          GoTo there12345
                          Else
                          End If
             End If
 
   If here$ <> "" Then

             If lang = 1 Then
                rest$ = "GLOBAL " + Chr(34) + here$ + "." + bstack.GroupName + f$ + Chr(34) + " { " + ss$ + "} " + rest$
                  Else
                  rest$ = "ΓΕΝΙΚΗ " + Chr(34) + here$ + "." + bstack.GroupName + f$ + Chr(34) + " { " + ss$ + "} " + rest$ ''sbf(I).sbGROUP +  " { " + ss$ + "} " + Rest$
                  End If
   GoTo BYPASS3
   Else
   
        ExecuteVarOnly = 0: Exit Function
   End If
   End If
  End If
  End If
  ' so is the first time, put it back
  If Left$(sbf(bstack.OriginalCode).sb, 10) = "'11001EDIT" Then
   
   ss$ = rest$
     IsSymbol3 ss$, "{"
    frm$ = block(ss$)
  If Right$(ss$, 2) <> vbCrLf Then
        b$ = GetNextLine((sbf(bstack.OriginalCode).sb)) + "+2"
  Else
        b$ = GetNextLine((sbf(bstack.OriginalCode).sb))
        End If
        nm$ = GetStrUntil(",", Mid$(b$, 12))
      GetSub nm$, i
      IsSymbol3 rest, "{"
       b$ = "{" + b$ + "+" + CStr(Len(sbf(i).sb)) + "-" + CStr(Len(ss$)) + vbCrLf
     
        
    rest$ = b$ + rest$


  End If
  If here$ = "" Then
  If w$ = "" Then
  If lang = 1 Then
    rest$ = "NEW " + f$ & " " & rest$
    w$ = "FUNCTION"
    Else
     rest$ = "ΝΕΑ " + f$ & " " & rest$
     w$ = "ΣΥΝΑΡΤΗΣΗ"
    End If
  Else
  If lang = 1 Then
    rest$ = "NEW " + bstack.GroupName + f$ & " " & rest$
    
    Else
     rest$ = "ΝΕΑ " + bstack.GroupName + f$ & " " & rest$
    End If
    End If
  Else
  rest$ = f$ & " " & rest$
    If w$ = "" Then
      If lang = 1 Then
    w$ = "FUNCTION"
    Else
     w$ = "ΣΥΝΑΡΤΗΣΗ"
    End If
    End If
  End If
  
BYPASS3:
 ExecuteVarOnly = Abs(Identifier(bstack, w$, rest$, , lang))
 'ExecuteVarOnly = Abs(MyFunction(0, bstack, rest$, lang))

   
  If GetSub(bstack.GroupName + f$ + "()", i) Then
   '''εδω να βάλω το group name μαζί!!!!! στο σχετικό με το i
   If Not lcl Then
   var(vvv).FuncList = Chr$(1) + Chr$(2) + f$ + "() " + CStr(i) + Chr$(1) + var(vvv).FuncList
   Else
   var(vvv).LocalList = var(vvv).LocalList + vbCrLf + "Local Function " + f$ + "{" + sbf(i).sb + "}"
   End If
   If here$ = "" Then
   sbf(i).sbgroup = bstack.GroupName
   Else
    sbf(i).sbgroup = here$ + "." + bstack.GroupName
  End If
Else

  End If
   
  ''   Bstack.GroupName = oldgroupname$
     Else
     ExecuteVarOnly = 0
     End If
     
     If ExecuteVarOnly = 0 Then Exit Function
     

Case "MODULE", "ΤΜΗΜΑ"
If IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", lang) Then
MyEr "GLOBAL can't used in a Group", "Η συνάρτηση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteVarOnly = False
Exit Function
End If
x1 = Abs(IsLabel(bstack, rest$, f$))
    If prv Then f$ = ChrW(&HFFBF) + f$
''f$ = myUcase$(f$)
If x1 <> 0 Then
  If var(vvv).FuncList <> "" Then  ' maybe we have it
  If InStr(var(vvv).FuncList, Chr$(3) + f$ + " ") > 0 Then
    IsSymbol3 rest$, "{"
    ss$ = block(rest$)
    If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
    If FastSymbol(rest$, "}") Then
             If GetSub(bstack.GroupName + f$, i) Then
            '' IF sbf(I).sbGROUP
                         If rinstr(sbf(i).sbgroup, bstack.GroupName) + Len(bstack.GroupName) - 1 = Len(sbf(i).sbgroup) Then
                          bstack.IndexSub = i
                          sbf(i).sb = ss$
                          GoTo there12345
                          End If
             End If

 
   If here$ <> "" Then
v = 123
             If lang = 1 Then
                rest$ = "GLOBAL " + Chr(34) + here$ + "." + bstack.GroupName + f$ + Chr(34) + " {'11001EDIT " + CStr(bstack.OriginalCode) + ", 3" + vbCrLf + ss$ + "} " + rest$
                  Else
                  rest$ = "ΓΕΝΙΚΟ " + Chr(34) + here$ + "." + bstack.GroupName + f$ + Chr(34) + " {'11001EDIT " + CStr(bstack.OriginalCode) + ", 3" + vbCrLf + ss$ + "} " + rest$
                  End If
   GoTo BYPASS4
   Else
   
        ExecuteVarOnly = 0: Exit Function
   End If
   End If
  End If
  End If
  ' so is the first time, put it back
  If Left$(sbf(bstack.OriginalCode).sb, 10) = "'11001EDIT" Then
   
   ss$ = rest$
     IsSymbol3 ss$, "{"
    frm$ = block(ss$)
 If Right$(ss$, 2) <> vbCrLf Then
        b$ = GetNextLine((sbf(bstack.OriginalCode).sb))
  Else
        b$ = GetNextLine((sbf(bstack.OriginalCode).sb))
        End If
        nm$ = GetStrUntil(",", Mid$(b$, 12))
      GetSub nm$, i
      IsSymbol3 rest, "{"
       b$ = "{" + b$ + "+" + CStr(Len(sbf(i).sb)) + "-" + CStr(Len(ss$)) + vbCrLf
     
        
    rest$ = b$ + rest$


  End If
  If here$ = "" Then
  
  rest$ = bstack.GroupName + f$ & " " & rest$
  Else
  
  rest$ = f$ & " " & rest$
  End If
  If glob Then
  If lang = 1 Then
  rest$ = "NEW " + rest$
  Else
  rest$ = "ΝΕΟ " + rest$
  End If
  End If
BYPASS4:
 ExecuteVarOnly = Abs(Identifier(bstack, w$, rest$, , lang))
' ExecuteVarOnly = Abs(MyModule(bstack, rest$, lang))
  If GetSub(bstack.GroupName + f$, i) Then

 If Not lcl Then
 var(vvv).FuncList = Chr$(1) + Chr$(3) + f$ + " " + CStr(i) + Chr$(1) + var(vvv).FuncList
 Else
  var(vvv).LocalList = var(vvv).LocalList + vbCrLf + "Local Module " + f$ + "{" + sbf(i).sb + "}"
 End If

        If here$ = "" Then
   sbf(i).sbgroup = bstack.GroupName
   Else
    sbf(i).sbgroup = here$ + "." + bstack.GroupName
  End If
  End If

     Else
     ExecuteVarOnly = 0
     End If
     If ExecuteVarOnly = 0 Then Exit Function

Case "DOCUMENT", "ΕΓΓΡΑΦΟ", "DIM", "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ", "GROUP", "ΟΜΑΔΑ", "LONG", "ΜΑΚΡΥΣ", "EVENT", "ΓΕΓΟΝΟΣ", "ΚΑΤΑΣΤΑΣΗ", "INVENTORY", "ΔΙΑΡΘΡΩΣΗ", "BUFFER"
' put back, change HERE$ and
contVar:
If w$ = "GROUP" Or w$ = "ΟΜΑΔΑ" Then
                                                 x1 = Abs(IsLabel(bstack, rest$, w$))
                                                 If prv Then w$ = ChrW(&HFFBF) + w$
                                                  If x1 = 1 Then
                                                                     If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", lang) Then
                                                                                        If IsStrExp(bstack, rest$, ss$) Then
                                                                                        frm$ = bstack.GroupName
                                                                                        prepareGroup bstack, w$, y1, glob
                                                                                        LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
                                                                                        bstack.priveflag = prv
                                                                                         ExecuteVarOnly = Abs(ExecuteVarOnly(bstack, bstack.GroupName & w$, y1, ss$, lang, glob))
                                                                                        bstack.priveflag = False
                                                                                            OvarnameLen = varhash.count + 1 'Len(VarName$) + 1   'we record ...
                                                                                      
                                                                                        
                                                                                         bstack.GroupName = frm$
                                                                                        End If
                                                
                                                                        Else
                                                                      If FastSymbol(rest$, "{") Then
                                                                                      ss$ = block(rest$)
                                                                                      frm$ = bstack.GroupName
                                                                                      prepareGroup bstack, w$, y1, glob
                                                                                    LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
                                                                                    
                                                                                    If Abs(ExecuteVarOnly(bstack, bstack.GroupName & w$, y1, ss$, lang, glob)) = 0 Then
                                                                                        rest$ = ss$ + rest$
                                                                                    Else
                                                                                        ExecuteVarOnly = FastSymbol(rest$, "}")
                                                                                    End If
                                                                                        OvarnameLen = varhash.count + 1  'we record ...
                                                                              
                                                                                     bstack.GroupName = frm$
                                                                                     If Typename(var(y1)) <> "Group" Then Set var(y1) = New Group
                                                                                     
                                                                                  Else
                                                                                  prepareGroup bstack, w$, y1, glob
                                                                                    LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
                                                                        End If
                                                                    End If
                                                         End If
                                   





Else
bstack.priveflag = prv
If glob Then
Select Case w$
Case "DIM"
rest$ = " NEW" + rest$
Case "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ"
rest$ = " ΝΕΟ " + rest$

End Select


End If
  ExecuteVarOnly = Abs(Identifier(bstack, w$, rest$, , lang))
'ExecuteVarOnly = Abs(MyDim(bstack, rest$, lang))
  bstack.priveflag = False
End If

     If ExecuteVarOnly = 0 Then Exit Function
       ''LogGroup bstack, vvv, oHere$, OvarnameLen, OarrnameLen, lcl
Case Else
' check if we have a class

nm$ = ""
If prv Then w$ = ChrW(&HFFBF) + w$
If Len(rest$) > 0 Then
If Not MaybeIsSymbol(rest$, TT$) Then
    If GetSub(w$ + "()", j) Then
        f$ = "=" + w$ + "()"
        
            If IsLabelA(here$, rest$, w$) <> 1 Then Exit Do
            ''w$ = myUcase(w$)
            rest$ = f$ + rest$
            nm$ = w$
            ''
    ElseIf GetSub(bstack.GroupName + w$ + "()", j) Then   '' why not here??
        f$ = "=" + bstack.GroupName + w$ + "()"
        If IsLabelA(here$, rest$, w$) <> 1 Then Exit Do
        ''w$ = myUcase(w$)
        rest$ = f$ + rest$
        nm$ = w$
        
    End If
End If
End If
w$ = ohere$ & "." & w$
Select Case v
Case 1
p = 0
If glob Then
 v = GlobalVar(w$, p, , True)
ElseIf here$ = "" Then

    If Not GetVar(bstack, w$, v) Then v = GlobalVar(w$, p) ': GetVar bstack, W$, v
Else
    If Not GetlocalVar(w$, v) Then v = GlobalVar(w$, p) ': GetlocalVar W$, v
End If

If FastSymbol(rest$, "=") Then
        
               If IsExp(bstack, rest$, p) Then
               If Not bstack.lastobj Is Nothing Then
                                If TypeOf bstack.lastobj Is lambda Then
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
                                 If here$ = "" Or glob Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(v), bstack.GroupName
                                            Else
                                                GlobalSub here$ & "." & w$ + "()", "CALL EXTERN " & CStr(v), here$ + "." + bstack.GroupName
                                            End If
                                             OvarnameLen = varhash.count + 1
                                             
                                ElseIf TypeOf bstack.lastobj Is Group Then
                                            Set myobject = bstack.lastobj
                                                                                                                                                                    
againgroup:
                                LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl

                       
                                            If nm$ <> "" Then
                                                
                                                UnFloatGroup bstack, nm$, v, myobject

                                              OvarnameLen = varhash.count + 1  'we record ...
                                                                                      
                                            End If
                                            If FastSymbol(rest$, ",") Then
                                            
                                          
                                                If IsLabelA(here$, rest$, nm$) = 1 Then
                                                    If here$ = "" Then
                                                        If Not GetVar(bstack, ohere$ & "." & nm$, v) Then v = GlobalVar(ohere$ & "." & nm$, p)   ': GetVar bstack, nm$, v
                                                    Else
                                                        If Not GetlocalVar(ohere$ & "." & nm$, v) Then v = GlobalVar(ohere$ & "." & nm$, p)   ': GetlocalVar W$, v
                                                    End If
                                                    GoTo againgroup:
                                                Else
                                                    SyntaxError
                                                    Exit Do
                                                End If
                                       
                                        End If

                                         Set bstack.lastobj = Nothing
                                        GoTo continuehere
                                    Set bstack.lastobj = Nothing
                                        ' look for other
                                Else
                                SyntaxError
                                Exit Do
                                End If
            ElseIf VarType(var(v)) = vbLong Then
                    var(v) = CLng(p)
                    Else
                    var(v) = p
                    End If
            
                 Else
                
                
                
                   If LastErNum <> -2 Then
                   NoValueForvariable w$
                    ExecuteVarOnly = 0
                     
                     Exit Function
                     End If
                    
                End If
               
        Else
        ss$ = ""
         If MaybeIsSymbol(rest$, "=-+*/<!") Then
            If FastSymbol(rest$, "+=") Then
                ss$ = "+"
            ElseIf FastSymbol(rest$, "/=", , 2) Then
            ss$ = "/"
            ElseIf FastSymbol(rest$, "-=", , 2) Then
            ss$ = "-"
            ElseIf FastSymbol(rest$, "*=", , 2) Then
            ss$ = "*"
            ElseIf IsOperator(rest$, "++", 2) Then
            ss$ = "++"
            ElseIf IsOperator(rest$, "--", 2) Then
            ss$ = "--"
            ElseIf IsOperator(rest$, "-!", 2) Then
            ss$ = "-!"
            ElseIf IsOperator(rest$, "~") Then
            ss$ = "!"
            ElseIf FastSymbol(rest$, "<=", , 2) Then
            ss$ = "="
            End If
        End If
        If Len(ss$) > 0 Then
        
        If GetVar(bstack, w$, v) Then
        If Len(ss$) = 1 Then
                    If IsExp(bstack, rest$, p) Then
                            On Error Resume Next
                            If VarType(var(v)) = vbLong Then
                               Select Case ss$
                                Case "="
                                var(v) = CLng(p)
                                Case "+"
                                var(v) = CLng(p) + var(v)
                                Case "*"
                                 var(v) = CLng(p) * var(v)
                                Case "-"
                                var(v) = var(v) - CLng(p)
                                Case "/"
                                If p = 0 Then
                                   ExecuteVarOnly = 0
                                   Exit Do
                                End If
                                 var(v) = var(v) \ CLng(p)
                                         Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            Else
                            Select Case ss$
                                Case "="
                                var(v) = p
                                Case "+"
                                var(v) = p + var(v)
                                Case "*"
                                 var(v) = p * var(v)
                                Case "-"
                                var(v) = var(v) - p
                                Case "/"
                                If p = 0 Then
                                   ExecuteVarOnly = 0
                                    
                                   Exit Function
                                End If
                          
                                 var(v) = var(v) / p
                                     Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            End If
                            If Err.Number = 6 Then
                             
                                Exit Function   'why ?
                          
                                             
                               End If
                               On Error GoTo 0
                    Else
        
       If LastErNum <> -2 Then
        NoValueForvariable w$
        ExecuteVarOnly = 0
         
         Exit Function
   
      
       End If
              
                               
                    End If
        Else
        If ss$ = "++" Then
        var(v) = 1 + var(v)
        ElseIf ss$ = "--" Then
        var(v) = var(v) - 1
        Else
        var(v) = -var(v)
        End If
        
        End If
    Else
                    ExecuteVarOnly = 0
                     
                                     Exit Function
    End If
        Else
     '         If Not ExecuteVarOnly(bstack, W$, Rest$) Then
             ''  ExecuteVarOnly = 0: Exit Function
          ''     End If
          ''  If Left$(HERE$ & "#", 1) = "!" Then HERE$ = Mid$(HERE$, 2): HERE$ = HERE$
        End If
        
    End If
        
    
        
Case 2
rest$ = w$ & rest$: Exit Function
Case 3
        ss$ = ""
         If MaybeIsSymbol(rest$, "=<") Then
            If FastSymbol(rest$, "<=", , 2) Then
                ss$ = "g"  'global
            ElseIf FastSymbol(rest$, "=") Then
            ss$ = "="
            End If
        End If
       

If ss$ <> "" Then

    If ss$ = "=" Then
    
    If here$ = "" Then
            If glob Then
           If IsStrExp(bstack, rest$, ss$) Then GlobalVar w$, ss$
          ElseIf GetVar(bstack, w$, v) Then
            
                If IsStrExp(bstack, rest$, ss$) Then CheckVar var(v), ss$
            ElseIf IsStrExp(bstack, rest$, ss$) Then
            
                GlobalVar w$, ss$
            
            End If
    Else
           If GetlocalVar(w$, v) Then
                If IsStrExp(bstack, rest$, ss$) Then CheckVar var(v), ss$
            ElseIf IsStrExp(bstack, rest$, ss$) Then
            If Not bstack.lastobj Is Nothing Then
                                         If TypeOf bstack.lastobj Is lambda Then
                                         v = GlobalVar(w$, Empty)
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
                                 If here$ = "" Or glob Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & CStr(v), bstack.GroupName
                                            Else
                                            
                                                GlobalSub here$ & "." & w$ + "()", "CALL EXTERN " & CStr(v), here$ + "." + bstack.GroupName
                                            End If

                                             OvarnameLen = varhash.count + 1
                                             Else
                                     NoValueForvariable w$
                       End If
               Else
                GlobalVar w$, ss$
            End If
            End If
            End If
        Else    ' g
          If GetVar(bstack, w$, v) Then
          
               If IsStrExp(bstack, rest$, ss$) Then

               CheckVar var(v), ss$

               Else
               NoValueForvariable w$
               End If
            Else
            Nosuchvariable w$
          End If
    End If
Else
' NO VALUE IS OK
If Not GetlocalVar(w$, v) Then
                v = GlobalVar(w$, ss$)
                ''GetlocalVar W$, v
                var(v) = ""

            End If
End If
Case 4
If glob Then
 v = GlobalVar(w$, p, , True)
ElseIf here$ = "" Then
If Not GetVar(bstack, w$, v) Then v = GlobalVar(w$, p) '': GetVar bstack, W$, v
Else
If Not GetlocalVar(w$, v) Then v = GlobalVar(w$, p) '': GetlocalVar W$, v
End If
        If FastSymbol(rest$, "=") Then
                If IsExp(bstack, rest$, p) Then
                 var(v) = Int(p)
                If Err.Number = 6 Then ExecuteVarOnly = 0:   Exit Function

                Else
                      If LastErNum <> -2 Then
                     NoValueForvariable w$
                    ExecuteVarOnly = 0
                     
                     Exit Function
                     End If
            
            End If
Else
    If FastSymbol(rest$, "+=", , 2) Then
    ss$ = "+"
    ElseIf FastSymbol(rest$, "/=", , 2) Then
    ss$ = "/"
    ElseIf FastSymbol(rest$, "-=", , 2) Then
    ss$ = "-"
    ElseIf FastSymbol(rest$, "*=", , 2) Then
    ss$ = "*"
    ElseIf IsOperator(rest$, "++", 2) Then
    ss$ = "++"
    ElseIf IsOperator(rest$, "--", 2) Then
    ss$ = "--"
    ElseIf IsOperator(rest$, "-!", 2) Then
    ss$ = "-!"
                ElseIf IsOperator(rest$, "~") Then
            ss$ = "!"
    ElseIf FastSymbol(rest$, "<=", , 2) Then
    ss$ = "="
    End If
    If ss$ = "" Then
              GoTo continuehere
                 
    End If
    If GetVar(bstack, w$, v) Then
        If Len(ss$) = 1 Then
                    If IsExp(bstack, rest$, p) Then
                            On Error Resume Next
                            Select Case ss$
                            Case "="
                            var(v) = Int(p)
                            Case "+"
                                var(v) = Int(p) + var(v)
                                Case "*"
                                 var(v) = Int(Int(p) * var(v))
                                Case "-"
                                var(v) = var(v) - Int(p)
                                Case "/"
                                     If p = 0 Then
                                ExecuteVarOnly = 0:   Exit Function
                                End If
                                 var(v) = var(v) \ Int(p)
                                                     Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            If Err.Number = 6 Then ExecuteVarOnly = 0:   Exit Function
                                On Error GoTo 0
                    Else
                                ExecuteVarOnly = 0:   Exit Function
                    End If
        Else
        If ss$ = "++" Then
          var(v) = 1 + var(v)
          ElseIf ss$ = "--" Then
          var(v) = var(v) - 1
          Else
          var(v) = -var(v)
          End If
        End If
    Else
            ExecuteVarOnly = 0:   Exit Function
    End If
End If
Case 5
If neoGetArray(bstack, w$, pppp, , glob) Then
If Not NeoGetArrayItem(pppp, bstack, w$, v, rest$) Then

 
If LastErNum = -2 Then

ExecuteVarOnly = 0:  Exit Function
Else
ExecuteVarOnly = 0
Exit Function
End If
End If
On Error Resume Next

If Not FastSymbol(rest$, "=", True) Then

End If
If Not IsExp(bstack, rest$, p) Then
If LastErNum = -2 Then

Else
MissNumExpr
End If
 
ExecuteVarOnly = 0: Exit Function
End If
If pppp.Arr Then
pppp.item(v) = p
Do While FastSymbol(rest$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, rest$, p) Then ExecuteVarOnly = 0:   Exit Function
pppp.item(v) = p
Else
Exit Do
End If
Loop
Else
pppp.GroupRef.Value = p
End If
lcl = False
Else
MyEr "Can't find array " & w$ & ")", "Δεν βρίσκω πίνακα " & w$ & ")"
ExecuteVarOnly = 0:   Exit Function
End If
Case 6
If neoGetArray(bstack, w$, pppp) Then
If Not NeoGetArrayItem(pppp, bstack, w$, v, rest$) Then ExecuteVarOnly = 0:   Exit Function
On Error Resume Next

If Not FastSymbol(rest$, "=") Then
  If FastSymbol(rest$, ":=", , 2) Then
    ss$ = Left$(aheadstatus(rest$), 1)
        If ss$ = "S" Then
        If Not IsStrExp(bstack, rest$, ss$) Then ExecuteVarOnly = 0:      Exit Function
        Else
        If Not IsExp(bstack, rest$, p) Then ExecuteVarOnly = 0:    Exit Function
        ss$ = Trim$(Str$(p))
        End If
             If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(rest$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
          ss$ = Left$(aheadstatus(rest$), 1)
                        If ss$ = "S" Then
        If Not IsStrExp(bstack, rest$, ss$) Then ExecuteVarOnly = 0:     Exit Function
        Else
        If Not IsExp(bstack, rest$, p) Then ExecuteVarOnly = 0:   Exit Function
        ss$ = Trim$(Str$(p))
        End If
        
                If Not IsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
   lcl = False
    Else
        ExecuteVarOnly = 0:   Exit Function
    End If
Else
If Not IsStrExp(bstack, rest$, ss$) Then
     ExecuteVarOnly = 0:   Exit Function
     End If
    If Not IsObject(pppp.item(v)) Then
        pppp.item(v) = ss$
    Else
        CheckVar pppp.item(v), ss$
    End If
        Do While FastSymbol(rest$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
        If Not IsStrExp(bstack, rest$, ss$) Then ExecuteVarOnly = 0:   Exit Function
        
        If Not IsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Else
        Exit Do
        End If
        Loop
        lcl = False
End If
Else
ExecuteVarOnly = 0:   Exit Function
End If
Case 7
If neoGetArray(bstack, w$, pppp) Then
If Not NeoGetArrayItem(pppp, bstack, w$, v, rest$) Then ExecuteVarOnly = 0:   Exit Function
On Error Resume Next
If Not FastSymbol(rest$, "=") Then ExecuteVarOnly = 0: Exit Function
If Not IsExp(bstack, rest$, p) Then ExecuteVarOnly = 0: Exit Function
p = Int(p)
If Err.Number > 0 Then ExecuteVarOnly = 0: Exit Function
pppp.item(v) = p
Do While FastSymbol(rest$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, rest$, p) Then ExecuteVarOnly = 0: Exit Function
pppp.item(v) = p
Else
Exit Do
End If
Loop
Else
ExecuteVarOnly = 0: Exit Function
End If
Case Else

If MaybeIsSymbol(rest$, ",-+*/_!@()[];<>|~`") Then
SyntaxError
ExecuteVarOnly = 0
Exit Function
End If
End Select
End Select
continuehere:
''\\\\\\\\\\\\\\\\
LogGroup bstack, vvv, ohere$, OvarnameLen, OarrnameLen, lcl
If MaybeIsSymbol(rest$, "}") Then

ExecuteVarOnly = 1
Exit Do
End If
If Not FastSymbol(rest$, ",") Then
SetNextLine rest$
lcl = False
End If
ExecuteVarOnly = 1
Loop Until Trim(rest$) = ""


End Function

Private Sub CallByObject(bstack As basetask, i As Long, ret As Boolean)
Dim that As stdCallFunction, Up As Long, getparam As Boolean, PP As Long
Dim k As Long, p As Double, final(0 To 63) As Variant
Dim x1 As Long, what$, curtype As Long, s$, Link$, rtype As Variant
Dim thisref(0 To 63) As Long

Set that = var(i)

If that.ReadType(that.count - 1) = -100 Then
Up = that.count - 1
getparam = True
Else
Up = that.count
End If

For k = 1 To Up
       
        If that.IsByRef(k - 1) Then
            ' look for label..and check it
           If bstack.IsInStackString(what$) Then
                   
                    If that.ReadType(k - 1) <= 4 Then
                            If GetGlobalVar(bstack.GroupName & what$, x1) Then
                                    thisref(k - 1) = x1 ' so that is used to restore value
                                    If IsObject(var(x1)) Then
                                         ' THIS IS NOT GOOD
                                    
                                    Else
                                             final(k - 1) = var(x1)
                                             
                                             ' so if this is a long we place a variant long
                                           ' thisref(k - 1) = x1
                                     End If
                            Else
                            ' no such variable
                            End If
                    Else
                    ' error no array yet
                    
                    End If
            Else
            ' type mismatch
            ' exit - error
            End If
        Else
        Dim ii As Long
                Select Case that.ReadType(k - 1)
                Case 2
                   If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = CLng(p)
                   End If
                    
                Case 1, 5
                        If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = p
                    End If
                Case 4, 7
                      If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = Int(p)
                    End If
                Case Else
                    If Not bstack.IsInStackString(s$) Then Exit For
                    final(k - 1) = s$
                End Select
        End If
Next k
If getparam Then
Do
If bstack.IsInStackLong(PP) Then
final(k - 1) = PP
k = k + 1
ElseIf bstack.IsInStackNumber(p) Then
final(k - 1) = p
k = k + 1
ElseIf bstack.IsInStackString(s$) Then
 final(k - 1) = s$
k = k + 1
Else
Exit Do
End If
Loop Until bstack.soros.IsEmpty Or k = 63

Up = k - 1
End If

If k > Up Then
'all is ok
' make your call
If that.RetType = 0 Then
rtype = vbLong
Else
rtype = that.RetType
End If
If that.CallType = 0 Then
x1 = stdCallW(that.LIB, that.func, rtype, final(), Up)
Else
x1 = cdeclCallW(that.LIB, that.func, rtype, final(), Up)
End If
If ret Then
If that.RetType = 0 Then
bstack.soros.PushVal CDbl(x1)   ' FEEDBACK TO STACK
Else
bstack.soros.PushStr GetBStrFromPtr(x1)
End If
End If
Else
'error message


Exit Sub
End If
For k = 1 To that.count
If that.IsByRef(k - 1) Then
' RESTORE VALUES...
    If that.ReadType(k - 1) < 5 Then
    var(thisref(k - 1)) = final(k - 1)
    
    End If
End If
Next k

End Sub

Sub CallGlobal(s$)
Dim ohere$
ohere$ = here$
here$ = "@"
 Execute basestack1, s$, False
 s$ = ""
here$ = ohere$
End Sub






Public Sub ProcProperty(bstack As basetask, v(), vIndex As Long, FN$, rest$, language As Long, Optional hardlink As Boolean = False)
Dim var1() As Variant, s$, r As Double, l As Long, newref As Long, many As Long, y1 As Boolean, x1 As Long, y2 As Boolean
Dim var2() As String, ss$, sp As Double, Indirect As Boolean
Dim vv As Object
Dim oo As Object, myVar As Variant
Set vv = v(vIndex)
Dim pppp As mArray
If TypeOf vv Is mHandler Then

If vv.Indirect >= 0 Then
 vIndex = vv.Indirect
    Set vv = var(vv.Indirect)
   
Else
    Set vv = vv.objref
End If
 Indirect = True
End If
Do
ReDim var1(0 To 0)
Erase var2()
Set pppp = Nothing

If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, r) Then



                        If FastSymbol(rest$, "@") Then
                            Set oo = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            ReDim var1(0 To 1)
                            If IsExp(bstack, rest$, sp) Then
                                var1(0) = sp
                            ElseIf IsStrExp(bstack, rest$, ss$) Then
                                var1(0) = ss$
                            End If
                            If oo Is Nothing Then
                                var1(1) = r
                            Else
                            If TypeOf oo Is mHandler Then
                                Set bstack.lastobj = oo
                                Set var(1) = bstack.lastobjIndirect(var())
                            Else
                                Set var1(1) = oo
                            End If
                                Set oo = Nothing
                            End If
                         
                            CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 2
                         Else
                                If bstack.lastobj Is Nothing Then
                                    var1(0) = r
                                    CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 1
                                Else
                                    Set var1(0) = bstack.lastobj
                                    Set bstack.lastobj = Nothing
                                    CallByNameFixParamArray vv, FN$, VbSet, var1(), var2(), 1
                                    
                                End If
                                
                        End If
 
 
ElseIf IsStrExp(bstack, rest$, s$) Then

                        If FastSymbol(rest$, "@") Then
                            ReDim var1(0 To 1)
                            
                            If IsExp(bstack, rest$, sp) Then
                                var1(0) = sp
                            ElseIf IsStrExp(bstack, rest$, ss$) Then
                                var1(0) = ss$
                            End If
                            var1(1) = s$
                            CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 2
                        Else
                            var1(0) = s$
                            CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 1
                        End If
End If
ElseIf IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
' WE MAKE A NEW OBJECT
l = FindDISPID(vv, FN$)
FN$ = Typename(vv) & "." & UCase(FN$)
If l <> -1 Then
' we have vv, fn$, l and we are looking for a label to make an object to that
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", language)

If Not y1 Then y2 = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", language) Else y2 = False

x1 = Abs(IsLabel(bstack, rest$, s$))

If x1 < 5 Then
    If y1 Or y2 Then GoTo jumpthere
    If GetlocalVar(s$, newref) Then
    ' so it is an object now
    If Not IsObject(var(newref)) Then
    MakeitPropReference var(newref)
    ElseIf Typename(var(newref)) <> "PropReference" Then
    MakeitPropReference var(newref)
    End If
Else
jumpthere:
''GlobalVar s$, 0   'we push a zero..GlobalVar create
''GetlocalVar s$, newref
If y1 Then
newref = GlobalVarRefOnly(s$, y1)
Else
newref = GlobalVarRefOnly(bstack.GroupName & s$)
End If
MakeitPropReference var(newref)
If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then
    Set oo = oo.objref
    If oo.T1 <> 1 Then
        GoTo there
    End If
End If
    var(newref).ConstructObj oo, l
Set oo = Nothing
Else
var(newref).Construct vIndex, l, Indirect   ' this is the link vindex is an index to var()
End If
' so for every method or property we use this simple struct
' we can define the value type

End If
Else



 If neoGetArray(bstack, s$, pppp, here$ <> "") Then

 
If NeoGetArrayItem(pppp, bstack, s$, newref, rest$) Then

With pppp

  MakeitPropReference myVar
  If pppp.Arr Then Set .item(newref) = myVar
  
    If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then
With oo
If .Indirect < 0 Then
    Set oo = oo.objref
Else
    If .Indirect <= var2used Then
    
    End If
End If
End With
End If
myVar.ConstructObj oo, l
Set oo = Nothing
Else
myVar.Construct vIndex, l   ' this is the link vindex is an index to var()
End If
Set myVar = Nothing
End With

End If
ElseIf FastSymbol(rest$, ")") Then
''s$ = Left$(s$, Len(s$) - 1)
If pppp Is Nothing Then

GlobalArr bstack, s$, "0)", (1), (y1)
 If Not neoGetArray(bstack, s$, pppp, here$ <> "") Then GoTo there
End If




MakeitPropReference myVar

If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then Set oo = oo.objref
myVar.ConstructObj oo, l
Set oo = Nothing
Else
myVar.Construct vIndex, l   ' this is the link vindex is an index to var()
End If

myVar.UseIndex = True

pppp.PushProp myVar

''
End If

End If
End If
ElseIf IsLabelSymbolNew(rest$, "ΘΕΣΕ", "SET", language) Then
' we make a new reference to that property
End If
 If FastSymbol(rest$, ",") Then
 If Not IsStrExp(bstack, rest$, FN$) Then Exit Do
 Else
 Exit Do
 End If
Loop
there:
Set oo = Nothing
Set pppp = Nothing
Set vv = Nothing
End Sub
''ProcProperty bstack, var(i), sS$, rest$,  LANG
' METHOD A,"Multiply" (12,12) [AS RESULT]   (or Result$)  if [As] isn't there so
' METHOD A "Multiply" (12,12)  AS RESULT  without
' METHOD A "Multiply", &alfa,&beta$   'passing by reference
''ProcMethod bstack, var(i), sS$, rest$,  LANG
Sub ProcMethod(bstack As basetask, v(), vIndex As Long, FN$, rest$, language As Long)
Dim var1() As Variant, s$, r As Double, l As Long, newref As Long, glob As Boolean
Dim vv As Object, mstack As New mStiva, result As Variant, retobject As Object
Dim namarg As Long
Set vv = v(vIndex)
If TypeOf vv Is mHandler Then
If vv.Indirect >= 0 Then
vIndex = vv.Indirect
Set vv = var(vv.Indirect)

Else
Set vv = vv.objref
End If
End If
ReDim var1(0 To 0)
Dim var2() As String
ReDim var2(0 To 0)
' expression or label:=expression'

''Exit Sub
Dim what$, it As Long, items As Long

' we have parameters..(by value)
If FastSymbol(rest$, "(") Then  ' we have "(par1, par2...) as result"
        RealMeth bstack, rest$, var1(), var2(), items, namarg
If Not FastSymbol(rest$, ")", True) Then Exit Sub
result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), items, retobject, namarg)
ElseIf FastSymbol(rest$, ",") Then
RealMeth bstack, rest$, var1(), var2(), items, namarg  ' if we have as result then we get an error...
 result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), items, retobject, namarg)
Else
 result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), 0, retobject, namarg)
End If
If Not retobject Is Nothing Then
     If IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
             glob = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", language)
             If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                                If GetVar(bstack, what$, it) Then
                                    Set var(it) = retobject
                                Else
                                    it = GlobalVar(what$, 0, glob)
                                    Set var(it) = retobject
                                End If
            End If
     End If
Else
     If IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
             glob = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", language)
             Select Case Abs(IsLabel(bstack, rest$, what$))
             Case 1
                                If GetVar(bstack, what$, it) Then
                                    var(it) = CDbl(result)
                                    
                                Else
                                    GlobalVar what$, CDbl(result), glob
                                    
                                End If
              Case 4
                                If GetVar(bstack, what$, it) Then
                                    var(it) = Int(CDbl(result))
                                Else
                                    GlobalVar what$, Int(CDbl(result)), glob
                                    
                                End If
              Case 3
              If GetVar(bstack, what$, it) Then
                                    var(it) = result
                                Else
                                    GlobalVar what$, result, glob
                                    
                                End If
              End Select
            
    End If
End If
End Sub
Sub RealMeth(bstack As basetask, rest$, var2() As Variant, var3() As String, NoNameditems As Long, namedargument As Long)
'  testmeth "122,&beta,121,alfa:=a+4, beta:=122"
Dim s$, l$
Dim trap As Long, ss$, p As Double, items As Long
Do
again:
If FastSymbol(rest$, ",") Then
' second, or more is optional
        var2(items) = vbError
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
        GoTo again
End If
s$ = aheadstatus(rest$, True) + " "
Select Case Left$(s$, 1)
Case "S"
If (trap Mod 2 = 0) And namedargument > 0 Then Exit Do  ' is a fault
        If IsStrExp(bstack, rest$, ss$) Then
            var2(items) = ss$
           If namedargument = 0 Then NoNameditems = NoNameditems + 1
        Else
            var2(items) = ""
            s$ = ""
        End If
        If trap > 0 Then trap = trap + 1
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
Case "N"


        ' maybe is a named argument
        l$ = rest$
        If IsLabel(bstack, l$, ss$) Then
                If IsOperator(l$, ":=", 2) Then
                    'push name to
                    namedargument = namedargument + 1
                    If UBound(var3()) < namedargument Then ReDim Preserve var3(namedargument + 1)
                    var3(namedargument) = ss$
                    
                    trap = 1
                    rest$ = l$
                    GoTo again
                Else
                       If Not ((trap Mod 2 = 0) And namedargument > 0) Then
                            
                            If IsExp(bstack, rest$, p) Then
                            If bstack.lastobj Is Nothing Then
                                 var2(items) = p
                            Else
                            If TypeOf bstack.lastobj Is mHandler Then
                                Set var2(items) = bstack.lastobjIndirect(var())
                            Else
                                Set var2(items) = bstack.lastobj
                                End If
                                Set bstack.lastobj = Nothing
                                 End If
                                If namedargument = 0 Then NoNameditems = NoNameditems + 1
                                  If trap > 0 Then trap = trap + 1
                             Else
                             
                             End If
                        Else
                        Exit Do
                        End If
                End If
        Else
                If Not ((trap Mod 2 = 0) And namedargument > 0) Then
                         If IsExp(bstack, rest$, p) Then
                             var2(items) = p
                             If namedargument = 0 Then NoNameditems = NoNameditems + 1
                              If trap > 0 Then trap = trap + 1
                         Else
                                 Exit Do
                         End If
                 Else
                             Exit Do
                 End If
    End If
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
End Select
If Not FastSymbol(rest$, ",") Then Exit Do
Loop Until s$ = ""

End Sub
Sub TestMeth(rest$)
'  testmeth "122,&beta,121,alfa:=a+4, beta:=122"
Dim s$, y1 As Long, l$, namedargument As Long
Dim trap As Long
Do
s$ = aheadstatus(rest$, True, y1)
''Debug.Print s$, Mid$(rest$, 1, y1 - 1)
If s$ <> "" Then
    l$ = Mid$(rest$, 1, y1 - 1)
    rest$ = Mid$(rest$, y1)
End If
If FastSymbol(rest$, ":=", , 2) Then

namedargument = namedargument + 1
trap = 0
ElseIf FastSymbol(rest$, ",") Then
trap = trap + 1
If trap > 1 And namedargument > 0 Then
''Debug.Print "error...no normal after namedvariablesl"
Exit Sub
End If
End If
y1 = 1
Loop Until s$ = ""
End Sub
Function ReadProp(fromIndex As Long, ByVal propIndex As Long, RETVAR As Variant) As Boolean
Dim o As Object, er$
On Error GoTo there
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
er$ = ""
ReadProp = ReadOneParameter(o, propIndex, er$, RETVAR)
If er$ <> "" Then
there:
BadGetProp
End If
End Function
Function ReadPropIndex(fromIndex As Long, ByVal propIndex As Long, myIndex As Variant) As Variant
Dim o As Object, er$
On Error GoTo there
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
er$ = ""
ReadPropIndex = ReadOneIndexParameter(o, propIndex, er$, myIndex)
If er$ <> "" Then
there:
BadGetProp
End If
End Function
Sub WriteProp(fromIndex As Long, ByVal propIndex As Long, Anyval As Variant)
Dim o As Object, er$
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
'ChangeOneIndexParameter
ChangeOneParameter o, propIndex, Anyval, er$
If er$ <> "" Then
BadLetProp
End If
End Sub
Sub WritePropIndex(fromIndex As Long, ByVal propIndex As Long, Anyval As Variant, myIndex)
Dim o As Object, er$
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
ChangeOneIndexParameter o, propIndex, Anyval, er$, myIndex
If er$ <> "" Then
BadLetProp
End If
End Sub
Function ReadPropIndexObj(o As Object, ByVal propIndex As Long, myIndex) As Variant
Dim er$
er$ = ""
 ReadPropIndexObj = ReadOneIndexParameter(o, propIndex, er$, myIndex)
If er$ <> "" Then
BadGetProp
End If
End Function
Function ReadPropObj(o As Object, ByVal propIndex As Long, RETVAR As Variant) As Boolean
Dim er$
er$ = ""
ReadPropObj = ReadOneParameter(o, propIndex, er$, RETVAR)
If er$ <> "" Then
BadGetProp
End If
End Function
Sub WritePropObj(o As Object, ByVal propIndex As Long, Anyval As Variant)
Dim er$
ChangeOneParameter o, propIndex, Anyval, er$
If er$ <> "" Then
BadLetProp
End If
End Sub
Sub WritePropIndexObj(o As Object, ByVal propIndex As Long, Anyval As Variant, myIndex)
Dim er$
ChangeOneIndexParameter o, propIndex, Anyval, er$, myIndex
If er$ <> "" Then
BadLetProp
End If
End Sub

Sub MakeThisSub(ThatStack As basetask, rest$)

If Left$(rest$, 5) = "THIS." Then

    If ThatStack.GroupName = "" Then
        rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If

ElseIf Left$(rest$, 5) = "ΑΥΤΟ." Then

If ThatStack.GroupName = "" Then
    rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)

Else

    rest$ = ThatStack.GroupName & Mid$(rest$, 6)
End If

Else

End If
End Sub

Sub MakeThisSubNum(ThatStack As basetask, rest$)
If Left$(rest$, 5) = "THIS." Then
    If ThatStack.UseGroupname <> "" Then
        rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If
ElseIf Left$(rest$, 5) = "ΑΥΤΟ." Then
    If ThatStack.UseGroupname <> "" Then
       rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If
End If

End Sub

Function ColorRGB(bstack As basetask, n$, r As Double) As Boolean
Dim r2 As Double, r3 As Double, ss$, par As Boolean
ColorRGB = True
    If IsExp(bstack, n$, r) Then
            
            r = mycolor(r)
            par = True
            If FastSymbol(n$, ",") Then
            par = IsExp(bstack, n$, r2)
            If par And FastSymbol(n$, ",") Then
            par = IsExp(bstack, n$, r3)
            End If
            r = rgb(Abs(r Mod 256), Abs(r2 Mod 256), Abs(r3 Mod 256))
            End If
            If Not par Then ColorRGB = False: Exit Function
    ElseIf IsStrExp(bstack, n$, ss$) Then
            ' value in hexadecimal input as in html RGB
            ' we have to make BGR
    
            ss$ = Right$("00000000" & ss$, 8)
   r = CDbl(UNPACKLNG(Right$(ss$, 2)) * 65536#) + CDbl(UNPACKLNG(Mid$(ss$, 5, 2)) * 256#) + CDbl(UNPACKLNG(Mid$(ss$, 3, 2)))
   
         
             Else
              ColorRGB = False
              
    End If
End Function

Function globalArrByPointer(bs As basetask, basestack As basetask, what$, Optional newonly As Boolean = False) As Boolean
Dim pppp As mArray, myobject As Object
   If bs.IsObjectRef(myobject) Then
   If newonly Then GoTo there1
             If neoGetArray(basestack, what$, pppp) Then ''basestack.GroupName &
             If Not pppp Is Nothing Then
                myobject.CopyArray pppp
                Set myobject = Nothing
                globalArrByPointer = True
                End If
            Else
there1:
      
                GlobalArr basestack, basestack.GroupName & what$, "", 0, -1
                If neoGetArray(basestack, what$, pppp) Then  ''basestack.GroupName &
                   myobject.CopyArray pppp
                   Set myobject = Nothing
                   globalArrByPointer = True
                End If
                
             End If
      
    End If
End Function
Public Sub CopyHandler(f As Variant, bstack As basetask)
Dim aa As mHandler, bb As mHandler
Set aa = f
aa.CopyTo bb
Set bstack.lastobj = bb
Set aa = Nothing
Set bb = Nothing
End Sub

Public Sub CopyLambda(f As Variant, bstack As basetask)
Dim aa As lambda, bb As lambda
Set aa = f
aa.CopyTo bb, var()
Set bstack.lastobj = bb
Set aa = Nothing
Set bb = Nothing
End Sub

Public Sub CopyGroup(mg As Variant, bstack As basetask)
Dim mgroup As Group
Set mgroup = mg
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, W3 As Long
Dim b$(), vvl As Variant, delme As Document, myArray As mArray, mySecondArray As mArray
Dim c$(), arrIndex As Long, choose$
Set k = New Group
Set k.Sorosref = mgroup.soros.Copy
Dim BI As Long
BI = 1

i = mgroup.soros.Total
k.BeginFloat i + 2
k.PokeItem 0, "Variables-Arrays"
k.PokeItem 1, i
For j = 2 To i * 2 + 1 Step 2
'Debug.Print k.soros.StackItem(BI)
b$() = Split(k.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then

k.PokeItem j, b$(0)

If Typename(var(val(b$(1)))) = doc Then 'preserve Documents
 MakeitObject vvl
 vvl.EmptyDoc
 vvl.textDoc = var(val(b$(1))).textDoc
 k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "Group" Then
' Not used
'MakeitObject2 vvl
'vvl.GroupName = var(val(b$(1))).GroupName
vvl = -1

CopyGroup var(val(b$(1))), bstack
Set vvl = bstack.lastobj
Set bstack.lastobj = Nothing
k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
CopyHandler var(val(b$(1))), bstack
Set vvl = bstack.lastobj
Set bstack.lastobj = Nothing
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then

Else
Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j
k.PokeItem j, mgroup.LocalList
k.PokeItem j + 1, GetFunctionList(mgroup.FuncList)
Set bstack.lastobj = k
End Sub

Sub UnFloatGroup(bstack As basetask, what$, i As Long, myobject As Object)
While Right$(what$, 1) = "."
what$ = Left$(what$, Len(what$) - 1)
Wend
If Trim$(what$) = "" Then Exit Sub
 Dim ps As mStiva, v As Long, s$, frm$, vvl As Variant, x1 As Long, ss$, frmarr$, sss$, j As Long
 Dim grtype As Variant, ps2push As String
 Set var(i) = New Group
 Set ps = var(i).soros
 Dim subgroup As Object, pppp As mArray
 Dim ohere$, oldgroupname$
 ohere$ = here$

If bstack.UseGroupname <> "" Then
here$ = ""
End If
 oldgroupname$ = bstack.GroupName
    If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & what$ & "."
  Else
  bstack.GroupName = what$ & "."
  End If

With myobject
            If .IamFloatGroup Then
                    .PeekItem 0, grtype
                    .PeekItem 1, vvl
                    For x1 = 2 To 1 + vvl * 2 Step 2
                            .PeekItem x1, vvl    'here is the name
                          '  Debug.Print "Preek one from UnFloatGroup to "; what$; "  <- "; vvl
                                                    
                            s$ = vvl

                            
                                     If here$ = "" Then
                                        ps2push = bstack.GroupName + s$
                                        Else
                                        ps2push = here$ + "." + bstack.GroupName + s$
                                        End If
              
                            
                            .PeekItem x1 + 1, vvl  'here is the value

                                       If InStr(s$, ".") = 0 Then

                            If Typename(vvl) = "mArray" Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            ss$ = ""
                                            If Not neoGetArrayLinkOnly(bstack, s$, i) Then  ''
                                                    Set subgroup = vvl
                                                    j = -1
                                                    GlobalArr bstack, s$, ss$, 0, j  ''bstack.GroupName &
                                                    Set pppp = var(j)
                                                   '  pppp.IHaveGui = vvl.IHaveGui
                                                    'Set pppp.GroupRef = vvl.GroupRef
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                                    
                                            End If

                                            ps.DataStr s$ + Str$(j)
                            ElseIf Typename(vvl) = "lambda" Then
                            v = GlobalVar(bstack.GroupName & s$, 0)
                                               If here$ = "" Then
                                                GlobalSub bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(v), bstack.GroupName
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(v), here$ + "." + bstack.GroupName
                                            End If
                            GoTo conthere2
                            ElseIf Typename(vvl) = "mHandler" Then
                            CopyHandler vvl, bstack
                            Set vvl = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            GoTo conthere1
                            ElseIf Typename(vvl) = "mEvent" Then
                            CopyEvent vvl, bstack
                            Set vvl = bstack.lastobj
                            If here$ = "" Then
                                   vvl.Upgrade bstack.GroupName
                            Else
                            vvl.Upgrade here$ + "." + bstack.GroupName
                            End If
                        
                            GoTo conthere1
                            Else  ' is not array so...

                                                   
                     
                                            If Typename(vvl) = "Group" Then
                                            Dim spare As Object
                                            If Left$(s$, 1) = "*" Then
                                            
                                             v = GlobalVar(bstack.GroupName & Mid$(s$, 2), 0)
                                                   Set spare = vvl
                                                        UnFloatGroup bstack, Mid$(s$, 2), v, spare
                                                    '    vvl.EndFloat
                                                        Set spare = Nothing
                                             ps.DataStr s$ + Str(v)
                                             Else
                                             
                                             
                                             
                                             v = GlobalVar(bstack.GroupName & s$, 0)
                                                 Set spare = vvl
                                                        UnFloatGroup bstack, s$, v, spare
                                                    
                                                        Set spare = Nothing
                                             
                                              ps.DataStr "*" + s$ + Str(v)
                                             End If
                                                        
                                                  
                                                      
                                            Else

                                            If Right$(s$, 2) = "()" Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            End If
conthere1:
                                                 v = GlobalVar(bstack.GroupName & s$, 0)
conthere2:
                                                        If IsObject(vvl) Then
                                                                    Set var(v) = vvl
                                                        Else
                                                                    var(v) = vvl
                                                        End If
                                                ps.DataStr s$ + Str(v) 'ps2push + Str(V)
                                            End If
                                                        ' ss$ = String$(16, ".")
                                                       ' Mid$(ss$, 1) = Str$(v)
                                                  ''      frm$ = frm$ + ss$
                                                  
                            End If
                            End If  ' rom instr
                 Next x1
           
                        If ohere$ = "" Or bstack.UseGroupname <> "" Then
                        here$ = ""
                        Else
                        here$ = ohere$
                        End If
              
              .PeekItem x1, vvl
     
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)

                 ExecuteVarOnly bstack, what$, i, s$, 1
              End If
                .PeekItem x1 + 1, vvl
               
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
           
                bstack.GroupName = ""
              While s$ <> ""
                 If ohere$ = "" Or bstack.UseGroupname <> "" Then
               here$ = oldgroupname$ + what$
              Else
              here$ = ohere$ + "." + oldgroupname$ + what$
              End If
              
              ''Execute bstack, s$, (True)
          x1 = IsLabelA("", s$, ss$)
        
             If x1 <> 0 Then
                sss$ = s$
                If Len(ss$) > 6 Then
                        x1 = IsLabelA("", s$, ss$)
                        If MyFunction(0, bstack, sss$, 1) Then '' >6 len for function
                        x1 = bstack.IndexSub
                                              var(i).FuncList = Chr$(1) + Chr$(2) + ss$ + "()" + Str(x1) + Chr$(1) + var(i).FuncList
                                              sbf(x1).sbgroup = here$ + "."
                        Else
                        x1 = 0
                         End If
                       
                      
                Else
                        x1 = IsLabelA("", s$, ss$)
                        If MyModule(bstack, sss$, 1) Then
                         x1 = bstack.IndexSub
                              var(i).FuncList = Chr$(1) + Chr$(2) + ss$ + Str(x1) + Chr$(1) + var(i).FuncList
                              sbf(x1).sbgroup = here$ + "."
                      Else
                        x1 = 0
                       End If
                End If
                
       
                sss$ = NLtrim$(sss$) + " "
                While AscW(sss$) = 13
                    SetNextLine sss$
                    sss$ = NLtrim$(sss$) + " "
                Wend
                    If bstack.UseGroupname <> "" Then
                                here$ = ""
                    Else
                            here$ = ohere$
                    End If
               
                s$ = sss$
              Else
              s$ = ""
              End If
              Wend

              End If
                 End If
                End With
                With var(i)
                 .GroupName = what$ + "."
                 .FloatGroupName = myobject.FloatGroupName
              '  .Varlist = frm$
          '      .ArrList = frmarr$
                
         
                End With
            
            here$ = ohere$
             bstack.GroupName = oldgroupname$
End Sub
Sub UnFloatGroupReWriteVars(bstack As basetask, what$, i As Long, myobject As Object)
While Right$(what$, 1) = "."
what$ = Left$(what$, Len(what$) - 1)
Wend
If Trim$(what$) = "" Then Exit Sub
 Dim ps As mStiva, v As Long, s$, frm$, vvl As Variant, x1 As Long, ss$, frmarr$, sss$, j As Long
 Dim grtype As Variant, ps2push As String, TT As Long, ff$
 Set ps = var(i).soros
 Dim subgroup As Object, pppp As mArray
 Dim ohere$, oldgroupname$
 ohere$ = here$
If bstack.UseGroupname <> "" Then
' check this please..
here$ = ""
End If
 oldgroupname$ = bstack.GroupName
 
    If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & what$ & "."
  Else
  bstack.GroupName = what$ & "."
  End If

             With myobject
             If Not .IamFloatGroup Then

             GoTo exithere1
             End If
                If .IamFloatGroup Then
                 .PeekItem 0, grtype
                 
                 .PeekItem 1, vvl
                    For x1 = 2 To 1 + vvl * 2 Step 2
                            .PeekItem x1, vvl    'here is the name
                    
                            
                            s$ = vvl
                            
                                        If here$ = "" Then
                                        ps2push = bstack.GroupName + s$
                                        Else
                                        ps2push = here$ + "." + bstack.GroupName + s$
                                        End If
                            
                            .PeekItem x1 + 1, vvl  'here is the value

                            If Typename(vvl) = "mArray" Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            ss$ = ""
                                            If Not neoGetArrayLinkOnly(bstack, s$, j) Then  ''
                                            j = -1
                                                    Set subgroup = vvl
                                                    GlobalArr bstack, s$, ss$, 0, j
                                                    Set pppp = var(j)
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                            Else
                                                    Set subgroup = vvl
                                                    Set pppp = var(j)
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                            End If
                                            TT = ps.Total
                                          
                                            ps.DataStrUn s$ + Str$(j)
                                    
                                            
                            ElseIf Typename(vvl) = "lambda" Then
                          
                             If GetVar(bstack, bstack.GroupName & s$, v) And here$ = "" Then
                             ElseIf Not GetVar(bstack, s$, v) Then
                        
                             v = GlobalVar(bstack.GroupName & s$, 0)
                              If here$ = "" Then
                                                GlobalSub bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(v), bstack.GroupName
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(v), here$ + "." + bstack.GroupName
                                            End If
                             End If
                             Set var(v) = vvl
                                
                              TT = ps.Total
                                 ps.DataStrUn s$ + Str(v)
                             
                            Else  ' is not array so...
                            '' drop *
                            If Asc(s$) = 42 Then s$ = Mid$(s$, 2)
                                  If GetVar(bstack, bstack.GroupName & s$, v) And here$ = "" Then
                                  ' this needed for "a<=b"  a copy to a global group
                                
                                                ElseIf Not GetVar(bstack, s$, v) Then
                                                        v = GlobalVar(bstack.GroupName & s$, 0)
                                            End If
                                            If Typename(vvl) = "Group" Then
                                                        Dim spare As Object
                                                        Set spare = vvl
                                                                    If Typename(var(v)) <> "Group" Then
                                                                                UnFloatGroup bstack, s$, v, spare
                                                                    Else
                                                                                UnFloatGroupReWriteVars bstack, s$, v, spare
                                                                    End If
                                           
                                                        Set spare = Nothing
                                                                  TT = ps.Total
                              
                                                         ps.DataStrUn "*" + s$ + Str(v)  'ps2push + Str(v)
                                            Else
                                                        If IsObject(vvl) Then
                                                        
                                                                    
                                                                    If Typename(vvl) = "mHandler" Then
                                                                    CopyHandler vvl, bstack
                                                                    Set vvl = bstack.lastobj
                                                                    Set bstack.lastobj = Nothing
                                                                    ElseIf Typename(vvl) = "mEvent" Then
                                                                    
                                                                    CopyEvent vvl, bstack
                                                                    Set vvl = bstack.lastobj
                                                                    Set bstack.lastobj = Nothing
                                                                    If here$ = "" Then
                                                                           vvl.Upgrade bstack.GroupName
                                                                    Else
                                                                    vvl.Upgrade here$ + "." + bstack.GroupName
                                                                    End If
                                                                    End If
                                                                    Set var(v) = vvl
                                                                    
                                                        Else
                                                                    var(v) = vvl
                                                        End If
                                                         TT = ps.Total
                                                             ps.DataStrUn s$ + Str(v)  'ps2push + Str(v)
                                            End If
                                    '                 If Not TT = ps.Total Then
                                     '  End If

                            End If
                 Next x1
                End If
                 If ohere$ = "" Or bstack.UseGroupname <> "" Then
                                here$ = ""
              Else
                                 here$ = ohere$
              End If
              
              .PeekItem x1, vvl
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
                   ExecuteVarOnly bstack, what$, i, s$, 1
              End If
                .PeekItem x1 + 1, vvl
               
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
           
                bstack.GroupName = ""
              While s$ <> ""
                 If ohere$ = "" Or bstack.UseGroupname <> "" Then
               here$ = oldgroupname$ + what$
              Else
     here$ = ohere$ + "." + oldgroupname$ + what$
              End If
              
              ''Execute bstack, s$, (True)
          x1 = IsLabelA("", s$, ss$)
        
             If x1 <> 0 Then
                sss$ = s$
                If Len(ss$) > 6 Then
                        x1 = IsLabelA("", s$, ss$)
                        If MyFunction(0, bstack, sss$, 1) Then '' >6 len for function
                        x1 = bstack.IndexSub
                                              var(i).FuncList = Chr$(1) + Chr$(2) + ss$ + "()" + Str(x1) + Chr$(1) + var(i).FuncList
                                              sbf(x1).sbgroup = here$ + "."
                        Else
                        x1 = 0
                         End If
                       
                      
                Else
                        x1 = IsLabelA("", s$, ss$)
                        If MyModule(bstack, sss$, 1) Then
                         x1 = bstack.IndexSub
                              var(i).FuncList = Chr$(1) + Chr$(2) + ss$ + Str(x1) + Chr$(1) + var(i).FuncList
                              sbf(x1).sbgroup = here$ + "."
                      Else
                        x1 = 0
                       End If
                End If
                
       
                sss$ = NLtrim$(sss$) + " "
                While AscW(sss$) = 13
                    SetNextLine sss$
                    sss$ = NLtrim$(sss$) + " "
                Wend
                        If bstack.UseGroupname <> "" Then
                    here$ = ""
                    Else
                                  here$ = ohere$
                    End If
               
                s$ = sss$
              Else
              s$ = ""
              End If
              Wend

              End If
             
             ''\   .EndFloat
                   
                
                
                End With
                With var(i)
    
             
                
         
                End With
exithere1:
            here$ = ohere$
             bstack.GroupName = oldgroupname$

End Sub
Function GetFunctionList(ByVal s$) As String
Dim c$, f$, k$(), b$(), q$(), dd$, qq$
While s$ <> ""
If ISSTRINGA(s$, c$) Then
k$() = Split(c$, " ")
qq$ = RTrim$(sbf(val(k$(1))).sb)
If qq$ <> "" Then
    If Right$(qq$, 2) <> vbCrLf Then qq$ = qq$ + vbCrLf
End If
If Right$(k$(0), 1) = ")" Then


f$ = "Function " + Mid$(k$(0), 2, Len(k$(0)) - 3) + " {" + qq$ + "}" + vbCrLf + f$
Else


f$ = "Module " + Mid$(k$(0), 2, Len(k$(0)) - 1) + " {" + qq$ + "}" + vbCrLf + f$
End If
End If

Wend
GetFunctionList = f$
End Function

Sub MakeMyTitle(s$, lang As Long)
     If InStr(s$, "(") > 0 Then
            If shortlang Then
            If lang Then Form1.TEXT1.TITLE = "F. " + s$ + " F12 " Else Form1.TEXT1.TITLE = "Σ. " + s$ + " "
            Else
            If lang Then Form1.TEXT1.TITLE = "Function " + s$ + " F12 " Else Form1.TEXT1.TITLE = "Συνάρτηση " + s$ + " "
            End If
            Else
            If shortlang Then
            If lang Then Form1.TEXT1.TITLE = "M. " + s$ + " F12 " Else Form1.TEXT1.TITLE = "Τ. " + s$ + " "
            Else
            If lang Then Form1.TEXT1.TITLE = "Module " + s$ + " F12 " Else Form1.TEXT1.TITLE = "Τμήμα " + s$ + " "
            End If
            End If
End Sub
Function SBcode(i As Long) As String
SBcode = sbf(i).sb
End Function
Function GlobalHandler(basestack As basetask, rest$, lang As Long, typeHandler As Long) As Boolean
Dim x1 As Long, ss$, i As Long, s$, what$, par As Boolean
Do
x1 = Abs(IsLabel(basestack, rest$, what$))
If x1 <> 1 Then GlobalHandler = False: Exit Function
ss$ = here$
here$ = ""

i = GlobalVar(basestack.GroupName & what$, s$, , True)
Select Case typeHandler
Case 1
MakeitObjectInventory var(i)
here$ = ss$
If FastSymbol(rest$, "=") Then
Set basestack.lastobj = var(i)
GlobalHandler = AddInventory(basestack, rest$)
Exit Function
End If
Case 2
MakeitObjectBuffer var(i)
here$ = ss$
Case Else
here$ = ss$
End Select
Loop Until Not FastSymbol(rest$, ",")
If rest$ <> "" Then
If Not MaybeIsSymbol(rest$, ":" + vbCr) Then
SyntaxError
Else
GlobalHandler = True
End If
Else
GlobalHandler = True
End If

 


End Function
Function GlobalEVENT(basestack As basetask, rest$, lang As Long) As Boolean
Dim x1 As Long, ss$, i As Long, s$, what$

x1 = Abs(IsLabel(basestack, rest$, what$))
If x1 <> 1 Then GlobalEVENT = False: Exit Function
ss$ = here$
here$ = ""
i = GlobalVar(basestack.GroupName & what$, s$, , True)
MakeitObjectEvent var(i)
here$ = ss$
GlobalEVENT = ProcEvent(basestack, rest$, lang, i)
 


End Function

Function GlobalMoveGroup(bstack As basetask, w$) As Boolean

Dim myobject As Object, r1 As Long, p As Double
                           r1 = GlobalVar(w$, p)
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If r1 <> 0 Then
                                        
                                            If Typename(var(r1)) = "Group" Then
                                 
                                            UnFloatGroupReWriteVars bstack, w$, r1, myobject
                                            Else
                         
                                        UnFloatGroup bstack, w$, r1, myobject
                                                 ' global??
                                        Set myobject = Nothing
                                    
                                            End If
                                                         
                                            
                                        End If

End Function
Function dimString(typo$) As String
Dim pppp As mArray, PP, i As Long, p
Dim b$(), vl$
b$() = Split(typo$, " ")

Set pppp = var(val(b$(1)))
      pppp.SerialItem PP, CLng(p), 5
         Dim A$()
         ReDim A$(PP)
      For i = 0 To PP - 1
      pppp.SerialItem p, i, 6
      A$(i) = CStr(p)
      Next i
      pppp.SerialItem p, CLng(0), 2
      If InStr(b$(0), "$") > 0 Then
      vl$ = "{" + CStr(p) + "} "
      Else
      vl$ = CStr(p) + " "
      End If
      If PP > 1 Then
      dimString = b$(0) + Join(A$(), ",") + ")=" + vl$
      Else
      dimString = b$(0) + A$(0) + ")=" + vl$
      End If
End Function
Sub LogGroup(bstack As basetask, vvv As Long, ohere$, OvarnameLen As Long, OarrnameLen As Long, lcl As Boolean)
Dim ss$, w$, i As Long, nm$, nt$, CM$, nt1$, j As Long, k As Long, dropit As Long
Dim s() As String
      With var(vvv)

  
        
        If here$ <> "" Then
        w$ = UCase(here$ & "." & ohere$ & ".")
        Else
        w$ = UCase(ohere$ & ".")
        End If
            If OvarnameLen <= varhash.count Then
                    
            For i = OvarnameLen To varhash.count  ' or not
            
                 varhash.ReadVar i - 1, ss$, dropit
                 
                If Left(ss$, Len(w$)) = w$ Then
                j = dropit
                    nt$ = Typename$(var(j))
                 If Not lcl Then
                                         If nt$ = "Group" Then
                                        .soros.DataStr "*" + Mid$(ss$, Len(w$) + 1) + Str(j)
                                        Else
                                        .soros.DataStr Mid$(ss$, Len(w$) + 1) + Str(j)
                                       
                                        End If
                            Else
                             nm$ = Mid$(ss$, Len(w$) + 1)
                          
                                If nt1$ <> nt$ Then .LocalList = .LocalList + vbCrLf: CM$ = ""
                           If i = OvarnameLen Then CM$ = "Local " Else CM$ = ", "
                           If nt$ = "Long" Then
                           If CM$ = "," Then nt1$ = "" Else nt1$ = nt$ + " "
                           .LocalList = .LocalList + CM$ + nt1$ + nm$ + "=" + Trim$(Str(var(j)))
                           ElseIf nt$ = "mArray" Then
                            .LocalList = .LocalList + vbCrLf + "local DIM " + dimString(nm$ + Str$(j)) + vbCrLf
                           ElseIf nt$ = doc Then
                           If CM$ = "," Then nt1$ = "" Else nt1$ = nt$ + " "
                           .LocalList = .LocalList + CM$ + nt1$ + nm$ + "=" + "{" + CStr(var(j)) + "}"
                           ElseIf InStr(nm$, "$") Then
                                .LocalList = .LocalList + CM$ + nm$ + "=" + "{" + CStr(var(j)) + "}"
                           Else
                                .LocalList = .LocalList + CM$ + nm$ + "=" + CStr(var(j))
                            End If
                            nt1$ = nt$
                End If
                End If
            Next i

            If lcl Then .LocalList = .LocalList + vbCrLf
            End If
        
           
           '
           

End With
OvarnameLen = varhash.count + 1 'Len(VarName$) + 1   'we record ...AGAIN

End Sub
Function FindNameForGroup(bstack As basetask, w$) As Boolean
Dim ss() As String, w2 As Long
  If InStr(w$, ChrW(&H1FFF)) > 0 Then
        If InStr(w$, ".") > 0 Then
        ss() = Split(w$, ".")
            If GetVar(bstack, ss(0), w2) Then
                If Typename(var(w2)) = "Group" Then
                   If var(w2).FloatGroupName <> "" Then ss(0) = var(w2).FloatGroupName: FindNameForGroup = True
                   w$ = Join(ss(), ".")
                            If InStr(w$, ChrW(&H1FFF)) > 0 Then
                             w$ = ""
                            Else
                             FindNameForGroup = True
                             End If
                 Else
                 w$ = ""
                End If
                                 Else
                 w$ = ""
            End If
                             Else
                 w$ = ""
    End If
    End If
End Function
Sub i3MouseIcon(basestack As basetask, rest$, lang As Long)
On Error Resume Next
Dim scr As Object, s$, x As Double
Set scr = basestack.Owner

If Typename(basestack.Owner) Like "Gui*" Then
oxiforforms
ElseIf basestack.toprinter Then
    oxiforPrinter
Else
        If IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", lang) Then
                If FastSymbol(rest$, "!") Or OperatingSystem > System_Windows_7 Then
                MouseShow False
                ElseIf basestack.tolayer > 0 Or basestack.toback Then
                            scr.MouseIcon = Form1.Picture2.Picture
                            scr.mousepointer = 99
                Else
                            If Not basestack.LastState Then
                                        basestack.LastState = True
                                        scr.MouseIcon = Form1.Picture2.Picture
                                        scr.mousepointer = 99
                            End If
                End If
        ElseIf IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", lang) Then
                If FastSymbol(rest$, "!") Or OperatingSystem > System_Windows_7 Then
                MouseShow True
                ElseIf basestack.tolayer > 0 Or basestack.toback Then
                 scr.mousepointer = 1
                          Set scr.MouseIcon = Nothing
                           
                
                Else
                            If basestack.LastState Then
                                    basestack.LastState = False
                                    If basestack.LastMouse1 = 99 Then
                                          s$ = CFname(basestack.LastMouse2)
                                          scr.MouseIcon = LoadPicture(GetDosPath(s$))
                                    End If
                                    scr.mousepointer = basestack.LastMouse1
                            End If
                End If
        ElseIf IsStrExp(basestack, rest$, s$) Then
                    
                If basestack.tolayer > 0 Or basestack.toback Then
                            If CFname(s$) <> "" Then
                                        s$ = CFname(s$)
                                        scr.MouseIcon = LoadPicture(GetDosPath(s$))
                                        scr.mousepointer = 99
                            End If
                Else
                            If Not basestack.LastState Then
                            s$ = CFname(s$)
                                        scr.MouseIcon = LoadPicture(GetDosPath(s$))
                                        scr.mousepointer = 99
                            Else
                                        If CFname(s$) <> "" Then
                                                s$ = CFname(s$)
                                                basestack.LastMouse1 = 99
                                                basestack.LastMouse2 = s$
                                                If Not basestack.LastState Then
                                                                scr.MouseIcon = LoadPicture(GetDosPath(s$))
                                                                scr.mousepointer = 99
                                                End If
                                        End If
                        End If
                End If
    ElseIf IsExp(basestack, rest$, x) Then
                basestack.LastState = False
                On Error Resume Next
                scr.mousepointer = CLng(x)
                If Err Then MyEr "Bad icon bumber", "Πρόβλημα με τον αριθμό" Else basestack.LastMouse1 = CLng(x)
                Err.Clear
    Else
             MyEr "Missing  filename or icon number", "Λείπει όνομα αρχείου ή αριθμός εικονιδίου"
    End If
End If
End Sub
Function procTestMe(bstack As basetask, rest$, what$) As Boolean
Dim ss$
procTestMe = True
If FastSymbol(rest$, "!") Then
untest:
If trace Then
With Form2
If pagio$ = "GREEK" Then
.gList2.HeadLine = "Έλεγχος"
Else
.gList2.HeadLine = "Control"
End If
If TestShowCode And here$ <> "" Then
    Form2.gList3(2).BackColor = &H606060
Else
    Form2.gList3(2).BackColor = &H3B3B3B
    End If
.Label1(0) = ""
.Label1(1) = ""
.Label1(2) = ""
.Hide
 Set .Process = Nothing
 End With
 
STq = False
STEXIT = False
STbyST = False
trace = False
End If
Else
ss$ = ""

STq = False
STEXIT = False
STbyST = True
Form2.Show , Form1
If ISSTRINGA(rest$, ss$) Then IsSymbol rest$, ","
If here$ = "" Then

 TestShowSub = ""
 TestShowStart = 0
 Form2.testpad.Text = ""
 Form2.testpad.Show
 Form2.testpad.SetRowColumn 1, 1
 
 End If
MyDoEvents
' gList2.HeadLine
If ss$ <> "" Then Form2.gList2.HeadLine = Form2.gList2.HeadLine + ": " + ss$: TestShowCode = True
Form2.Label1(0) = here$
Form2.Label1(1) = what$
Form2.Label1(2) = GetStrUntil(vbCrLf, rest$ & vbCrLf, False)

If TestShowCode And here$ <> "" Then

Form2.gList3(2).BackColor = &H606060
ss$ = GetNextLine((sbf(bstack.OriginalCode).sb))
    If Left$(ss$, 10) = "'11001EDIT" Then
    
    TestShowSub = Mid$(sbf(bstack.OriginalCode).sb, Len(ss$) + 3)
    Else
     TestShowSub = ss$
     End If
     If bstack.addlen Then
     If Len(TestShowSub) - bstack.addlen > 0 Then
     TestShowStart = rinstr(Left$(TestShowSub, Len(TestShowSub) - bstack.addlen), Mid$(rest$, 2)) - 1
     Else
     TestShowStart = 1
     End If
     Else
        TestShowStart = rinstr(TestShowSub, Mid$(rest$, 2)) - 1
End If
Else
 TestShowSub = ""
 End If
 Set Form2.Process = bstack
stackshow bstack
MyDoEvents
Form1.Show , Form5

If IsLabelOnly(rest$, what$) Then
rest$ = ": " + what$ + " " + rest$
If Not trace Then
trace = True
procTestMe = Execute(bstack, rest$, True) = 1
GoTo untest
End If

End If
trace = True
End If

End Function
Function procMotionW(bstack As basetask, rest$) As Boolean
Dim x As Double, y As Double
If Not Form1.Visible Then Exit Function
procMotionW = True
Form1.Visible = True
If Form1.WindowState <> 0 Then Form1.WindowState = 0 ': mydoevents

If Form1.WindowState = 0 Then
    If Not IsExp(bstack, rest$, x) Then x = Form1.Left
    If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, y) Then procMotionW = False: Exit Function
        Else
        
        y = Form1.top
    End If
    If FastSymbol(rest$, ";") Then
    x = ((ScrX() - 1) - Form1.Width) / 2
    y = ((ScrY() - 1) - Form1.Height) / 2
    End If
' LETS MOVE
Form1.Move x, y
'Form1.follow IEX, IEY
Form1.Up
If IsWine Then Sleep 10

'Form1.Refresh
End If
End Function
Function procLineSpace(bstack As basetask, rest$) As Boolean
Dim x As Double
procLineSpace = True
If IsExp(bstack, rest$, x) Then

    If CLng(x) < 0 Or CLng(x) > 60 * dv15 Then
    OutOfLimit
    Else
    x = (x \ 30) * 60
    x = CLng(x) / 2
    
   SetText bstack.Owner, CLng(x)
    
    End If
ElseIf FastSymbol(rest$, "!") Then
   SetText bstack.Owner, 4 * Screen.TwipsPerPixelY
Else
MissNumExpr
procLineSpace = False

Exit Function
End If


End Function

Function ProcLabel(basestack As basetask, rest$) As Boolean
Dim s$, frm$, p As Double, x As Double, y As Double, sx As Double, sy As Double
Dim scr As Object, prive As basket
Set scr = basestack.Owner
prive = players(GetCode(scr))
ProcLabel = True
If Not IsStrExp(basestack, rest$, s$) Then Exit Function


frm$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))
s$ = ""
x = 0
If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, s$) Then
    If TypeOf scr Is GuiM2000 Then
    s$ = scr.Controls(1).FontName
    Else
    s$ = prive.FontName
    End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, x) Then
         If TypeOf scr Is GuiM2000 Then
         x = scr.Controls(1).FontSize
         Else
            x = prive.SZ
        End If
        End If
        
            y = 0
            
                If FastSymbol(rest$, ",") Then
                    If Not IsExp(basestack, rest$, p) Then p = 0
                  If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, sy) Then
                        nPlain basestack, frm$, s$, x, y, CLng(p), True, CLng(sy \ DXP)
                    Else
                        nPlain basestack, frm$, s$, x, y, CLng(-p - 1)
                    End If
                 Else
                    nPlain basestack, frm$, s$, x, y, CLng(-p - 1)
                 End If
                Else
                    nPlain basestack, frm$, s$, x, y, -1
                End If
    Else
        nPlain basestack, frm$, s$, x, 0, -1
    End If
Else
nPlain basestack, frm$, prive.FontName, prive.SZ, x, -1
End If
PlaceBasket scr, prive
End Function
Function ProcLegend(basestack As basetask, rest$) As Boolean
Dim s$, frm$, p As Double, x As Double, y As Double, sx As Double, sy As Double
Dim scr As Object, prive As basket
Set scr = basestack.Owner
prive = players(GetCode(scr))
ProcLegend = True
If FastSymbol(rest$, "!") Then
ProcLegend = False
If IsStrExp(basestack, rest$, s$) Then
      If InStr(s$, ChrW(&HFFFFF8FB)) > 0 Then s$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))

    ProcLegend = True
    If Not FastSymbol(rest$, ",") Then ProcLegend = False: Exit Function
    If IsExp(basestack, rest$, p) Then
    x = p
    If Not FastSymbol(rest$, ",") Then
    y = 1
    ElseIf Not IsExp(basestack, rest$, y) Then
       ProcLegend = False: Exit Function
    End If
    Else
    x = prive.mx
    If Not FastSymbol(rest$, ",") Then ProcLegend = False: Exit Function
    If Not IsExp(basestack, rest$, y) Then ProcLegend = False: Exit Function
    End If
    wPlain scr, prive, s$, (x), y - 1
End If
Else
If Not IsStrExp(basestack, rest$, s$) Then Exit Function


frm$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))
s$ = ""
x = 0
If FastSymbol(rest$, ",") Then
If Not IsStrExp(basestack, rest$, s$) Then Exit Function
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, x) Then Exit Function
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, y) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, p) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, sx) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, sy) Then Exit Function
nPlain basestack, frm$, s$, x, y, CLng(p), sx <> False, CLng(sy \ DXP)
Else
nPlain basestack, frm$, s$, x, y, CLng(p), sx <> False
End If
Else
nPlain basestack, frm$, s$, x, y, CLng(p)
End If
Else
nPlain basestack, frm$, s$, x, y
End If
Else

nPlain basestack, frm$, s$, x
End If
End If
If FastSymbol(rest$, ";") Then
''NO REFRESH
Else
If Not extreme Then If Not basestack.toprinter Then MyDoEvents1 scr
End If
PlaceBasket scr, prive
End Function

Function ProcText(basestack As basetask, isHtml As Boolean, rest$) As Boolean
Dim x1 As Long, frm$, pa$, s$
ProcText = True
If IsSymbol(rest$, "UTF-8", 5) Then
x1 = 2
ElseIf IsSymbol(rest$, "UTF-16", 6) Then
x1 = 0 ' only little endian (but if something convert it to big we can read...)
Else
x1 = 3
End If

s$ = ""
If Not IsStrExp(basestack, rest$, s$) Then
If Not Abs(IsLabelOnly(rest$, s$)) = 1 Then
    ProcText = False
    Exit Function
End If
End If
FastSymbol rest$, ","
If s$ <> "" Then

If FastSymbol(rest$, "+") Then pa$ = "" Else pa$ = "new"
If FastSymbol(rest$, "{") Then frm$ = NLtrim$(blockString(rest$))
If frm$ <> "" Then
If isHtml Then
If ExtractType(s$) = "" Then s$ = s$ & ".html"
End If
 textPUT basestack, mylcasefILE(s$), frm$, pa$, x1
Else
 textDel (mylcasefILE(s$))
 ProcText = True
 Exit Function
End If
ProcText = FastSymbol(rest$, "}")
End If
Exit Function

End Function
Function ProcPrinting(basestack As basetask, rest$, lang As Long) As Boolean
Dim xp As Printer, scr As Object
Set scr = basestack.Owner
  ProcPrinting = True
 If ThereIsAPrinter = False Then Exit Function
If IsLabelSymbolNew(rest$, "ΝΑΙ", "ON", lang) And pname <> "" And Not basestack.toprinter Then
                            basestack.toprinter = True
                            For Each xp In Printers
                            If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
                            Next xp
                            getfirstpage
                            Set scr = Form1.PrinterDocument1
                            If players(-2).Xt = 0 Then
                            players(-2) = players(0)  'COPY dis
                            With players(-2)
                                .curpos = 0
                                .currow = 0
                                .XGRAPH = 0
                                .YGRAPH = 0
                            End With
                            End If
                            PlaceBasket Form1.PrinterDocument1, players(-2)
                            SetText Form1.PrinterDocument1
                            ''SetTextSZ scr, players(0).SZ
                            LCTbasket Form1.PrinterDocument1, players(-2), 0, 0
                            Printer.CurrentX = 0
                            Printer.CurrentY = 0
ElseIf IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", lang) And basestack.toprinter Then
                    getenddoc
                    Set scr = Form1.DIS
                    basestack.toprinter = False
                    SetNormal scr
ElseIf IsLabelSymbolNew(rest$, "ΔΙΕΚΟΨΕ", "BREAK", lang) And basestack.toprinter Then
                    pnum = 0
                    oprinter.ClearUp
                    Form1.PrinterDocument1.Picture = LoadPicture("")
                    Set scr = Form1.DIS
                    basestack.toprinter = False
                    SetNormal scr
                    Else
                    ProcPrinting = False
                    End If
Exit Function


End Function

Function ProcPrinter(basestack As basetask, rest$) As Boolean
Dim xp As Printer, i As Long, p As Double, x1 As Long, y1 As Long, x As Double, y As Double
Dim s$, ss$, frm$, f As Long, pa$, sx As Double, it As Long, ya As Long, AddTwipsTopL As Long
Dim scr As Object
ProcPrinter = True
Set scr = basestack.Owner
If basestack.toprinter Then Exit Function
 If ThereIsAPrinter = False Then Exit Function
If FastSymbol(rest$, "!") Then
olamazi
If ThereIsAPrinter Then
For Each xp In Printers
If xp.DeviceName = pname Then
Set Printer = xp
Exit For
End If
Next xp

If ShowProperties(Form1, Printer.DeviceName, MyDM()) Then
MyDoEvents
PrinterDim pw, ph, psw, psh, pwox, phoy
End If
End If
Exit Function
End If

If FastSymbol(rest$, "?") Then
Form1.List1.Clear
For Each xp In Printers
Form1.List1.additemFast xp.DeviceName & " (" & xp.port & ")"
Next xp
For i = 0 To Form1.List1.listcount - 1
If pname & " (" & port & ")" = Form1.List1.list(i) Then Form1.List1.ListIndex = i
Next i
If interpret(basestack, "menu !") Then
i = InStr(Form1.List1, " (")
pname = Left$(Form1.List1, i - 1)
port = Mid$(Form1.List1, i + 2, InStr(i + 2, Form1.List1, ")") - i - 2)
End If
For Each xp In Printers
If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
Next xp
ReDim MyDM(1 To 1) As Byte
Exit Function
End If
If Not IsExp(basestack, rest$, p) Then p = players(-2).SZ

If FastSymbol(rest$, ",") Then
If IsStrExp(basestack, rest$, s$) Then
For Each xp In Printers
If xp.DeviceName & " (" & xp.port & ")" = s$ Then
pname = xp.DeviceName
port = xp.port
Set Printer = xp
If FastSymbol(rest$, ",") Then
If IsStrExp(basestack, rest$, ss$) Then
LoadArray MyDM(), ss$
End If
Exit For
End If
End If
Next xp

Exit Function
End If
End If
If FastSymbol(rest$, "{") Then
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
 If ThereIsAPrinter = False Then Exit Function
If pname = "" Then Exit Function
For Each xp In Printers
If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
Next xp
getfirstpage

If players(-2).Xt = 0 Then

players(-2) = players(0)  'COPY dis
With players(-2)
players(-2).curpos = 0
players(-2).currow = 0
.SZ = CSng(p * 3)
End With
PlaceBasket Form1.PrinterDocument1, players(-2)
SetText Form1.PrinterDocument1

Else
SetTextSZ Form1.PrinterDocument1, CSng(p * 3)
LCTbasket Form1.PrinterDocument1, players(-2), 0, 0
End If

With Printer   ' for no specific reason..I have to think it again
.CurrentX = 0
.CurrentY = 0
End With
basestack.toprinter = True
it = Execute(basestack, ss$, False)
If Not basestack.toprinter Then
pnum = 0
oprinter.ClearUp
Form1.PrinterDocument1.Picture = LoadPicture("")
Else
getenddoc
End If
basestack.toprinter = False
Set scr = basestack.Owner
If it = 0 Then
If Trim(ss$) = "" Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$
ProcPrinter = False
End If
End If
Else
PlainBaSket scr, players(GetCode(scr)), pname & " (" & port & ")"
crNew basestack, players(GetCode(scr))
End If
Exit Function
End Function

Function ProcLayer(basestack As basetask, rest$) As Boolean
Dim xp As Printer, i As Long, p As Double, x1 As Long, y1 As Long, x As Double, y As Double
Dim s$, ss$, frm$, f As Long, pa$, sx As Double, it As Long, W3 As Long, ya As Long, AddTwipsTopL As Long
Dim scr As Object, scr1 As GuiM2000
Dim prive As basket
ProcLayer = True
Set scr = basestack.Owner
prive = players(GetCode(scr))  ' backup
If Not IsExp(basestack, rest$, p) Then
prive = players(0)
p = 0 ' dis
Set basestack.lastobj = Nothing
End If
If basestack.lastobj Is Nothing Then
If p > 32 Then p = 0 ' dis
Else
If Typename(basestack.lastobj) = "mHandler" Then
    i = basestack.lastobj.Indirect
    If i >= 0 And i <= var2used Then
        If Typename(var(i)) = "GuiM2000" Then
            Set scr1 = var(i)
            p = GetCode(scr1)
        End If
    End If
ElseIf Typename(basestack.lastobj) = "GuiM2000" Then
    Set scr1 = basestack.lastobj
    p = GetCode(scr1)

End If
End If
Set basestack.lastobj = Nothing
W3 = basestack.tolayer
basestack.tolayer = CLng(p)


If FastSymbol(rest$, "{") Then
If p > 32 Then
    If players(p).MAXXGRAPH = 0 Then
        SetTextBasketBack scr1, players(0)
        SetText scr1, prive.MineLineSpace, True
        With players(p)
        .curpos = 0
        .currow = 0
        .mysplit = 0
        .osplit = 0
        .XGRAPH = 0
        .YGRAPH = 0
        .lastprint = True
        .Paper = Form1.DIS.BackColor
        .mypen = players(0).mypen
        End With
        scr1.BackColor = Form1.DIS.BackColor
        scr1.CurrentX = 0
        scr1.CurrentY = 0
     End If
ElseIf p > 0 Then
f = FindSpriteByTag(CLng(p))
If f = 0 Then
    f = GetNewLayerObj(CLng(p), scr.Width, scr.Height)
    SetTextBasketBack Form1.dSprite(f), prive   ' load form prive to dSprite
    SetText Form1.dSprite(f), prive.MineLineSpace, True    'load Players() with first values
    With players(p)
    .curpos = 0
    .currow = 0
    .mysplit = 0
    .osplit = 0
    .Paper = Form1.DIS.BackColor
    .mypen = players(0).mypen
    End With
    Form1.dSprite(f).BackColor = Form1.DIS.BackColor
End If

p = f
End If
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
If p = 0 Then
Set basestack.Owner = Form1.DIS
ElseIf p < 33 Then
Set basestack.Owner = Form1.dSprite(p)
Else
Set basestack.Owner = scr1
End If

it = Execute(basestack, ss$, False)

MyDoEvents2 basestack.Owner
GdiFlush
basestack.tolayer = W3
Set basestack.Owner = scr

If it = 0 Then
If Trim(ss$) = "" Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$
ProcLayer = False
End If
End If
End If



End Function
Function MakeForm(basestack As basetask, rest$) As Boolean
On Error Resume Next
MakeForm = True
Dim scr As Object, XX As Single, p As Double, x1 As Long, y1 As Long, x As Double, y As Double
Dim W3 As Long, W4 As Long, sx As Double, adjustlinespace As Boolean, SZ As Single
Set scr = basestack.Owner
Dim basketcode As Long, mAddTwipsTop As Long


If Typename(scr) Like "Gui*" Then
If Typename(scr) Like "GuiM2000" Then GoTo there1
ElseIf scr.name = "Form1" Then

Else
there1:
basketcode = GetCode(scr)
With players(basketcode)
mAddTwipsTop = .uMineLineSpace  ' the basic

If IsExp(basestack, rest$, p) Then
    If p < 10 Then p = 10
    x = 4
    XX = 4
    If scr.name = "DIS" Then
    Do
    y = CDbl(XX)
    XX = CSng(x)
    nForm basestack, XX, W3, W4, mAddTwipsTop  'using line spacing
    If XX > CSng(x) Then x = CDbl(XX)
    
    If Form1.Width < W3 * p Then Exit Do
    x = x + 0.25
    Loop
 
    
    Else
    Do
    
    y = CDbl(XX)
    XX = CSng(x)

    nForm basestack, XX, W3, W4, mAddTwipsTop  'using line spacing
    If XX > CSng(x) Then x = CDbl(XX)
    
    If scr.Width < W3 * p Then Exit Do
    
    x = x + 0.4
    Loop
    End If
    x = y
    sx = 0
   
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, sx) Then
        '' ok
        
       mAddTwipsTop = 0  ' find a new one
       players(basketcode).MineLineSpace = 0
       players(basketcode).uMineLineSpace = 0
        adjustlinespace = True
    ''    mmx = scr.Width
''mmy = scr.Height
        Else
        MakeForm = False
        MissNumExpr
        Set scr = Nothing
        Exit Function
        End If
   
End If
If FastSymbol(rest$, ";") And scr.name = "DIS" Then
adjustlinespace = False
    Form1.Move 0, 0, ScrX(), ScrY()
    Form1.BackColor = players(-1).Paper
    
Sleep 1
End If
nForm basestack, CSng(x), W3, W4, 0
Dim mmx As Long, mmy As Long
If sx = 0 Then
SZ = CSng(x)
mmx = scr.Width
 If scr.name = "DIS" Then
 mmy = CLng(mmx * Form1.Height / Form1.Width) ' WHY 3/4 ??
 Else
 mmy = scr.Width
 End If
 players(basketcode).MineLineSpace = mAddTwipsTop
 players(basketcode).uMineLineSpace = mAddTwipsTop
FrameText scr, SZ, CLng(W3 * p), mmy, players(basketcode).Paper
Else
If scr.name = "DIS" Then
If (sx * W4) > Form1.Height Then
y = Form1.Height
While sx * W4 > Form1.Height

XX = y / (dv20 * sx)

nForm basestack, XX, W3, W4, 0  'using no spacing so we put a lot of lines
x = CDbl(XX)
y = y * 0.9
Wend


End If
Else
If sx * W4 > scr.Height Then
y = scr.Height
While sx * W4 > scr.Height

XX = y / (dv20 * sx)

nForm basestack, XX, W3, W4, 0  'using no spacing so we put a lot of lines
x = CDbl(XX)
y = y * 0.9
Wend


End If

End If
If scr.name = "DIS" Then
If Not adjustlinespace Then If scr.Height >= Form1.Height - dv15 Then mAddTwipsTop = dv15 * (((scr.Height - sx * W4) / sx / 2) \ dv15)
End If
nForm basestack, (x), W3, W4, mAddTwipsTop
SZ = CSng(x)
'If mmx < scr.Width Then
mmx = scr.Width


'If mmx < scr.Width Then
mmy = scr.Height
If adjustlinespace Then
If scr.name = "DIS" Then
mAddTwipsTop = dv15 * (((Form1.Height - sx * W4) / sx / 2) \ dv15)
Else
mAddTwipsTop = dv15 * (((scr.Height - sx * W4) / sx / 2) \ dv15)
End If
sx = CLng(sx * (W4 + mAddTwipsTop * 2))
Else
sx = CLng(sx * W4)
End If
players(basketcode).MineLineSpace = mAddTwipsTop
players(basketcode).uMineLineSpace = mAddTwipsTop
FrameText scr, SZ, CLng(W3 * p), CLng(sx), players(basketcode).Paper, Not (scr.name = "DIS")


End If


ElseIf FastSymbol(rest$, ";") And scr.name = "DIS" Then
Form1.Move 0, 0, ScrX(), ScrY()
Form1.BackColor = players(-1).Paper
Form1.Cls


''x = interpret(basestack, "MOTION CENTER")
''x = interpret(basestack, "MODE" & Str$(players(GetCode(scr)).SZ) & "," & Str$(scr.Width) & "," & Str$(scr.Height))
MyMode scr
ElseIf scr.name = "DIS" Then
Form1.Move Form1.Left + scr.Left, Form1.top + scr.top, scr.Width, scr.Height
scr.Move 0, 0
Form1.Cls
SetText scr
Set scr = Nothing
Exit Function
Else
'' CROP LAYER
If basketcode > 0 Then
With players(basketcode)
.MAXXGRAPH = .mx * .Xt
.MAXYGRAPH = .My * .Yt
End With
With Form1.dSprite(basestack.tolayer)
.Move .Left, .top, players(basketcode).MAXXGRAPH, players(basketcode).MAXYGRAPH
End With

End If
End If

players(basketcode).MineLineSpace = mAddTwipsTop
players(basketcode).uMineLineSpace = mAddTwipsTop
MakeForm = True
.curpos = 0
.currow = 0

End With
End If
SetText scr


End Function
Function ProcAbout(basestack As basetask, rest$, lang As Long) As Boolean

Dim par As Boolean, s$, ss$, x As Double, y As Double, i As Long
Dim kk As New Document
Dim UAddPixelsTop As Long  ' just not used

If FastSymbol(rest$, "!") Then
'*******
vH_title$ = ""
par = True
par = par And IsStrExp(basestack, rest$, s$)

If par Then
If s$ = "" Then
abt = False
sHelp "", "", 0, 0
Else
par = par And FastSymbol(rest$, ",")
par = par And IsExp(basestack, rest$, x)
par = par And FastSymbol(rest$, ",")
par = par And IsExp(basestack, rest$, y)
par = par And FastSymbol(rest$, ",")
par = par And IsStrExp(basestack, rest$, ss$)

If par Then
abt = True
kk.EmptyDoc
kk.textDoc = s$
s$ = kk.textFormat(vbCrLf)
kk.EmptyDoc
kk.textDoc = s$
s$ = kk.TextParagraph(1)
kk.EmptyDoc
kk.textDoc = ss$
sHelp s$, kk.textFormat(vbCrLf), CLng(x), CLng(y)
End If
End If
End If
'*******
ElseIf IsLabelSymbolNew(rest$, "ΚΑΛΕΣΕ", "CALL", lang) Then

If IsStrExp(basestack, rest$, ss$) Then
kk.textDoc = ss$
FeedbackExec$ = kk.textFormat(vbCrLf)
Else

End If
Else
If IsStrExp(basestack, rest$, s$) Then
kk.EmptyDoc
kk.textDoc = s$
s$ = kk.textFormat(vbCrLf)
kk.EmptyDoc
kk.textDoc = s$
s$ = kk.TextParagraph(1)
        i = 0
        x = (ScrX() - 1) * 2 / 5
        y = (ScrY() - 1) / 7
        If FastSymbol(rest$, ",") Then
                par = True
                    If Not IsExp(basestack, rest$, x) Then
                    x = (ScrX() - 1) * 2 / 5: par = False
                    Else
                    i = 1
                    End If
                    If FastSymbol(rest$, ",") Then
                        par = True
                        If Not IsExp(basestack, rest$, y) Then
                        y = (ScrY() - 1) / 7: par = False
                        Else
                        i = 2
                        End If
                    End If
        End If
 
        If Not Form4.Visible Then
           vH_x = CLng(x * Helplastfactor)
           vH_y = CLng(y * Helplastfactor)
           
                Form4.Show , Form1
                
                MyForm Form4, ScrX() - CLng(x * Helplastfactor), ScrY() - CLng(y * Helplastfactor), CLng(x * Helplastfactor), CLng(y * Helplastfactor), True, 1  'Helplastfactor
                HelpLastWidth = x
        ElseIf i <> 0 Then
                Form4.Show , Form1
                
                MyForm Form4, Form4.Left, Form4.top, CLng(x * Helplastfactor), CLng(y * Helplastfactor), True, Helplastfactor
        End If
       
        Form4.Line (0, 0)-(Form4.ScaleWidth - dv15, Form4.ScaleHeight - dv15), Form4.BackColor, BF
        Form4.MoveMe
        If FastSymbol(rest$, ",") Or Not par Then
        If IsStrExp(basestack, rest$, ss$) Then
        kk.EmptyDoc
        kk.textDoc = ss$
        Form4.Label1.Text = kk.textFormat(vbCrLf)
        End If
        End If
        
With Form4.Label1

.EditDoc = False
.NoMark = True
.enabled = True
.NewTitle s$, 4 + UAddPixelsTop
.glistN.DragEnabled = False
.glistN.WordCharLeft = "["
.glistN.WordCharRight = "]"
.glistN.WordCharRightButIncluded = ""
End With
Else
vH_title$ = ""
If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If

End If
End If
Exit Function
End Function
Sub procthreads(scr As Object, bstack As basetask, rest$, lang As Long)

If TaskMaster.QueueCount >= 0 Then

If IsLabelSymbolNew(rest$, "ΣΒΗΣΕ", "ERASE", lang) Then
TaskMaster.Dispose
bstack.ThrowThreads
Exit Sub
End If
If lang = 0 Then
        PlainBaSket scr, players(GetCode(scr)), "NHMATA ΣΕ ΕΠΕΞΕΡΓΑΣΙΑ:" & CStr(TaskMaster.QueueCount)
        Else
        PlainBaSket scr, players(GetCode(scr)), "THREADS PROCESSING:" & CStr(TaskMaster.QueueCount)
        End If
        If bstack.ThreadsStr(lang) <> "" Then
        crNew bstack, players(GetCode(scr))
        PlainBaSket scr, players(GetCode(scr)), bstack.ThreadsStr(lang)
        End If
Else
        If lang = 0 Then
        PlainBaSket scr, players(GetCode(scr)), "ΤΙΠΟΤΑ ΣΕ ΕΠΕΞΕΡΓΑΣΙΑ"
        Else
        PlainBaSket scr, players(GetCode(scr)), "NOTHING PROCESSING"
        End If
End If
crNew bstack, players(GetCode(scr))
' was mydoevents 2
MyDoEvents1 scr
Set scr = Nothing
End Sub
Function ProcPage(basestack As basetask, rest$, lang As Long) As Boolean
ProcPage = True
Dim scr As Object, x As Double
Set scr = basestack.Owner
If basestack.toprinter Then
getnextpage
If IsNumber(basestack, rest$, x) Then
If x = 1 Then Portrait basestack Else Landscape basestack
End If
ElseIf IsNumber(basestack, rest$, x) Then
If x = 1 Then Portrait basestack Else Landscape basestack
Else
ClearScr scr, mycolor(PaperOne)
End If
Set scr = Nothing
End Function

Function ProcMotion(basestack As basetask, rest$, lang As Long) As Boolean
Dim scr As Object, x1 As Long, y1 As Long, p As Double
Set scr = basestack.Owner
ProcMotion = True
If lang = 1 And IsLabelSymbolLatin(rest$, "CENTER") Then
x1 = interpret(basestack, "MODE" & Str$(players(GetCode(scr)).SZ) & "," & Str$(scr.Width) & "," & Str$(scr.Height))
ElseIf IsLabelSymbol(rest$, "ΚΕΝΤΡΟ") Then
x1 = interpret(basestack, "MODE" & Str$(players(GetCode(scr)).SZ) & "," & Str$(scr.Width) & "," & Str$(scr.Height))

Else
If IsExp(basestack, rest$, p) Then x1 = CLng(p) Else x1 = scr.Left
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
y1 = CLng(p)
Else
Set scr = Nothing
ProcMotion = False
Exit Function
End If
Else
y1 = scr.top
End If
scr.Move x1, y1
End If
 MyDoEvents1 scr
Set scr = Nothing


End Function


Function ProcCls(basestack As basetask, rest$) As Boolean
If basestack.toprinter Then Exit Function
Dim scr As Object, p As Double
 ProcCls = True
Set scr = basestack.Owner
If Not IsExp(basestack, rest$, p) Then p = -scr.BackColor
With players(GetCode(scr))
.Paper = mycolor(p)
If Not basestack.toprinter Then
If FastSymbol(rest$, ",") Then
    If IsExp(basestack, rest$, p) Then
    If p < 0 Then p = .My + p
        .mysplit = Int(p)
        If .mysplit >= .My Then .mysplit = 0: .pageframe = 0
        .pageframe = Int((.My - .mysplit) * 2 / 3)
    Else
        ProcCls = False
        Set scr = Nothing
        Exit Function
    End If
End If
End If

ClearScrNew scr, players(GetCode(scr)), CLng(mycolor(.Paper))   '' here 1.15 is not rgb but standard colors
''.Paper = scr.BackColor  ' Αυτό θα γίνει του BASESTACK
If Form4.Visible Then
vHelp
End If
End With
Set scr = Nothing
End Function

Function ProcPen(basestack As basetask, rest$) As Boolean
Dim scr As Object, x1 As Long, y1 As Long, p As Double, ss$, it As Long
ProcPen = True
Set scr = basestack.Owner
If IsExp(basestack, rest$, p) Then
    If FastSymbol(rest$, "{") Then
        ss$ = "{" & block(rest$) & "}"
        If FastSymbol(rest$, "}") Then
         y1 = GetCode(scr)
            x1 = players(y1).mypen
           
            players(y1).mypen = CLng(mycolor(p))
            TextColor scr, players(y1).mypen
            Call executeblock(it, basestack, ss$, False, False)

            players(y1).mypen = x1
            TextColor scr, x1
            If it <> 1 Then ProcPen = False: rest$ = Left$(ss$, Len(ss$) - 1) + rest$
        End If
    Else
    
        players(GetCode(scr)).mypen = CLng(mycolor(p))
        
        TextColor scr, CLng(mycolor(p))
    End If
Else
    ProcPen = False
End If
Set scr = Nothing
End Function
Function ProcMedia(basestack As basetask, rest$, lang As Long) As Boolean
Dim scr As Object
Dim s$, ss$, x As Double, y As Double
Set scr = basestack.Owner
On Error Resume Next
ProcMedia = True
If IsLabelSymbolNew(rest$, "ΦΟΡΤΩΣΕ", "LOAD", lang) Then
            If AVIUP Then
                  AVI.GETLOST
                  MyDoEvents
            End If
            If IsStrExp(basestack, rest$, s$) Then
                If s$ <> "" Then
                    If ExtractType(s$) = "" Then s$ = s$ & ".avi"
                    If CFname(s$) = "" Then
                        s$ = mcd & s$: If CFname(s$) = "" Then Exit Function
                    Else
                        s$ = CFname(s$)
                    End If
                Else
                    Set scr = Nothing
                    ProcMedia = True  ' ??????????
                    Exit Function
                End If
                avifile = s$
                Load AVI
                
                MediaPlayer1.playMovie
                MediaPlayer1.pauseMovie
                
                MediaPlayer1.setPositionTo 0
                Sleep 2
                MyDoEvents
                AVIRUN = False
                    If Form1.Visible Then Form1.SetFocus
                    MediaPlayer1.setLeftVolume vol * 10
                    MediaPlayer1.setRightVolume vol * 10
                    
                
            End If
            Set scr = Nothing
            ProcMedia = True
            Exit Function
            
    ElseIf AVIUP Then
    ss$ = ""
        If IsLabelSymbolNewExp(rest$, "ΔΕΙΞΕ", "SHOW", lang, ss$) Then
            'If Not AVIRUN Then MediaPlayer1.playMovie: MediaPlayer1.pauseMovie
                AVI.Show
             AVI.SetFocus
                MyDoEvents
                Set scr = Nothing
                ProcMedia = True
                Exit Function
      
        ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΥΨΕ", "HIDE", lang, ss$) Then
                AVI.Hide
                Set scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΑΤΗΣΕ", "PAUSE", lang, ss$) Then
                If MediaPlayer1.isMoviePlaying Then MediaPlayer1.pauseMovie
                Set scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΠΑΙΞΕ", "PLAY", lang, ss$) Then
        
                If Not AVIRUN Then
                AVI.Timer1.Interval = MediaPlayer1.getLengthInMS - MediaPlayer1.getPositionInMS
                AVI.Avi2Up
                End If
        
                MyDoEvents
                Set scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΞΕΚΙΝΑ", "RESTART", lang, ss$) Then
                    If Not MediaPlayer1.isMoviePlaying Then
                    
                         MediaPlayer1.playMovie
                         
                    Else
                         MediaPlayer1.resumeMovie
                    End If
                    MyDoEvents
                    AVIRUN = False
                    Set scr = Nothing
                    ProcMedia = True
                    Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΣΤΟ", "TO", lang, ss$) Then
                    If IsExp(basestack, rest$, x) Then
                        If MediaPlayer1.getLengthInMS > 0 Then MediaPlayer1.setPositionTo x
                        
                    End If
                    Set scr = Nothing
                    ProcMedia = True
                    Exit Function

        End If
    End If
    ss$ = ""
' do nothing until here
If IsExp(basestack, rest$, x) Then
   
            If FastSymbol(rest$, ",") Then
    
             UseAviSize = False
    AviSizeX = 0
    AviSizeY = 0
    aviX = 0
    aviY = 0
    UseAviSize = False
    UseAviXY = True: aviX = CLng(x): aviY = 0
            If IsExp(basestack, rest$, y) Then aviY = CLng(y) Else ProcMedia = False: UseAviXY = False: aviX = 0
            Else ' SPECIAL
            If MediaPlayer1.getLengthInMS > 0 Then
                If x < 0 Then
                MediaPlayer1.pauseMovie
                AVIRUN = MediaPlayer1.isMoviePlaying
                If scr.name <> "Printer" Then
                If scr.Visible Then scr.SetFocus
                End If
                ElseIf x = 0 Then
                          
                MediaPlayer1.playMovie
                MyDoEvents
                Else
                MediaPlayer1.setPositionTo x
                End If
                ProcMedia = True
        Else
        ProcMedia = False
        End If
        Set scr = Nothing
        Exit Function
            End If
            If aviX = 0 Then UseAviXY = False
            If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then AviSizeX = CLng(x) Else rest$ = "," & rest$
                If FastSymbol(rest$, ",") Then
            If IsExp(basestack, rest$, x) Then AviSizeY = CLng(x) Else rest$ = "," & rest$
                End If
                UseAviSize = (AviSizeY + AviSizeX) <> 0 Or (aviX = 0 And aviY = 0)
                
            End If
            If Not FastSymbol(rest$, ",") Then
                   If AVIUP Then
                   If UseAviXY And UseAviSize Then
                   AVI.Move aviX, aviY, AviSizeX, AviSizeY
                   MediaPlayer1.sizeLocateMovie 0, 0, Form1.ScaleX(AviSizeX, vbTwips, vbPixels), Form1.ScaleY(AviSizeY, vbTwips, vbPixels) + 1
                   ElseIf UseAviXY Then
                   AVI.Move aviX, aviY
                    End If
           Else
                   If AVIRUN Or AVIUP Then
                AVI.GETLOST
            End If
           
            End If
            Set scr = Nothing
            Exit Function
            
            End If
      
ElseIf FastSymbol(rest$, ";") Then
'MediaPlayer1.closeMovie
    UseAviXY = False
    UseAviSize = False
    AviSizeX = 0
    AviSizeY = 0
    aviX = 0
    aviY = 0
    AVI.GETLOST
Else
 
'MediaPlayer1.closeMovie
If AVIRUN Or AVIUP Then
                AVI.GETLOST
              
            End If
  
End If

Do
ProcTask2 basestack

 If Not MediaPlayer1.isMoviePlaying Then AVIRUN = False
Loop Until Not AVIRUN Or NOEXECUTION

Do While IsStrExp(basestack, rest$, s$)
If s$ <> "" Then
If ExtractType(s$) = "" Then s$ = s$ & ".avi"
    If CFname(s$) = "" Then
        s$ = mcd & s$: If CFname(s$) = "" Then Set scr = Nothing: Exit Function

    Else
        s$ = CFname(s$)
    End If
    Else
    AVI.GETLOST
    Exit Do
End If
avifile = s$
Load AVI
AVI.Avi2Up
AVI.Show
Sleep 5

If AVIRUN Then
If Form1.Visible Then Form1.SetFocus
MediaPlayer1.setLeftVolume vol * 10
MediaPlayer1.setRightVolume vol * 10

End If
If FastSymbol(rest$, ",") Then
If AVIRUN Then
Do
 AVIRUN = MediaPlayer1.isMoviePlaying
 ProcTask2 basestack
' sleep 5

Loop Until AVIRUN = False Or NOEXECUTION
End If
Else
If FastSymbol(rest$, ";") Then
If AVIRUN Then
Do
 AVIRUN = MediaPlayer1.isMoviePlaying
ProcTask2 basestack
 ' sleep 5

Loop Until AVIRUN = False Or NOEXECUTION
End If
End If
Exit Do
End If
Loop
Set scr = Nothing
Exit Function


End Function
Function ProcCat(bstack As basetask, rest$, lang As Long) As Boolean
Dim aDir As New recDir, ss$, s$, pa$, frm$, par As Boolean, i As Long, col As Long
aDir.IncludedFolders = True
aDir.Nofiles = True
aDir.TopFolder = mcd
aDir.LevelStop = 1
aDir.SortType = Abs(FastSymbol(rest$, "!")) + Abs(FastSymbol(rest$, "!"))
ProcCat = True
s$ = ""
pa$ = ""

par = lang = 1
i = FastSymbol(rest$, "+")
If FastSymbol(rest$, "*") Then
ss$ = "*"
ElseIf Not IsStrExp(bstack, rest$, ss$) Then
ss$ = ""
Else
ss$ = myUcase$(ss$)
End If
''stac1 = ""

If InStr(ss$, "?") > 0 Or InStr(ss$, "*") > 0 Then
aDir.Pattern = ss$
frm$ = mylcasefILE$(aDir.Dir2$(mcd, "", False))

Else
frm$ = mylcasefILE$(aDir.Dir2$(mcd, ss$, False))

End If

If i = False Then
    If frm$ <> "" Then
        If par Then
            pa$ = "Folders " & ss$ & ": "
        Else
            pa$ = "Κατάλογοι " & ss$ & ": "
        End If
    End If
End If
ss$ = ""
col = Len(mcd)
Do While frm$ <> ""
MyDoEvents
s$ = Mid$(frm$, col + 2)
If s$ <> "" Then
If i Then
Form1.List1.additem s$
Else
If InStr(s$, " ") > 0 Then s$ = Chr(34) + s$ + Chr(34)
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
End If
End If
s$ = aDir.Dir2
If s$ <> "" Then frm$ = s$ Else frm$ = ""
Loop
If i = False Then RepPlain bstack, bstack.Owner, pa$ + ss$

End Function
Function ProcImage(bstack As basetask, rest$, lang As Long) As Boolean
Dim photo As Object, pppp As mArray, s$, x1 As Long, y1 As Long, w$, it As Long, p As Double
ProcImage = True
If IsStrExp(bstack, rest$, s$) Then
    x1 = 0
    y1 = 0
    If Not (Left$(s$, 4) = "cDIB" And Len(s$) > 12) Then If ExtractType(s$) = "" Then s$ = s$ + ".bmp"
    If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
        If CFname(s$) <> "" Or (Left$(s$, 4) = "cDIB" And Len(s$) > 12) Then
            Select Case Abs(IsLabel(bstack, rest$, w$))
            Case 3
                If GetVar(bstack, w$, it) Then
                    Set photo = New cDIBSection
                    If CFname(s$) <> "" Then
                    s$ = CFname(s$)
                    On Error GoTo 0
                        photo.CreateFromPicture LoadPicture(GetDosPath(s$))
                         photo.GetDpi 96, 96
                CheckOrientation photo, s$
                        If photo.bitsPerPixel <> 24 Then Conv24 photo
                        
                        If photo.Width = 0 Then
                            Set photo = Nothing
                            MissCdib
                             ProcImage = False: Exit Function
                        End If
                    ElseIf Not cDib(s$, photo) Then
                        Set photo = Nothing
                        MissCdibStr
                         Exit Function
                    End If
                    x1 = photo.Width
                    y1 = photo.Height
                    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = x1 * p / 100#: y1 = y1 * p / 100#
                    If FastSymbol(rest$, ",") Then
                        If IsExp(bstack, rest$, p) Then
                            y1 = photo.Height * p / 100#
                        Else
                            Set photo = Nothing
                         ProcImage = False: MissNumExpr: Exit Function
                        End If
                    End If
                    If photo.Width > 0 Then
                    Set photo = photo.Resample(Abs(y1), Abs(x1))
                        var(it) = DIBtoSTR(photo)
                    End If
                    Set photo = Nothing
                    Exit Function
                Else
                ProcImage = False
                If w$ <> "" Then
                Nosuchvariable w$
                Else
            MissingStrVar
                     End If
                End If
                Exit Function
            Case 6
    ' ΑΠΟ ΠΙΝΑΚΑ
                Dim W5 As Long
                
                If neoGetArray(bstack, w$, pppp) Then
                       
                        If Not NeoGetArrayItem(pppp, bstack, w$, W5, rest$) Then ProcImage = False: MissNumExpr: Exit Function
                     Set photo = New cDIBSection
                    If CFname(s$) <> "" Then
                    s$ = CFname(s$)
                        photo.CreateFromPicture LoadPicture(GetDosPath(s$))
                         
                        If photo.bitsPerPixel <> 24 Then
                        Conv24 photo
                        Else
                        CheckOrientation photo, s$
                        End If
                        If photo.Width = 0 Then
                            Set photo = Nothing
                             ProcImage = False: MissNumExpr: Exit Function
                        End If
                        ' load the bitmap to string array
                        If IsObject(pppp.item(W5)) Then
                        ' this is an error.we cannot push binary data to Document
                        MyEr "can't copy image to " + Typename(pppp.item(W5)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W5))
                        ProcImage = False
                        Else
                        pppp.item(W5) = DIBtoSTR(photo)
                        End If
                       
                        Set photo = Nothing
                        Exit Function
                    ElseIf Not cDib(s$, photo) Then
                        Set photo = Nothing
                         ProcImage = False: MissNumExpr: Exit Function
                    End If
                    x1 = photo.Width
                    y1 = photo.Height
                    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = x1 * p / 100#: y1 = y1 * p / 100#
                    If FastSymbol(rest$, ",") Then
                        If IsExp(bstack, rest$, p) Then
                            y1 = photo.Height * p / 100#
                        Else
                            Set photo = Nothing
                         ProcImage = False: MissNumExpr: Exit Function
                        End If
                    End If
                    If photo.Width > 0 Then
                        'resample bitmap to string array
                        Set photo = photo.Resample(y1, x1)
                           If IsObject(pppp.item(W5)) Then
                        ' this is an error.we cannot push binary data to Document
                             MyEr "can't copy image to " + Typename(pppp.item(W5)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W5))

                        ProcImage = False
                        Else
                        pppp.item(W5) = DIBtoSTR(photo)
                        End If
                    End If
                    Set photo = Nothing
                    Exit Function
                Else
                     ProcImage = False: MissNumExpr: Exit Function
                End If
            End Select
        Else
        MyEr "file missing " & s$, "λείπει το αρχείο εικόνας " & s$
        ProcImage = False
        Exit Function
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΕΞΑΓΩΓΗ", "EXPORT", lang) Then
        If IsStrExp(bstack, rest$, w$) Then
            If Not CanKillFile(w$) Then FilePathNotForUser:  Exit Function
           Set photo = New cDIBSection
           If cDib(s$, photo) Then
                If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, p) Then
                        x1 = (Abs(p) - 1) Mod 100 + 1
                        
                        SaveJPG photo, ExtractPath(w$) + ExtractNameOnly(w$) & ".jpg", x1
                     Else
                        Set photo = Nothing
                         ProcImage = False: MissNumExpr: Exit Function
                    End If
                Else
                    photo.SaveDib ExtractPath(w$) + ExtractNameOnly(w$) & ".bmp"
                End If
            Else
                Set photo = Nothing
                 ProcImage = False: MissNumExpr: Exit Function
            End If
            Set photo = Nothing
            Exit Function
        Else
             ProcImage = False: MissNumExpr: Exit Function
        End If
    Else
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = p
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p Else ProcImage = False: MissNumExpr: Exit Function
        SImage bstack.Owner, x1, y1, s$
    End If
End If
End Function
Function ProcField(bstack As basetask, rest$, lang As Long) As Boolean
Dim prive As Long, pppp As mArray, s$, it As Long, x As Double, y As Double, p As Double
Dim i As Long, x1 As Long, y1 As Long, what$, par As Boolean
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
ProcField = True
 prive = GetCode(bstack.Owner)
  With players(prive)
        If IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", lang) Then result = 0: Exit Function
        If IsLabelSymbolNew(rest$, "ΣΥΝΘΗΜΑ", "PASSWORD", lang) Then i = True
    
        If Not IsExp(bstack, rest$, x) Then x = .curpos
        If Not FastSymbol(rest$, ",") Then Exit Function
        If Not IsExp(bstack, rest$, y) Then y = .currow
        If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, p) Then Exit Function
        p = Int(p)
        End If
        If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then Exit Function
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 3
            par = False
            If Not GetVar(bstack, what$, it) Then it = GlobalVar(what$, String$(CLng(p), 32))
            s$ = var(it)
        Case 6
                 par = True
                If neoGetArray(bstack, what$, pppp) Then If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                s$ = pppp.item(it)
        Case Else
        Exit Function
        End Select
        If p = 0 And s$ = "" Then Exit Function
        If p = 0 Then p = Len(s$)
        s$ = Left$(s$, p)
        s$ = s$ & String$(p - Len(s$), " ")
        x1 = 1
        
        s$ = gf(bstack, y, x, s$, x1, y1, CBool(i))
        
        
        If y1 <> 99 Then
        LCTbasket bstack.Owner, players(prive), y + 1, 0
        End If
        result = y1
        If par Then
                If Typename(pppp.item(it)) = doc Then
            Set pppp.item(it) = New Document
            If s$ <> "" Then pppp.item(it).textDoc = s$
            Else
            pppp.item(it) = s$
            End If
        Else
        CheckVar var(it), s$
        End If
        Exit Function
End With
End Function
Function ProcFiles(bstack As basetask, rest$, lang As Long) As Boolean
Dim aDir As New recDir, ss$, pa$, s$, par As Boolean, stac1 As String, frm$, i As Long
ProcFiles = True
aDir.IncludedFolders = False
aDir.Nofiles = False
aDir.TopFolder = mcd
aDir.SortType = Abs(FastSymbol(rest$, "!")) + Abs(FastSymbol(rest$, "!"))

s$ = ""
pa$ = ""

par = lang = 1
i = FastSymbol(rest$, "+")
If FastSymbol(rest$, "*") Then
ss$ = "*"
ElseIf Not IsStrExp(bstack, rest$, ss$) Then
ss$ = "TXT"
Else
ss$ = myUcase$(ss$)
End If
stac1 = ""
If FastSymbol(rest$, ",") Then
' SEARCH INSIDE FILE
If Not IsStrExp(bstack, rest$, stac1$) Then SyntaxError: Exit Function
End If

If InStr(ss$, "?") > 0 Or InStr(ss$, "*") > 0 Then
aDir.Pattern = ss$
frm$ = mylcasefILE$(aDir.Dir2$(mcd, "", False))
'frm$ = mylcasefILE$(Dir(mcd + mylcasefILE(sS$)))
Else
frm$ = mylcasefILE$(aDir.Dir2$(mcd, ss$, False))
'frm$ = mylcasefILE$(Dir(mcd & "*." & sS$))
End If

If i = False Then
    If frm$ <> "" Then
        If par Then
            If stac1 <> "" Then
            pa$ = "Files " & ss$ & " with text " & Chr(34) + stac1 + Chr(34) & " :  "
            Else
            pa$ = "Files " & ss$ & ": "
            End If
        Else
            If stac1 <> "" Then
            pa$ = "Αρχεία " & ss$ & " με κείμενο " & Chr(34) + stac1 + Chr(34) & " :  "
            
            Else
            pa$ = "Αρχεία " & ss$ & ": "
            End If
        End If
    End If
Else
   ' Form1.List2.clear
End If
ss$ = ""
Do While frm$ <> ""
MyDoEvents

If Right$(" " & aDir.Pattern, 1) <> "*" Then
s$ = ExtractNameOnly(Included(mcd + frm$, stac1))
Else
s$ = Included(mcd + frm$, stac1)
End If
If s$ <> "" Then
If i Then
If Right$(" " & aDir.Pattern, 1) <> "*" Then
Form1.List1.additem s$
Else
Form1.List1.additem s$
End If
Else

If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
End If
End If
s$ = aDir.Dir2
If s$ <> "" Then frm$ = s$ Else frm$ = ""
Loop
If i = False Then
RepPlain bstack, bstack.Owner, pa$ + ss$
End If
End Function

Function ProcEdit(basestack As basetask, rest$, lang As Long) As Boolean
Dim s$, x1 As Long, y1 As Long, o As Long, frm$, i As Long, par As Boolean, p As Double
Dim scr As Object, ss$
ProcEdit = True
Set scr = basestack.Owner
If Typename(scr) Like "Gui*" Then oxiforforms: Exit Function
Form1.EditTextWord = False ' edit code

s$ = aheadstatus(rest$, False, y1)
If y1 > 2 And Left$(s$, 1) = "S" Then
If Mid$(rest$, y1 - 1, 1) = "(" Or Mid$(rest$, y1 - 2, 2) = "()" Then s$ = "ok"

End If

If Left$(s$, 1) = "S" Then
    
    If IsStrExp(basestack, rest$, s$) Then
        If s$ <> "" Then
            If ExtractPath(s$) = "" Then
                If CFname(s$) <> "" Then
                    s$ = CFname(s$)
                ElseIf mylcasefILE(s$) = ExtractName(s$) Then
                    s$ = mcd + s$
                End If
                If ExtractType(s$) = "" Then
                    MyEr "missing file type (.gsb or .txt or .gm2)", "δεν υπάρχει τύπος αρχείου (.gsb η .txt η .gm2)"
                    Set scr = Nothing
                    Exit Function
                End If
            End If
            s$ = ExtractPath(s$) + ExtractName(s$)
            ' check if path exist
            ' uSE THE MYDIR.ISDIR
            If Dir$(ExtractPath(s$), vbDirectory) = vbNullString Then
            ' error
                MyEr "wrong path to save", "λάθος τόπος για σώσιμο"
                Set scr = Nothing
                Exit Function
            ElseIf ExtractName(s$) = "" Then
                MyEr "missing file name", "χάθηκε το όνομα αρχείου"
                Set scr = Nothing
                Exit Function
            End If
          
            If CFname(s$) <> "" Then
            s$ = CFname(s$)
             frm$ = ReadUnicodeOrANSI(s$, True, x1)
             ' CHECK TO SEE IF THIS IS A PASSWORD PROTECTED PROGRAMM
             For i = 1 To Len(frm$)
             If AscW(Mid$(frm$, i, 1)) < 128 Then
             Exit For
             End If
             Next i
             If i > Len(frm$) Then
             If lang = 1 Then
             MsgBoxN "not text found", 0
             Else
             MsgBoxN "δεν βρήκα κείμενο", 0
             End If
             Set scr = Nothing
             Exit Function
             End If
            par = Len(frm$) = FileLen(GetDosPath(s$)) ' not unicode
     
            Else
            frm$ = ""
            par = False
            End If
            Form1.EditTextWord = LCase(ExtractType(s$)) <> "gsb"
                Form1.TEXT1.TITLE = ExtractName(s$) + " "
            If x1 = 0 Then x1 = -1
            Form1.ResetMarks
            If o < 1 Then o = 0
            If o > Len(frm$) Then o = Len(frm$) + 1
            With players(GetCode(basestack.Owner))
            ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1, o, x1
            End With
            Form1.ResetMarks
            If frm$ <> "" And x1 >= 0 Then
            If par Then
                            i = FreeFile
                                            If Not WeCanWrite(s$) Then Set scr = Nothing: Exit Function
                            On Error Resume Next
                            
                            Open GetDosPath(s$) For Output As i
                                            If Err.Number > 0 Then
                                Err.Clear
                                 MyEr "Bad filename", "Λάθος στο όνομα αρχείου"
                                Set scr = Nothing
                                Exit Function
                                End If
                            Print #i, frm$;
                            Close i
                Else
                par = SaveUnicode(s$, frm$, x1)
                End If
            End If
        End If
        Set scr = Nothing
        Exit Function
    Else
    Set scr = Nothing
    Exit Function
    End If
End If

    If s$ <> "" Then
x1 = Abs(IsLabel(basestack, rest$, s$))
        If x1 > 0 Then
        If x1 > 3 Then
            s$ = ReplaceStr("(", "", s$)
            If FastSymbol(rest$, ")") Then
            End If
            s$ = s$ & "()"
            End If
        Else
        Set scr = Nothing
        Exit Function
        End If
        MakeThisSub basestack, s$  'NO GOOD..
        If GetSub(s$, x1) Then
            ' επιτρέπεται αλλαγή σε περίπτωση που κάποιο τμήμα έτρεξε και πιάσαμε με TRY το λάθος
            ' να δώσουμε την δυνατότητα για αλλαγή χωρίς να σταματήσουν τυχόν νήματα!
            If x1 >= lckfrm And lckfrm <> 0 Then
            MyEr s$ & " is locked", s$ & " είναι κλειδωμένο"
            rest$ = ""
            Set scr = Nothing
            Exit Function
            End If
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
            y1 = Abs(IsLabel(basestack, rest$, frm$))
              If y1 <> 0 Then
           '' frm$ = myUcase(frm$)
             GetSub frm$, x1
             
            If x1 = 0 Then
            If y1 > 3 Then frm$ = frm$ + ")"
            GetSubFullName s$, ss$
            
            subHash.RenameKey ss$, Mid$(frm$, Len(ss$) - Len(s$) + 1)
            End If
            End If
            Set scr = Nothing
            Exit Function
            ElseIf FastSymbol(rest$, ",") Then
            i = 1
                If IsExp(basestack, rest$, p) Then
                    i = Int(p)
                    If i < 0 Then i = Len(sbf(x1).sb) + i
                    If i < 0 Then i = 0
                    If i > Len(sbf(x1).sb) Then i = Len(sbf(x1).sb) + 1
                End If
                sbf(x1).sbc = i
            End If
            If sbf(x1).sbc = 0 Then sbf(x1).sbc = -1
        MakeMyTitle s$, lang

        With players(GetCode(basestack.Owner))
            ScreenEdit basestack, sbf(x1).sb, 0, .mysplit, .mx - 1, .My - 1, sbf(x1).sbc
            End With
            FK$(13) = "@EDIT " & s$ & "," & CStr(i)
        Else
            i = -1
          
           MakeMyTitle s$, lang
           With players(GetCode(basestack.Owner))
            ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1, i
            End With
            If frm$ <> "" Then
            MakeThisSub basestack, s$
               x1 = GlobalSub(s$, frm$)
                If x1 <> 0 Then sbf(x1).sbc = i
                FK$(13) = "@EDIT " & s$ & "," & CStr(i)
                Else
                FK$(13) = "@EDIT " & s$
            End If
        End If
    ElseIf Not basestack.IamChild Then
        frm$ = Mid$(ReplaceStr(vbCr, vbCrLf, QUERYLIST), 3)
        Form1.ShadowMarks = True
        If UserCodePage = 1253 Then
        Form1.TEXT1.TITLE = "Λίστα εντολών "
        Else
        Form1.TEXT1.TITLE = "Command List "
        End If
        With players(GetCode(basestack.Owner))
        ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1
        End With
        Form1.ShadowMarks = False
        QUERYLIST = vbCr + ReplaceStr(vbCrLf, vbCr, frm$)
    End If

End Function
Function ProcModuleEntry(basestack As basetask, ohere$, x1 As Long, rest$) As Boolean
On Error GoTo there22
  If LastErNum = -1 Then GoTo there22
Dim frm$, bs As basetask, i As Long, pa$, p As Double, loopthis As Boolean
Dim subs As Long, snames As Long, vname As Long, vvv As Variant
Dim subspoint As Boolean
'LastErName = "": LastErNameGR = ""
i = 1

' ******************************************* module entry..............

        Set bs = New basetask
       With bs
        .reflimit = varhash.count
        Set .Parent = basestack
        Set .Sorosref = basestack.soros   'same stack
        Set .Owner = .Parent.Owner
        .OriginalName$ = ohere$
        .Vars = var2used: vname = varhash.count
        subs = sb2used: snames = subHash.count

        .UseGroupname = sbf(x1).sbgroup
        .OriginalCode = x1
        If Not basestack.StaticCollection Is Nothing Then
           If basestack.ExistVar("%_" + here$) Then
                   basestack.ReadVar "%_" + here$, vvv
                   If IsObject(vvv) Then Set bs.StaticCollection = vvv
                    Set vvv = Nothing

        End If
        End If
       .StaticInUse$ = here$
       End With
       i = 1

If myexit(bs) Then ProcModuleEntry = False: Exit Function

 Do
  frm$ = Mid$(sbf(x1).sb, i)
againmod:
       If LastErNum = -1 Then GoTo myerror1
        Select Case Execute(bs, frm$, False, False, loopthis)

        Case 0
        
myerror1:
                    If sb2used <> 0 And Not NERR Then
        If bs.UseGroupname <> "" Then
If InStr(bs.UseGroupname, ChrW(&H1FFF)) > 0 Then

pa$ = GetNextLine((sbf(bs.OriginalCode).sb))
FK$(13) = Mid$(pa$, 7) + "-" + CStr(Len(frm$))

MyErMacro rest$, "Problem in class", "Πρόβλημα στη κλάση"
ProcModuleEntry = True
GoTo thh1
End If

        End If
                     
                    pa$ = "EDIT " & StripRVAL(here$) & ", " + CStr(Len(sbf(x1).sb))
                    If ohere$ <> "" Then
                    
                    If Left$(sbf(x1).sb, 10) = "'11001EDIT" Then
                    
                    pa$ = Mid$(GetNextLine(sbf(x1).sb), 7)
                    sbf(x1).sb = Mid$(sbf(x1).sb, 3)
                    
                    MyEr "in module " & ohere$ & "." & here$, "στο τμημα " & ohere$ & "." & here$
                    Else
                    
                    End If
                    Else
                    MyEr "in module " & here$, "στο τμημα " & here$
                    
                    End If
                    If InStr(FK$(13), ",") > 0 Then
                    If Left$(pa$, InStr(pa$, ",")) <> Left$(FK$(13), InStr(FK$(13), ",")) Then
                    GoTo thh
                    End If
               
GoTo thh

                    End If
                    If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then
                    FK$(13) = pa$
                    Else
                    DropLeft ",", FK$(13)
                    If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                    If sbf(x1).sbgroup <> "" Then
                    FK$(13) = pa$ & "-" & CStr(Len(frm$) - 2) + FK$(13)
                    Else
                    FK$(13) = pa$ & "-" & CStr(Len(frm$)) + FK$(13)
                    End If
                    End If
                    
                    Else
                    If sb2used > 0 Then
                    MyEr "in module " & here$, "στο τμημα " & here$
                    Else
                    MyEr "", ""
                    End If
                    End If
                    
                    GoTo thh
            
        Case 1, 3

thh:
    If LastErNum <> 0 Then
                   rest$ = ""
                    End If
thh1:
                    On Error Resume Next
                    With bs
                    .ThrowThreads
                                  
                    var2used = .Vars
                    varhash.ReduceHash vname, var()
                    If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
                        ReDim Preserve var(UBound(var()) / 2) As Variant
                    End If
                    
                        
                  
                    
                    

                    sb2used = subs
                    subHash.ReduceHash snames, sbf()
                     If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
                               ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
                       End If
                       End With
                   With bs
                   
                   If Not .StaticCollection Is Nothing Then
                   
                   basestack.SetVarobJ "%_" + .StaticInUse$, .StaticCollection
                   End If
                   End With
                    Set bs = Nothing
                    here$ = ohere$
                
               
                    Exit Do
        Case 2
                    i = 1
                    If frm$ <> "" Then
                            If frm$ = "BREAK" Then
                              Exit Do
                             ElseIf frm$ = Chr$(0) Then
                             
                                     If bs.IsInRetStackNumber(p) Then
                                     If p < -1 Then
                                     bs.IsInRetStackNumber p
                                     subspoint = True
                                     i = Len(sbf(basestack.OriginalCode)) - CLng(p) + 1

                                     ElseIf p < 0 Then
                                     subspoint = False
                                     bs.IsInRetStackNumber p
                                     i = Len(sbf(x1).sb) - CLng(p) + 1
                                     End If
                                   PopStage bs
                    
                                       
                             ElseIf bs.IsInRetStackString(frm$) Then
                                      If InStr(frm$, " ") > 0 Then
                                   If subspoint Then bs.RetStack.PushVal -2 Else bs.RetStack.PushVal -1
                                                 If searchsub(sbf(x1).sb, frm$, i) Then
                                     
                                         subspoint = False
                                                              If frm$ <> "" Then
                                                                     frm$ = "Read NEW " + frm$ + vbCrLf + Mid$(sbf(x1).sb, i)
                                                             Else
                                                                     frm$ = Mid$(sbf(x1).sb, i)
                                                             End If
                                                           
                                                             GoTo againmod
                                                 ElseIf x1 <> basestack.OriginalCode And basestack.OriginalCode <> 0 Then
                                                 If searchsub(sbf(basestack.OriginalCode).sb, frm$, i) Then
                                         
                                         subspoint = True
                                                 
                                                 If frm$ <> "" Then
                                                                     frm$ = "Read NEW " + frm$ + vbCrLf + Mid$(sbf(basestack.OriginalCode).sb, i)
                                                             Else
                                                                     frm$ = Mid$(sbf(basestack.OriginalCode).sb, i)
                                                             End If
                                                              GoTo againmod
                                                             Else
                                                             bs.RetStack.drop 5
                                                             Exit Do
                                                 End If
                                                 Else
                                                 If frm$ <> "" Then MyEr "sub not found", "δεν βρέθηκε η ρουτίνα"
                                                 If bs.IsInRetStackNumber(p) Then
                          
                                     If p = -1 Then
                                     subspoint = False
                                     bs.IsInRetStackNumber p
                                     'i = Len(sbf(x1).sb) - CLng(p) + 1
                                     frm$ = Space(p)
                                     End If
                                                    End If
                                                    bs.RetStack.drop 5
                                                                        GoTo myerror1

                                                 End If
                                         
                                         End If

                                    End If

                             Else
                                        '' i = PosLabel(frm$, sbf(x1).sb)
                                         If InStr(frm$, vbCr) > 0 Then
                                         i = rinstr(sbf(x1).sb, frm$)
                                         If i = 0 Then i = Len(sbf(x1).sb) + 1
                                          Else
                                          i = PosLabel(frm$, sbf(x1).sb)
                                         End If
                            End If
                    Else
                    
If Not loopthis Then Exit Do
loopthis = False
                   End If
        End Select
Loop
ProcModuleEntry = True

Exit Function
there22:
If Err Then
MyEr Err.Description, Err.Description
Err.Clear
If Not bs Is Nothing Then GoTo thh
End If
End Function
Function PushParamGeneralV7(basestack As basetask, rest$) As Boolean
PushParamGeneralV7 = True
Dim ps As mStiva, p As Double, s$
Dim ParentStack As basetask
Set ParentStack = basestack.Parent
    Set ps = New mStiva
                Do
                 If FastSymbol(rest$, "?") Then
                        ps.DataOptional
            ElseIf FastSymbol(rest$, "!") Then
                If IsExp(ParentStack, rest$, p) Then
                ps.DataValLong p
                End If
                ElseIf IsExp(ParentStack, rest$, p) Then
        If Not ParentStack.lastobj Is Nothing Then
           ps.DataObj ParentStack.lastobj
       Set ParentStack.lastobj = Nothing
        Else
            ps.DataVal p
         End If
    ElseIf Not LastErNum <> 0 Then
    If IsStrExp(ParentStack, rest$, s$) Then
       If Not ParentStack.lastobj Is Nothing Then
           ps.DataObj ParentStack.lastobj
           Set ParentStack.lastobj = Nothing
        Else
        ps.DataStr s$
        End If
    ElseIf MaybeIsSymbol(rest$, ",") Then
        ps.DataOptional
    ' here
    End If
    Else
  If LastErNum <> 0 Then
     PushParamGeneralV7 = False
  Exit Do
    End If
    End If
      If LastErNum <> -2 And LastErNum <> 0 Then
      MyEr "Error in input list", "Πρόβλημα στις παραμέτρους"
      PushParamGeneralV7 = False
      End If
    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
             Set ParentStack = Nothing
             With basestack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
            
End Function
Function PushParamGeneral(basestack As basetask, rest$) As Boolean
PushParamGeneral = True
Dim ps As mStiva, p As Double, s$
    Set ps = New mStiva
    
        

    
                Do
        If FastSymbol(rest$, "?") Then
                        ps.DataOptional
            ElseIf FastSymbol(rest$, "!") Then
                If IsExp(basestack, rest$, p) Then
                ps.DataValLong p
                End If
                ElseIf IsExp(basestack, rest$, p) Then
        If Not basestack.lastobj Is Nothing Then
           ps.DataObj basestack.lastobj
       Set basestack.lastobj = Nothing
        Else
            ps.DataVal p
            
         End If
    ElseIf Not LastErNum <> 0 Then
    If IsStrExp(basestack, rest$, s$) Then
       If Not basestack.lastobj Is Nothing Then
           ps.DataObj basestack.lastobj
           Set basestack.lastobj = Nothing
        Else
        ps.DataStr s$
        End If
    ElseIf MaybeIsSymbol(rest$, ",") Then
        ps.DataOptional
    ' here
    End If
    Else
  If LastErNum <> 0 Then
     PushParamGeneral = False
  Exit Do
    End If
    End If
      If LastErNum <> -2 And LastErNum <> 0 Then
      MyEr "Error in input list", "Πρόβλημα στις παραμέτρους"
      PushParamGeneral = False
      End If
    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
            
                      
             With basestack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
End Function
Sub PushParamGeneraOLD(basestack As basetask, rest$)
Dim ps As mStiva, p As Double, s$
    Set ps = New mStiva
                Do
                    If IsExp(basestack, rest$, p) Then
                            If Not basestack.lastobj Is Nothing Then
                                    ps.DataObj basestack.lastobj
                            Else
                                    ps.DataVal p
                            End If
                    ElseIf IsStrExp(basestack, rest$, s$) Then
                            If Not basestack.lastobj Is Nothing Then
                                    ps.DataObj basestack.lastobj
                            Else
                                    ps.DataStr s$
                            End If

                    Else
                    
                            Exit Do
                    End If
                    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
             
              With basestack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
End Sub

Function searchsub(A$, w$, final As Long) As Boolean
Dim acopy As Document, there As Long, Curs As Long, Curs2 As Long
Dim a1 As Long, b As Long, c As Long, d As Long
Dim ww$(), Len1 As Long, there1 As Long
Dim ss$, DUMP$
ww$() = Split(w$)
paliedo:
Len1 = Len(ww$(0))
If Len1 = 1 Then
If ww$(0) = "S" Then
Set acopy = New Document
With acopy
.textDocFast = A$
.LCID = 1032
ww$(1) = ww$(1) + ":"
Do While .FindIdentifier(ww$(1), False, there, Curs)
If Trim$(Left$(.TextParagraph(there), Curs - 1)) = "" Then
' we find it
                               final = -1
                               .FindPos .FirstParagraphLine(there) + 2, 1, final, a1, b, c, d
                               final = final + 1 ' because mid$ starts from 1
                               w$ = ""
                                searchsub = True
                                Exit Function
End If

Loop
End With
Else
final = PosLabel(ww$(1), A$)
If final <> 1 Then
w$ = ""
searchsub = True
End If
End If
Exit Function
End If
Set acopy = New Document

With acopy
.textDocFast = A$
.LCID = 1032
there = 0
Curs = 0
Do
If .FindIdentifier(ww$(0), False, there, Curs) Then

ss$ = Left$(acopy.TextParagraph(there), Curs - 1)

IsNumberLabel ss$, DUMP$
                        If Trim$(ss$) = "" Then
                        Curs2 = Curs
                        there1 = there
                        If .FindIdentifier(ww$(1), True, there1, Curs2) Then
                        
                                    If there1 <> there Then
                                           Curs = 0
                                    Else
                                                final = -1  ' this is the mode for search charpos ...in findpos
                                                ' FROM 1,0, BUT  PARAGRAPH LINES ARE FROM 0
                                                ' SO PLUS ONE PLU ONE MORE FOR NEXT LINE
                                                '
                                                .FindPos .FirstParagraphLine(there1) + 2, 1, final, a1, b, c, d
                                                       final = final + 1 ' because mid$ starts from 1
                                                       
                                                       
                                                        w$ = BlockParam(Trim(Mid$(.TextParagraph(there), Curs2 + Len(ww(1)))))
                                                        If w$ <> "" Then
                                                   '' If Right$(w$, 1) = ")" Then w$ = Left$(w$, Len(w$) - 1)
                                                        End If
                                                        searchsub = True
                                                        
                                                       
                                                        Exit Do
                                    End If
                        End If
            End If
            Else
            If ww$(0) = "ΡΟΥΤΙΝΑ" Then
            ww$(0) = "ΡΟΥΤΊΝΑ"
            GoTo paliedo
            End If
            Exit Do
        End If
   Loop
End With


End Function
Function search2KIND(A$, w$, final As Long, Optional Anypos As Boolean = False) As Boolean
Dim acopy As Document, there As Long, Curs As Long, Curs2 As Long
Dim a1 As Long, b As Long, c As Long, d As Long
Dim ww$(), there1 As Long
Dim ss$, DUMP$
ww$() = Split(w$)

Set acopy = New Document

With acopy
.textDocFast = A$
there = 0
Curs = 0
Do
If .FindIdentifier(ww$(0), True, there, Curs) Then

ss$ = Left$(acopy.TextParagraph(there), Curs - 1)

IsNumberLabel ss$, DUMP$
If Anypos Then
If Right$(Trim$(ss$), 1) = ":" Then ss$ = ""
End If
                        If Trim$(ss$) = "" Then
                        Curs2 = Curs + Len(ww$(0))
                        there1 = there
                        If .FindWord(ww$(1), True, there1, Curs2) Then
                        
                                    If there1 <> there Then
                                           Curs = 0
                                    Else
                                                final = -1  '
                                                If Not Anypos Then Curs2 = 1 Else Curs2 = Curs2 + 1
                                                .FindPos .FirstParagraphLine(there1) + 1, Curs2, final, a1, b, c, d

                                                       search2KIND = True
                                                        Exit Do
                                    End If
                        End If
            End If
            Else
            Exit Do
        End If
   Loop
End With


End Function

Function executeblock(Exec As Long, bstack As basetask, b$, Once As Boolean, kolpo As Boolean, Optional stepbystep As Boolean = False) As Boolean

executeblock = True
'bstack.LastComm = ""
Dim i As Long, ec$, ec1$, LL As Long, oldLL As Long, bb$, p As Double, x2 As Long, y2 As Long, monce As Long, W3 As Long, removebracket As Boolean
Dim myLevel As Long, oldexec As Long, loopthis As Boolean, subspoint As Boolean, RetStackSize As Long
RetStackSize = bstack.RetStackTotal
If Exec = 0 Then Exec = 1
oldexec = Exec
myLevel = bstack.SubLevel
i = 1
monce = Once
If FastSymbol(b$, "}") Then ''MyDoEvents
executeblock = False
 If myexit(bstack) Then Exec = 1 Else Exec = Abs(NOEXECUTION = False) * oldexec
Exit Function
ElseIf IsSymbolBracket(b$) Then
stepbystep = False
ec1$ = b$
ec$ = block(ec1$)
removebracket = True
Else
ec1$ = b$
ec$ = block(ec1$)
If ec$ = "" Then ec$ = b$
End If
oldLL = bstack.addlen
If Len(ec1$) > 0 And Len(b$) <> Len(ec1$) Then

LL = Len(ec1$) + oldLL
Else
LL = oldLL
End If
ec1$ = ""

        Do
                bb$ = Mid$(ec$, i)
fromfirst0:
        
                kolpo = Once: Once = False
                bstack.addlen = LL
             
                W3 = Execute(bstack, bb$, kolpo, stepbystep, loopthis)
                bstack.addlen = oldLL
                Select Case W3
                Case 0
                        If myLevel <> bstack.SubLevel Then
                                b$ = bb$
                                Exec = 0
                                bstack.RetStack.drop 7 * (bstack.SubLevel - myLevel)  ' NOW LEVEL HAS 5+2 ITEMS
                                Exit Function
                        End If
                        If NocharsInLine(bb$) Then
                                b$ = ""
                        Else
                                If InStr(bb$, " : ERROR -2") <= 3 Then
                                        b$ = bb$
                                Else
                                        b$ = Mid$(b$, Len(ec$) - Len(bb$) + 1)
                                End If
                        End If
                        Exec = 0
                        Exit Function
                Case 1
ALFA12:
                        If LastErNum = -2 Then
                                If NocharsInLine(bb$) Then
                                        b$ = ""
                                Else
                                        If Left$(bb$, 12) = " : ERROR -2" Then
                                                b$ = bb$
                                        Else
                                                b$ = Mid$(b$, Len(ec$) - Len(bb$) + 1)
                                        End If
                                End If
                                Exec = 0
                                Exit Function
                        End If
                        Exec = oldexec ''1
                        If kolpo And monce And Exec = 1 Then
                                b$ = bb$
                                Once = True
                                Exit Function
                        ElseIf kolpo And NocharsInLine(bb$) Then
                                ' exit
                                Exec = W3
                                Exit Do
                        End If
                        If removebracket Then
                                b$ = Right$(b$, Len(b$) - Len(ec$))
                                If IsSymbol(b$, "}") Then Exec = oldexec: Exit Do
                                If Once Then Exit Do
                        ElseIf NocharsInLine(bb$) And kolpo Then
                                b$ = ""
                        Else
                                If stepbystep Then
                                        b$ = bb$
                                Else
                                        b$ = Right$(b$, Len(b$) - Len(ec$))
                                End If
                        End If
                        Exit Do

                Case 2
                
                        If bb$ = "BREAK" Then
                                Exec = 2
                                b$ = ""
                                Once = True
                                kolpo = True
                                Exit Function
                        End If
                        If Not kolpo Then
                                If bb$ <> "" Then
                                        If bb$ = Chr$(0) Then
                                        If RetStackSize = bstack.RetStackTotal And bstack.RetStack.LookTopVal < 0 Then
                                        ' this is a return form other block
                                         Exec = 2
                                        b$ = bb$
                                        Exit Function
                                        End If
                                                i = 1
from123:

                                                If bstack.IsInRetStackNumber(p) Then
                                                        If LastErNum = -1 Then
                                                                bstack.RetStack.PushVal p
                                                                Exec = 0
                                                                Exit Function
                                                        End If
           
                                                        subspoint = False
                                                        bstack.IsInRetStackNumber p
                                                        Exec = 1
                                                        i = Len(ec$) - CLng(p) + 1
                                                        PopStage bstack
                                                        If loopthis Then
                                                                bb$ = Mid$(ec$, i)
                                                                GoTo fromfirst0
                                                        Else
                                                                bb$ = Mid$(ec$, CLng(p) + 1)
                                                        End If
                                                        If bb$ = vbCrLf Then Exit Do
                                                ElseIf bstack.IsInRetStackString(bb$) Then
findelsesub0:

                                                        If InStr(bb$, " ") > 0 Then
                                                                If subspoint Then bstack.RetStack.PushVal -2 Else bstack.RetStack.PushVal -1
                                   
                                                                If searchsub(sbf(bstack.OriginalCode).sb, bb$, i) Then
                                                                
                                                                        subspoint = False
                                                                        If bb$ <> "" Then
                                                                                bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(bstack.OriginalCode).sb, i)
                                                                        Else
                                                                                bb$ = Mid$(sbf(bstack.OriginalCode).sb, i)
                                                                        End If
                                                          
                                                                        kolpo = False
                                                                        GoTo contSub
                                                                ElseIf bstack.IamChild Then
                                                                        If searchsub(sbf(bstack.Parent.OriginalCode).sb, bb$, i) Then
                                                                                subspoint = True
                                                                                If bb$ <> "" Then
                                                                                        bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(bstack.Parent.OriginalCode).sb, i)
                                                                                Else
                                                                                        bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, i)
                                                                                End If
                                                                                kolpo = False
                                                                                  
contSub:
y2 = y2 + 1
subsub02:
                                                                        Exec = 0
                                                                                    x2 = Execute(bstack, bb$, kolpo)
                                                                                    If x2 = 2 Then
                                                                                            If bb$ = Chr$(0) Then

                                                                                       
                                                                                                    If bstack.IsInRetStackString(bb$) Then GoTo findelsesub0
                                                                           
                                                                                                    y2 = y2 - 1
                                                                                                    If y2 = 0 Then GoTo from123  'normal level
                                                                                           
                                                                                                    If bstack.IsInRetStackNumber(p) Then
                                                                                              
                                                                                                            If p < -1 Then
                                                                                                                    subspoint = True
                                                                                                                    bstack.IsInRetStackNumber p
                                                                                                    
                                                                                                                    bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, Len(sbf(bstack.Parent.OriginalCode).sb) - CLng(p) + 1)
                                                                                                                    
                                                                                                            ElseIf p < 0 Then
                                                                                                                    subspoint = False
                                                                                                                    bstack.IsInRetStackNumber p
                                                                                                  If bstack.OriginalCode = 0 Then
                                                                                                    bb$ = Mid$(sbf(bstack.Parent.OriginalCode).sb, Len(sbf(bstack.Parent.OriginalCode).sb) - CLng(p) + 1)
                                                                                                  Else
                                                                                                                    bb$ = Mid$(sbf(bstack.OriginalCode).sb, Len(sbf(bstack.OriginalCode).sb) - CLng(p) + 1)
                                                                                                                    End If
                                                                                                                    
                                                                                                            End If
                                                                                                             PopStage bstack
                                                                                                            Exec = 1
                                                                                                            GoTo subsub02
                                                                                                    Else
                                                                                                            Exit Do
                                                                                                    End If
                                                                                            ElseIf InStr(bb$, " ") > 0 Then
                                                                                                    GoTo findelsesub0
                                                                                            Else   ' jump ??
                                                                                        
                                                                                                i = PosLabel(bb$, sbf(bstack.OriginalCode).sb)
                                                                                                
                                                                                            If i <> 0 And i < Len(sbf(bstack.OriginalCode).sb) Then
                                                                                                    bb$ = Mid$(sbf(bstack.OriginalCode).sb, i)
                                                                                                    
                                                                                                    GoTo subsub02
                                                                                            End If
                                                                                                   Exit Do
                                                                                            End If
                                                                                    ElseIf x2 = 1 Then
                                                                                            If LastErNum <> -2 Then
                                                                                                    bstack.RetStack.drop 7 * bstack.SubLevel - myLevel
                                                                                                    b$ = ec$
                                                                                                    Exec = oldexec
                                                                                                    Exit Function
                                                                                                    
                                                                                            End If
                                                                                            ' NO RETURN...DROP STACK
                                                                                            bstack.RetStack.drop 2
                                                                                            Exit Do
                                                                                    ElseIf x2 = 0 Then
                                                                                            b$ = bb$
                                                                                            Exec = 0
                                                                                            Exit Function
                                                                                    End If
                                                                            Else
                                                                                    bstack.RetStack.drop 5
                                                                                    Exit Do
                                                                            End If
                                                                    Else
                                                                            bstack.RetStack.drop 5
                                                                            Exit Do
                                                                    End If
                                                         End If
                                                        ' ????????
                                                End If
                                        ElseIf MaybeIsSymbol(bb$, "}") Or NocharsInLine(bb$) Then
                                                i = 1
                                                bb$ = ec$
                                        Else
                                                i = PosLabel(bb$, ec$)
                                                If i = 0 Or i > Len(ec$) Then
                                                        b$ = bb$
                                                        Exec = 2
                                                        Exit Do
                                                Else
                                                        bb$ = Mid$(ec$, i)
                                                        GoTo fromfirst0
                                                End If
                                        End If
                                Else
                                loopthis = False
                                        i = 1
                                End If
                        Else
                               Once = kolpo
                               Exec = 2: b$ = bb$: Exit Function
                        End If
                Case Else
                        If W3 = 3 And bb$ = "CONTINUE" Then
                                If removebracket Then
                                        ec$ = block(b$)
                                Else
                                b$ = Mid$(b$, Len(ec$) + 1)
                                   
                                End If
                              
                                Exec = 3: Exit Do
                       ElseIf W3 = 3 And NocharsInLine(bb$) Then
                       bb$ = Mid$(b$, Len(ec$) + 1)
                       W3 = 1
                       GoTo ALFA12   ' FROM REVISION 121
                        End If
                        If IsSymbol(b$, "}") Then
                                Exec = 1: Exit Do
                                If Once Then Exit Do
                        Else
                                b$ = Right$(b$, Len(b$) - Len(bb$))
                        End If
                        Exit Do
                End Select

                If myexit(bstack) Then Exec = oldexec: Exit Do

                If monce Then Exit Do
        Loop
        
executeblock = False
End Function
Function StockValues(bstack As basetask, b$, lang As Long) As Boolean
' Stock  A[$|%| ]() in  A,B$,C(3)   copy values to stock array...and

' Stock  A[$|%| ]() out  A,B$,C(3),...  copy values to variables and make empty space in stock

' Stock A[$|%| ]()  keep  N,  B[$|%| ]()
' Stock A[$|%| ]()  sweep  N [,  value ]   fill a copy of value to n items or empty slots
Dim w$, pppp As mArray, v As Long, VN As Long, i As Long, what$, pppp1 As mArray, V1 As Long
Dim bs As New basetask, p As Double, p1 As Double, soros As mStiva
If Abs(IsLabel(bstack, b$, what$)) > 4 Then
        If neoGetArray(bstack, what$, pppp) Then
If Not pppp.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                If NeoGetArrayItem(pppp, bstack, what$, v, b$) Then
againhere:
                            If IsLabelSymbolNew(b$, "ΑΠΟ", "IN", lang) Then
                            
                                If what$ = "" Then Exit Function   ' no for no named array
                                Set soros = bstack.soros
                                Set bstack.Sorosref = bs.soros
                                ' Need bstack and not bs because bstack has more info inside.
                                    If MyData(bstack, b$) Then
                                     Set bstack.Sorosref = soros
                                     Set soros = Nothing
                                                   VN = v + bs.soros.Total - 1
                                                   If pppp.UpperMonoLimit >= VN Then
                                                            With bs.soros
                                                                     i = 1
                                                                     For v = v To VN
                                                                              If .StackItemTypeObjectType(i) = "" Then
                                                                                       pppp.item(v) = .StackItem(i)
                                                                              Else
                                                                                       Set pppp.item(v) = .StackItem(i)
                                                                                       
                                                                              End If
                                                                              i = i + 1
                                                                     Next v
                                                            End With
                                                   Else
                                                            MyEr "Stock out of space", "Το απόθεμα έμεινε από χώρο"
                                                            Exit Function
                                                   End If
                                                    StockValues = True
                                                    Exit Function
                                    End If
                            ElseIf IsLabelSymbolNew(b$, "ΣΕ", "OUT", lang) Then
                                                  
                                                                     Do
                                                                        If IsObject(pppp.item(v)) Then
                                                                       
                                                                                        Select Case Abs(IsLabel(bstack, b$, w$))
                                                                                        Case 1, 4
                                                                                        If GetVar(bstack, w$, i) Then
                                                                                        If Typename$(var(i)) = "Group" Then UnFloatGroupReWriteVars bstack, what$, i, pppp.item(v)
                                                                                        Else
                                                                                        Set var(i) = pppp.item(v)
                                                                                        End If
                                                                                        Case 3
                                                                        
                                                                                        If GetVar(bstack, w$, i) Then Set var(i) = pppp.item(v)
                                                                                        Case 5, 6, 7
                                                                                         If neoGetArray(bstack, w$, pppp1) Then
                                                                                         If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                                            If IsSymbol(b$, ")") Then
                                                                                                bs.soros.PushObj pppp.item(v)
                                                                                                        If Not globalArrByPointer(bs, bstack, w$) Then MyEr "No array found", "Δεν βρήκα πίνακα"
                                                                                                Else
                                                                                                        If NeoGetArrayItem(pppp1, bstack, w$, V1, b$) Then
                                                                                                               Set pppp1.item(V1) = pppp.item(v)
                                                                                                        End If
                                                                                                End If
                                                                                        ElseIf IsSymbol(b$, ")") Then
                                                                                                        bs.soros.PushObj pppp.item(v)
                                                                                                        If Not globalArrByPointer(bs, bstack, w$) Then MyEr "No array found", "Δεν βρήκα πίνακα"
                                                                                                End If

                                                                                        
                                                                                        End Select
                                                                        Else
                                                                        Select Case Abs(IsLabel(bstack, b$, w$))
                                                                                        Case 1, 3, 4
                                                                                        If GetVar(bstack, w$, i) Then
                                                                                        Else
                                                                                        i = GlobalVar(w$, 0)
                                                                                        End If
                                                                                        var(i) = pppp.item(v)
                                                                                        
                                                                                        Case 5, 6, 7
                                                                                         If neoGetArray(bstack, w$, pppp1) Then
                                                                                         If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                                                If NeoGetArrayItem(pppp1, bstack, w$, V1, b$) Then
                                                                                                     pppp1.item(V1) = pppp.item(v)
                                                                                                End If
                                                                                      
                                                                                         End If
                                                                                        End Select
                                                                        
                                                                        End If
                                                                        v = v + 1
                                                                          If pppp.UpperMonoLimit < v Then
                                                                          If MaybeIsSymbol(b$, ",") Then
                                                                          MyEr "Reach array upper limit", "Έφθασα στο άνω όριο του πίνακα"
                                                                          Exit Function
                                                                          End If
                                                                          End If
                                                                        Loop Until Not FastSymbol(b$, ",")
                                                  
                                                    ElseIf IsLabelSymbolNew(b$, "ΓΙΑ", "KEEP", lang) Then
                                                    ' no copy of objects...only pointers...to objects
                                                    
                                                    If IsExp(bstack, b$, p) Then
                                                            If p <> Int(p) Or p < 0 Then
                                                                        MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                        Exit Function
                                                            End If
                                                                     If IsSymbol(b$, ",") Then
                                                                     If Abs(IsLabel(bstack, b$, w$)) > 4 Then
                                                                        If neoGetArray(bstack, w$, pppp1) Then
                                                                        If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                         If NeoGetArrayItem(pppp1, bstack, w$, V1, b$) Then
                                                                                   If Not (V1 + p - 1 <= pppp1.UpperMonoLimit) Then
                                                                                                MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                                                Exit Function
                                                                                   Else
                                                                                   If pppp1 Is pppp Then
                                                                                   If v = V1 Then
                                                                                   ' do nothing
                                                                                   ElseIf Abs(v - V1) < p And V1 > v Then
                                                                                   'from top
                                                                                               For i = p - 1 To 0 Step -1
                                                                                                                With pppp
                                                                                                                If IsObject(.item(i + v)) Then
                                                                                                                     Set pppp1.item(i + V1) = .item(i + v)
                                                                                                                Else
                                                                                                                     pppp1.item(i + V1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                   Else
                                                                                            For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If IsObject(.item(i + v)) Then
                                                                                                                     Set pppp1.item(i + V1) = .item(i + v)
                                                                                                                Else
                                                                                                                    pppp1.item(i + V1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                   End If

                                                                                   Else
                                                                                               For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If IsObject(.item(i + v)) Then
                                                                                                                     Set pppp1.item(i + V1) = .item(i + v)
                                                                                                                Else
                                                                                                                      pppp1.item(i + V1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                    End If
                                                                                    StockValues = True
                                                                                    Exit Function
                                                                                    End If
                                                                                                End If
                                                                                  End If
                                                                                  ElseIf Right$(w$, 1) = "$" Then
                                                                                   If GetVar(bstack, w$, V1) Then
                                                                                    var(V1) = ""
                                                                                        Else
                                                                                        V1 = GlobalVar(w$, "")
                                                                                        End If
                                                                                        VN = Right$(what$, 3) = "$"
                                                                                         If p - 1 + v > pppp.UpperMonoLimit Then
                                                                                          MyEr "Invalid copy number", "Μη έγκυρος δείκτης αντιγραφής"
                                                                                         Exit Function
                                                                                         End If
                                                                                    For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If IsObject(.item(i + v)) Then
                                                                                                                        If VN Then var(V1) = var(V1) + Sput("") Else var(V1) = var(V1) & " 0"
                                                                                                                Else
                                                                                                                  
                                                                                                                     Select Case VarType(.item(i + v))
                                                                                                                     Case 5
                                                                                                                     var(V1) = var(V1) + " " + Trim$(Str(.item(i + v)))
                                                                                                                     Case 8
                                                                                                                     w$ = .item(i + v)
                                                                                                                     If IsNumberD2(w$, p) Then
                                                                                                                     var(V1) = var(V1) + " " + .item(i + v)
                                                                                                                     Else
                                                                                                                     var(V1) = var(V1) + Sput(.item(i + v))
                                                                                                                     End If
                                                                                                                     Case Else
                                                                                                                     If VN Then var(V1) = var(V1) + Sput("") Else var(V1) = var(V1) & " 0"
                                                                                                              
                                                                                                                     ''var(V1) = var(V1) & " " & Trim$(Str$(.item(i + V)))
                                                                                                                     End Select
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                               
                                                                                   StockValues = True
                                                                                    Exit Function
                                                                                  End If
                                                   End If
                                                   End If

                                                    
                                                    ElseIf IsLabelSymbolNew(b$, "ΘΕΣΕ", "SWEEP", lang) Then
                                                    If what$ = "" Then Exit Function   ' no for no named array
                                                            If IsExp(bstack, b$, p) Then
                                                                            If p <> Int(p) Or p < 0 Then
                                                                                   MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                                   Exit Function
                                                                            End If
                                                         
                                                                If Not (v + p - 1 <= pppp.UpperMonoLimit) Then
                                                                            MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                            Exit Function
                                                                Else
                                                                    If Not IsSymbol(b$, ",") Then
                                                                                                                For i = 0 To p - 1
                                                                                                               If IsObject(pppp.item(i + v)) Then
                                                                                                               Set pppp.item(i + v) = Nothing
                                                                                                               End If
                                                                                                                pppp.item(i + v) = Empty
                                                                                                                Next i
                                                                    
                                                                    Else
                                                                    
                                                                            i = 1
                                                                            what$ = aheadstatus(b$, False, i)
                                                                            Set bstack.lastobj = Nothing
                                                                            If what$ <> "" Then
                                                                                            If Left$(what$, 1) = "N" Then
                                                                                                        If IsNumber(bstack, b$, p1) Then
                                                                                                                If bstack.lastobj Is Nothing Then
                                                                                                                For i = 0 To p - 1
                                                                                                                pppp.item(i + v) = p1
                                                                                                                Next i
                                                                                                                Else
                                                                                                            bs.soros.PushObj bstack.lastobj
                                                                                                                Set bstack.lastobj = Nothing
                                                                                                                For i = 0 To p - 1
                                                                                                                bs.soros.Copy2TopItem 1
                                                                                                                Set pppp.item(i + v) = bs.soros.PopObj
                                                                                                                Next i
                                                                                                                End If
                                                                                                        End If
                                                                                            Else
                                                                                                        If IsString(bstack, b$, what$) Then
                                                                                                                If bstack.lastobj Is Nothing Then
                                                                                                                For i = 0 To p - 1
                                                                                                               
                                                                                                                pppp.item(i + v) = what$
                                                                                                                Next i
                                                                                                                Else
                                                                                                                                                bs.soros.PushObj bstack.lastobj
                                                                                                                Set bstack.lastobj = Nothing
                                                                                                                For i = 0 To p - 1
                                                                                                                bs.soros.Copy2TopItem 1
                                                                                                                Set pppp.item(i + v) = bs.soros.PopObj
                                                                                                                Next i
                                                                                                                End If
                                                                                                                End If
                                                                                                        End If
                                                                                            End If
                                                                                    End If
                                                                                    End If
                                                          
                                                            End If
                                                        End If
                                                    End If
                                                    StockValues = True
                                Else
                            b$ = what$ + b$
                            If IsExp(bstack, b$, p) Then
                            what$ = ""
                            If Typename(bstack.lastobj) = "mArray" Then Set pppp = bstack.lastobj: Set bstack.lastobj = Nothing: GoTo againhere
                            
                            ElseIf IsStrExp(bstack, b$, what$) Then
                            what$ = ""
                            If Typename(bstack.lastobj) = "mArray" Then Set pppp = bstack.lastobj: Set bstack.lastobj = Nothing: GoTo againhere
                            End If
                            End If
                           
                    End If
            
End Function
Public Function SubsExist() As Boolean
SubsExist = subHash.count > 0
End Function
Function preProcessor(bstack As basetask, b$) As Long
Dim ec$, ss$, w$, backup, p As Double, backupstr$
If Len(b$) = 0 Then
preProcessor = 1: Exit Function
End If
If AscW(b$) = 39 Then backup = InStr(b$, vbCrLf) + 2 Else backup = 1
' backup show first char for code
While Mid$(b$, backup, 2) = vbCrLf
backup = backup + 2
Wend
If Mid$(b$, backup, 2) = "\#" Then
backupstr$ = Left$(b$, backup - 1)
b$ = Mid$(b$, backup + 2)

Do
        Do While FastSymbol(b$, "(")
        If FastSymbol(b$, ")") Then b$ = "()" + b$: Exit Do
                    If IsExp(bstack, b$, p) Then
                            If p = 0 Then  ''skip lines"
                                    If FastSymbol(b$, ",") Then  ''Skip lines
                                    If IsExp(bstack, b$, p) Then
                                        For p = p To 1 Step -1:    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): Next p
                                    Else
                                    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): GoTo continueloop
                                    
                                    End If
                                    Else  ' skip this
                                    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): GoTo continueloop
                                    End If
                                    
                            End If
                            IsSymbol3 b$, ")"
                    End If
            Loop
    w$ = GetNextLine(b$)
    ec$ = w$
    ss$ = GetStrUntil(":", ec$)
        If ss$ = "" Then
        ec$ = w$
        ss$ = GetStrUntil(" ", ec$)
        End If
    ec$ = NLtrim$(ec$)
    b$ = ReplaceStr2(ss$, ec$, b$)
While Left$(b$, 2) = vbCrLf
    b$ = Mid$(b$, 3)
Wend
continueloop:
Loop Until Not FastSymbol(b$, "\#", , 2)
b$ = backupstr$ + b$
End If
preProcessor = backup
End Function
Function newStart(basestack As basetask, rest$) As Boolean
Dim scr As Object, s$, pa As Long
newStart = True
Set scr = basestack.Owner
Targets = False
ReDim q(0) As target
scr.ForeColor = mycolor(11)
basestack.myBold = False
basestack.myitalic = False
pa = 0
            Err.Clear
            On Error Resume Next
If IsStrExp(basestack, rest$, s$) Then
            If s$ <> "" And s$ <> "*" Then MYFONT = s$ Else MYFONT = scr.Font.name
      
                scr.Font.charset = 0
                scr.Font.name = MYFONT
               If Not myLcase(MYFONT) = myLcase(scr.Font.name) Then
               scr.Font.charset = 1
               scr.Font.name = MYFONT
               End If
               Sleep 1
              '  mydoevents
                scr.Font.charset = basestack.myCharSet
                    Form1.TEXT1.Font.charset = basestack.myCharSet

    Form1.List1.Font.charset = basestack.myCharSet
  '  Form1.List2.Font.CharSet = BaseSTACK.myCharSet
                scr.FontBold = False
                scr.FontItalic = False
            If Err.Number > 0 Then
                Err.Clear
                scr.Font.name = FFONT
                scr.Font.charset = basestack.myCharSet
            End If
        StoreFont scr.Font.name, scr.FontSize, scr.Font.charset
        
        SetText scr, -2, True
            s$ = ""
            If FastSymbol(rest$, ",") Then
             
            If IsStrExp(basestack, rest$, s$) Then
            'rest$ = s$ & "}" & rest$
            If s$ <> "" Then s$ = ": " & s$ & "}"
            ElseIf FastSymbol(rest$, "{") Then
            s$ = ": " & block(rest$)
            If Not FastSymbol(rest$, "}") Then Set scr = Nothing: newStart = False: Exit Function
                End If
                End If
            Original basestack1, s$  ' set...
            
Else
'NOEXECUTION = True
'MOUT = False
MyEr "", ""
    closeAll ' we closed all files
    If AVIRUN Then MediaPlayer1.stopMovie
    PlaySoundNew ""
    
    If basestack.toprinter Then
    getnextpage
    End If
    Set scr = Form1.DIS
  
Form1.myBreak basestack
    basestack.toprinter = False
    Form1.Cls
    
    Original basestack1, "NEW:CLEAR"

    basestack.soros.Flush

End If

End Function
Sub newHide(basestack As basetask)
Dim scr As Object
Set scr = basestack.Owner
If scr.name = "DIS" Or scr.name = "dSprite" Then
scr.Visible = False
End If
MyDoEvents1 scr
Set scr = Nothing
End Sub
Function GiveForm() As Form
If Form1.Visible Then
Set GiveForm = Form1
Else
Set GiveForm = Nothing
End If
End Function
Sub newshow(bstack As basetask)
Dim scr As Object
Set scr = bstack.Owner
If scr.name = "DIS" Or scr.name = "dSprite" Then
If Form1.Visible = False Then
If ttl Then
' we have title
If Form3.WindowState = 1 Then
Form3.Visible = True: Form3.WindowState = 0: If Form3.WindowState = 0 Then Form3.Move -48000, 48000
Form1.Visible = True
    Do While Not Form1.Visible Or NOEXECUTION
        mywait bstack, 1
        Sleep 10
        Loop
         Form3.Timer1.Interval = 30
End If
Else

 Form1.Show , Form5
 mywait bstack, 5
End If
Else
    If ttl Then
    ' we have title
        If Form3.WindowState = 1 Then
        Form3.Visible = True: Form3.WindowState = 0: If Form3.WindowState = 0 Then Form3.Move -48000, 48000
            Do While Not Form1.Visible Or NOEXECUTION
           mywait bstack, 5
                Loop
        End If
    Else
     Form1.Show , Form5
     mywait bstack, 5
    End If
End If
If Typename(scr) = "PictureBox" Then
If scr.Parent.Visible = False Then
scr.Parent.Visible = True
mywait bstack, 5
End If
End If
    scr.Visible = True
        Do While Not scr.Visible Or NOEXECUTION
mywait bstack, 5
        Loop
If scr.Visible Then scr.SetFocus
End If
Set scr = Nothing
End Sub
Sub TraceStore(b As basetask, v As Long, c$, o&, Optional r&)
     v = b.addlen
     r& = Len(c$) - o&

         b.addlen = r& + b.addlen
         
End Sub
Sub TraceRestore(b As basetask, v As Long)
         b.addlen = v
End Sub
Sub ProcBackGround(bstack As basetask, rest$, lang As Long, afier As Boolean)
Dim s$, p As Double, i As Long, x1 As Long, x As Double, y As Double, f As Long, y1 As Long, sx As Double, ss$, pa$, it As Long
Dim scr As Object, frm$, W3 As Long, ya As Long, AddTwipsTopL As Long
Set scr = bstack.Owner
afier = True
Dim prive As basket
If IsLabelSymbolNew(rest$, "ΜΟΥΣΙΚΗ", "MUSIC", lang) Then
If IsStrExp(bstack, rest$, s$) Then
 'OPEN OR REPLACE
 If s$ <> "" Then
                    If ExtractType(s$) = "" Then s$ = s$ & ".avi"
                    If CFname(s$) = "" Then
                        s$ = mcd & s$: If CFname(s$) = "" Then Exit Sub
                    Else
                        s$ = CFname(s$)
                    End If
                   If s$ <> "" Then
                   MediaBack1.closeMovie
                   MediaBack1.FileName = s$
                   MediaBack1.openMovie
                   MediaBack1.playMovie
                   End If
                Else
                    afier = False
                    Exit Sub
                End If
Else
' CLOSE
MediaBack1.closeMovie
End If
Else
If Not IsExp(bstack, rest$, p) Then p = 0   '' no change

If FastSymbol(rest$, "{") Then
ss$ = block(rest$)

frm$ = rest$
If FastSymbol(rest$, "}") Then
'' check players(-2)
If players(-1).SZ = 0 Then
prive = players(GetCode(scr))
SetTextBasketBack Form1, prive
    SetText Form1, prive.MineLineSpace, True    'load Players() with first values
    With players(-1)
    .curpos = 0
    .currow = 0
    .mysplit = 0
    .osplit = 0
    .Paper = prive.Paper
    End With
End If
If p > 0 Then
SetTextSZ Form1, CSng(p)
End If
W3 = bstack.tolayer
bstack.toback = True
Set bstack.Owner = Form1
If NLtrim(ss$) = "" Then
If players(-1).Paper <> Form1.BackColor Then
Form1.BackColor = players(-1).Paper
 End If
it = 1
Else
 ss$ = "{" & ss$ & "}"
afier = executeblock(it, bstack, ss$, False, False) = 0
End If
 MyDoEvents2 bstack.Owner

Set bstack.Owner = scr
bstack.tolayer = W3
bstack.toback = False
If it <> 1 Then
If Trim(ss$) = "" Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$: afier = False: Exit Sub
End If

End If
End If

End If

End Sub

Sub SetSizeAndHotSpot(thisbasket As basket, MaxX As Long, MaxY As Long, Optional ByVal HotSpotX = 0, Optional ByVal HotSpotY = 0)
With thisbasket
.MAXXGRAPH = MaxX
.MAXYGRAPH = MaxY
If Not IsMissing(HotSpotX) Then .x = CLng(HotSpotX)  ' this is hotspot
If Not IsMissing(HotSpotY) Then .y = CLng(HotSpotY)
End With
End Sub
Sub FeedBasket(ddd As Object, thisbasket As basket, alinespace As Long)
With thisbasket
.FontName = ddd.FontName
.SZ = ddd.FontSize
.charset = ddd.Font.charset
.MineLineSpace = alinespace
.uMineLineSpace = alinespace
''.Paper = ddd.BackColor
FrameText ddd, .SZ, 0, 0, -.Paper, (ddd.name <> "Form1")

End With
End Sub
Sub PlaceBasketPrive(ddd As Object, thisbasket As basket)
On Error Resume Next
With thisbasket
If Not ddd.FontName = .FontName And ddd.Font.charset = .charset And ddd.FontSize = .SZ Then
ddd.Font.charset = 0
ddd.FontSize = 9
ddd.FontName = .FontName
ddd.Font.charset = .charset
ddd.FontSize = .SZ
End If
' these I have to delete after change
End With
End Sub
Sub PlaceBasket(ddd As Object, thisbasket As basket)
On Error Resume Next
With thisbasket
If Not (ddd.FontName = .FontName And ddd.Font.charset = .charset And ddd.Font.Size = .SZ) Then
StoreFont .FontName, .SZ, .charset
ddd.Font.charset = 0
ddd.FontSize = 9
ddd.FontName = .FontName
ddd.Font.charset = .charset
ddd.FontSize = .SZ
End If
ddd.ForeColor = .mypen
End With
End Sub
Function GetCode(dq As Object) As Long
Dim u As Long
If Typename(dq) Like "Gui*" Then

' each gui* take a number above 32
On Error Resume Next
u = dq.prive
If Err > 0 Then Err.Clear: oxiforforms: GetCode = -1: Set dq = Form1
If u = 0 Then
For u = 33 To 132
If Not players(u).used Then Exit For
Next u
If u = 101 Then oxiforforms: GetCode = -1: Set dq = Form1: Exit Function
dq.prive = u

players(u) = zero
players(u).used = True

End If

GetCode = u
Else

Select Case dq.name
Case "DIS"
GetCode = 0
Case "Form1"
GetCode = -1
Case "PrinterDocument1"
GetCode = -2
Case Else
GetCode = val("0" & Form1.dSprite(dq.index).Tag)
End Select
End If
End Function
Sub RepPlain(bstack As basetask, scr As Object, txt$)
Dim prive As Long
prive = GetCode(scr)
If players(prive).curpos > 0 Then crNew bstack, players(prive)
wwPlain bstack, players(prive), txt$, scr.Width, 100000, True
If players(prive).curpos > 0 Then crNew bstack, players(prive)
End Sub
Sub ProcWindow(bstack As basetask, rest$, scr As Object, ifier As Boolean)
Dim x1 As Long, y1 As Long, p As Double
If scr.name = "GuiM2000" Then
    Else
If scr.name = "Form1" Then
    DisableTargets q(), -1
ElseIf scr.name = "DIS" Then
    DisableTargets q(), 0
ElseIf scr.name = "dSprite" Then
    DisableTargets q(), val(scr.index)
End If
End If
With players(GetCode(scr))
        If IsExp(bstack, rest$, p) Then
            .SZ = p
            If .SZ < 4 Then .SZ = 4
            If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, p) Then
                    x1 = CLng(p)
                    If x1 = 0 And scr.name = "DIS" Then
                    If Not Form1.WindowState = 0 Then Form1.WindowState = 0: Form1.Refresh
                    Form1.Move 0, 0, ScrX(), ScrY()
        
                    FrameText scr, .SZ, CLng(Form1.Width), CLng(Form1.Height), .Paper
                    players(-1).MAXXGRAPH = .MAXXGRAPH
                    players(-1).MAXYGRAPH = .MAXYGRAPH
                    Exit Sub
        Else
                    y1 = CLng(x1 * ScrY() / ScrX())
        End If
End If
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = CLng(p)
End If
If scr.name = "GuiM2000" Then
 Set scr.Picture = LoadPicture("")
               If FastSymbol(rest$, ";") Then 'CENTER
                            FrameText scr, .SZ, x1, y1, .Paper, True
                            scr.Move (ScrX() - .MAXXGRAPH) / 2, (ScrY() - .MAXYGRAPH) / 2
                Else
                            scr.Move scr.Left, scr.top, x1, y1

                            FrameText scr, .SZ, 0, 0, .Paper, True
                            
                End If
                SetTextSZ scr, .SZ
ElseIf scr.name = "dSprite" Then
            RsetRegion scr
            Set scr.Picture = LoadPicture("")
                If FastSymbol(rest$, ";") Then 'CENTER
                            FrameText scr, .SZ, x1, y1, .Paper, True
                            scr.Move (ScrX() - .MAXXGRAPH) / 2, (ScrY() - .MAXYGRAPH) / 2
                Else
                            scr.Move scr.Left, scr.top, x1, y1

                            FrameText scr, .SZ, 0, 0, .Paper, True
                            
                End If
                SetTextSZ scr, .SZ
Else
    If FastSymbol(rest$, ";") Then 'CENTER
        Form1.WindowState = 0

        FrameText scr, .SZ, x1, y1, .Paper
      ''  Form1.Move 0, 0
        Form1.Move (ScrX() - .MAXXGRAPH) / 2, (ScrY() - .MAXYGRAPH) / 2, .MAXXGRAPH, .MAXYGRAPH

       '''' Form1.follow IEX, IEY
        scr.Move 0, 0
        If ttl Then
        If Form3.WindowState = 0 Then Form1.Show , Form5
        Else
        Form1.Show , Form5
        End If
    Else
        Form1.WindowState = 0

        FrameText scr, .SZ, x1, y1, .Paper
        Form1.Move 0, 0, .MAXXGRAPH, .MAXYGRAPH
        players(-1).MAXXGRAPH = .MAXXGRAPH
        players(-1).MAXYGRAPH = .MAXYGRAPH
        Form1.Up
        'Form1.follow IEX, IEY
        scr.Move 0, 0
                If ttl Then
        If Form3.WindowState = 0 Then Form1.Show , Form5
        Else
        Form1.Show , Form5
        End If
    End If
End If
Else
ifier = False
Exit Sub
End If
''SleepWait 4
End With
End Sub
Function GetRealPos(dq As Object) As Long
Dim mybasket As basket, oldx
mybasket = players(GetCode(dq))
If mybasket.lastprint Then
oldx = dq.CurrentX
dq.CurrentX = dq.CurrentX + mybasket.Xt - dv15
GetXYb dq, mybasket, mybasket.curpos, mybasket.currow
dq.CurrentX = oldx
End If

 GetRealPos = mybasket.curpos
End Function
Function GetRealRow(dq As Object) As Long
Dim mybasket As basket
mybasket = players(GetCode(dq))
If mybasket.lastprint Then
GetXYb dq, mybasket, mybasket.curpos, mybasket.currow
End If

 GetRealRow = mybasket.currow
End Function

Function Funcweak(basestack As basetask, s$) As String
' no validation of names
' check for "dot"
Dim w As Long, ww$, Original$, s1$, ww1$, p As Double
again:
w = IsLabel(basestack, s$, ww$)
ww1$ = ww$
If w >= 5 Then
s1$ = "&" + ww$ + ")"
w = IsLabel(basestack, s1$, ww$)
If w = 2 Then
' IT IS A FUNCTION
 ww1$ = ww1$ + ")"
GetSubFullName ww1$, ww$
If FastSymbol(s$, ")") Then
If here$ = "" Then
Funcweak = ww1$
Else
Funcweak = here$ + "." + ww1$
End If
End If
ElseIf w = 0 Then
If ISSTRINGA(s1$, ww$) Then
If FastSymbol(s$, ")") Then
Funcweak = ww$
Else
' check parameters
ww$ = ww$ + "("
Do
If IsExp(basestack, s$, p) Then ww$ = ww$ + CStr(p)
If Not FastSymbol(s$, ",") Then Exit Do
ww$ = ww$ + ","
Loop
If FastSymbol(s$, ")") Then ww$ = ww$ + ")"
If FastSymbol(s$, ".") Then ' ............
End If
Funcweak = ww$
End If
End If
End If
Else
s1$ = "&" + ww$
w = IsLabel(basestack, s1$, ww1$)
If w = 0 Then

If FastSymbol(s1$, ":") Then

GetSubFullName ww$, ww1$
Funcweak = ww1$
Else

If ISSTRINGA(s1$, ww1$) Then
If FastSymbol(s$, ".") Then

If Right$(ww1$, 1) = "$" Then
If IsStrExp(basestack, ww1$, ww$) Then
s$ = ww$ + "." + s$
GoTo again
End If
End If
End If
Funcweak = ww1$
End If
End If
End If
End If

End Function

Function MyRound(ByVal x, Optional d As Double = 0) As Double
Dim i, n
  i = Abs(Int(d)): If i > 13 Then i = 13
  n = Sgn(x) * 0.5
On Error GoTo there
Select Case i
Case 0
MyRound = Fix(x + n)
Case 1
MyRound = Fix(x * 10# + n) / 10#
Case 2
MyRound = Fix(x * 100# + n) / 100#
Case 3
MyRound = Fix(x * 1000# + n) / 1000#
Case 4
MyRound = Fix(x * 10000# + n) / 10000#
Case 5
MyRound = Fix(x * 100000# + n) / 100000#
Case 6
MyRound = Fix(x * 1000000# + n) / 1000000#
Case 7
MyRound = Fix(x * 10000000# + n) / 10000000#
Case 8
MyRound = Fix(x * 100000000# + n) / 100000000#
Case 9
MyRound = Fix(x * 1000000000# + n) / 1000000000#
Case 10
MyRound = Fix(x * 10000000000# + n) / 10000000000#
Case 11
MyRound = Fix(x * 100000000000# + n) / 100000000000#
Case 12
MyRound = Fix(x * 1000000000000# + n) / 1000000000000#
Case 13
MyRound = Fix(x * 10000000000000# + n) / 10000000000000#
End Select
Exit Function
there:
MyRound = x

End Function

Function AllocVar()
var2used = var2used + 1
  If UBound(var()) <= var2used + 20 Then
        On Error Resume Next

            ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
               ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
            If Err.Number > 0 Then
            If UBound(var()) <= var2used Then
            Err.Clear
            Else
            NOEXECUTION = True
            MyEr Err.Description, Err.Description
            Err.Clear
            Exit Function
            End If
            End If
            
        End If
       AllocVar = var2used
End Function
Function AllocSub() As Long
    On Error Resume Next
    If UBound(sbf()) <= sb2used + 1 Then
    ReDim Preserve sbf(UBound(sbf()) * 2 + 1) As modfun
    End If
    sb2used = sb2used + 1
    AllocSub = sb2used
End Function
Public Function ExpEnvirStr(strInput) As String
Dim result As Long
Dim strOutput As String
'' Two calls required, one to get expansion buffer length first then do expansion
strOutput = Space$(1000)
result = ExpandEnvironmentStrings(StrPtr(strInput), StrPtr(strOutput), result)
strOutput = Space$(result)
result = ExpandEnvironmentStrings(StrPtr(strInput), StrPtr(strOutput), result)
ExpEnvirStr = StripTerminator(strOutput)
End Function
Function ProcEvent(bstack As basetask, rest$, lang As Long, i As Long) As Boolean
'look for { }, or hold
Dim aa As mEvent, s$, LastName$, dd As Long, pm As Long, pf As Long
ProcEvent = True
Dim ss$, rd$, ss1$
If FastSymbol(rest$, "{") Then
Set aa = var(i)
aa.BypassInit 10
aa.VarIndex = i
aa.enabled = True
ss$ = NLtrim$(block(rest$))
rd$ = ""
While ss$ <> ""
If FastSymbol(ss$, vbCrLf) Then
ss$ = NLtrim(ss$)
ElseIf IsLabelSymbolNew(ss$, "ΔΙΑΒΑΣΕ", "READ", lang) Then
If lang = 1 Then
If rd$ = "" Then rd$ = "READ "
Else
If rd$ = "" Then rd$ = "ΔΙΑΒΑΣΕ "
End If

Do
dd = 1
      s$ = aheadstatus(ss$, , dd)
      If s$ <> "" Then
      pm = pm + 1
      If IsLabelOnly((ss$), ss1$) Then
   
            If pm < 2 Then
            rd$ = rd$ + Left$(ss$, dd - 1)
            Else
            rd$ = rd$ + "," + Left$(ss$, dd - 1)
            End If
      
      ss$ = Mid$(ss$, dd)
      Else
      ProcEvent = False
      Exit Function
      End If
      Else
      Exit Do
      End If
   Loop Until Not FastSymbol(ss$, ",")

ElseIf IsLabelSymbolNew(ss$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", lang) Then
'' check only for blocks
pf = pf + 1
If FastSymbol(ss$, "{") Then
s$ = "{" + rd$ + vbCrLf + block(ss$) + "}" + here$ + "." + bstack.GroupName
If Not FastSymbol(ss$, "}") Then ProcEvent = False: Exit Function
aa.GenItemCreator LTrim(Str(pf * 123)), s$
While ss$ <> ""
If FastSymbol(ss$, vbCrLf, , 2) Then
    ss$ = NLtrim(ss$)
ElseIf IsLabelSymbolNew(ss$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", lang) Then
        If FastSymbol(ss$, "{") Then
            s$ = "{" + rd$ + vbCrLf + block(ss$) + "}"
            If Not FastSymbol(ss$, "}") Then ProcEvent = False: Exit Function
            ' βάλε ένα key
            pf = pf + 1
            aa.GenItemCreator LTrim(Str(pf * 123)), s$
        Else
            ProcEvent = False: Exit Function
        End If
Else
    ProcEvent = False: Exit Function
End If
Wend
End If
Else
    ProcEvent = False: Exit Function
End If
Wend
aa.ParamBlock rd$, pm




Set aa = Nothing

If Not FastSymbol(rest$, "}") Then ProcEvent = False: Exit Function
' do something
' find Read command and some Functions
ElseIf IsLabelSymbolNew(rest$, "ΑΦΗΣΕ", "RELEASE", lang) Then
Set aa = var(i)
aa.enabled = True
ElseIf IsLabelSymbolNew(rest$, "ΚΡΑΤΗΣΕ", "HOLD", lang) Then
Set aa = var(i)
aa.enabled = False
ElseIf IsLabelSymbolNew(rest$, "ΚΑΘΑΡΟ", "CLEAR", lang) Then
Set aa = var(i)
aa.enabled = False
aa.BypassInit 10
ElseIf IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", lang) Then
Set aa = var(i)
Do
dd = 1
      ss$ = aheadstatus(rest$, , dd)
      If ss$ = "S" Then
       LastName$ = here$ + "." + NLtrim(myUcase(Left(rest$, dd - 1), True))
        If Not IsStrExp(bstack, rest$, s$) Then
          ProcEvent = False: Exit Function
        End If
      ElseIf ss$ = "N" Then
       ss$ = "&" + Left$(rest$, dd)
        If Not IsString(bstack, (ss$), s$) Then
            ProcEvent = False: Exit Function
            Else
            LastName$ = subHash.LastKnown
        End If
        rest$ = Mid$(rest$, dd)
        Else
        s$ = ""
    End If
    If Len(s$) > 1 Then
        
       
        If Not aa.StandBy("(FREE)", LastName$, s$) Then aa.GenItemCreator LastName$, s$
        Else
    ProcEvent = False
    Exit Function
    End If
Loop Until Not FastSymbol(rest$, ",")
Set aa = Nothing


ElseIf IsLabelSymbolNew(rest$, "ΠΕΤΑ", "DROP", lang) Then
Set aa = var(i)
Do
rest$ = "&" + LTrim$(rest$)
If IsString(bstack, rest$, s$) Then
    LastName$ = subHash.LastKnown
    If LastName$ <> "" Then
'' Σβήσε εδώ??? ή μάλλον σβήσε κώδικα..
'' αλλά πρέπει να δω και το κλειδί!!!!
'' και το count δεν θα αλλάξει!
    If Not aa.StandBy(LastName$, "(FREE)", "") Then ProcEvent = False: Exit Function
    
    Else
 
    ProcEvent = False: Exit Function
    End If
Else
Exit Do

End If
Loop Until Not FastSymbol(rest$, ",")
End If
Set aa = Nothing
End Function
Sub CopyEvent(A As Variant, bstack As basetask)
Dim alfa As New mEvent, i As Long
Dim aa As mEvent
Set aa = A
'' now put code to copy a to alfa
alfa.BypassInit CLng(A.CurMaxSpace)
Dim aaa() As GenItem, bbb() As Long, mytop As Long
aa.CopySpaceUp aaa(), bbb(), mytop
alfa.CopySpaceDown aaa(), bbb(), mytop
alfa.ParamBlock aa.ParamsRead, aa.params
Set bstack.lastobj = alfa
Set aa = Nothing
End Sub
Function CallEvent(bstack As basetask, rest$, lang As Long, ByVal i As Long) As Boolean
CallEvent = True
Dim A As mEvent, n$, f$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
FastSymbol rest$, ","
Set A = var(i)
''bstack.Look2Parent = True
If Not PushParamGeneral(bstack, rest$) Then

CallEvent = False
Set A = Nothing
Exit Function

End If
''bstack.Look2Parent = False
Dim j As Long, k, s1$, klm As Long
Set oldbstack = bstack.soros
Dim ohere$
ohere$ = here$
For j = 0 To A.count - 1
here$ = "EV" + CStr(i) + "." + CStr(j)
If A.enabled Then
A.ReadVar j, n$, f$
If f$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            bb.Copy2TopNItems2FromStiva A.params, oldbstack
            PushStage bstack, False
            s1$ = Mid$(f$, 2, rinstr(f$, "}") - 2)
            klm = GlobalSub("A_()", s1$, Trim$(Mid$(f$, Len(s1$) + 3)))
            
            If Not ProcModuleEntry(bstack, "A_()", klm, "") Then
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
            PopStage bstack

bb.Flush
End If
End If
Next j
conthere:
Set bstack.Sorosref = oldbstack
Set oldbstack = Nothing
bstack.soros.drop A.params
Set bb = Nothing

here$ = ohere$
End Function
Public Function CallEventFromGui(gui As Object, A As mEvent, aString$) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
olescok = escok
escok = False
extr = extreme
extreme = True
tr = trace
If Rnd * 100 > 3 Then trace = False
On Error Resume Next

CallEventFromGui = True
Dim n$, f$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = basestack1
bstack.IamAnEvent = True
Dim i As Long
If A Is Nothing Then GoTo conthere1
i = A.VarIndex
bstack.soros.DataStr aString$
If gui.index >= 0 Then
bstack.soros.DataVal gui.index
End If
bstack.soros.DataObj gui

Set oldbstack = bstack.soros
Dim j As Long, s1$, klm As Long
Dim ohere$
ohere$ = here$
For j = 0 To A.count - 1
here$ = "EV" + CStr(i) + "." + CStr(j)
If A.enabled Then
A.ReadVar j, n$, f$
If f$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            bb.Copy2TopNItems2FromStiva A.params, oldbstack
            PushStage bstack, False
            s1$ = Mid$(f$, 2, rinstr(f$, "}") - 2)
            klm = GlobalSub("A_()", s1$, Trim$(Mid$(f$, Len(s1$) + 3)))
            
            If Not ProcModuleEntry(bstack, "A_()", klm, "") Then
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
            PopStage bstack

bb.Flush
End If
End If
Next j
conthere:
Set bstack.Sorosref = oldbstack
Set oldbstack = Nothing
bstack.soros.drop A.params
Set bb = Nothing
here$ = ohere$
conthere1:
extreme = extr
If tr Then
If STEXIT Then trace = tr
End If
escok = olescok
End Function
Public Function CallEventFromGuiOne(gui As Object, A As mEvent, aString$) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
CallEventFromGuiOne = True
olescok = escok
escok = False
tr = trace
extr = extreme
extreme = True
If Rnd * 100 > 3 Then trace = False
Dim n$, f$, F1$, bb As mStiva, uIndex As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
bstack.IamAnEvent = True
Dim i As Long
If A Is Nothing Then GoTo conthere0
i = A.VarIndex
uIndex = gui.index
If uIndex >= 0 Then
bstack.soros.DataVal CDbl(uIndex)
uIndex = 1
End If
uIndex = uIndex + 1
F1$ = gui.ModuleName$
bstack.soros.DataObj gui

Dim j As Long, k As Long, s1$, klm As Long, s2$
Dim ohere$
ohere$ = here$
here$ = "EV" + CStr(i)
If A.enabled Then
            PushStage bstack, False
            IsLabelOnly (aString$), f$
            n$ = Mid$(aString$, Len(f$) + 1)
            n$ = Left$(n$, Len(n$) - 1)
            If n$ <> "" Then
           If uIndex > 0 Then
            n$ = "Data " + n$ + " : ShiftBack Stack.Size" + Str(1 - uIndex) + "," + Str$(uIndex) + vbCrLf
            Else
            n$ = "Data " + n$ + " : ShiftBack Stack.Size" + vbCrLf
            End If
            End If
            If F1$ <> "" Then f$ = myUcase(F1$ + "." + f$ + ")", True) Else f$ = myUcase(f$ + ")", True)
            If Not GetSub(f$, klm) Then PopStage bstack: GoTo conthere
            s1$ = sbf(klm).sb
            If Left$(s1$, 10) = "'11001EDIT" Then
            SetNextLine s1$
            End If
            If F1$ <> "" Then s1$ = n$ + "Module " + F1$ + vbCrLf + sbf(klm).sb Else s1$ = n$ + sbf(klm).sb
            If Execute(bstack, s1$, False, False) <> 1 Then
            bstack.soros.Flush
                PopStage bstack
                GoTo conthere
            End If
            PopStage bstack
End If
conthere:
Set bstack = Nothing
here$ = ohere$
conthere0:
If tr Then
If STEXIT Then trace = tr
End If
extreme = extr
escok = olescok
End Function
Public Function CallEventFromGuiNow(gui As Object, A As mEvent, aString$, vrs()) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
olescok = escok
escok = False
CallEventFromGuiNow = True
extr = extreme
extreme = True
tr = trace
If Rnd * 100 > 3 Then trace = False
Dim n$, f$, F1$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
bstack.IamAnEvent = True
Dim i As Long
If A Is Nothing Then GoTo conthere0
i = A.VarIndex
F1$ = gui.ModuleName$
Set oldbstack = bstack.soros
Dim j As Long, k As Long, s1$, klm As Long, s2$
Dim ohere$
ohere$ = here$
'For j = 0 To a.Count - 1

here$ = "EV" + CStr(i)

If A.enabled Then
A.ReadVar 0, n$, f$
If f$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            PushStage bstack, False
            For k = LBound(vrs()) To UBound(vrs()) - 1
            If VarType(vrs(k)) = vbString Then
            GlobalVar "EV" + CStr(i + k) + "$", vrs(k)
            bb.DataStr here$ + "." + "EV" + CStr(i + k) + "$"
            Else
            GlobalVar "EV" + CStr(i + k), vrs(k)
            bb.DataStr here$ + "." + "EV" + CStr(i + k)
            End If
            
            
            Next k
            bb.DataObj gui
             
            IsLabelOnly (aString$), f$
            n$ = Mid$(aString$, Len(f$) + 1)
            If Len(n$) > 0 Then
            
            n$ = Left$(n$, Len(n$) - 1)
            If n$ <> "" Then n$ = "Push " + n$ + vbCrLf
         End If
            If F1$ <> "" Then f$ = myUcase(F1$ + "." + f$ + ")", True) Else f$ = myUcase(f$ + ")", True)
  
            If Not GetSub(f$, klm) Then PopStage bstack: bb.Flush: GoTo conthere
            '' look for '11001EDIT
            s1$ = sbf(klm).sb
            If Left$(s1$, 10) = "'11001EDIT" Then
            SetNextLine s1$
            End If
            If F1$ <> "" Then s1$ = n$ + "Module " + F1$ + vbCrLf + sbf(klm).sb Else s1$ = n$ + sbf(klm).sb
            
          
            
            If Execute(bstack, s1$, False, False) <> 1 Then
            
            
            
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
                  here$ = "EV" + CStr(i)
       For k = LBound(vrs()) To UBound(vrs()) - 1
        If VarType(vrs(k)) = vbString Then
            GetlocalVar "EV" + CStr(i + k) + "$", j
            vrs(k) = var(j)
        Else
            GetlocalVar "EV" + CStr(i + k), j
             vrs(k) = var(j)
            End If
           
            Next k
            PopStage bstack

            bb.Flush
End If
End If

conthere:

Set bstack.Sorosref = oldbstack
here$ = ohere$
conthere0:
Set oldbstack = Nothing
Set bb = Nothing

If tr Then
If STEXIT Then trace = tr
End If
extreme = extr
escok = olescok
End Function

Function ExpandGui(bstack As basetask, what$, rest$, ifier As Boolean, lang As Long, oName As String)
Dim pppp As mArray, aVar As Variant, h$
'' add new GuiItems but not visible
what$ = Left$(what$, Len(what$) - 1)
 If neoGetArray(bstack, oName$, pppp, here$ <> "") Then
 If Not pppp.IHaveGui Then ifier = False: Exit Function
 Dim i As Long
 i = pppp.UpperMonoLimit + 1
 pppp.SerialItem 0, i + 2, 9
  If Typename$(pppp.item(0)) Like "Gui*" Then

  On Error Resume Next
  Select Case Typename$(pppp.item(0))
  Case "GuiM2000"
                             CreateFormObject aVar, 1
                                Set pppp.item(i) = aVar
                                Dim aaa As GuiM2000
                                Set aaa = aVar
                                With pppp.item(0)
                                Set aaa.EventObj = .EventObj
                                h$ = .ModuleName
                                End With
                                Set aaa = Nothing
                                With aVar
                                 .MyName = what$
                                 .ModuleName = h$
                                 .TITLE = what$ + "(" + LTrim(Str$(i)) + ")"
                                 .index = i
                                End With
Case "GuiButton"
                                CreateFormObject aVar, 2
                            
                                Set pppp.item(i) = aVar
                                Dim aaa1 As GuiButton
                                Set aaa1 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa1.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                End With
Case "GuiTextBox"
                                CreateFormObject aVar, 3
                                Set pppp.item(i) = aVar
                                Dim aaa2 As GuiTextBox
                                Set aaa2 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa2.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                                 End With
                                
Case "GuiCheckBox"
                                CreateFormObject aVar, 4
                                Set pppp.item(i) = aVar
                                Dim aaa3 As GuiCheckBox
                                Set aaa3 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa3.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With
                               
Case "GuiEditBox"
                                CreateFormObject aVar, 5
                                Set pppp.item(i) = aVar
                                Dim aaa4 As GuiEditBox
                                Set aaa4 = pppp.item(0)
                                Set aaa = aaa4.GetCallBack
                                With aVar
                                .ConstructArray aaa, what$, i
                                .Move 0, 2000, 6000, 1200
                              
                                If aaa.prive <> 0 Then
                                    .Linespace = players(aaa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                                 End With
                                 Set aaa = Nothing
                              
Case "GuiListBox"
                                CreateFormObject aVar, 6
                                Set pppp.item(i) = aVar
                                Dim aaa5 As GuiListBox
                                Set aaa5 = pppp.item(0)
                                Set aaa = aaa5.GetCallBack
                                With aVar
                                .ConstructArray aaa5.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                If aaa.prive <> 0 Then
                                    .Linespace = players(aaa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With
Case "GuiDropDown"
                                CreateFormObject aVar, 7
                                Set pppp.item(i) = aVar
                                Dim aaa6 As GuiDropDown
                                Set aaa6 = pppp.item(0)
                                Set aaa = aaa6.GetCallBack
                                With aVar
                                .ConstructArray aaa5.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                'If aaa.prive <> 0 Then
                                 '   .Linespace = players(aaa.prive).uMineLineSpace
                                'Else
                                 '   .Linespace = players(0).uMineLineSpace
                                'End If
                                '.ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With

End Select
ifier = True
End If
End If
End Function
Function DeclareGUI(bstack As basetask, what$, rest$, ifier As Boolean, lang As Long, i As Long, Optional ar As Long = 0, Optional oName As String = "", Optional glob As Long = 0)
DeclareGUI = True
Dim w$, x1 As Long, y1 As Long, s$, useold As Boolean, bp As Long
Dim alfa As GuiM2000, mm As CallBack2
Dim aVar As Variant, p As Double
Dim pppp As mArray, mmmm As mEvent
 If IsLabelSymbolNew(rest$, "ΕΦΑΡΜΟΓΗ", "APPLICATION", lang) Then
 
 Set mm = New CallBack2
 
                     With mm
                     .NoPublic bstack, ""
                    End With
                     Set var(i) = mm
                     Set mm = Nothing
                        Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΤΜΗΜΑ", "MODULE", lang) Then
         Set mm = New CallBack2
                     With mm
                     .NoPublic bstack, here$
                    End With
                     Set var(i) = mm
                     Set mm = Nothing
                     Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
                  If IsLabelSymbolNew(rest$, "ΓΕΓΟΝΟΣ", "EVENT", lang) Then
                  
                             x1 = Abs(IsLabel(bstack, rest$, w$))
                             If x1 <> 1 Then
                                     BadObjectDecl
                             Else
                                If GetlocalVar(bstack.GroupName & w$, y1) Then
                                useold = True
                                ElseIf GetVar(bstack, bstack.GroupName & w$, y1) Then
                                useold = True
                                Else
                                y1 = GlobalVar(bstack.GroupName & w$, s$)
                                MakeitObjectEvent var(y1)
                                 
                                End If
                                If Typename(var(y1)) <> "mEvent" Then
                                    ifier = False
                                    DeclareGUI = False: Exit Function
                                End If
                                
                             End If
                              
                            If ar = 0 Then
                               If Not useold Then ProcEvent bstack, "{Read msg$, &obj}", 1, y1
                                CreateFormObject var(i), 1
                                  Set alfa = var(i)
                                  Set alfa.EventObj = var(y1)
                                  alfa.index = -1
                                  alfa.MyName = what$
                                  alfa.ModuleName = here$
                                  alfa.TITLE = what$
                                  Set alfa = Nothing
                            Else
                                ProcEvent bstack, "{Read index, msg$, &obj}", 1, y1
                                Set mmmm = var(y1)
                                GoTo contEvArray
                           End If
                    Else
                    bp = True
                    If ar = 0 Then
                    CreateFormObject var(i), 1
                    Set alfa = var(i)
                    Set mmmm = New mEvent
                                  Set alfa.EventObj = mmmm
                                  With mmmm
                                    .BypassInit 10
                                    .VarIndex = i * 1000 + varhash.count
                                    .enabled = True
                                    .ParamBlock "Read msg$, &obj", 2
                                    .GenItemCreator LTrim(Str(i * 456)), "{ Module " + here$ + vbCrLf + "try { Call local " + here$ + "." + bstack.GroupName + what$ + "() } }" + here$ + "." + bstack.GroupName
                                 End With
                                  alfa.MyName = what$
                                  alfa.index = -1
                                  alfa.ModuleName = here$
                                  alfa.ByPass = bp
                                  alfa.TITLE = what$
                                  Set mmmm = Nothing
                                  Set alfa = Nothing
                    Else
                     Set mmmm = New mEvent
contEvArray:
                        If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                                what$ = Left$(what$, Len(oName$))
                              If y1 = 0 Then
                                 With mmmm
                                    .BypassInit 10
                                    .VarIndex = i * 1000 + varhash.count
                                    .enabled = True
                                    .ParamBlock "Read Index, msg$, &obj", 3
                                    .GenItemCreator LTrim(Str(i * 3456)), "{ Module " + here$ + vbCrLf + "try { call local " + here$ + "." + bstack.GroupName + what$ + "() } }" + here$ + "." + bstack.GroupName
                                 End With
                                 End If
                                For i = 0 To ar - 1
                                CreateFormObject aVar, 1
                                Set pppp.item(i) = aVar
                                Dim aaa As GuiM2000
                                Set aaa = aVar
                                Set aaa.EventObj = mmmm
                                Set aaa = Nothing
                                With aVar
                                 .MyName = what$
                                 .ModuleName = here$
                                 .ByPass = bp
                                 .TITLE = what$ + "(" + LTrim(Str$(i)) + ")"
                                 .index = i
                                End With
                                Next i
                         End If
                         pppp.IHaveGui = True
                         Set mmmm = Nothing
                    End If
                    End If
         
 ElseIf IsLabelSymbolNew(rest$, "ΠΛΗΚΤΡΟ", "BUTTON", lang) Then
        If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 2
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .Caption = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 2
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
ElseIf IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗ", "TEXTBOX", lang) Then
        If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 3
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .SetUp
                        .Text = what$
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 3
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΕΠΙΛΟΓΗ", "CHECKBOX", lang) Then
         If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 4
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .Caption = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 4
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΚΕΙΜΕΝΟ", "EDITBOX", lang) Then
          If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 5
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 1200
                        If alfa.prive <> 0 Then
                            .Linespace = players(alfa.prive).uMineLineSpace
                        Else
                            .Linespace = players(0).uMineLineSpace
                        End If
                        .SetUp
                        .Text = what$
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 5
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 1200
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΛΙΣΤΑ", "LISTBOX", lang) Then
 If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 6
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                        .ListText = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 6
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΛΙΣΤΑ.ΕΙΣΑΓΩΓΗΣ", "COMBOBOX", lang) Then
 If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 7
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                             '   If alfa.prive <> 0 Then
                              '      .Linespace = players(alfa.prive).uMineLineSpace
                               ' Else
                                '    .Linespace = players(0).uMineLineSpace
                                'End If
                        '.ListText = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 7
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                               ' .Construct alfa, what$
                                .Move 0, 2000, 6000, 600
                         '       If alfa.prive <> 0 Then
                          '          .Linespace = players(alfa.prive).uMineLineSpace
                           '     Else
                            '        .Linespace = players(0).uMineLineSpace
                             '   End If
                              '  .ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
    End If
End Function

Sub ProcMethodArray(bstack As basetask, pppp As mArray, index As Long, co$, rest$, lang As Long, ifier0 As Boolean)
Dim VR(1)
Set VR(0) = pppp.item(index)
On Error Resume Next
ProcMethod bstack, VR(), 0, co$, rest$, lang
 ifier0 = Err = 0
          Err.Clear
End Sub
Sub ProcPropertyArray(bstack As basetask, pppp As mArray, index As Long, co$, rest$, lang As Long, ifier0 As Boolean)
        Dim VR(1)
        Set VR(0) = pppp.item(index)
        On Error Resume Next
          ProcProperty bstack, VR(), 0, co$, rest$, lang, True
  ifier0 = Err = 0
          Err.Clear
End Sub
Private Function ProcPtr(ByVal nAddress As Long) As Long
    ProcPtr = nAddress
End Function

Function CallByPtr(nSubAddress As Long, basestack As basetask, rest$, lang As Long) As Boolean
Dim resp As Boolean
If TaskMaster.PlayMusic Then
                    TaskMaster.OnlyMusic = True
                        TaskMaster.TimerTick
                        TaskMaster.OnlyMusic = False
End If
CallWindowProc nSubAddress, VarPtr(basestack), VarPtr(rest$), VarPtr(lang), VarPtr(resp)
CallByPtr = resp
End Function
Sub NeoInput(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyInput(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoEvent(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = myEvent(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoWait(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim basestack As basetask, p As Double
Set basestack = ObjFromPtr(basestackLP)
If IsExp(basestack, rest$, p) Then
mywait basestack, p
Else
mywait basestack, 0
End If
Set basestack = Nothing
resp = True
End Sub
Sub NeoModule(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyModule(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoModules(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyModules(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoGroup(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcGroup(0, ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoBack(basestackLP As Long, rest$, lang As Long, resp As Boolean)
ProcBackGround ObjFromPtr(basestackLP), rest$, lang, resp
End Sub
Sub NeoOver(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcOver(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoDrop(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcDrop(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoShift(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcShift(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoShiftBack(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcShiftBack(ObjFromPtr(basestackLP), rest$)
End Sub
Sub CallNext(basestack As basetask, rest$, resp As Boolean, V1 As Double, V2 As String)
Dim i As Long, p As Double, par As Boolean, f As Long
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
reenter1:

i = Abs(IsLabel(basestack, rest$, what$))
If i = 3 And Len(rest$) > 0 Then
If AscW(rest$) = 46 Then
If Not IsStrExp(basestack, (what$), what$) Then MissPar:  Exit Sub
rest$ = what$ + rest$
GoTo reenter1
End If
End If
' call function as module
'**********************************************************

    ss$ = what$ & ")"
    
     If FastSymbol(rest$, ",") Then
    
    End If
    ''ss$ = myUcase$(ss$)

    resp = True
    MakeThisSub basestack, ss$
    it = CLng(GetSub(ss$, x1))
    
    If Not it Then it = CLng(GetlocalSub(ss$, x1))
 
    If it Then
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        If Not TheSame(here$, ss$) Then Set bs.Sorosref = basestack.soros
        Set bs.Owner = basestack.Owner
            ' bs.UseGroupname = sbf(x1).sbgroup
             bs.OriginalCode = x1
             If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
             Call GoFunc(bs, ss$, rest$, vvl, , x1)
             Else
             bs.UseGroupname = sbf(x1).sbgroup
        Call GoFunc(bs, ss$, rest$, vvl)
        End If
            If Not bs.StaticCollection Is Nothing Then
        basestack.SetVarobJ "%_" + ss$, bs.StaticCollection
        End If
        Set bs = Nothing
        If Not par Then
        If Typename(vvl) = "Empty" Then resp = False: Exit Sub
        If InStr(ss$, "$") > 0 Then
   
        V2 = CStr(vvl)
        Else
        
            V1 = CDbl(vvl)
   
        End If
        End If
        Else
        ' ??
        End If
End Sub

Sub NeoCall(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim basestack As basetask, i As Long, p As Double, par As Boolean, f As Long
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
Set basestack = ObjFromPtr(basestackLP)
resp = True
If FastSymbol(rest$, "!") Then basestack.nokillvars = True
par = False: f = 0
If IsLabelSymbolNew(rest$, "ΚΕΝΗ", "VOID", lang) Then par = True
If IsLabelSymbolNew(rest$, "ΕΞΩΤΕΡΙΚΗ", "EXTERN", lang) Then
' NOW WE HAVE TO GET THE NUMBER
basestack.nokillvars = False
If IsExp(basestack, rest$, p) Then
' WE HAVE THE NUMBER, BUT IS f OUR OBJECT???
i = CLng(p)
If i >= 0 Or i <= p Then
If Typename(var(i)) = "stdCallFunction" Then
CallByObject basestack, i, Not par
Set basestack = Nothing

Exit Sub
ElseIf Typename(var(i)) = "lambda" Then
' call lamda
            PushStage basestack, False
            flag = False
            it = 1
            rest$ = ""
            Dim aa As lambda
            var(i).name = here$
            
            var(i).CopyToVar basestack, here$ = "", var()
            'sbf(0).sb = var(i).code$
            basestack.OriginalCode = 0
            basestack.FuncRec = subHash.LastKnown
               Call executeblock(it, basestack, var(i).code$, False, flag)
               var(i).CopyFromVar basestack, var()
          If it = 0 Then
                    Set basestack.lastobj = Nothing
                    Set basestack.FuncObj = Nothing
                    basestack.ThrowThreads
                    MyErMacro rest$, "Problem in lambda", "Πρόβλημα στη λάμδα"
                    PopStage basestack
                    Set basestack = Nothing

                    Exit Sub
             End If
            PopStage basestack
            Set basestack = Nothing

            Exit Sub
Else
' INVALID FUNCTION HANDLE
End If

Else
' INVALID FUNCTION HANDLE
End If
Else
'WRONG...
End If
ElseIf IsLabelSymbolNew(rest$, "ΓΕΓΟΝΟΣ", "EVENT", lang) Then
    i = Abs(IsLabel(basestack, rest$, what$))
    If i = 1 Then
        If Not GetVar(basestack, basestack.GroupName & what$, i) Then
            MissPar
        Else
            If Typename(var(i)) <> "mEvent" Then
                  MyEr "Can't find Event", "Δεν μπορώ να βρω Γεγονός"
            Else
               resp = CallEvent(basestack, rest$, lang, i)
  
            End If
        End If
    Else
        MissPar
    End If
    Set basestack = Nothing

    Exit Sub
Else
flag = IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", lang)
If IsLabelSymbolNew(rest$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", lang) Then f = 3

reenter1:

i = Abs(IsLabel(basestack, rest$, what$))
If i = 3 And Len(rest$) > 0 Then
If AscW(rest$) = 46 Then
If Not IsStrExp(basestack, (what$), what$) Then MissPar: Set basestack = Nothing:  Exit Sub
rest$ = what$ + rest$
GoTo reenter1
End If
End If
If i = 0 Or i = 2 Then
If i = 0 Then
If Not IsStrExp(basestack, rest$, what$) Then MissPar: Set basestack = Nothing:  Exit Sub
End If
s$ = what$
i = Abs(IsLabel(basestack, s$, what$))

If i = 0 Then

If FastSymbol(s$, "{") Then
reenter2:
 ss$ = block(s$)
 If FastSymbol(s$, "}") And ss$ <> "" Then
PushStage basestack, False
x1 = GlobalSub("A_()", ss$, Trim$(s$))
 Set bs = New basetask
     bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
    If par Then
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       Else
       '' no static for this type of call
       
       bs.OriginalName = "()"
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       If Not vvl = Empty Then
       vvl = CStr(vvl)
       x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
       End If
       End If
       ' If Not bs.StaticCollection Is Nothing Then
       ' basestack.SetVarobJ "%_" + what$, bs.StaticCollection
       ' End If
        ''
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
        
    resp = True
PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
End If
rest$ = s$ + rest$
End If
If f > 0 And i < 5 Then i = i + 4: what$ = what$ & "("
If i = 1 Then
    If FastSymbol(rest$, ",") Then
    End If

    
    MakeThisSub basestack, what$
   it = GetlocalSub(what$, x1)
  
    If Not it Then it = GetSub(what$, x1)
 If Not it Then
 If here$ = what$ Then
  it = True: x1 = basestack.OriginalCode
 Else
 For i = -iRVAL(here$, 0) To -1
 
    it = GetSub(RVAL2(here$, i) + what$, x1)
    If it Then Exit For
    Next i
   End If
  If it = 0 Then
 If StripThis(here$) = what$ Then
 it = True: x1 = basestack.OriginalCode
 End If
 End If
 End If

    If it Then
     Set bs = New basetask
     bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1

        If here$ = "" Then
        here$ = what$
        Call GoFunc(bs, what$, rest$, vvl, , x1)
        here$ = ""
        ElseIf x1 >= 0 Then
       ' Call GoFunc(bs, "", rest$, vvl, , x1)
          If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
             Call GoFunc(bs, "()", rest$, vvl, , x1)
             Else
             bs.UseGroupname = sbf(x1).sbgroup
        Call GoFunc(bs, "", rest$, vvl, , x1)
        End If
        Else
       Call GoFunc(bs, what$, rest$, vvl)
       End If

        If Not bs.StaticCollection Is Nothing Then
        basestack.SetVarobJ "%_" + what$, bs.StaticCollection
        End If
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
        Else
         rest$ = ":" & what$ & " " & rest$
    End If
    resp = True

  Set basestack = Nothing:  Exit Sub
ElseIf i = 3 Then
    'If FastSymbol(rest$, ",") Then
    
   ' End If
    If IsStrExp(basestack, what$, s$) Then
    If Len(s$) > 0 Then
    If FastSymbol(s$, "{") Then GoTo reenter2
     rest$ = s$ & rest$
    
      GoTo reenter1
      Else
      basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
      End If
    Else
        ' error
        basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
    End If
ElseIf i > 3 Then
' call function as module
'**********************************************************

    ss$ = what$ & ")"
    
     If FastSymbol(rest$, ",") Then
    
    End If
    ''ss$ = myUcase$(ss$)

    
    MakeThisSub basestack, ss$
    it = CLng(GetSub(ss$, x1))
    
    If Not it Then it = CLng(GetlocalSub(ss$, x1))
 
    If it Then
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        If Not TheSame(here$, ss$) Then Set bs.Sorosref = basestack.soros
        Set bs.Owner = basestack.Owner
            ' bs.UseGroupname = sbf(x1).sbgroup
             bs.OriginalCode = x1
             If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
             Call GoFunc(bs, ss$, rest$, vvl, , x1)
             Else
             bs.UseGroupname = sbf(x1).sbgroup
        Call GoFunc(bs, ss$, rest$, vvl)
        End If
            If Not bs.StaticCollection Is Nothing Then
        basestack.SetVarobJ "%_" + ss$, bs.StaticCollection
        End If
        Set bs = Nothing
        If Not par Then
        If InStr(ss$, "$") > 0 Then
            If vvl <> "" Then  ' no zero we have error
            x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            basestack.nokillvars = False
            

            Set basestack = Nothing: Exit Sub
            End If
        Else
            If val(vvl) <> 0 Then  ' no zero we have error
                MyEr "ERROR " & Trim$(Str$(val(vvl))), "ΛΑΘΟΣ " & Trim$(Str$(val(vvl)))
                resp = False
                basestack.nokillvars = False
                Set basestack = Nothing

               Set basestack = Nothing:  Exit Sub
            End If
        End If
        End If
    Else
    rest$ = ""
    End If
ElseIf IsStrExp(basestack, rest$, s$) Then
If f = 3 Then s$ = s$ & "("
If FastSymbol(rest$, ",") Then
End If
If s$ <> "" Then
If InStr(s$, ").") > 0 And f <> 3 Then
If Right$(s$, 1) = ")" Then

rest$ = s$ & " " & rest$

GoTo reenter1
Else

rest$ = ": " + s$ & " " & rest$
End If
Else
If Right$(s$, 1) = ")" Then

rest$ = Left$(s$, Len(s$) - 1) & " " & rest$

Else

rest$ = s$ & " " & rest$
End If
GoTo reenter1
End If
End If
Else
rest$ = ": " & rest$
End If
End If
basestack.nokillvars = False
Set basestack = Nothing

End Sub
Sub NeoSwap(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MySwap(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoComm(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyRead(3, ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoRef(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyRead(2, ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoRead(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyRead(1, ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoReport(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyReport(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoDeclare(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyDeclare(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoMethod(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyMethod(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoWith(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyWith(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoSprite(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim s$
If IsStrExp(ObjFromPtr(basestackLP), rest$, s$) Then sprite ObjFromPtr(basestackLP), s$, rest$
resp = True
End Sub

Sub NeoPlayer(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcPlayer(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoPrinter(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcPrinter(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoPage(basestackLP As Long, rest$, lang As Long, resp As Boolean)
ProcPage ObjFromPtr(basestackLP), rest$, lang
resp = True
End Sub
Sub NeoCompact(basestackLP As Long, rest$, lang As Long, resp As Boolean)
BaseCompact ObjFromPtr(basestackLP), rest$
resp = True
End Sub
Sub NeoLayer(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcLayer(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoOrder(basestackLP As Long, rest$, lang As Long, resp As Boolean)
MyOrder ObjFromPtr(basestackLP), rest$
resp = True
End Sub

Sub NeoDelete(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = DELfields(ObjFromPtr(basestackLP), rest$)
'resp = True  '' maybe this can be change
End Sub
Sub NeoAppend(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim s$, p As Double
resp = True
If IsExp(ObjFromPtr(basestackLP), rest$, p) Then
resp = AddInventory(ObjFromPtr(basestackLP), rest$)
ElseIf IsStrExp(ObjFromPtr(basestackLP), rest$, s$) Then
append_table ObjFromPtr(basestackLP), s$, rest$, False
Else
SyntaxError
resp = False
End If
End Sub
Sub NeoSearch(basestackLP As Long, rest$, lang As Long, resp As Boolean)
getrow ObjFromPtr(basestackLP), rest$, , "", lang
resp = True
End Sub
Sub NeoRetr(basestackLP As Long, rest$, lang As Long, resp As Boolean)
getrow ObjFromPtr(basestackLP), rest$, , , lang
resp = True
End Sub
Sub NeoExecute(basestackLP As Long, rest$, lang As Long, resp As Boolean)
If IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", lang) Then
 resp = ExecCode(ObjFromPtr(basestackLP), rest$)
 Else
CommExecAndTimeOut ObjFromPtr(basestackLP), rest$
resp = True
End If

End Sub

Sub NeoTable(basestackLP As Long, rest$, lang As Long, resp As Boolean)
NewTable ObjFromPtr(basestackLP), rest$
resp = True
End Sub
Sub NeoBase(basestackLP As Long, rest$, lang As Long, resp As Boolean)
NewBase ObjFromPtr(basestackLP), rest$
resp = True
End Sub
Sub NeoHold(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcHold()
End Sub
Sub NeoRelease(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcRelease()
End Sub

Sub NeoClass(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcClass(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoDIM(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyDim(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoPathDraw(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcPath(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoDrawings(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyDrawings(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoFill(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcFill(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoFloodFill(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcFLOODFILL(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoTextCursor(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyCursor(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoMouseIcon(basestackLP As Long, rest$, lang As Long, resp As Boolean)
i3MouseIcon ObjFromPtr(basestackLP), rest$, lang
resp = True
End Sub
Sub NeoDouble(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim bstack As basetask
Set bstack = ObjFromPtr(basestackLP)
SetDouble bstack.Owner
Set bstack = Nothing
resp = True
End Sub
Sub NeoNormal(basestackLP As Long, rest$, lang As Long, resp As Boolean)
Dim bstack As basetask
Set bstack = ObjFromPtr(basestackLP)
SetNormal bstack.Owner
Set bstack = Nothing
resp = True
End Sub
Sub NeoSort(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcSort(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoImage(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcImage(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoBitmaps(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyBitmaps(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoMovies(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyMovies(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoSounds(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MySounds(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoPen(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcPen(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoCls(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcCls(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoStructure(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = myStructure(ObjFromPtr(basestackLP), rest$, lang)

End Sub
Function myStructure(basestack As basetask, rest$, lang As Long) As Boolean
Dim base As String
If IsStrExp(basestack, rest$, base) Then
    TABLENAMES base, basestack, rest$, lang
    myStructure = True
Else
    myStructure = makestruct(basestack, rest$, lang)
End If
End Function
Function makestruct(basestack As basetask, rest$, lang As Long) As Boolean
Dim what$, offset As Long, offset1 As Long, offsetlist As FastCollection, i As Long, s$, b$, p As Double, w2 As Long

' struct is an inventory of offsets
If Abs(IsLabel(basestack, rest$, what$)) = 1 Then  ' WE HAVE A NAME
If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
          If GetlocalVar(basestack.GroupName & what$, i) Then
                        If Not IsObject(var(i)) Then MakeitObjectInventory var(i)
                    ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
                        If Not IsObject(var(i)) Then MakeitObjectInventory var(i)
                    Else
                        i = GlobalVar(basestack.GroupName & what$, s$)
                        MakeitObjectInventory var(i)
                    End If
Set offsetlist = var(i).objref
' so now we have the inventory
If FastSymbol(rest$, "{") Then
    If StructPage(basestack, rest$, lang, 0, offset, offsetlist, "") Then
    offsetlist.StructLen = offset
    var(i).ReadOnly = True
    makestruct = True
    End If
End If
Set offsetlist = Nothing
End If
End Function
Function StructPage(basestack As basetask, rest$, lang As Long, ByVal offset, ByRef offset2, offsetlist As FastCollection, ByVal lasthead$) As Boolean
Dim what$, offset1 As Long, i As Long, s$, b$, p As Double, w2 As Long, maxoffset As Long, probeoffset As Long

    b$ = NLtrim$(block(rest$))
   If Not FastSymbol(rest$, "}") Then Exit Function
again:
    If FastSymbol(b$, vbCrLf, , 2) Then
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = ""
AGAIN1:
    If MaybeIsSymbol(b$, "\'") Then
    
    SetNextLineNL b$
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = ""
 
    GoTo AGAIN1
    ElseIf FastSymbol(b$, "{") Then
    ' IS A NEW PAGE
    probeoffset = 0
    If StructPage(basestack, b$, lang, offset, probeoffset, offsetlist, lasthead$) Then
        If probeoffset > maxoffset Then maxoffset = probeoffset
        ' leave offset as is
    GoTo again
    Else
    Exit Function
    End If
    ElseIf Abs(IsLabelOnly(b$, what$)) = 1 Then
    Do
    '' check type, or by default use 2
    If IsLabelSymbolNew(what$, "ΔΟΜΗ", "STRUCTURE", lang, , , , False) Then
    If Abs(IsLabelOnly(b$, what$)) = 1 Then
    If FastSymbol(b$, "{") Then
        probeoffset = 0
        If offsetlist.ExistKey(lasthead$ + what$) Then
        MyEr "double name is same struct", "διπλή εισαγωγή ονόματος"
        StructPage = False
        Set offsetlist = Nothing
        Exit Function
        End If

        If StructPage(basestack, b$, lang, offset, probeoffset, offsetlist, lasthead$ + what$ + ".") Then
            If probeoffset > maxoffset Then maxoffset = probeoffset
            ' leave offset as is
    
            offsetlist.AddKey myUcase(lasthead$ + what$, True), CVar(offset)
            If offsetlist.Done Then offsetlist.sValue = probeoffset - offset
        GoTo again
        Else
        Exit Function
        End If
    Else
        Exit Function
    End If
        Else
        Exit Function
    End If

    ElseIf IsLabelSymbolNew(b$, "ΩΣ", "AS", lang, , , , False) Then
                        If IsLabelSymbolNew(b$, "ΨΗΦΙΟ", "BYTE", lang, , , , False) Then
                                     offset1 = 1
                                ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", lang, , , , False) Then
                                     offset1 = 2
                                ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", lang, , , , False) Then
                                     offset1 = 4
                                ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", lang, , , , False) Then
                                     offset1 = 8
                                Else
                                If IsLabelOnly(b$, s$) Then
                                If IsExp(basestack, s$, p) Then
                                    If basestack.lastobj Is Nothing Then GoTo comehere
                                    If Not TypeOf basestack.lastobj Is mHandler Then GoTo comehere
                                    If Not TypeOf basestack.lastobj.objref Is FastCollection Then GoTo comehere
                                    If basestack.lastobj.objref.StructLen = 0 Then GoTo comehere
                                offset1 = basestack.lastobj.objref.StructLen
                                    Set basestack.lastobj = Nothing
                                    Else
                                    GoTo comehere
                                End If
                                Else
comehere:
                                    SyntaxError
                 
                                   Exit Function
                                   End If
                                   End If
    
    Else
    
    offset1 = 2
    End If
    w2 = offset1
    p = 1
    If FastSymbol(b$, "*") Then
    If Not IsExp(basestack, b$, p) Then
           MissNumExpr
        Exit Function
    Else
    p = Int(p)
    If p * offset1 + offset > &H1FFFFFFF Then  ' half gigabyte for struct (is very big too)
        MyEr "Too big number for struct", "Μεγάλο νούμερο για δομή"
        Exit Function
    ElseIf p < 0 Then
        MyEr "Too big number for struct", "Μεγάλο νούμερο για δομή"
        Exit Function
    Else
        offset1 = offset1 * CLng(p)
    End If
    End If
    End If
    If offsetlist.ExistKey(lasthead$ + what$) Then
    MyEr "double name is same struct", "διπλή εισαγωγή ονόματος"
    StructPage = False
    Set offsetlist = Nothing
    Exit Function
    End If
    
    offsetlist.AddKey myUcase(lasthead$ + what$, True), CVar(offset)
    If offsetlist.Done Then offsetlist.sValue = w2
    offset = offset + offset1
    SetNextLineNL b$
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = ""
    Loop Until Not Abs(IsLabelOnly(b$, what$)) = 1
        If maxoffset < offset Then
    offset2 = offset
    Else
    offset2 = maxoffset
    End If
    StructPage = True
    GoTo AGAIN1
   End If
    If maxoffset < offset Then
    offset2 = offset
    Else
    offset2 = maxoffset
    End If
    StructPage = True
   
    If offset2 < maxoffset Then
        offset2 = maxoffset
        StructPage = True
    End If
    End If
    

End Function
Sub NeoText(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcText(ObjFromPtr(basestackLP), False, rest$)
End Sub
Sub NeoHtml(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcText(ObjFromPtr(basestackLP), True, rest$)
End Sub

Sub NeoCurve(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcCurve(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoPoly(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcPoly(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoCircle(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcCircle(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoNew(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyNew(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoTitle(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcTitle(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoDraw(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcDraw(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoWidth(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcDrawWidth(ObjFromPtr(basestackLP), rest$)
End Sub

Sub NeoMove(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcMove(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoStep(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcStep(ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoPrint(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = RevisionPrint(ObjFromPtr(basestackLP), rest$, 0, lang)
End Sub
Sub NeoCopy(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyCopy(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoPrinthEX(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = RevisionPrint(ObjFromPtr(basestackLP), rest$, 1, lang)
End Sub
Sub NeoRem(basestackLP As Long, rest$, lang As Long, resp As Boolean)
    SetNextLineNL rest$
    resp = True
End Sub
Sub NeoPush(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyPush(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoData(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyData(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoClear(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyClear(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoLinespace(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = procLineSpace(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoSet(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = interpret(ObjFromPtr(basestackLP), GetNextLine(rest$))
End Sub


Sub NeoBold(basestackLP As Long, rest$, lang As Long, resp As Boolean)
ProcBold ObjFromPtr(basestackLP), rest$
resp = True
End Sub
Sub NeoChooseObj(basestackLP As Long, rest$, lang As Long, resp As Boolean)
    resp = ProcChooseObj(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoChooseFont(basestackLP As Long, rest$, lang As Long, resp As Boolean)
    ProcChooseFont ObjFromPtr(basestackLP), lang
    resp = True
End Sub
Sub NeoFont(basestackLP As Long, rest$, lang As Long, resp As Boolean)
    ProcChooseFont ObjFromPtr(basestackLP), lang
    resp = True
End Sub
Sub NeoScore(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyScore(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoPlayScore(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyPlayScore(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoMode(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcMode(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoGradient(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcGradient(ObjFromPtr(basestackLP), rest$)
End Sub
Sub NeoFunction(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyFunction(0, ObjFromPtr(basestackLP), rest$, lang)
End Sub

Sub NeoFiles(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcFiles(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoCat(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = ProcCat(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Sub NeoLet(basestackLP As Long, rest$, lang As Long, resp As Boolean)
resp = MyLet(ObjFromPtr(basestackLP), rest$, lang)
End Sub
Function MyLet(bstack As basetask, rest$, lang As Long) As Boolean
Dim what$, ss$, i As Long, x1 As Long, flag As Boolean
MyLet = True
Do
    x1 = IsLabel(bstack, rest$, what$)
    If x1 <> 0 Then
            If x1 > 4 Then
                    ss$ = BlockParam(rest$)
                    what$ = what$ + ss$ + ")"
                    rest$ = Mid$(rest$, Len(ss$) + 2)
                    Do While IsSymbol(rest$, ".")
                    x1 = IsLabel(bstack, rest$, ss$)
                    If x1 > 0 Then what$ = what$ + "." + ss$ Else Exit Do
                            If x1 > 4 Then
                            ss$ = BlockParam(rest$)
                            what$ = what$ + ss$ + ")"
                            rest$ = Mid$(rest$, Len(ss$) + 2)
                            End If
                    Loop
            End If
    
If FastSymbol(rest$, "=") Then

    i = 1
    aheadstatus rest$, False, i
    If i > 1 Then
ss$ = Left$(rest$, i - 1)
                'I2 bstack, "PUSH", ss$, flag, lang
                flag = MyPush(bstack, ss$)
                If LastErNum = -2 Then
                rest$ = ss$ + Mid$(rest$, i)
                MyLet = flag
                Exit Function
                End If
              If MyLet Then
            ' MyLet = Identifier(bstack, "@READ", what$)
             MyLet = MyRead(1, bstack, what$, 1)
             rest$ = Mid$(rest$, i)
             Else
             MyEr "Nothig to assign", "Τίποτα για να δώσω"
             Exit Function
             End If
    Else
            MyEr "Expecting expression", "Περίμενα έκφραση"
            MyLet = False
    End If
  
End If

End If
Loop Until Not FastSymbol(rest$, ",")
End Function
Function MyThread(bstack As basetask, rest$, lang As Long) As Boolean
Dim frm$, ss$, what$, i As Long, p As Double, x As Double, par As Boolean, bs As basetask
MyThread = True
     If FastSymbol(rest$, "{") Then
        frm$ = NLtrim$(block(rest$))
        If FastSymbol(rest$, "}") Then
                par = False
                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
                Else
                    MyEr "can't find clause AS variable_name", "δεν μπορώ να βρώ το μέρος ΩΣ ονομα_μεταβλητής"
                   
                    MyThread = False
               
                    Exit Function
                End If
                Select Case Abs(IsLabel(bstack, rest$, what$)) ' is Ifier
                Case 1
                        p = GetTaskId + 20000
                        If GetVar(bstack, what$, i) Then ' if exist
                            var(i) = p
                        Else
                            GlobalVar what$, p     ' or make one
                        End If
                        Set bs = New basetask   ' bs is the basetask of the thread but thread process class arn't constructed yet
                        Set bs.Parent = bstack  ' link to current basestask
      
                        bs.reflimit = bstack.reflimit
                        bstack.PushThread CLng(p), what$  'push thread id and Ifier to threads collection in current basetask
                        sThreadInternal bs, p, 0, frm$, uintnew(-1), here$, False ' thread construction - also we have a connection to
                        
                        
                        Set bs = Nothing
                        ss$ = ""
                        If IsLabelSymbolNewExp(rest$, "ΚΑΘΕ", "INTERVAL", lang, ss$) Then
                        GoTo chekInterval
                        ElseIf IsLabelSymbolNewExp(rest$, "ΕΚΤΕΛΕΣΗ", "EXECUTE", lang, ss$) Then
                        TaskMaster.Message CLng(p), 4, , rest$
                        End If
                Case Else
                       MissingnumVar
                        
                        MyThread = False
  
                     Exit Function
                End Select
        End If
ElseIf IsExp(bstack, rest$, p) Then
ss$ = ""
    If IsLabelSymbolNewExp(rest$, "ΣΒΗΣΕ", "ERASE", lang, ss$) Then
        bstack.ThrowOne CLng(p)
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΑΤΑ", "HOLD", lang, ss$) Then
        TaskMaster.Message CLng(p), 0
    ElseIf IsLabelSymbolNewExp(rest$, "ΕΚΤΕΛΕΣΗ", "EXECUTE", lang, ss$) Then
     TaskMaster.Message CLng(p), 4, , rest$
    ElseIf IsLabelSymbolNewExp(rest$, "ΞΕΚΙΝΑ", "RESTART", lang, ss$) Then
        TaskMaster.Message CLng(p), 2
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΑΘΕ", "INTERVAL", lang, ss$) Then
chekInterval:
        If IsExp(bstack, rest$, x) Then
            If x < 2 Then x = 2
            TaskMaster.Message CLng(p), 3, CLng(x)
        Else
            MyEr "Expected number for interval, miliseconds", "Περίμενα αριθμό για ορισμό τακτικού διαστήματος εκκίνησης νήματος (χρόνο σε χιλιοστά δευτερολέπτου)"
           
            MyThread = False
        End If
    Else
        MyEr "can't find ERASE or HOLD or RESTART or INTERVAL clause", "Δεν μπορώ να βρω όρο όπως το ΣΒΗΣΕ ή το ΚΡΑΤΑ ή το ΞΕΚΙΝΑ ή το ΚΑΘΕ"
      
        MyThread = False

    End If
End If
what$ = ""
End Function
Private Function ObjFromPtr(ByVal Ptr As Long) As Object
    ObjSetAddRef ObjFromPtr, Ptr
End Function
Sub ProcBold(bstack As basetask, rest$)
Dim p As Double
If IsExp(bstack, rest$, p) Then
bstack.myBold = (p <> 0)
Else
bstack.myBold = Not bstack.myBold
p = CDbl(bstack.myBold)
End If
players(GetCode(bstack.Owner)).bold = Abs(p <> 0)
bstack.Owner.Font.bold = Abs(p <> 0)

End Sub
Sub ProcChooseFont(bstack As basetask, lang As Long)
If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
DialogSetupLang lang
With bstack.Owner
    ReturnFontName = .Font.name
    ReturnBold = .Font.bold
    ReturnItalic = .Font.Italic
    ReturnSize = CSng(.Font.Size)
    ReturnCharset = .Font.charset
End With
FeedFont2Stack bstack, OpenFont(bstack, Form1)

End Sub
Function ProcGradient(bstack As basetask, rest$) As Boolean
Dim x As Double, y As Double, p As Double
ProcGradient = True
If Not IsExp(bstack, rest$, x) Then x = rgb(255, 255, 255)
If Not FastSymbol(rest$, ",") Then
y = 0
Else
If Not IsExp(bstack, rest$, y) Then y = 0
End If
If Not FastSymbol(rest$, ",") Then

Gradient bstack.Owner, mycolor(x), mycolor(y), 0, 0, 0, 0, True, False


Else
If Not IsExp(bstack, rest$, p) Then
ProcGradient = IfierVal: Exit Function
Else
Gradient bstack.Owner, mycolor(x), mycolor(y), 0, 0, 0, 0, p <> 0, False


End If
End If

End Function
Function ProcMode(bstack As basetask, rest$) As Boolean
Dim scr As Object, p As Double, x1 As Long, y1 As Long
Dim prive As Long
ProcMode = True
'' Kform is global
Kform = True
On Error Resume Next
Set scr = bstack.Owner
With players(GetCode(scr))
x1 = scr.Width
y1 = scr.Height
If scr.name = "GuiM2000" Then
    Else
If scr.name = "Form1" Then
DisableTargets q(), -1

ElseIf scr.name = "DIS" Then
DisableTargets q(), 0

ElseIf scr.name = "dSprite" Then
DisableTargets q(), val(scr.index)
End If
End If
If IsExp(bstack, rest$, p) Then
.SZ = CSng(p)
If .SZ < 4 Then .SZ = 4
If Not bstack.toprinter Then
If FastSymbol(rest$, ",") Then
    If IsExp(bstack, rest$, p) Then x1 = CLng(p): y1 = CLng(x1 * ScrY() / ScrX())
    If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, p) Then y1 = CLng(p)
        
    End If
ElseIf FastSymbol(rest$, ";") Then
prive = GetCode(bstack.Owner)
.mysplit = 0
scr.Font.Size = .SZ
       SetText scr
        GetXYb scr, players(prive), .curpos, .currow

Set scr = Nothing
Exit Function
End If
Else
.SZ = .SZ * 3
End If
Err.Clear
scr.Font.Size = .SZ
If Err.Number > 0 Then

MYFONT = "ARIAL"
scr.Font.name = MYFONT
scr.Font.charset = bstack.myCharSet
scr.Font.name = MYFONT
scr.Font.charset = bstack.myCharSet
End If
.SZ = scr.Font.Size
     .uMineLineSpace = .MineLineSpace
    
 FrameText scr, .SZ, x1, y1, .Paper
 
    Else
    ProcMode = False
    Exit Function
    End If
    .currow = 0
    .curpos = 0
    .XGRAPH = 0
    .YGRAPH = 0
End With
Set scr = Nothing

End Function
Function ProcDrawWidth(bstack As basetask, rest$) As Boolean
Dim x As Double, p As Double, it As Long, ss$, frm$, i As Long, x1 As Long
ProcDrawWidth = True
Dim scr As Object
Set scr = bstack.Owner
If IsExp(bstack, rest$, p) Then
    i = scr.DrawWidth
    x1 = scr.DrawStyle
    scr.DrawWidth = p
    If p = 1 Then
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, x) Then
                On Error Resume Next
                x = Int(x)
                If x >= 0 Or x <= 6 Then
                    scr.DrawStyle = x
                    If Err Then x = 0: scr.DrawStyle = Int(x)
                    scr.DrawWidth = p
                End If
            End If
        End If
    End If
    If FastSymbol(rest$, "{") Then
        ss$ = "{" & block(rest$) & "}"
        frm$ = rest$
        If FastSymbol(rest$, "}") Then
            Call executeblock(it, bstack, ss$, False, False)
        End If
    End If
End If
scr.DrawWidth = i
scr.DrawStyle = x1
If it <> 1 Then
    If Trim(ss$) = "" Then ss$ = " "
    rest$ = Left$(ss$, Len(ss$) - 1) + frm$
    ProcDrawWidth = False
End If
Set scr = Nothing
End Function
Function ProcCurve(bstack As basetask, rest$, lang As Long) As Boolean
Dim par As Boolean, sx As Double, sy As Double, x As Double, y As Double, x1 As Integer, p As Double, f As Long

ProcCurve = True
With players(GetCode(bstack.Owner))
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", lang) Then par = True
f = 32
ReDim PLG(f)
x1 = 1
PLG(0).x = bstack.Owner.ScaleX(.XGRAPH, 1, 3)
PLG(0).y = bstack.Owner.ScaleY(.YGRAPH, 1, 3)
Do
If x1 >= f Then f = f * 2: ReDim Preserve PLG(f)
If IsExp(bstack, rest$, p) Then
x = p

If Not FastSymbol(rest$, ",") Then ProcCurve = False: MissNumExpr: Exit Function
If IsExp(bstack, rest$, p) Then
If par Then
sx = x / PI2
sx = (sx - Fix(sx)) * PI2
.XGRAPH = .XGRAPH + Cos(sx) * p
.YGRAPH = .YGRAPH - Sin(sx) * p
Else
.XGRAPH = .XGRAPH + CLng(x)
.YGRAPH = .YGRAPH + CLng(p)
End If
PLG(x1).x = bstack.Owner.ScaleX(.XGRAPH, 1, 3)
PLG(x1).y = bstack.Owner.ScaleY(.YGRAPH, 1, 3)

Else
 ProcCurve = False: MissNumExpr: Exit Function
End If
Else
 ProcCurve = False: MissNumExpr: Exit Function
End If

x1 = x1 + 1
Loop Until Not FastSymbol(rest$, ",")
x1 = x1 - 1

If PolyBezier(bstack.Owner.hDC, PLG(0), x1 + 1) = 0 Then
BadGraphic
 Exit Function
End If
bstack.Owner.FillStyle = vbSolid
End With
MyDoEvents1 bstack.Owner


End Function

Function ProcPoly(bstack As basetask, rest$, lang As Long) As Boolean
Dim par As Boolean, sx As Double, sy As Double, x As Double, y As Double, x1 As Integer, p As Double, f As Long
Dim col As Long, scr As Object
ProcPoly = True


Set scr = bstack.Owner
If IsExp(bstack, rest$, p) Then
col = p
End If
If Not FastSymbol(rest$, ",") Then SyntaxError: ProcPoly = False: Exit Function
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", lang) Then par = True
scr.FillStyle = vbSolid
scr.FillColor = mycolor(col)
f = 32
ReDim PLG(f)
x1 = 1
With players(GetCode(scr))
PLG(0).x = scr.ScaleX(.XGRAPH, 1, 3)
PLG(0).y = scr.ScaleY(.YGRAPH, 1, 3)
Do
If x1 >= f Then f = f * 2: ReDim Preserve PLG(f)
If IsExp(bstack, rest$, p) Then
x = p

If Not FastSymbol(rest$, ",") Then SyntaxError: ProcPoly = False: Set scr = Nothing: Exit Function
    If IsExp(bstack, rest$, p) Then
        If par Then
      
            sx = x / PI2
            sx = (sx - Fix(sx)) * PI2
            .XGRAPH = .XGRAPH + Cos(sx) * p
            .YGRAPH = .YGRAPH - Sin(sx) * p
        Else
            .XGRAPH = .XGRAPH + CLng(x)
            .YGRAPH = .YGRAPH + CLng(p)
        End If
        PLG(x1).x = scr.ScaleX(.XGRAPH, 1, 3)
        PLG(x1).y = scr.ScaleY(.YGRAPH, 1, 3)
    
    Else
         MissNumExpr
         Set scr = Nothing
        ProcPoly = False: Exit Function
    End If
Else
MissNumExpr
Set scr = Nothing
ProcPoly = False: Exit Function
End If

x1 = x1 + 1
Loop Until Not FastSymbol(rest$, ",")
x1 = x1 - 1
If Polygon(scr.hDC, PLG(0), x1) = 0 Then
ProcPoly = True: BadGraphic: Set scr = Nothing: Exit Function
End If
scr.FillStyle = vbSolid
End With
MyDoEvents1 scr
Set scr = Nothing
End Function
Function ProcCircle(bstack As basetask, rest$, lang As Long) As Boolean
Dim par As Boolean, sx As Double, sy As Double, x As Double, y As Double, x1 As Integer, p As Double
Dim col As Long, scr As Object
ProcCircle = True
par = False
If IsLabelSymbolNew(rest$, "ΓΕΜΙΣΜΑ", "FILL", lang) Then
If IsExp(bstack, rest$, p) Then x = p
If Not FastSymbol(rest$, ",") Then MissNumExpr: ProcCircle = False: Exit Function
par = True
End If
x1 = 0
y = 1

With players(GetCode(bstack.Owner))
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MissNumExpr: ProcCircle = False: Exit Function
sx = 0
sy = 0
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sx = p Else MissNumExpr: ProcCircle = False: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sy = p Else MissNumExpr: ProcCircle = False: Exit Function
sx = sx / PI2
sx = (sx - Fix(sx)) * PI2
sy = sy / PI2
sy = (sy - Fix(sy)) * PI2
Set scr = bstack.Owner
scr.CurrentX = .XGRAPH
scr.CurrentY = .YGRAPH
If par Then
    scr.FillStyle = vbSolid
    scr.FillColor = mycolor(x)
    If sx = sy Or Abs(sx - sy) + 0.0001 > PI2 Then
        scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), , , y
    Else
        If sx = 0 Then sx = 0.0001
        If sy = 0 Then sy = PI2
        scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), -sx, -sy, y
    End If
    scr.FillStyle = 1
Else
    scr.FillStyle = 1
    scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), sx, sy, y
End If
End With
MyDoEvents1 scr
Set scr = Nothing

End Function
Function ProcDraw(bstack As basetask, rest$, lang As Long) As Boolean
Dim col As Long, x1 As Long, sx As Double, sy As Double, f As Long, y1 As Long
Dim p As Double, scr As Object
ProcDraw = True
With players(GetCode(bstack.Owner))
x1 = 0
y1 = 1
col = .mypen
If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", lang) Then
If IsExp(bstack, rest$, p) Then x1 = p Else x1 = .XGRAPH
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then y1 = p Else y1 = .YGRAPH
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then col = p Else ProcDraw = False: Exit Function
End If
Else
 y1 = .YGRAPH
End If

Set scr = bstack.Owner
scr.CurrentX = .XGRAPH
scr.CurrentY = .YGRAPH
scr.Line (.XGRAPH, .YGRAPH)-(x1, y1), mycolor(col)

.XGRAPH = scr.CurrentX
.YGRAPH = scr.CurrentY
MyDoEvents1 scr
Set scr = Nothing
Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", lang) Then
If IsExp(bstack, rest$, p) Then sx = p Else ProcDraw = False: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sy = p Else ProcDraw = False: Exit Function
sx = sx / PI2
sx = (sx - Fix(sx)) * PI2
x1 = Cos(sx) * sy
y1 = -Sin(sx) * sy
Else
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p
End If
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else ProcDraw = False: Exit Function
Set scr = bstack.Owner
scr.CurrentX = .XGRAPH
scr.CurrentY = .YGRAPH

scr.Line (.XGRAPH, .YGRAPH)-Step(x1, y1), mycolor(col)

.XGRAPH = scr.CurrentX
.YGRAPH = scr.CurrentY
Set scr = Nothing
End With

End Function
Function ProcStep(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, sy As Double, sx As Double
ProcStep = True
With players(GetCode(bstack.Owner))
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", lang) Then
If IsExp(bstack, rest$, p) Then sx = p Else ProcStep = False: MissNumExpr: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sy = p Else ProcStep = False: MissNumExpr: Exit Function
sx = sx / PI2
sx = (sx - Fix(sx)) * PI2
.XGRAPH = .XGRAPH + Cos(sx) * sy
.YGRAPH = .YGRAPH - Sin(sx) * sy
Else
If IsExp(bstack, rest$, p) Then .XGRAPH = .XGRAPH + p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then .YGRAPH = .YGRAPH + p Else ProcStep = False: MissNumExpr: Exit Function
End If
End With


End Function
Function ProcMove(bstack As basetask, rest$) As Boolean
ProcMove = True
Dim p As Double
With players(GetCode(bstack.Owner))
If FastSymbol(rest$, "!") Then
 .XGRAPH = .curpos * .Xt
 .YGRAPH = .currow * .Yt
ElseIf IsExp(bstack, rest$, p) Then .XGRAPH = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then .YGRAPH = p Else ProcMove = False: MissNumExpr: Exit Function
End If
End With
End Function
Function ProcPlayer(bstack As basetask, rest$, lang As Long)
Dim par As Boolean, sx As Double, sy As Double, x As Double, y As Double, x1 As Integer, p As Double, it As Long
Dim col As Long, scr As Object, what$, i As Long, s$, pppp As mArray, frm$, sxy As Double
If IsExp(bstack, rest$, p) Then
    If p = 0 Then   ' ZERO CLEAR ALL HARDWARE SPRITES
        ClrSprites
        ProcPlayer = True
        Exit Function
    End If
    If p < 1 Or p > 32 Then SyntaxError: ProcPlayer = False: Exit Function
    it = FindSpriteByTag(CLng(p))
    If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, x) Then  ' get new left or leave it empty
            If it = 0 Then
                x = 0
            Else
                x = Form1.dSprite(it).Left + players(it).x
            End If
            If FastSymbol(rest$, ",") Then
                If Not IsExp(bstack, rest$, y) Then MissNumExpr: ProcPlayer = False: Exit Function
            Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End If
        Else
            If FastSymbol(rest$, ",") Then   ' so ,, is "stay X where you are
                If Not IsExp(bstack, rest$, y) Then MissNumExpr: ProcPlayer = False: Exit Function
            Else
                If it = 0 Then
                    y = 0
                Else
                    y = Form1.dSprite(it).top + players(it).y
                End If
            End If
        End If
        If IsLabelSymbolNew(rest$, "ΜΕ", "USE", lang) Then ' no need for coma
            Select Case Abs(IsLabel(bstack, rest$, what$))
            Case 3
                If GetVar(bstack, what$, i) Then s$ = var(i)
            Case 6
                If neoGetArray(bstack, what$, pppp) Then
                    
                    If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then
                        MissNumExpr
                        ProcPlayer = True: Exit Function
                    End If
                Else
                    MissNumExpr
                    ProcPlayer = False: Exit Function
                End If
                s$ = pppp.item(it)  ' get the sprite image
            Case Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End Select
            col = rgb(255, 255, 255)
            sx = 0
            If FastSymbol(rest$, ",") Then  ' get image manipulators..
                    If IsExp(bstack, rest$, sy) Then
                     col = CLng(sy)
                     If col > 0 Then col = QBColor(col Mod 16) Else col = -col
                     ElseIf IsStrExp(bstack, rest$, frm$) Then
                     '' maybe is a mask
                     
                     col = 0
                     Else
                     ProcPlayer = False: MissNumExpr: Exit Function
                    End If
                     
                        If FastSymbol(rest$, ",") Then
                            If IsExp(bstack, rest$, sx) Then
                          
                               Else
                            MissNumExpr
                            ProcPlayer = False: Exit Function
                            End If
                        Else
                
                        End If
                    
              End If
              If FastSymbol(rest$, ",") Then
                            If IsExp(bstack, rest$, sxy) Then
                        
                               Else
                            MissNumExpr
                            ProcPlayer = False: Exit Function
                            End If
                        Else
                
                        End If
                   If IsLabelSymbolNew(rest$, "ΜΕΓΕΘΟΣ", "SIZE", lang) Then
              If Not IsExp(bstack, rest$, sy) Then ProcPlayer = False: MissNumExpr: Exit Function
              Else
              sy = 1
              End If
              ' so col, sx and sy are image manipulators
            it = GetNewSpriteObj(CLng(p), s$, col, CLng(sx), CSng(sy), CSng(sxy), frm$)
          
            PosSprite CLng(p), x - players(it).x, y - players(it).y
        Else ' without USE
         PosSprite CLng(p), x - players(it).x, y - players(it).y
        End If
        Else ' without x, y
            If IsLabelSymbolNew(rest$, "ΜΕ", "USE", lang) Then
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 3
            If GetVar(bstack, what$, i) Then s$ = var(i)
        Case 6
             If neoGetArray(bstack, what$, pppp) Then
   
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then
                     ProcPlayer = False: MissNumExpr: Exit Function
                End If
            Else
                 ProcPlayer = False: MissNumExpr: Exit Function
            End If
            s$ = pppp.item(it)
        Case Else
             ProcPlayer = False: MissNumExpr: Exit Function
        End Select
        col = rgb(255, 255, 255)
        sx = 0
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, sy) Then
            col = CLng(sy)
            If col > 0 Then col = QBColor(col) Else col = -col
        ElseIf IsStrExp(bstack, rest$, frm$) Then
            '' maybe is a mask
            col = 0
        Else
            ProcPlayer = False: MissNumExpr: Exit Function
        End If
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, sx) Then
            Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End If
        Else
        End If
    End If
            If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, sxy) Then
                Else
                    MissNumExpr
                    ProcPlayer = False: Exit Function
                End If
            Else
    
            End If
            If IsLabelSymbolNew(rest$, "ΜΕΓΕΘΟΣ", "SIZE", lang) Then          ' SIZE WITHOUT COMMA
                If Not IsExp(bstack, rest$, sy) Then ProcPlayer = False: MissNumExpr: Exit Function
            Else
                sy = 1
            End If
    
            it = GetNewSpriteObj(CLng(p), s$, col, CLng(sx), CSng(sy), CSng(sxy), frm$)
            ' no USE no X, Y or X,Y USE ..
            ' only command
        ElseIf IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", lang) Then     ' SHOW
            SrpiteHideShow p, (True)
        ElseIf IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", lang) Then        ' HIDE
            SrpiteHideShow p, (False)
        ElseIf IsLabelSymbolNew(rest$, "ΑΛΛΑΞΕ", "SWAP", lang) Then       ' SWAP
            If IsExp(bstack, rest$, x) Then
                SpriteControl CLng(p), CLng(x)
                Dim bb As basket, bl As Long, BR As Long
                bl = FindSpriteByTag(CLng(p))
                BR = FindSpriteByTag(CLng(x))
                bb = players(bl)
                players(bl) = players(BR)
                players(BR) = bb
                
            Else
                ProcPlayer = False
            End If
        End If
    End If
End If
ProcPlayer = True
Exit Function
End Function
Function MyRead(jump As Long, bstack As basetask, rest$, lang As Long) As Boolean
Dim ps As mStiva, bs As basetask, f As Long, ohere$, par As Boolean, flag As Boolean, flag2 As Boolean
Dim s$, ss$, pa$, what$, x1 As Long, y1 As Long, i As Long, myobject As Object, it As Long, useoptionals As Boolean
MyRead = True
Dim p As Double, x As Double
Dim pppp As mArray
ohere$ = here$
Dim col As Long
On jump GoTo read, refer, commit
Exit Function
commit:
If bstack.UseGroupname <> "" Then
f = True
col = 1
Set bs = bstack
GoTo contFromRebound
Else
BadReBound
MyRead = False
End If
Exit Function
refer:
col = 1
GoTo read123

read:
If FastSymbol(rest$, "?") Then
useoptionals = True

End If
flag2 = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", lang)
If Not flag2 Then flag = IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", lang)
read123:
Set bs = bstack
contFromRebound:
par = IsLabelSymbolNew(rest$, "ΑΠΟ", "FROM", lang)
If par And f Then
SyntaxError
MyRead = False
Exit Function
End If
If par Then
x1 = Abs(IsLabel(bstack, rest$, ss$))
If x1 > 0 And x1 <> 1 Then rest$ = ss$ + " " + rest$
If x1 = 1 Then

 If getvar2(bstack, ss$, i, , , flag) Then
 If IsObject(var(i)) Then
            ' need to make new stack frame with pointers to
        If Typename(var(i)) <> "Group" Then MyRead = True: Exit Function
        Set ps = New mStiva
        If ohere$ <> "" Then
                Set myobject = var(i).PrepareSoros(var(), ohere$ + "." + Left$(ss$, Len(ss$) - Len(var(i).GroupName) + 1))
                Else
                Set myobject = var(i).PrepareSoros(var(), Left$(ss$, Len(ss$) - Len(var(i).GroupName) + 1))
                End If
        With myobject
               For x1 = 1 To .Total
                  s$ = .StackItem(x1) + " "
                  If Left$(s$, 1) = "*" Then '' we have a group
                  s$ = Split(Mid$(s$, 2))(0)
                  Else
                  s$ = Split(s$)(0)
                  End If

 ''we place references

                If Right$(s$, 2) = "()" Then
                        ps.DataStr Left$(s$, Len(s$) - 2)
                Else
                        ps.DataStr s$
                End If
 ''bstack.Soros.DataStr .StackItem(X1)
            Next x1
        End With
Set myobject = Nothing
 Set bs = New basetask
    Set bs.Sorosref = ps
    If FastSymbol(rest$, ";") Then
    bstack.soros.MergeTop ps
    
    MyRead = True
    Exit Function
    End If
    If Not FastSymbol(rest$, ",") Then
    MissPar
    MyRead = False
 Exit Function
    End If
 Else
 MissingGroup
 MyRead = False
 Exit Function
 End If
 Else
 MissingGroup
 MyRead = False
 Exit Function
 End If
 col = 1 ' this is a switch... look down
 
ElseIf IsStrExp(bstack, rest$, ss$) Then
Set ps = New mStiva
Do While ss$ <> ""
If ISSTRINGA(ss$, pa$) Then
ps.DataStr pa$
ElseIf IsNumberD(ss$, x) Then
ps.DataVal x
Else
Exit Do
End If
Loop
Set bs = New basetask
Set bs.Sorosref = ps
    If Not FastSymbol(rest$, ",") Then
    MissPar
    MyRead = False
 Exit Function
    End If
End If
End If
' from here is not MyRead = True
Do
AGAIN1:
MyRead = False
If FastSymbol(rest$, ",") Then bs.soros.drop 1: GoTo AGAIN1
If FastSymbol(rest$, "&") Or col = 1 Then
' so now for GROUP variables we use only by reference
Select Case Abs(IsLabel(bstack, rest$, what$))
Case 1
If bs.IsString(s$) Then
     
          
    
    If GetGlobalVar(s$, i) Then
conthereifglobal:
        If flag2 Then
            If Not f Then
                If Not flag Then
                    If ohere$ <> "" Then
                        GoTo contpush12
                    Else
                        NoSecReF
                        Exit Do
                    End If
                End If
            End If
        ElseIf GetVar(bstack, what$, it, , , flag) And Not f Then
               If Not flag Then
                          If GetlocalVar(what$, y1) = False And ohere$ <> "" Then
                                   GoTo contpush12
                              Else
                                  NoSecReF
                                 Exit Do
                            End If
                End If
                
   
   Else
contpush12:
       what$ = myUcase$(what$)
       
       If Not LinkGroup(what$, var(i)) Then
            If f Then
                If Not ReboundVar(bstack, what$, i) Then GlobalVar what$, i, True
            Else
                GlobalVar what$, i, True
                If Typename(var(i)) = "lambda" Then
                    If ohere$ = "" Then
                        GlobalSub what$ + "()", "CALL EXTERN " & CStr(i)
                    Else
                        GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & CStr(i)
                    End If
                End If
            End If
        Else
            it = GlobalVar(what$, it)
            MakeitObject2 var(it)
            With var(i)
                var(it).edittag = .edittag
                var(it).FuncList = .FuncList
                var(it).GroupName = myUcase(what$) + "."
                Set var(it).Sorosref = .soros.Copy
            End With
        End If
        MyRead = True
    End If
     Else
        If GetVar(bstack, s$, i, True) Then GoTo conthereifglobal

         NoReference
    MyRead = False
    Exit Function

    End If
    Else
If bs.IsObjectRef(myobject) Then
If Not GetVar(bstack, what$, i, , , flag) Then i = GlobalVar(what$, 0)
CreateFormOtherObject var(i), myobject
 MyRead = True
Set myobject = Nothing
Else
    NoReference
    MyRead = False
    Exit Function
    End If
    End If

Case 3, 4
    If bs.IsString(s$) Then
        If GetGlobalVar(s$, i) Then
            If flag2 Then
            If Not f Then
                If Not flag Then
                    If ohere$ <> "" Then
       
                GlobalVar what$, i, True
               MyRead = True
       
                    Else
                        NoSecReF
                        Exit Do
                    End If
                End If
            End If
        ElseIf GetVar(bstack, what$, it, , , flag) And Not f Then '' GetlocalVar(what$, it)
                NoSecReF
                Exit Do
            Else
                If f Then
                    If Not ReboundVar(bstack, what$, i) Then GlobalVar what$, i, True
                Else
                    GlobalVar what$, i, True
                End If
                MyRead = True
            End If
        Else
            NoReference
            MyRead = False
            Exit Function
        End If
    Else
        NoReference
        MyRead = False
        Exit Function
    End If
Case 5, 6, 7
    If bs.IsString(s$) Then  ' get the pointer!!!!!
        If MaybeIsSymbol(s$, "{") Then
            If Not FastSymbol(rest$, ")") Then
                MyEr "Syntax error, use )", "Συντακτικό λάθος βάλε )": Exit Do
            Else
                s$ = Left$(what$, Len(what$) - 1) + " " + s$
                If f Then
                    ss$ = here$
                    here$ = ""
                    If Not MyFunction(0, bstack, s$, 1) Then
                        MyEr "No function definition founded", "Δεν βρέθηκε ορισμός συνάρτησης"
                        Exit Do
                    Else
                        sbf(bstack.IndexSub).sbgroup = s$
                    End If
                    here$ = ss$
                Else
                    If Not MyFunction(0, bstack, s$, 1) Then
                        MyEr "No function definition founded", "Δεν βρέθηκε ορισμός συνάρτησης"
                        Exit Do
                    Else
                        sbf(bstack.IndexSub).sbgroup = s$
                    End If
                End If
                MyRead = True
            End If
        Else
            i = CopyArrayItemsNoFormated(bstack, s$)
            If i > 0 Then
                If Not FastSymbol(rest$, ")") Then MyEr "Syntax error, use )", "Συντακτικό λάθος βάλε )": Exit Do
                If f Then   '' look about f - work for refer but no refer can't be done...why???
                    If Not ReboundArr(bstack, what$, i) Then GoTo arrconthere
                Else
arrconthere:
                what$ = myUcase(what$)
                If ohere$ = "" Then
                    If varhash.ExistKey(what$) Then
                      If flag2 And Not f And Not flag Then
                           varhash.ItemCreator what$, i
                           
                    Else
                        MyEr "Try other array name", "Δοκίμασε άλλο όνομα πίνακα"
                        Exit Do
                        End If
                    Else
                        varhash.ItemCreator what$, i
                    End If
                Else
                    If varhash.ExistKey(ohere$ & "." & what$) Then
                    If flag2 And Not f And Not flag Then
                           varhash.ItemCreator ohere$ & "." & what$, i, True
                    Else
                        MyEr "Try other array name", "Δοκίμασε άλλο όνομα πίνακα"
                        Exit Do
                    End If
                    Else
                        varhash.ItemCreator ohere$ & "." & what$, i, True
                    End If
                End If
            End If
            MyRead = True
        End If
    End If
End If
Case Else
    Exit Do
End Select
Else
x1 = Abs(IsLabel(bstack, rest$, what$))
If x1 <> 0 Then
    If useoptionals Then If bstack.soros.IsEmpty Then bstack.soros.DataOptional
    what$ = myUcase(what$)
End If
Select Case x1
Case 1
    If bs.IsObjectRef(myobject) Then
        MyRead = True
        If flag Then
            p = 0
            GlobalVar what$, p
        End If
        If GetVar(bstack, what$, i, , , flag) Then
                If Typename$(myobject) = Typename(var(i)) Then
                    If Typename$(var(i)) = "Group" Then
                    '' we cannot place a group over another group
                    '' once we read it we make it..in that place
                    UnFloatGroupReWriteVars bstack, what$, i, myobject
                    ElseIf Typename$(var(i)) = "mHandler" Then
                        If var(i).ReadOnly Then
                            MyRead = False
                           MyEr "Read Only", "Μόνο για ανάγνωση"
                           Exit Function
                        ElseIf var(i).T1 = myobject.T1 Then
                           Set var(i) = myobject
                        Else
                          MyRead = False
                          MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                          Exit Function
                        End If
                    Else
                    Set var(i) = myobject
                    End If
                Else
                     MyRead = False
                    MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                    Exit Function
                End If
        Else
            i = GlobalVar(what$, 0)
            If Typename$(myobject) = "Group" Then
                UnFloatGroup bstack, what$, i, myobject
            ElseIf Typename$(myobject) = "mEvent" Then
                Set var(i) = myobject
            ElseIf Typename$(myobject) = "lambda" Then
                Set var(i) = myobject
                If ohere$ = "" Then
                    GlobalSub what$ + "()", "CALL EXTERN " & CStr(i)
                Else
                    GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & CStr(i)
                End If
            ElseIf Typename$(myobject) = "mHandler" Then
            If IsObject(var(i)) Then
                    If TypeOf var(i) Is mHandler Then
                    If var(i).ReadOnly Then
                        MyEr "Read Only", "Μόνο για ανάγνωση"
                        MyRead = False
                       Exit Function
                        End If
                        End If
                        End If
                If myobject.Indirect > -1 Then
                Set var(i) = MakeitObjectGeneric(myobject.Indirect)
                Else
                Set var(i) = myobject
                End If
            End If
            Set myobject = Nothing
        End If
    ElseIf bs.IsNumber(p) Then
        MyRead = True
        If flag2 Then
            GlobalVar what$, p
        ElseIf GetVar(bstack, what$, i, , , flag) Then
                If VarType(var(i)) <> vbLong Then
                    var(i) = p
                Else
                    var(i) = CLng(p)
                End If
        ElseIf i = -1 Then
                bstack.SetVar what$, p
        Else
                GlobalVar what$, p
        End If
        
    ElseIf bs.IsOptional Then
        MyRead = True
        p = 0
        If flag2 Then
            GlobalVar what$, p
        ElseIf GetVar(bstack, what$, i, , , flag) Then
        ElseIf i = -1 Then
        Else
                GlobalVar what$, p
        End If
    
    Else
        MissStackNumber
        MyRead = False
        Exit Do
    End If
Case 3
    If bs.IsString(s$) Then
        MyRead = True
        If flag2 Then
            GlobalVar what$, s$
        ElseIf GetVar(bstack, what$, i, , , flag) Then
            CheckVar var(i), s$
        ElseIf i = -1 Then
            bstack.SetVar what$, s$
        Else
            GlobalVar what$, s$
        End If
    ElseIf bs.IsOptional Then
       MyRead = True
       s$ = ""
        If flag2 Then
            GlobalVar what$, s$
        ElseIf GetVar(bstack, what$, i, , , flag) Then
        ElseIf i = -1 Then
      
        Else
            GlobalVar what$, s$
        End If
    ElseIf bs.IsObjectRef(myobject) Then
        If Typename$(myobject) = "lambda" Then
            If flag2 Then
                GlobalVar what$, s$
            ElseIf GetVar(bstack, what$, i, , , flag) Then
                CheckVar var(i), s$
            Else
                GlobalVar what$, s$
            End If
            Set var(i) = myobject
            If ohere$ = "" Then
                GlobalSub what$ + "()", "CALL EXTERN " & CStr(i)
            Else
                GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & CStr(i)
            End If
            MyRead = True
        Else
            MyRead = False
        End If
    Else
        MissStackStr
        MyRead = False
        Exit Do
    End If
Case 4
    If bs.IsNumber(p) Then
        MyRead = True
        If flag2 Then
            GlobalVar what$, Int(p)
        ElseIf GetVar(bstack, what$, i, , , flag) Then
            var(i) = Int(p)
        ElseIf i = -1 Then
            bstack.SetVar what$, p
        Else
            GlobalVar what$, Int(p)
        End If
    ElseIf bs.IsOptional Then
        MyRead = True
        p = 0
        If flag2 Then
            GlobalVar what$, p
        ElseIf GetVar(bstack, what$, i, , , flag) Then
            
        ElseIf i = -1 Then
            
        Else
            GlobalVar what$, Int(p)
        End If
    Else
        MissStackNumber
        MyRead = False
        Exit Do
    End If
Case 5
    MyRead = False
    If FastSymbol(rest$, ")") Then
       MyRead = globalArrByPointer(bs, bstack, what$, flag2): If Not MyRead Then SyntaxError: Exit Do
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Do
        Else
            Exit Do
        End If
        If IsOperator(rest$, ".") Then
            If Not Typename(pppp.item(it)) = "Group" Then
                MyEr "Expected group", "Περίμενα ομάδα"
                MyRead = False: Exit Function
            Else
                 i = 1
                aheadstatus rest$, False, i
                ss$ = Left$(rest$, i - 1)
                MyRead = SpeedGroup(bstack, pppp, "@READ", ".", ss$, it) <> 0
                rest$ = Mid$(rest$, i)
                GoTo loopcont123
            End If
        End If
        If bs.IsObjectRef(myobject) Then
                If Typename$(myobject) = "Group" Then
                         If myobject.IamFloatGroup Then
                                    Set pppp.item(it) = myobject
                                    Set myobject = Nothing
                                    MyRead = True
                             Else
                                          BadGroupHandle
                                          MyRead = False
                                          Set myobject = Nothing
                                          Exit Function
                             End If
                             
                             GoTo loopcont123
                   ElseIf Typename$(myobject) = "lambda" Then
                            Set pppp.item(it) = myobject
                            Set myobject = Nothing
                            MyRead = True
                            GoTo loopcont123
                    End If
        ElseIf bs.IsOptional Then
        MyRead = True
        ElseIf Not bs.IsNumber(p) Then
            MissStackNumber
            MyRead = False
            Exit Do
        End If
        MyRead = True
        pppp.item(it) = p
    End If
 Case 6
    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2): If Not MyRead Then SyntaxError: Exit Do
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Do
        Else
            Exit Do
        End If
        If Not bs.IsString(s$) Then
            If bs.IsObjectRef(myobject) Then
                If Typename$(myobject) = "lambda" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing
                Else
                    MissStackStr
                    Exit Do
                End If
            Else
                MissStackStr
                Exit Do
            End If
        ElseIf bs.IsOptional Then
            MyRead = True
        Else
            If Not IsObject(pppp.item(it)) Then
                pppp.item(it) = s$
            Else
                Set pppp.item(it) = New Document
                CheckVar pppp.item(it), s$
            End If
        End If
        MyRead = True
    End If
Case 7
    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2): If Not MyRead Then SyntaxError: Exit Do
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Do
        Else
            Exit Do
        End If
        If bs.IsOptional Then
        MyRead = True
        ElseIf Not bs.IsNumber(p) Then
            MissStackNumber
            Exit Do
        End If
        MyRead = True
        pppp.item(it) = Int(p)
    End If
End Select
End If
loopcont123:
Loop Until Not FastSymbol(rest$, ",")

End Function
Function MyPush(bstack As basetask, rest$) As Boolean
Dim s$, p As Double
MyPush = True
Do
  
         If FastSymbol(rest$, "!") Then
                If IsExp(bstack, rest$, p) Then
                 bstack.soros.DataValLong p
                End If
                ElseIf IsExp(bstack, rest$, p) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.PushVal p
                Else
                        bstack.soros.PushObj bstack.lastobj
                         Set bstack.lastobj = Nothing
                End If
        ElseIf IsStrExp(bstack, rest$, s$) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.PushStr s$
                Else
                        bstack.soros.PushObj bstack.lastobj
                         Set bstack.lastobj = Nothing
                End If
        Else
                Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
Loop
End Function
Function MyData(bstack As basetask, rest$) As Boolean
Dim s$, p As Double ', vvl As Variant, photo As Object
MyData = True
Do
       If FastSymbol(rest$, "!") Then
                If IsExp(bstack, rest$, p) Then
                 bstack.soros.DataValLong p
                End If
                ElseIf IsExp(bstack, rest$, p) Then
                  If bstack.lastobj Is Nothing Then
                      bstack.soros.DataVal p
                 Else
                      bstack.soros.DataObj bstack.lastobj
                      Set bstack.lastobj = Nothing
                End If
        ElseIf IsStrExp(bstack, rest$, s$) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.DataStr s$
                Else
                        bstack.soros.DataObj bstack.lastobj
                        Set bstack.lastobj = Nothing
                End If
        Else
                Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
        
Loop
End Function
Function MyClear(bstack As basetask, rest$) As Boolean
Dim curbstack As basetask, i As Long, y1 As Long, what$, it As Long, pppp As mArray
'Dim bs As basetask
MyClear = True


Do
y1 = Abs(IsLabel(bstack, rest$, what$))


If y1 = 3 Then
      If GetVar(bstack, what$, i) Then
        If Typename(var(i)) = doc Then
        Set var(i) = New Document
        var(i).LCID = LCID_DEF
        var(i).textDoc = ""
        Else
        var(i) = ""
        End If
       Else
        GlobalVar what$, ""
        
       End If
ElseIf y1 < 5 And y1 > 0 Then
      If GetVar(bstack, what$, i) Then
        If IsObject(var(i)) Then
        ' PUT ZERO TO VARIABLES INSIDE GROUP
       If Typename(var(i)) = "lambda" Then
       Set var(i) = Nothing
       var(i) = CLng(0)
       ElseIf Typename(var(i)) = "Group" Then
       var(i) = CLng(0)
       ElseIf Typename(var(i)) = "mHandler" Then
       If var(i).T1 = 1 Then
       If var(i).ReadOnly Then
            MyEr "Read Only", "Μόνο για ανάγνωση"
            MyClear = False
            
            End If
       Set var(i).objref = New FastCollection
       Else
       Set var(i).objref = New MemBlock
       End If
       Else
         MissingGroup
         MyClear = False
       End If
        Else
        If VarType(var(i)) = vbLong Then
        var(i) = CLng(0)
        Else
            var(i) = CDbl(0)
            End If
        End If
        
       Else
        GlobalVar what$, it
       End If
ElseIf y1 = 5 Or y1 = 7 Then
  If neoGetArray(bstack, what$, pppp) Then
  If Not pppp.Arr Then NotArray: MyClear = False: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then MyClear = False: Exit Function
                         If Typename(pppp.item(it)) = "Group" Then
                         Set pppp.item(it) = Nothing
                         EmptyVariantArrayItem pppp, it
                         ElseIf Typename(pppp.item(it)) = "lambda" Then
                         Set pppp.item(it) = Nothing
                         EmptyVariantArrayItem pppp, it
                         Else
                         SyntaxError
                         MyClear = False
                         End If
                 
       Else
       SyntaxError
       MyClear = False
       End If
ElseIf y1 = 6 Then
        If neoGetArray(bstack, what$, pppp) Then
        If Not pppp.Arr Then NotArray: MyClear = False: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then MyClear = False: Exit Function
                         If Typename(pppp.item(it)) = doc Then
                         Set pppp.item(it) = New Document
                         pppp.item(it).textDoc = ""
                         Else
                         pppp.item(it) = ""
                         End If
                 
       Else
       SyntaxError
       MyClear = False
       End If
ElseIf y1 > 0 Then
  SyntaxError
       MyClear = False
Else
Form1.List1.Clear
If bstack.IamThread Then
 MyEr "Can't Clear all variables in a thread", "Δεν μπορώ να σβήσω όλες τις μεταβλητές σε ένα νήμα"
Else

Set curbstack = bstack

again1234:

 If curbstack.IamChild Then
 If curbstack.IamThread Then Set curbstack = Nothing: Exit Function
 With curbstack
   Set .StaticCollection = Nothing
        If .Vars <> 0 Then Set curbstack = Nothing: Exit Function
      
   End With
   
Set curbstack = curbstack.Parent
GoTo again1234
End If
GarbageFlush
Set curbstack = Nothing
Set bstack.StaticCollection = Nothing
varhash.ReduceHash 0, var()
var2used = 0
ReDim var(3000) As Variant

Set curbstack = bstack
again12345:
 If curbstack.IamChild Then
            With curbstack
                 If .Vars = 0 Then Set curbstack = Nothing: Exit Function
                     .Vars = 0
   
            End With
            Set curbstack = curbstack.Parent
            GoTo again12345
End If
Set curbstack = Nothing
End If
Exit Do
End If
If Not MyClear Then Exit Do
Loop Until Not FastSymbol(rest$, ",")
End Function
Function MyDeclare(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, i As Long, s$, pa$
Dim x1 As Long, y1 As Long, par As Boolean, ss$, w$, what$, y3 As Boolean
Dim photo As Object, ML As Long
Dim DUM As Boolean
Dim pppp As mArray
Dim ii As Long, ev As ComShinkEvent
MyDeclare = True
ML = -1
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", lang)
y3 = IsLabelSymbolNew(rest$, "ΜΕΓΕΓΟΝΟΤΑ", "WITHEVENTS", lang)
x1 = Abs(IsLabel(bstack, rest$, what$, , True))

w$ = myUcase$(what$)
gohere:
    If x1 = 1 Or x1 = 3 Then
        If x1 = 1 Then
            If GetVar(bstack, w$, i) Then
            If y3 Then
            If TypeOf var(i) Is GuiM2000 Then
                    MyEr "Can't define com events here", "Δεν μπορώ να χειριστώ γεγονότα COM εδώ"
                            MyDeclare = False
            Exit Function
            End If
               If GetShink(ev, i, w$) Then
                            If Not GetVar(bstack, ChrW(&HFFBF) + "_" + w$, ii) Then
                            
                            ii = GlobalVar(ChrW(&HFFBF) + "_" + w$, s$, , y1 = True)
                            End If
                            
                            
                            Set var(ii) = ev
                                        
                            Else
                            MyEr "Can't handle events here", "Δεν μπορώ να χειριστώ γεγονότα"
                            MyDeclare = False
                         End If
                        Exit Function
            End If
            ss$ = ""

               If IsLabelSymbolNewExp(rest$, "ΤΙΠΟΤΑ", "NOTHING", lang, ss$) Then
                   If ML >= 0 Then
goNothing:
              If neoGetArray(bstack, w$, pppp) Then
              For i = 0 To pppp.UpperMonoLimit
                If IsObject(pppp.item(i)) Then
                    If Typename$(pppp.item(i)) = "GuiM2000" Then
                    Set photo = pppp.item(i)
                    Unload photo
                    End If
                 Set pppp.item(i) = Nothing
                Else
                pppp.item(i) = Empty
                End If
              Next i
              Else
              MyDeclare = False
                Exit Function
              End If
                   
                   ElseIf Not IsObject(var(i)) Then
                        BadObjectDecl
                        MyDeclare = False
                   Else
                   If var(i) Is Nothing Then Exit Function
                      If TypeOf var(i) Is GuiM2000 Then
                      var(i).CloseNow
                      Unload var(i)
                      Else
                      If GetVar(bstack, ChrW(&HFFBF) + "_" + w$, ii) Then
                        Set var(ii) = Nothing
                      End If
                      End If
                       Set var(i) = Nothing
                   End If
                   Exit Function
               
               ElseIf IsLabelSymbolNewExp(rest$, "ΝΕΟ", "NEW", lang, ss$) Then
               Set var(i) = Nothing
               GoTo THEREnew
               Else
                  BadObjectDecl
                    MyDeclare = False
                  Exit Function
               End If
                     
            End If
   
         End If
         ss$ = ""
         
         If IsLabelSymbolNewExp(rest$, "ΑΠΟ", "LIB", lang, ss$) Then
         
              par = Fast2Label(rest$, "C", 1, "", 0, "", 0, 1)
              
            If IsStrExp(bstack, rest$, pa$) Then
                       ' we get the lib
                If Not IsStrExp(bstack, rest$, ss$) Then ss$ = ""
                SpaceForVar i
                Set photo = New stdCallFunction
                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
                If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
                MyDeclare = False
                Set photo = Nothing
                Exit Function
                Else
            photo.RetType = CLng(p)
                End If
                End If
                photo.CallThis pa$, ss$, lang
                If par Then photo.CallType = 1
            
                Set var(i) = photo
                
                s$ = w$
                If x1 = 3 Then
                    If here$ = "" Or y1 Then
                        GlobalSub s$ + "()", "CALL EXTERN " & CStr(i) & " : = LETTER$"
                    Else
                        GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(i) & " : = LETTER$"
                    End If
                Else
                    If here$ = "" Or y1 Then
                        GlobalSub s$ + "()", "CALL EXTERN " & CStr(i) & " : = NUMBER"
                    Else
                        GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & CStr(i) & " : = NUMBER"
                    End If
                End If
               Set photo = Nothing
                Exit Function
            Else
                BadObjectDecl
                 MyDeclare = False
                 Set photo = Nothing
                Exit Function
            End If
        ElseIf IsLabelSymbolNewExp(rest$, "ΜΕ", "USE", lang, ss$) Then
                If y3 <> 0 Then
                SyntaxError
                Exit Function
                End If


                    x1 = Abs(IsLabel(bstack, rest$, pa$))
                    IsSymbol3 rest$, ","
                    If x1 = 1 Then
                            If GetVar(bstack, pa$, x1) Then
                                    If IsObject(var(x1)) Then
                                                i = GlobalVar(w$, s$, , y1 = True)
                                                If IsStrExp(bstack, rest$, ss$) Then
                                                Set var(i) = MakeObjectFromString(var(x1), ss$)
                                         
                                                
                                                
                                                
                                                End If
                                    End If
                            End If
                    Else
                    MissPar
                    MyDeclare = False
                    End If
                    Exit Function
        End If
        If ML >= 0 Then
         If neoGetArray(bstack, w$, pppp, here$ <> "") Then
                MyDeclare = False
                Exit Function
         Else
         
         GlobalArr bstack, w$ + "(", LTrim(Str(ML)) + ")", i, y1
        If DeclareGUI(bstack, what$, rest$, MyDeclare, lang, i, ML, w$, y1) Then
        Exit Function
        End If
        End If
        '' EXPAND OBJECTS HERE
        '' ElseIf IsLabelSymbolNewExp(rest$, "GREEK NAME", "ENGLISH NAME", lang, ss$) Then
        '' i = GlobalVar(w$, s$, , y1 = True)
        '' Set var(i) = New .....

        Else
        i = GlobalVar(w$, s$, , y1 = True)
        End If
THEREnew:
MyDeclare = False
        If IsStrExp(bstack, rest$, s$) Then
            If FastSymbol(rest$, ",") Then
                If IsStrExp(bstack, rest$, pa$) Then
                    
                If FastSymbol(rest$, ",") Then
                        If IsStrExp(bstack, rest$, w$) Then
                        Err.Clear
                        On Error Resume Next
                        If w$ = "" Then
                            Licenses.Add s$
                        Else
                            Licenses.Add s$, w$
                        End If
                        If Err.Number > 0 And Err.Number <> 732 Then
                        MissLicence
                        Err.Clear
                        Else
                        Err.Clear
                        CreateitObject var(i), s$, CStr(pa$)
                        If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                        End If
                        Licenses.Remove s$
                        Else
                        MissStringExpr
                        End If
                        
                        
                Else
                      Err.Clear
                        On Error Resume Next
                CreateitObject var(i), s$, CStr(pa$)
                     If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                    End If
                    
                    
                Else
                 If FastSymbol(rest$, ",") Then
                 If IsStrExp(bstack, rest$, pa$) Then
                    Err.Clear
                        On Error Resume Next
                        If pa$ = "" Then
                        Licenses.Add s$
                        Else
                 Licenses.Add s$, pa$
                 End If
                     If Err.Number > 0 And Err.Number <> 732 Then
                        MissLicence
                        Err.Clear
                        Else
                        Err.Clear
                 CreateitObject var(i), s$
                 If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                        End If
                 Licenses.Remove s$
                 Else
                    MissStringExpr
                 End If
                Else
                    MissStringExpr
                    End If
                End If
                
                
                
                
                
            Else
               Err.Clear
                        On Error Resume Next
                CreateitObject var(i), s$
                
                 If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        ElseIf y3 <> 0 Then
                        
                         
                         If GetShink(ev, i, w$) Then
                         ' private
                         ' no need for a name, we do not address it in any way.
                         ' ev knows how to call handler
                         ii = GlobalVar(ChrW(&HFFBF) + "_" + w$, s$, , y1 = True)
                         Set var(ii) = ev
                         Else
                         MyEr "Can't handle events here", "Δεν μπορώ να χειρστώ γεγονότα"
                            MyDeclare = False
            
                         End If
                         
                        End If
            End If
            
        ElseIf y3 Then
        SyntaxError
        Exit Function
        ElseIf DeclareGUI(bstack, what$, rest$, MyDeclare, lang, i) Then
         
         
        End If
           Err.Clear
                        On Error Resume Next
            
        If Not IsObject(var(i)) Then
        BadObjectDecl
        End If
       
    ElseIf x1 = 5 Then
If FastSymbol(rest$, ")") Then
 'w$ = Left$(w$, Len(w$) - 1)
'w$ = w$ + ")"
 If IsLabelSymbolNewExp(rest$, "ΤΙΠΟΤΑ", "NOTHING", lang, ss$) Then GoTo goNothing
 If IsLabelSymbolNewExp(rest$, "ΠΑΝΩ", "OVER", lang, ss$) Then
    ExpandGui bstack, what$, rest$, MyDeclare, lang, w$
    '' not yet
'' ElseIf IsLabelSymbolNewExp(rest$, "ΥΠΟ", "UNDER", lang, ss$) Then
  ''  ReduceGui bstack, what$, rest$, ifier, lang, w$
Else

 
 BadObjectDecl
 End If
ElseIf IsExp(bstack, rest$, p) Then
ML = CLng(p)
If FastSymbol(rest$, ")") Then
x1 = 1
 w$ = Left$(w$, Len(w$) - 1)
   GoTo gohere
Else
BadObjectDecl
End If
Else
BadObjectDecl
End If
    Else
    
    BadObjectDecl
    
    End If
     MyDeclare = True
     Set photo = Nothing
    

End Function
Function MyWith(bstack As basetask, rest$, lang As Long) As Boolean
Dim i As Long, ss$, s$, pppp As mArray, pa$, x1 As Long
MyWith = True
x1 = Abs(IsLabel(bstack, rest$, s$))
If x1 = 1 Then
    If GetVar(bstack, s$, i) Then
            If Not IsObject(var(i)) Then BadObjectDecl:  Exit Function
            If Not var(i) Is Nothing Then  ''???
                   Do While FastSymbol(rest$, ",")
                    If IsStrExp(bstack, rest$, ss$) Then
                    On Error Resume Next
                      ProcProperty bstack, var(), i, ss$, rest$, lang
                      MyWith = Err = 0
                      Err.Clear
                    Else
                    MissStringExpr
                    MyWith = False
                    Exit Do
                    End If
                    Loop
                    Exit Function
            Else
                    BadObjectDecl
                    Exit Function
            End If
    Else
    
     Nosuchvariable s$
    End If
ElseIf x1 = 5 Then
  If neoGetArray(bstack, s$, pppp) Then
    If NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then
      Do While FastSymbol(rest$, ",")
                    If IsStrExp(bstack, rest$, ss$) Then
                  ProcPropertyArray bstack, pppp, i, ss$, rest$, lang, MyWith
                    Else
                    MissStringExpr
                    MyWith = False
                    Exit Do
                    End If
                    Loop
                    Exit Function
           
            
     End If
  Else
      MissingObj
  End If
End If
End Function
Function MyMethod(bstack As basetask, rest$, lang As Long) As Boolean

Dim i As Long, s$, pppp As mArray, pa$
i = Abs(IsLabel(bstack, rest$, s$))
MyMethod = True

If i = 1 Then
 If GetVar(bstack, s$, i) Then
        If IsObject(var(i)) Then
            If var(i) Is Nothing Then
                MissingObj
            Else
                IsSymbol3 rest$, ","
                If IsStrExp(bstack, rest$, pa$) Then
           ''     IsSymbol3 rest$, ","
              ProcMethod bstack, var(), i, pa$, rest$, lang
          MyMethod = Err = 0
          Err.Clear
                End If
            End If
        Else
            MissingObjRef
        End If
        Exit Function
        Else
  Nosuchvariable s$
 End If
 ElseIf i = 5 Then
  If neoGetArray(bstack, s$, pppp) Then
again11:
    If NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then
    If FastSymbol(rest$, "(") Then
    If IsObject(pppp.item(i)) Then
    Dim pppp1 As mArray
    If TypeOf pppp.item(i) Is mArray Then
        Set pppp = pppp.item(i)
    Else
        pppp1.Arr = False
        Set pppp1.GroupRef = pppp.item(i)
        Set pppp = pppp1
        Set pppp1 = Nothing
    End If
    GoTo again11
    End If
    End If
             IsSymbol3 rest$, ","
            If IsStrExp(bstack, rest$, pa$) Then
                ProcMethodArray bstack, pppp, i, pa$, rest$, lang, MyMethod
              End If
     End If
  Else
      MissingObj
  End If

End If

End Function
Function myEvent(basestack As basetask, rest$, lang As Long)
Dim x1 As Long, what$, i As Long, s$
myEvent = True
 x1 = Abs(IsLabel(basestack, rest$, what$))
 If x1 <> 1 Then myEvent = False: Exit Function
 If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
 If GetlocalVar(basestack.GroupName & what$, i) Then
 ' we found it
  ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
  ' we found it
  Else
   i = GlobalVar(basestack.GroupName & what$, s$)
   MakeitObjectEvent var(i)
 End If
 myEvent = ProcEvent(basestack, rest$, lang, i)
End Function
Function MyReport(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, prive As Long, x As Double, y As Double, y1 As Long, x1 As Long, it As Long
Dim s$, i As Long, pa$, sx As Double
MyReport = False
prive = GetCode(bstack.Owner)

If IsExp(bstack, rest$, p) Then
If Not FastSymbol(rest$, ",") Then MissPar:: Exit Function
Else
p = 0
End If
If IsStrExp(bstack, rest$, s$) Then
 x = bstack.Owner.Width
If FastSymbol(rest$, ",") Then
If Not IsExp(bstack, rest$, x) Then: Exit Function
With players(prive)
If x <= .mx Then
x = x * .Xt - 2 * dv15
bstack.Owner.CurrentX = bstack.Owner.CurrentX + dv15
End If
End With
End If

If FastSymbol(rest$, ",") Then
If Not IsExp(bstack, rest$, y) Then: Exit Function
y1 = y - 1
If IsLabelSymbolNew(rest$, "ΓΡΑΜΜΗ", "LINE", lang) Then
        If Not IsExp(bstack, rest$, sx) Then: Exit Function
        x1 = sx - 1
If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
          wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), x1, , , True
  rest$ = "@READ " + rest$
  If Not executeblock(i, bstack, rest$, True, False) Then
' error ??
  End If
  Else
        wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), x1
      End If
Else
If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
  wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), , it, , True
  rest$ = "@READ " + rest$
  If Not executeblock(i, bstack, rest$, True, False) Then
 ' error ?
  End If
  
Else
  wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), , it
  End If
 End If
players(prive).LastReportLines = CDbl(it)
  
Else

 wwPlain bstack, players(prive), s$, CLng(x), 100000, True, , CLng(p), , it
   players(prive).LastReportLines = -1
End If

MyReport = True
Else
If LastErNum <> 0 Then LastErNum = 0:: Exit Function      'ifier=true

End If

End Function
Function MyInput(bstack As basetask, rest$, lang As Long) As Boolean
Dim i As Long, p As Double, s$, ss$, what$, f As Long, x1 As Long, y As Double, x As Double
Dim frm$, par As Boolean, pppp As mArray, prive As Long, it As Long, w$


MyInput = True
With players(GetCode(bstack.Owner))
If IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", lang) Then

If Not NOEDIT Then

NOEDIT = True
Else
If QRY Then QRY = False  ''INK$ = Chr$(13) '
End If
Exit Function
End If
prive = GetCode(bstack.Owner)
If Not releasemouse Then If Not Form1.Visible Then Form1.Visible = True  '

MyInput = False '*************
rest$ = NLtrim$(rest$)

If FastSymbol(rest$, "!") Then
        x1 = 0
        frm$ = ""
        If bstack.toprinter = True Then oxiforPrinter:   Exit Function
        If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
        f = Abs(IsLabel(bstack, rest$, what$))
        Select Case f
        Case 1, 4
                     If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                     If Not IsExp(bstack, rest$, p) Then p = .mx
                     x = p
                     
                             y = 0
                             x1 = 30
                             If f = 4 Then x1 = 16
                     
                     Form1.ShadowMarks = True
                    
                    If y < 1 And x1 = 0 Then y = 1
                     If GetVar(bstack, what$, i) Then
                     s$ = LTrim(Str(var(i)))
                     Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, f = 4)
                     Loop Until ValidNum(s$, True, f = 4)
                               ValidNumberOnly s$, p, f = 4
                             var(i) = p
                     Else
                     If i = -1 Then
                     If f = 4 Then
                      s$ = LTrim(Str(ReadVarInt(bstack, what$)))
                     Else
                      s$ = LTrim(Str(ReadVarDouble(bstack, what$)))
                      End If
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, f = 4)
                     Loop Until ValidNum(s$, True, f = 4)
                              ValidNumberOnly s$, p, f = 4
                             bstack.SetVar what$, p
                     Else
                     s$ = ""
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, f = 4)
                     Loop Until ValidNum(s$, True, f = 4)
                              ValidNumberOnly s$, p, f = 4
                             GlobalVar what$, (p)
                     End If
                     End If
                     MyInput = True
                     Form1.ShadowMarks = False
        Case 3
                     If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                     If Not IsExp(bstack, rest$, p) Then p = .mx
                     x = p
                     If Not FastSymbol(rest$, ",") Then
                             y = 0
                             x1 = 50
                             If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", lang, , , , False) Then
                                     If FastSymbol(rest$, "=") Then
                                             If IsExp(bstack, rest$, p) Then
                                                     x1 = Abs(Int(p))
                                             Else
                                                     MissNumExpr
                                                     Exit Function
                                             End If
                                     Else
                                             MissSymbolMyEr "="
                                             Exit Function
                                     End If
                             End If
                     ElseIf Not IsExp(bstack, rest$, y) Then
                             MissPar
                             Exit Function
                     Else
                             If FastSymbol(rest$, ",") Then
                                     If Not IsStrExp(bstack, rest$, frm$) Then MissPar: Exit Function
                            Else
                            If Len(var(i)) > 0 Then x1 = -Len(var(i))
                        
                             End If
                           
                     End If
                     Form1.ShadowMarks = True
                     ''rest$ = nltrim$(rest$)
If y < 1 And x1 = 0 Then y = 1
                     If GetVar(bstack, what$, i) Then
                             var(i) = iText(bstack, var(i), (x), (y), frm$, x1)
                     Else
                     If i = -1 Then

                     bstack.SetVar what$, iText(bstack, ReadVarStr(bstack, what$), (x), (y), frm$, x1)
                     Else
                             GlobalVar what$, iText(bstack, "", (x), (y), frm$, x1)
                     End If
                     End If
                     MyInput = True
                     Form1.ShadowMarks = False
        Case 5, 7 ' NUMBER IN ARRAY
                            If neoGetArray(bstack, what$, pppp) Then
                            If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                    Else
                            Exit Function
                    End If
                    If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                    If Not IsExp(bstack, rest$, p) Then p = .mx
                    x = p
                     y = 0
                   x1 = 30
                    If f = 7 Then x1 = 16
                Form1.ShadowMarks = True
                If y < 1 And x1 = 0 Then y = 1

            
            
       s$ = LTrim(Str(pppp.item(it)))
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, f = 7)
                     Loop Until ValidNum(s$, True, f = 7)
                              ValidNumberOnly s$, p, f = 7
                              
           
           If f = 4 Then
                        pppp.item(it) = Int(p)
           Else
                        pppp.item(it) = p
                        End If
        Form1.ShadowMarks = False
                MyInput = True
        Case 6
                    If neoGetArray(bstack, what$, pppp) Then
                            If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                    Else
                            Exit Function
                    End If
                    If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                    If Not IsExp(bstack, rest$, p) Then p = .mx
                    x = p
                    If Not FastSymbol(rest$, ",") Then
                        y = 0
                        x1 = 50
                        If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", lang, , , , False) Then
                                If FastSymbol(rest$, "=") Then
                                        If IsExp(bstack, rest$, p) Then
                                            x1 = Abs(Int(p))
                                        Else
                                            MissNumExpr
                                            Exit Function
                                        End If
                                Else
                                        MissSymbolMyEr "="
                                        Exit Function
                                End If
                        ElseIf Not IsExp(bstack, rest$, y) Then
                                MissPar
                                Exit Function
                        Else
                                If FastSymbol(rest$, ",") Then
                                        If Not IsStrExp(bstack, rest$, frm$) Then MissPar: Exit Function
                                        Else
                            If Len(CStr(pppp.item(it))) > 0 Then x1 = -Len(CStr(pppp.item(it)))
                        
                                End If
                        End If
                End If
                Form1.ShadowMarks = True
                If y < 1 And x1 = 0 Then y = 1
                s$ = iText(bstack, LTrim(Str(pppp.item(it))), (x), (y), frm$, x1)
                Form1.ShadowMarks = False
                If Typename(pppp.item(it)) = doc Then
                        Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                Else
                        pppp.item(it) = s$
                End If
                MyInput = True
        End Select
        Exit Function
                    '********************************************
ElseIf FastSymbol(rest$, "#") Then
            If Not IsExp(bstack, rest$, p) Then MissPar:   Exit Function
            If Not FastSymbol(rest$, ",") Then MissPar:  Exit Function
            f = CLng(MyMod(p, 512))
            par = True
Else
If bstack.toprinter = True Then oxiforPrinter:   Exit Function
 If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
            If ISSTRINGA(rest$, frm$) Then
            If Not FastSymbol(rest$, ",") Then MissPar:  Exit Function
            Else
            frm$ = "?"
            End If
            par = False
End If
w$ = ""
FKey = -1
If bstack.toprinter = True And Not par Then
            oxiforPrinter
            Exit Function
End If
 If (Typename(bstack.Owner) Like "Gui*") And Not par Then oxiforforms: Exit Function
MyInput = False
Do
        
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 1
                If par Then
                        If Uni(f) Then
                                getUniRealComma f, p
                        Else
                                getAnsiRealComma f, p
                        End If
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), "+*/!@#$|\{}[]'~`%^&()=_:;", True)
                        If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False: Exit Function
                        If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False: Exit Function
                End If
                If GetVar(bstack, what$, i) Then
                        If Typename(var(i)) = "Group" Then
                                BadGroupHandle
                                MyInput = False
                                Exit Function
                        Else
                                var(i) = p
                        End If
                Else
                    If i = -1 Then
                    bstack.SetVar what$, p
                    Else
                        GlobalVar what$, p
                    End If
                End If
                 MyInput = True
        Case 3
               
                If par Then
                        If Uni(f) Then
                                getUniStringComma f, s$
                        Else
                                getAnsiStringComma f, s$
                        End If
                Else
                 prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        QUERY bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), IIf(MaybeIsSymbol(rest$, ","), Chr$(0), ",")
                End If
                If GetVar(bstack, what$, i) Then
                        CheckVar var(i), s$
                Else
                    If i = -1 Then
                        bstack.SetVar what$, s$
                    Else
                        GlobalVar what$, s$
                    End If
                End If
                 MyInput = True
    Case 4
               
                If par Then
                        If Uni(f) Then
                                getUniRealComma f, p
                        Else
                                Input #f, p
                        End If
                Else
                                prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), "+*/!.@#$|\{}[]'~`%^&()=_:;", True)
                       If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False: Exit Function
                        If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False: Exit Function
                End If
                If GetVar(bstack, what$, i) Then
                        var(i) = Int(p)
                Else
                        If i = -1 Then
                        bstack.SetVar what$, Int(p)
                        Else
                        GlobalVar what$, Int(p)
                        End If
                End If
                 MyInput = True
    Case 5
                If neoGetArray(bstack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                Else
                MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                        Exit Function
                End If
                MyInput = True
                If par Then
                        If Uni(f) Then
                                getUniRealComma f, p
                        Else
                                Input #f, p
                        End If
                Else
              prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), "+*/!@#$|\{}[]'~`%^&()=_:;", True)
                        If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False: Exit Function
                        If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False: Exit Function
                End If
                pppp.item(it) = p
                 MyInput = True
    Case 6
                If neoGetArray(bstack, what$, pppp) Then
                       If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                Else
                 MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                       Exit Function
                End If
                MyInput = True
                If par Then
                        If Uni(f) Then
                                getUniStringComma f, s$
                        Else
                                Input #f, s$
                        End If
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        QUERY bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), IIf(MaybeIsSymbol(rest$, ","), Chr$(0), ",")
                End If
                If Typename(pppp.item(it)) = doc Then
                Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                Else
                        pppp.item(it) = s$
                End If
                 MyInput = True
    Case 7
                If neoGetArray(bstack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                Else
                        MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                        Exit Function
                End If
                If par Then
                        If Uni(f) Then
                                getUniRealComma f, p
                        Else
                                Input #f, p
                        End If
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), ",", vbCr), "+*/!@#$|\{}[.]'~`%^&()=_:;", True)
                         If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False: Exit Function
                        If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False: Exit Function
                End If
                pppp.item(it) = Int(p)
                MyInput = True
    End Select
    
                If FastSymbol(rest$, ",") Then
                w$ = ""
                If Not par Then frm$ = " "
                ElseIf FastSymbol(rest$, ";") Then
                If Not par Then
               
                                 w$ = ";"
                                frm$ = " "
                   End If
                Else
                If Not par Then If Not w$ = ";" Then crNew bstack, players(prive)
                w$ = ""
                Exit Function
                End If
                
                Loop
                FKey = 0
                Exit Function
                End With

End Function
Function MyModules(bstack As basetask, rest$, lang As Long) As Boolean
Dim frm$, s$, pa$, ss$, mDir As recDir

MyModules = True
frm$ = subHash.ShowRev    ' Mid$(SubName$, 2)
s$ = ""
pa$ = ""
ss$ = ""
Do While ISSTRINGA(frm$, s$)
If InStr(s$, ChrW(&H1FFF)) > 0 Then
Else
If frm$ <> "" Then
    If InStrRev(s$, ")") > 0 Then
    
    pa$ = pa$ & Left$(s$, InStrRev(s$, ")") - 1) & ", "
    Else
    pa$ = pa$ & Left$(s$, InStrRev(s$, " ") - 1) & ", "
    End If
Else
    If InStrRev(s$, ")") > 0 Then
    pa$ = pa$ & Left$(s$, InStrRev(s$, ")") - 1)
    Else
    pa$ = pa$ & Left$(s$, InStrRev(s$, " ") - 1)
    End If
End If
End If
Loop

If pa$ <> "" Then
If here$ <> "" Then If FastSymbol(rest$, "?") Then GoTo ponly
If lang Then

pa$ = "In Memory: " & pa$ & vbCrLf & "        Use REMOVE to remove the left most, EDIT module_name to edit"
Else
pa$ = "Στη Μνήμη: " & pa$ & vbCrLf & "        Με τη ΔΙΑΓΡΑΦΗ θα σβήσεις το τελευταίο, με ΣΥΓΓΡΑΦΗ ή Σ όνομα_τμήματος θα γράψεις"
End If
If here$ = "" Then If FastSymbol(rest$, "?") Then GoTo ponly
End If
IsSymbol3 rest$, "?"

Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "GSB", False))

If frm$ <> "" Then
If pa$ <> "" Then pa$ = pa$ & vbCrLf
If lang Then
pa$ = pa$ & "On Disk: "
Else
pa$ = pa$ & "Στον Δίσκο: "
End If
End If
ss$ = ""
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = ""

Loop
Set mDir = Nothing
pa$ = pa$ & ss$
If ss$ <> "" Then
If here$ = "" Then
If lang Then
pa$ = pa$ & vbCrLf + ReplaceStr$("'", Chr(34), "        Use LOAD 'module_name' to load, EDIT 'module_name.gsb' to edit on disk")
If IsSupervisor Then pa$ = pa$ & ", WIN DIR$ for folders tasks"
Else
pa$ = pa$ & vbCrLf + ReplaceStr$("'", Chr(34), "        Με ΦΟΡΤΩΣΕ ονομα_τμηματος φορτώνεις στη μνήμη, με Σ ή ΣΥΓΓΡΑΦΗ 'ονομα_τμηματος.gsb' διορθώνεις στο δίσκο")
If IsSupervisor Then pa$ = pa$ & ", με ΣΥΣΤΗΜΑ ΚΑΤ$ ανοίγεις τον κατάλογο με τα αρχεία για εργασίες"
End If
End If
End If
' PRINT ONLY
ponly:
RepPlain bstack, bstack.Owner, pa$

End Function
Function MyScore(bstack As basetask, rest$) As Boolean
Dim s$, sx As Double, p As Double
MyScore = False
If IsExp(bstack, rest$, p) Then
If p >= 1 And p <= 16 Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, sx) Then
If FastSymbol(rest$, ",") Then
If IsStrExp(bstack, rest$, s$) Then
voices(p - 1) = s$
BEATS(p - 1) = sx
MyScore = True
End If
End If
End If
End If
End If
End If
End Function

Function MyPlayScore(bstack As basetask, rest$) As Boolean
Dim task As TaskInterface, sx As Double, p As Double

MyPlayScore = True
If IsExp(bstack, rest$, p) Then
    If p = 0 Then
    TaskMaster.MusicTaskNum = 0
    TaskMaster.OnlyMusic = True
    Do
    TaskMaster.TimerTickNow
    Loop Until TaskMaster.PlayMusic = False
    TaskMaster.OnlyMusic = False   '' forget it in revision 130
   mute = True
    Else
    mute = False
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, sx) Then
          If sx < 1 Then
          sx = 0
          Do While TaskMaster.ThrowOne(CLng(p))
          sx = sx - 1
          If sx < -100 Then Exit Do
          Loop
          Else
          Set task = New MusicBox
          Set task.Owner = Form1.DIS
         
          task.Parameters CLng(p), CLng(sx)
          TaskMaster.MusicTaskNum = TaskMaster.MusicTaskNum + 1
          TaskMaster.AddTask task
          End If
          Do While FastSymbol(rest$, ",")
           MyPlayScore = False
        If IsExp(bstack, rest$, p) Then
             If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, sx) Then
                If sx < 1 Then
                        sx = 0
                        Do While TaskMaster.ThrowOne(CLng(p))
                        sx = sx - 1
                        If sx < -100 Then Exit Do
                        Loop
                  Else
                    Set task = New MusicBox
                    Set task.Owner = Form1.DIS
                    task.Parameters CLng(p), CLng(sx)
                    TaskMaster.MusicTaskNum = TaskMaster.MusicTaskNum + 1
                     TaskMaster.AddTask task
              End If
                MyPlayScore = True
                 End If
            End If
        End If
        If MyPlayScore = False Then
          mute = True
        Exit Do
        End If
          Loop
        End If
    End If
    End If
Else

MyPlayScore = False
End If
End Function
Function MyCopy(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, scr As Object, photo As cDIBSection, s$, it As Long, what$
MyCopy = True
Dim x1 As Long, y1 As Long, x2 As Long, y2 As Long, pppp As mArray
            If IsStrExp(bstack, rest$, s$) Then
            On Error Resume Next
            If ExtractType(s$) = "" Then s$ = s$ + ".bmp"
            FixPath s$
            If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            Set photo = New cDIBSection
            photo.CopyPicture bstack.Owner
            photo.SaveDib s$
            Set photo = Nothing
            Exit Function
Else
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p

If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
Select Case Abs(IsLabel(bstack, rest$, s$))
Case 3
    If GetVar(bstack, s$, it) Then
    
    Set photo = New cDIBSection
    Set scr = bstack.Owner
    With players(GetCode(scr))
    x1 = scr.ScaleX(x1 + .XGRAPH, 1, 3) - scr.ScaleX(.XGRAPH, 1, 3)
    y1 = scr.ScaleX(y1 + .YGRAPH, 1, 3) - scr.ScaleX(.YGRAPH, 1, 3)
    If photo.Create(CLng(x1), CLng(y1)) Then
    photo.LoadPictureBlt scr.hDC, CLng(scr.ScaleX(.XGRAPH, 1, 3)), CLng(scr.ScaleX(.YGRAPH, 1, 3))
    
    If photo.bitsPerPixel <> 24 Then Conv24 photo
    
    var(it) = DIBtoSTR(photo)
    ' DOSE OK
    End If
    End With
     Set photo = Nothing
     Set scr = Nothing
    Exit Function
    Else
    what$ = s$
    MyCopy = False
    Exit Function
    End If
Case 6
    ' ΑΠΟ ΠΙΝΑΚΑ
    Dim W6 As Long
    If neoGetArray(bstack, s$, pppp) Then
           If Not NeoGetArrayItem(pppp, bstack, s$, W6, rest$) Then Exit Function
    
    
      Set photo = New cDIBSection
      Set scr = bstack.Owner
      With players(GetCode(scr))
    x1 = scr.ScaleX(x1 + .XGRAPH, 1, 3) - scr.ScaleX(.XGRAPH, 1, 3)
    y1 = scr.ScaleX(y1 + .YGRAPH, 1, 3) - scr.ScaleX(.YGRAPH, 1, 3)
    If photo.Create(CLng(x1), CLng(y1)) Then
            photo.LoadPictureBlt scr.hDC, CLng(scr.ScaleX(.XGRAPH, 1, 3)), CLng(scr.ScaleX(.YGRAPH, 1, 3))

            If photo.bitsPerPixel <> 24 Then Conv24 photo
                If IsObject(pppp.item(W6)) Then
                        MyEr "can't copy image to " + Typename(pppp.item(W6)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W6))
                        MyCopy = False
                Else
                        pppp.item(W6) = DIBtoSTR(photo)
                End If
            ' DOSE OK
        End If
        End With
        Set photo = Nothing
        Set scr = Nothing
        Exit Function
    
        Else
    what$ = s$
    MyCopy = False
    Exit Function
    End If

End Select
ElseIf IsLabelSymbolNew(rest$, "ΜΕ", "USE", lang) Then

If IsStrExp(bstack, rest$, s$) Then
 Set photo = New cDIBSection

If cDib(s$, photo) Then
x2 = 0
  Set scr = bstack.Owner
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x2 = p
    If y2 = 0 Then y2 = 100
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else y2 = 100
    If x2 = 0 Then
   
    If y2 = 100 Then

 photo.PaintPicture scr.hDC, CLng(scr.ScaleX(x1, 1, 3)), CLng(scr.ScaleX(y1, 1, 3))


    Else
        photo.StretchPicture scr.hDC, CLng(scr.ScaleX(x1, 1, 3)), CLng(scr.ScaleX(y1, 1, 3)), photo.Width * y2 \ 100, photo.Height * y2 \ 100
        End If
     
    Else
  
     RotateDib1 bstack, photo, x2, y2, scr.BackColor
      photo.PaintPicture scr.hDC, CLng(scr.ScaleX(x1, 1, 3)), CLng(scr.ScaleX(y1, 1, 3))
    End If
End If
Set photo = Nothing
Set scr = Nothing
Else
 MyCopy = False: MissNumExpr: Exit Function
End If
ElseIf IsLabelSymbolNew(rest$, "ΕΠΑΝΩ", "TOP", lang) Then

If IsStrExp(bstack, rest$, s$) Then
 Set photo = New cDIBSection
Set scr = bstack.Owner
If cDib(s$, photo) Then
x2 = 0
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x2 = p
    If y2 = 0 Then y2 = 100
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else y2 = 100
    

     RotateDib1 bstack, photo, x2, y2, , CLng(x1), CLng(y1)
       
        photo.PaintPicture scr.hDC, MyRound((scr.ScaleX(x1, 1, 3)), 0), MyRound((scr.ScaleX(y1, 1, 3)), 0) '', photo.Width * y2 \ 100, photo.Height * y2 \ 100
     
 
End If
Set photo = Nothing
Set scr = Nothing
Else
 MyCopy = False: MissNumExpr: Exit Function
End If
Else
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x2 = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else MyCopy = False: MissNumExpr: Exit Function

If x2 = 0 Or y2 = 0 Then MyCopy = False: MissNumExpr: Exit Function
ICOPY bstack.Owner, x1, y1, x2, y2
End If
End If
MyDoEvents1 bstack.Owner

End Function
Function MyDrawings(bstack As basetask, rest$, lang As Long) As Boolean
MyDrawings = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "WMF", False))
s$ = ""
ss$ = ""
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = ""
Loop

If lang Then
ss$ = "Drawings: " & ss$
Else
ss$ = "Σχέδια: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function
Function MySounds(bstack As basetask, rest$, lang As Long) As Boolean
MySounds = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "WAV", False))
s$ = ""
ss$ = ""
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = ""
Loop
If lang Then
ss$ = "Sounds: " & ss$
Else
ss$ = "Ηχοι: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function

Function MyMovies(bstack As basetask, rest$, lang As Long) As Boolean
MyMovies = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "AVI", False))
s$ = ""
ss$ = ""
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = ""
Loop
Set mDir = Nothing
If lang Then
ss$ = "Movies: " & ss$
Else
ss$ = "Ταινίες: " & ss$
End If
RepPlain bstack, bstack.Owner, ss$
End Function
Function MyBitmaps(bstack As basetask, rest$, lang As Long) As Boolean
MyBitmaps = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "BMP", False))
s$ = ""
ss$ = ""
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = ""
Loop
If lang Then
ss$ = "Bitmaps: " & ss$
Else
ss$ = "Εικόνες: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function
Function MyFunction(entrypoint As Long, bstack As basetask, rest$, lang As Long) As Boolean
Dim y1 As Long, par As Boolean, what$, s$, ss$, pa$, x1 As Long, i As Long
Dim ohere$
ohere$ = here$
MyFunction = True
        If entrypoint = 1 Then
                par = True
                y1 = True
        Else
                y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", lang)
                par = IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", lang)
        End If
        If y1 <> 0 Then
                ' FUNCTION GLOBAL "ALFA[212].other" {definition} so we can place [ ] in a definition..
                ' FOR INTERNAL USE..
                    If MaybeIsSymbol(rest$, Chr(34)) Then
                        ISSTRINGA rest$, what$
                            x1 = 1
                        If Right$(what$, 1) = "$" Then
                            x1 = 3
                        ElseIf Right$(what$, 1) = "%" Then
                            x1 = 4
                        End If
                        what$ = what$ & "()"
                        If FastSymbol(rest$, "{") Then
                                ss$ = block(rest$)
                                i = Len(rest$)
                                If Not FastSymbol(rest$, "}") Then
                                        MyFunction = False
                                Else
                                ''*****************************************************************************
                                      If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                                If Left$(sbf(bstack.OriginalCode).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = ""
                                                        Else
                                                                pa$ = sbf(bstack.OriginalCode).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                                                End If
                                                        End If
                                                Else
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf
                                                        End If
                                                End If
                                   
                                        bstack.IndexSub = GlobalSub(what$, s$ + ss$)
                                End If
                                Exit Function
                        End If
                End If
        End If
        x1 = Abs(IsLabel(bstack, rest$, what$))
        If x1 = 1 Or x1 = 3 Or x1 = 4 Then   ' C() C%() C$()
                what$ = what$ & "()"
                MakeThisSub bstack, what$
                If y1 Then  ' We have a global function
                        If Not GetGlobalSubAfterHere(bstack, what$, x1) Then
                                If FastSymbol(rest$, "{") Then
                                        ss$ = block(rest$)
                                        i = Len(rest$)
                                        If Not FastSymbol(rest$, "}") Then
                                                MyFunction = False
                                        Else
                                                  If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                                  If Left$(sbf(bstack.OriginalCode).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = ""
                                                        Else
                                                                pa$ = sbf(bstack.OriginalCode).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                                                End If
                                                        End If
                                                Else
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf
                                                        End If
                                                End If
                                             bstack.IndexSub = GlobalSub(what$, s$ + ss$)
                                    
                                        End If
                                Else
                                       MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                                End If
                         Else
                                If FastSymbol(rest$, "{") Then
                                        what$ = block(rest$)
                                        If Not FastSymbol(rest$, "}") Then
                                                MyFunction = False
                                        Else
                                                Call preProcessor(bstack, what$)
                                                If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                sbf(x1).sb = what$: bstack.IndexSub = x1
                                        End If
                                Else
                                    MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                                End If
                        End If
                        Exit Function
                Else
                If par Then
                x1 = GlobalSub(what$, "", "")
                GoTo jump1
                        ElseIf here$ = "" And GetSub(what$, x1) Then
jump1:
                                If x1 >= lckfrm And lckfrm <> 0 Then   ' when we load a scrabled program..we have locked functions/modules
                                            MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                            rest$ = ""
                                            MyFunction = False: Exit Function
                                End If
                                If FastSymbol(rest$, "{") Then
                                          ''  I = Len(Rest$)      'function point in source
                                            what$ = block(rest$) + " "
                                           '' While Left$(what$, 10) = "'11001EDIT"
                                            ''        SetNextLine what$
                                           '' Wend
                                         ''   what$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(I) + vbCrLf + what$
                                            If Not FastSymbol(rest$, "}") Then
                                                    MyFunction = False
                                            Else
                                                    Call preProcessor(bstack, what$)
                                                    If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                    sbf(x1).sb = what$: bstack.IndexSub = x1
                                            End If
                                    Else
                                            MyFunction = False
                                    End If
                                    Exit Function
                        ElseIf GetlocalSub(bstack.GroupName & what$, x1) Then
                                    If x1 >= lckfrm And lckfrm <> 0 Then
                                            MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                            rest$ = ""
                                            MyFunction = False: Exit Function
                                    End If
                                    If FastSymbol(rest$, "{") Then
                                            i = Len(rest$)
                                            what$ = block(rest$) + " "
                                            While Left$(what$, 10) = "'11001EDIT"
                                                    SetNextLine what$
                                            Wend
                                            If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                            what$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf + what$
                                            If Not FastSymbol(rest$, "}") Then
                                                    MyFunction = False
                                            Else
                                                    Call preProcessor(bstack, what$)
                                                    If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                    sbf(x1).sb = what$
                                                    bstack.IndexSub = x1
                                            End If
                                    Else
                                    '' or MyFunction=false
                                            rest$ = ":" & bstack.GroupName & what$ & " " & rest$
                                    End If
                                    Exit Function
                        ElseIf FastSymbol(rest$, "{") Then
                                    If here$ = "" Then
                                                s$ = block(rest$)
                                                If Right$(s$, 2) <> vbCrLf Then s$ = s$ + vbCrLf
                                                ' NEED TO HAVE A HEADER ******************************************************************************
                                                bstack.IndexSub = GlobalSub(what$, s$)
                                    Else
                                                ss$ = block(rest$)
                                                i = Len(rest$)
                                                If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                                If Left$(sbf(bstack.OriginalCode).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = ""
                                                        Else
                                                                pa$ = sbf(bstack.OriginalCode).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                                                         
                                                                End If
                                                        End If
                                                Else
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf
                                                        End If
                                                End If

                                                bstack.IndexSub = GlobalSub(here$ & "." & bstack.GroupName & what$, s$ + ss$)
                                                
                                    End If
                                    If Not FastSymbol(rest$, "}") Then MyFunction = False
                                    Exit Function
                            Else
                                    MyFunction = False
                            End If
                End If
        Else
                rest$ = what$ & " " & rest$
                MyFunction = False
        End If

End Function
Function ProcDBprovider(bstack As basetask, rest$, lang As Long) As Boolean
Dim pa$, s$, ss$
ProcDBprovider = True
If IsStrExp(bstack, rest$, pa$) Then
If pa$ = "" Then
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
Else
' DB.PROVIDER "Microsoft.Jet.OLEDB.4.0", "Jet OLEDB", "100101"
' DB.PROVIDER "dns=testme;Uid=admin;Pwd=12alfa45", "ODBC", "100101"
' use (name) for database name

 JetPrefixUser = "Provider=" + pa$ + ";Data Source="  ' normal
    If FastSymbol(rest$, ",") Then
       If IsStrExp(bstack, rest$, s$) Then
          If s$ = "" Then
             ProcDBprovider = False
          ElseIf UCase(s$) = "ODBC" Or UCase(s$) = "PATH" Then
                If FastSymbol(rest$, ",") Then
                 If IsStrExp(bstack, rest$, ss$) Then
                 JetPrefixUser = pa$ & ";Password=" & ss$
                 Else
                 JetPrefixUser = pa$ & ";Password="
                 End If
                Else
                JetPrefixUser = pa$
                End If
                JetPostfixUser = ";"
          Else
          
             If FastSymbol(rest$, ",") Then
                If IsStrExp(bstack, rest$, ss$) Then
                   If ss$ = "" Then
                       JetPostfixUser = ";" & s$ & ":Database Password=100101;"
                   Else
                       JetPostfixUser = ";" & s$ & ":Database Password=" & ss$ & ";"
                   
                   End If
                    
                Else
                    ProcDBprovider = False
                End If
             Else
                JetPostfixUser = ";" & s$ & ":Database Password=100101;"
             End If
          End If
        Else
         ProcDBprovider = False
       End If
    Else
       JetPostfixUser = JetPostfixHelp

    End If
 End If
 Else
 JetPrefixUser = JetPrefixHelp
 
End If
JetPostfix = JetPostfixUser
JetPrefix = JetPrefixUser
End Function
Function ProcDBUSER(bstack As basetask, rest$, lang As Long) As Boolean
Dim s$
ProcDBUSER = -True
    If IsStrExp(bstack, rest$, s$) Then
        If s$ = "" Then
            extDBUser = ""
            extDBUserPassword = ""
        Else
            extDBUser = s$
        End If
        If FastSymbol(rest$, ",") Then
            If Not IsStrExp(bstack, rest$, extDBUserPassword) Then
                extDBUserPassword = ""
            End If
            DBUser = extDBUser
            DBUserPassword = extDBUserPassword
        End If
    End If

End Function
Function ProcChooseOrgan(bstack As basetask, rest$, lang As Long) As Boolean
Dim f As Long, i As Long, s$
If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
Form1.List1.Clear
f = 0
For i = 1 To 127
s$ = ORGAN(i)
Form1.List1.additemFast s$
'If TextWidth(bstack.Owner, s$) > f Then f = TextWidth(bstack.Owner, s$)
Next i
ProcChooseOrgan = MyMenu(1, bstack, rest$, lang)
End Function
Function ProcChooseObj(bstack As basetask, rest$, lang As Long) As Boolean
Dim f As Long, i As Long, s$, p As Double
    Dim iSectCount As Long, iSect As Long, sSections() As String
    Dim iVerCount As Long, iVer As Long, sVersions() As String
      Dim iExeSectCount As Long, iExeSect As Long, sExeSect() As String

If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
 Form1.List1.Clear
    If MaybeIsSymbol(rest$, "!") Then
            ObjectCatalog.Done = True
            For i = 0 To ObjectCatalog.count - 1
                ObjectCatalog.index = i
                Form1.List1.additemFast ObjectCatalog.KeyToString
                
            Next i
        ProcChooseObj = MyMenu(2, bstack, rest$, lang)
    Else
      
       Set ObjectCatalog = New FastCollection
       Dim cr As New cRegistry, first$, k As Long
       Dim bFoundExeSect As Boolean, ss$, mmdir As New recDir
       '' some code here are copies from VbScriptEditor
       '' http://www.codeproject.com/Articles/19986/VbScript-Editor-With-Intellisense
       cr.ClassKey = HKEY_CLASSES_ROOT
       cr.ValueType = REG_SZ
       cr.SectionKey = "TypeLib"
        If cr.EnumerateSections(sSections(), iSectCount) Then
            For iSect = 1 To iSectCount
                cr.SectionKey = "TypeLib\" & sSections(iSect)
                If cr.EnumerateSections(sVersions(), iVerCount) Then
             
                    For iVer = 1 To iVerCount
                    
                            cr.SectionKey = "TypeLib\" & sSections(iSect) & "\" & sVersions(iVer)
                            first$ = cr.Value
                            cr.EnumerateSections sExeSect(), iExeSectCount
                           ''    ObjectCatalog.AddKey cR.Value + sVersions(iVer) + CStr(k), cR.Value + " (" + sVersions(iVer) + ")" + CLSIDToProgID(sSections(iSect))
                            If iExeSectCount > 0 Then
                                       bFoundExeSect = False
                                        For iExeSect = 1 To iExeSectCount
                                            If IsNumeric(sExeSect(iExeSect)) Then
                                            
                                            cr.SectionKey = cr.SectionKey & "\" & sExeSect(iExeSect) & "\win32"
                                                bFoundExeSect = True
                                            Exit For
                     
                                            End If
                                    Next iExeSect
                                                
                                       If bFoundExeSect Then
                                            ss$ = cr.Value
                                            
'
                                             ss$ = ExtractPath(ss$, , True) + ExtractName(ss$)
                                             If mmdir.ExistFile(ss$) Then
                                             
                                                ObjectCatalog.AddKey first$ + " (" + sVersions(iVer) + ")", ss$
 
                                               
                                          End If
                                        End If
               
                            End If
                            
                       Next iVer
                     End If
            Next iSect
            ObjectCatalog.Sort
            ObjectCatalog.Done = True
            For i = 0 To ObjectCatalog.count - 1
                ObjectCatalog.index = i
                Form1.List1.additemFast ObjectCatalog.KeyToString
                
            Next i
            
            ProcChooseObj = MyMenu(2, bstack, rest$, lang)
        
        Else
            OutOfLimit
            ProcChooseObj = False
        End If
    End If
End Function

Function ProcBrowser(bstack As basetask, rest$, lang As Long) As Boolean
Dim s$, w$, x As Double
ProcBrowser = True
If Not IsStrExp(bstack, rest$, s$) Then
    If Not Abs(IsLabelBig(bstack, rest$, s$, , w$)) = 1 Then
    If NOEDIT Then
    
    If Form1.view1.Visible Then
     Form1.KeyPreview = True
     ProcTask2 bstack
    Form1.view1.SetFocus: Form1.KeyPreview = False
    Else
    Form1.KeyPreview = True
    End If
    Else
    
    End If
        Exit Function
    Else
    s$ = w$ '' low case
    End If
End If
            If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IEX = CLng(x): IESizeX = Form1.ScaleWidth - IEX Else MissNumExpr: ProcBrowser = False: Exit Function
                If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IEY = CLng(x): IESizeY = Form1.ScaleHeight - IEY Else MissNumExpr: ProcBrowser = False: Exit Function
                                If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IESizeX = CLng(x) Else MissNumExpr: ProcBrowser = False: Exit Function
                                    If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IESizeY = CLng(x) Else MissNumExpr: ProcBrowser = False: Exit Function
                 End If
                End If
             End If
           End If
           If IESizeX = 0 Or IESizeY = 0 Then
           IEX = Form1.ScaleWidth / 8
           IEY = Form1.ScaleHeight / 8
           IESizeX = Form1.ScaleWidth * 6 / 8
           IESizeY = Form1.ScaleHeight * 6 / 8
           End If

If myLcase(Left$(s$, 7)) = "http://" Or myLcase(Left$(s$, 4)) = "www." Or myLcase(Left$(s$, 6)) = "about:" Then
Form1.IEUP s$
ElseIf s$ <> "" Then
Form1.IEUP "file:" & strTemp + s$
Else
Form1.IEUP ""
Form1.KeyPreview = True
End If
ProcTask2 bstack
End Function

Function ProcView(bstack As basetask, rest$, lang As Long) As Boolean
If bstack.toprinter Then oxiforPrinter: Exit Function
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
GetNames bstack, rest$, Form1.List1, lang
mywait bstack, CDbl(100)
If Not FastSymbol(rest$, ";") Then ProcView = MyMenu(2, bstack, rest$, lang) Else ProcView = True
End Function

Function ProcTone(bstack As basetask, rest$) As Boolean
Dim p As Double, sx As Double
If IsExp(bstack, rest$, p) Then
    If Not FastSymbol(rest$, ",") Then
       Beeper 1000, p
    ElseIf IsExp(bstack, rest$, sx) Then
    Beeper sx, p
    Else
    MyEr "wrong parameter", "λάθος παράμετρος"
    Exit Function
    End If
Else
Beeper 1000, 100
End If
ProcTone = True
End Function
Function ProcBuffer(bstack As basetask, rest$, lang As Long) As Boolean
ProcBuffer = True
Dim s$, what$, i As Long, p As Double, PP As Long, par As Long, what2$, Runnable As Boolean
If IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", lang) Then Runnable = True
If IsLabelSymbolNew(rest$, "ΚΕΝΗ", "CLEAR", lang) Then par = &H8

     Do While Abs(IsLabel(bstack, rest$, what$)) = 1
     If bstack.priveflag Then what$ = ChrW(&HFFBF) + what$
     
                    If GetlocalVar(bstack.GroupName & what$, i) Then
                        If Not IsObject(var(i)) Then MakeitObjectBuffer var(i)
                    ElseIf GetVar(bstack, bstack.GroupName & what$, i) Then
                        If Not IsObject(var(i)) Then MakeitObjectBuffer var(i)
                    Else
                        i = GlobalVar(bstack.GroupName & what$, s$)
                        MakeitObjectBuffer var(i)
                    End If
                    ' GET TYPE OF  BUFFER
                    ' Char (1 byte) String (2 bytes)  Long (4 Bytes)
                    PP = 1
                    If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
                        If IsLabelSymbolNew(rest$, "ΨΗΦΙΟ", "BYTE", lang, , , , False) Then
                            PP = 1
                        ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", lang, , , , False) Then
                            PP = 2
                        ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", lang, , , , False) Then
                            PP = 4
                        ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", lang, , , , False) Then
                            PP = 8
                        ElseIf Abs(IsLabel(bstack, rest$, what2$)) = 1 Then
                        If IsExp(bstack, what2$, p) Then
                                If bstack.lastobj Is Nothing Then GoTo comehere
                                If Not TypeOf bstack.lastobj Is mHandler Then GoTo comehere
                                If Not TypeOf bstack.lastobj.objref Is FastCollection Then GoTo comehere
                                If bstack.lastobj.objref.StructLen = 0 Then GoTo comehere
                               PP = bstack.lastobj.objref.StructLen
                               Set var(i).objref.structref = bstack.lastobj.objref
                               var(i).objref.UseStruct = True
                               Set bstack.lastobj = Nothing
                        End If
                        Else
comehere:
                        SyntaxError
                            ProcBuffer = False
                                Exit Function
                        End If
                    
                    If FastSymbol(rest$, "*") Then
                        If IsExp(bstack, rest$, p) Then
                        ' we get the size here
                        If p <= 0 Then
                            MyEr "No Zero or Negative number for size", "Όχι μηδέν ή αρνητικό αριθμό για μήκος"
                            ProcBuffer = False
                            Exit Function
                        Else
                         '' MAKE IT
                    If var(i).objref.ItemSize <> 0 Then
                    If var(i).objref.ItemSize = PP Then
                    var(i).objref.ResizeItems CLng(p), par
                    End If
                    
                    Else

                                             var(i).objref.Costruct PP, CLng(p), par, Runnable
                        End If
                        End If
                        Else
                            MissPar
                            ProcBuffer = False
                            Exit Function
                        End If
                        
                    Else
                    If var(i).objref.Status = 0 Then
                        var(i).objref.Costruct PP, 1, par, Runnable
                        End If
                    End If
                End If
     
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     Loop

End Function
Function ProcInventory(bstack As basetask, rest$, lang As Long) As Boolean
ProcInventory = True
Dim s$, what$, i As Long, p As Double


     Do While Abs(IsLabel(bstack, rest$, what$)) = 1
     If bstack.priveflag Then what$ = ChrW(&HFFBF) + what$
     If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(bstack.GroupName & what$, i) Then
       
            If Not IsObject(var(i)) Then GoTo makeitnow1
            GoTo there12
            ElseIf GetVar(bstack, bstack.GroupName & what$, i) Then
             If Not IsObject(var(i)) Then GoTo makeitnow1
            GoTo there12
            Else
            i = GlobalVar(bstack.GroupName & what$, s$)     ' MAKE ONE  '

             GoTo makeitnow1
            End If
            ElseIf GetVar(bstack, bstack.GroupName & what$, i) Then
             If Not IsObject(var(i)) Then GoTo makeitnow1
                GoTo there12
            Else
        
                i = GlobalVar(bstack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow1:
                    MakeitObjectInventory var(i)
there12:
' here look for block
                    If FastSymbol(rest$, "=") Then
                        Set bstack.lastobj = var(i)
                        ProcInventory = AddInventory(bstack, rest$)
                        Exit Function
                    Else
                    ' DO NOTHING
                    End If
                End If
            End If
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     Loop

End Function


Function ProcSettings(bstack As basetask, rest$, lang As Long) As Boolean
Dim it As Long
TweakLang = lang
With bstack.Owner
    it = .FontItalic
    .FontItalic = 0
    notweak = True
    If Not Form1.Visible Then
    TweakForm.Show , Form5
    Else
    TweakForm.Show 1, Form1
    End If
    If Not notweak Then
        Form1.myBreak bstack
        Original bstack, ""
    Else
        .FontItalic = it
    End If
End With
ProcSettings = True
End Function
Function ProcThreadPlan(bstack As basetask, rest$, lang As Long) As Boolean
If IsLabelSymbolNew(rest$, "ΤΑΥΤΟΧΡΟΝΟ", "CONCURRENT", lang) Then
If TaskMaster.QueueCount <> 0 Then
If Not Interrupted Then MyEr "Threads exist, can't change thread plan", "Υπάρχουν νήματα, δεν μπορείς να αλλάξεις σχέδιο"
Else
Interrupted = True
End If

ElseIf IsLabelSymbolNew(rest$, "ΔΙΑΔΟΧΙΚΟ", "SEQUENTIAL", lang) Then
If TaskMaster.QueueCount <> 0 Then
If Interrupted Then MyEr "Threads exist, can't change thread plan", "Υπάρχουν νήματα, δεν μπορείς να αλλάξεις σχέδιο"
Else
Interrupted = False
End If
End If
ProcThreadPlan = True
End Function
Function ProcBeep(bstack As basetask, rest$) As Boolean
Dim p As Double
If IsExp(bstack, rest$, p) Then
MessageBeep CLng(p)
Else
Beep
End If
ProcBeep = True
End Function
Function ProcSound(bstack As basetask, rest$) As Boolean
Dim s$
If IsStrExp(bstack, rest$, s$) Then PlaySoundNew s$
ProcSound = True
End Function
Function ProcTune(bstack As basetask, rest$) As Boolean
'' break async
Dim p As Double, s$
If IsExp(bstack, rest$, p) Then
    If Not FastSymbol(rest$, ",") Then
        beeperBEAT = CLng(p)
    ElseIf IsStrExp(bstack, rest$, s$) Then
        beeperBEAT = CLng(p)
        PlayTune (s$)
    Else
        MyEr "wrong parameter", "λάθος παράμετρος"
        Exit Function
    End If
ElseIf IsStrExp(bstack, rest$, s$) Then
' B C D E F G
PlayTune (s$)
End If
ProcTune = True
End Function
Function ProcName(bstack As basetask, rest$, lang As Long) As Boolean
Dim s$, w$, x1 As Long, y1 As Long, ss$
ProcName = True
x1 = Abs(IsLabelBig(bstack, rest$, s$, , w$))

If x1 = 1 Then
s$ = w$
 If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then ProcName = False: Exit Function
 y1 = Abs(IsLabelBig(bstack, rest$, ss$, , w$))
 If y1 = 0 Then
rest$ = w$ + rest$
y1 = IsStrExp(bstack, rest$, ss$)
ElseIf y1 = 1 Then
ss$ = w$
End If
If y1 <> 0 Then
If Not CanKillFile(CFname(s$)) Then FilePathNotForUser: ProcName = False: Exit Function
RenameFile s$, ss$

Exit Function
End If
Else
rest$ = s$ + rest$
End If
If IsStrExp(bstack, rest$, s$) Then
 If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then ProcName = False: Exit Function
If IsStrExp(bstack, rest$, ss$) Then
On Error Resume Next
RenameFile s$, ss$
On Error GoTo 0
Else
ProcName = False
Exit Function
End If
Else
ProcName = False
Exit Function
End If
End Function
Function ProcOpen(bstack As basetask, rest$, lang As Long) As Boolean
Dim s$, what$, it As Long, p As Double, x1 As Long, i As Long
If IsStrExp(bstack, rest$, s$) Then
If s$ <> "" Then
FixPath s$
Else
BadFilename
Exit Function
End If
    If IsLabelSymbolNew(rest$, "ΓΙΑ", "FOR", lang) Then
    
    i = FreeFile
   Uni(i) = IsLabelSymbolNew(rest$, "ΕΥΡΙΑ", "WIDE", lang)
   'SPELLING CORRECTION FOR GREEK WORD..
   If Not Uni(i) Then Uni(i) = IsLabelSymbolNew(rest$, "ΕΥΡΕΙΑ", "WCHAR", lang)
    If IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗ", "INPUT", lang) Then
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
                    If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                        If GetVar(bstack, what$, it) Then
                            var(it) = i
                        Else
                            GlobalVar what$, i
                        End If
                        FLEN(i) = 1
                        If CFname(GetDosPath(s$)) <> "" Then
                            On Error Resume Next
                                Open GetDosPath(s$) For Binary Access Read As i
                            If Err.Number > 0 Then Exit Function
                         
                        End If
                End If
                End If
        ElseIf IsLabelSymbolNew(rest$, "ΣΥΜΠΛΗΡΩΣΗ", "APPEND", lang) Then
         If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
                If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                    If GetVar(bstack, what$, it) Then
                        var(it) = i
                    Else
                        GlobalVar what$, i
                    End If
                    If CFname(GetDosPath(s$)) <> "" Then
                        FLEN(i) = 1
                        On Error Resume Next
                        If Not WeCanWrite(GetDosPath(s$)) Then ProcOpen = False: Exit Function
                            Open GetDosPath(s$) For Binary Access Write As i
                            Seek i, LOF(i) + 1
                        If Err.Number > 0 Then Exit Function

                    End If
                End If
            End If
        ElseIf IsLabelSymbolNew(rest$, "ΕΞΑΓΩΓΗ", "OUTPUT", lang) Then
        If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
        If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
            If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                If GetVar(bstack, what$, it) Then
                var(it) = i
                Else
                GlobalVar what$, i
                End If
                On Error Resume Next
                FLEN(i) = 1
                If Not NeoUnicodeFile(s$) Then Exit Function

                 On Error Resume Next
                 Open GetDosPath(s$) For Binary Access Write As i
 
                    If Err.Number > 0 Then Exit Function

               End If
       End If
        ElseIf IsLabelSymbolNew(rest$, "ΠΕΔΙΑ", "RANDOM", lang) Then
        If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
      If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
            If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                If GetVar(bstack, what$, it) Then
                    var(it) = i
                 Else
                    GlobalVar what$, i
                End If
                If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", lang, , , , False) Then
                    If FastSymbol(rest$, "=") Then
                        If IsExp(bstack, rest$, p) Then
                                p = Abs(p)
                   If Uni(i) Then p = p * 2
                                        If p > 32767 Then p = 32767
                                        
                                        x1 = p
                        
                                 FLEN(i) = x1
                        Else
                                Exit Function
                        End If
                    Else
                            Exit Function
                    End If

                        On Error Resume Next
                        If CFname(s$) = "" Then
                         If Not NeoUnicodeFile(s$) Then Exit Function
                        End If
            
                
                        Open GetDosPath(s$) For Binary As i
                        If Err.Number > 0 Then Exit Function
                        
                End If
          End If
        End If
   
            End If

  
    End If
    ProcOpen = True
End If

End Function
Function ProcTargets(bstack As basetask, rest$, lang As Long) As Boolean
If lang = 1 Then
If IsLabelSymbolLatin(rest$, "NEW") Then
If Targets Then
Targets = False
End If
ReDim q(0) As target
End If
Else
If IsLabelSymbol(rest$, "ΝΕΟΙ") Then
If Targets Then
Targets = False
End If
ReDim q(0) As target
End If
End If
ProcTargets = True
End Function
Function ProcWriter(basestack As basetask, rest$, lang As Long) As Boolean
Dim prive As Long
prive = GetCode(basestack.Owner)
If lang = 1 Then
PlainBaSket basestack.Owner, players(prive), "George Karras (C), Kanalaki, Greece 1999-2016"
Else
PlainBaSket basestack.Owner, players(prive), "Γιώργος Καρράς (C), Καναλάκι, Ελλάδα 1999-2016"
End If
crNew basestack, players(prive)
ProcWriter = True
End Function
Function ProcList(basestack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, again$, Clsid() As GUID, LNames() As String, clsNumber As Long, i As Long, probe$, what$
Dim usemodule As Boolean, where As Long, page$
If FastSymbol(rest$, "!") Then
mylist basestack, -2, lang   ' proportional
ElseIf IsLabelSymbolNew(rest$, "ΑΠΟ", "LIB", lang) Then

If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
If here$ <> "" Then
    MyEr "Only in command line interpreter", "Μόνο στον μεταφραστή γραμμής"
    Exit Function
End If

If IsLabelOnly(rest$, what$) = 0 Then
    MyEr "Expect a module name", "Περίμενα ένα όνομα τμήματος"
    Exit Function
End If
what$ = myUcase(what$, True)
If Not subHash.Find(what$, where) Then
If lang = 1 Then
where = GlobalSub(what$, "\\ End for Automatic list" + vbCrLf)
Else
where = GlobalSub(what$, "\\ Τέλος Αυτόματης λίστα" + vbCrLf)
End If
End If
usemodule = True

End If

'' read a name and give a list
'' use Choose.Object
'' List Lib ?
If ObjectCatalog.count <> 0 Then again$ = "!"
' use Choose.object + to make it again
If ProcChooseObj(basestack, again$, lang) Then
' list1 is a glist control
If Form1.List1.ListIndex = -1 Then ProcList = True: Exit Function
    If Form1.List1.listcount > 0 Then
                ObjectCatalog.index = Form1.List1.ListIndex
        If Not usemodule Then
                basestack.soros.PushStr ObjectCatalog.Value
                ProcList = MyReport(basestack, "letter$", lang)
        End If
        On Error GoTo there
        If GetAllCoclasses(ObjectCatalog.Value, Clsid(), LNames(), clsNumber) Then
        If Not usemodule Then If clsNumber > 0 Then ProcList = MyReport(basestack, "{CoClasses - Objects}", lang)
        For i = 0 To clsNumber - 1
        If usemodule Then
            If lang = 1 Then
                page$ = page$ + "Declare "
            Else
                page$ = page$ + "Όρισε "
            End If
            page$ = page$ + LNames(i) + " " + Chr$(34) + GetGUIDstr(Clsid(i)) + Chr$(34) + vbCrLf
        Else
        probe$ = strProgID(Clsid(i))
        basestack.soros.PushStr GetGUIDstr(Clsid(i))
        If probe$ = "" Then
        basestack.soros.PushStr LNames(i)
        Else
        basestack.soros.PushStr probe$
        End If
        
        ProcList = MyReport(basestack, "quote$(letter$)+{, }+quote$(letter$)", lang)
        End If
        Next i
         If usemodule Then
         sbf(where).sb = page$ + sbf(where).sb
         
         End If
       ' If Not UnloadLibrary(ObjectCatalog.Value) Then
        'MyEr "Can't Unload library", "Δεν μπορώ να ξεφορτώσω την βιβλιοθήκη"
        'End If
        End If
      ProcList = True
    End If
Else
ProcList = True
End If
Exit Function
ElseIf IsExp(basestack, rest$, p) Then
mylist basestack, CLng(p), lang

Else
mylist basestack, , lang

  


End If
MyDoEvents1 basestack.Owner
ProcList = True
Exit Function
there:
MyEr Err.Description, Err.Description
Err.Clear
End Function
Function ProcFKey(bstack As basetask, rest$, lang As Long) As Boolean
Dim i As Long, p As Double, s$, prive
If IsLabelSymbolNew(rest$, "ΚΑΘΑΡΟ", "CLEAR", lang) Then
    For i = 1 To 13: FK$(i) = "": Next i
ElseIf IsExp(bstack, rest$, p) Then

    i = ((CLng(p) + 11) Mod 12) + 1
    If FastSymbol(rest$, ",") Then
        If IsStrExp(bstack, rest$, s$) Then
            FK$(i) = s$
        Else
            MissPar
            Exit Function
        End If
    Else
        prive = GetCode(bstack.Owner)
        PlainBaSket bstack.Owner, players(prive), FK$(i)
        crNew bstack, players(prive)
    End If
Else
    s$ = "": prive = GetCode(bstack.Owner)
    For i = 1 To 13
        If FK$(i) <> "" Then
            s$ = s$ + placeme$("ΚΛΕΙΔΙ", "FKEY", lang) + Right$(" " & Str$(i), 3) & " [" & FK$(i) & "]" ' FKEY
            If i = 13 Then s$ = s$ + " SHIFT + F1" Else s$ = s$ + " F" & CStr(i)
            s$ = s$ + vbCrLf
        End If
    Next i
    RepPlain bstack, bstack.Owner, s$
End If
ProcFKey = True
End Function
Function ProcItalic(bstack As basetask, rest$) As Boolean
Dim p As Double
If IsExp(bstack, rest$, p) Then
    bstack.myitalic = (p <> 0)
Else
    bstack.myitalic = Not bstack.myitalic
    p = CDbl(bstack.myitalic)
End If
players(GetCode(bstack.Owner)).italics = Abs(p <> 0)
bstack.Owner.Font.Italic = (p <> 0)
ProcItalic = True
End Function
Function ProcEditDoc(bstack As basetask, rest$, lang As Long) As Boolean
Dim prive As Long, s$, sx As Double, i As Long, DUM As Boolean, frm$
Dim x1 As Long, y1 As Long, p As Double, col As Long
Dim pppp As mArray
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
prive = GetCode(bstack.Owner)
With players(prive)

                Form1.EditTextWord = Not IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", lang)
                DUM = False
                    y1 = Abs(IsLabel(bstack, rest$, s$))
                     
                    If y1 = 6 Then
                                If neoGetArray(bstack, s$, pppp) Then
                                 If Not NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then Exit Function
                                Else
                                MissingDoc
                                
                                Exit Function
                                End If
                    End If
                    If FastSymbol(rest$, ",") Then
                        If Not IsExp(bstack, rest$, sx) Then    ' FROM
                      If FastSymbol(rest$, ",") Then
                      GoTo conteditdoc
                      Else
                             MissNumExpr
                            
                            Exit Function
                      End If
                        End If
                    Else
                
                    
                 sx = 0
                    End If
                    If FastSymbol(rest$, ",") Then
conteditdoc:
                        If Not IsStrExp(bstack, rest$, frm$) Then
                        If FastSymbol(rest$, ",") Then GoTo conteditdoc2
                        End If
                          Else
                    Form1.ResetMarks
                     frm$ = ""
                    
                    End If
                    If FastSymbol(rest$, ",") Then
conteditdoc2:
                        If Not IsExp(bstack, rest$, p) Then    ' FROM
                            MissStringExpr
                            
                            Exit Function
                            Else
                            col = CLng(p)
                            DUM = True
                        End If
                        
                    Else
                    Form1.ResetMarks
                    End If
                        If y1 = 3 Then
                            If GetVar(bstack, s$, i) Then
                                If Typename(var(i)) = doc Then
                                If var(i).LastSelStart > 0 And sx = 0 Then
                                x1 = var(i).LastSelStart
                                    Else
                                    If sx = 0 Then sx = -1
                                    x1 = sx
                                End If
                                   Form1.TEXT1.TITLE = frm$ + " "
                                  ScreenEditDOC bstack, var(i), 0, .mysplit, .mx - 1, .My - 1, x1, DUM, col
                                    var(i).LastSelStart = x1
                                    ProcEditDoc = True
                                Else
                                    MissingDoc
                                    
                                End If
                            Else
                                   MissFuncParameterStringVar
                                    
                            End If
                        ElseIf y1 = 6 Then
                                    If Typename(pppp.item(i)) = doc Then
                                                  If pppp.item(i).LastSelStart > 0 And sx = 0 Then
                                x1 = pppp.item(i).LastSelStart
                                    Else
                                    If sx = 0 Then sx = -1
                                    x1 = sx
                                End If
                                    Form1.TEXT1.TITLE = frm$ + " "
                                  ScreenEditDOC bstack, pppp.item(i), 0, .mysplit, .mx - 1, .My - 1, x1, DUM, col
                                    pppp.item(i).LastSelStart = x1
                                    ProcEditDoc = True
                                    
                                      Else
                                      MissingDoc
                                      
                                      End If
                               
                                    
                    Else
                          MissPar
                          
                    End If
End With
End Function
Function ProcVersion(bstack As basetask) As Boolean
Dim prive
prive = GetCode(bstack.Owner)
PlainBaSket bstack.Owner, players(prive), CStr(App.Major) & "." & CStr((App.Minor \ 1000) - 1) & " (" & CStr(App.Minor Mod 1000) & ")"
crNew bstack, players(prive)
ProcVersion = True
End Function
Function ProcSrcoll(bstack As basetask, rest$, lang As Long) As Boolean
Dim prive As Long, p As Double, DUM As Boolean
ProcSrcoll = True
If bstack.toprinter Then
MyEr "No scrolling for printer document", "Όχι κύλιση για το έγγραφο εκτύπωσης"
ProcSrcoll = False
Else
prive = GetCode(bstack.Owner)
If IsLabelSymbolNew(rest$, "ΚΑΤΩ", "DOWN", lang) Then
    ScrollDownNew bstack.Owner, players(prive)
ElseIf IsLabelSymbolNew(rest$, "ΧΩΡΙΣΜΑ", "SPLIT", lang) Then
If IsExp(bstack, rest$, p) Then
''SetText bstack.Owner
With players(prive)
    If p < 0 Then p = .My + p
    If p >= 0 And p < .My Then .mysplit = p
End With
Else
ProcSrcoll = False
SyntaxError
End If
Else
 DUM = IsLabelSymbolNew(rest$, "ΑΝΩ", "UP", lang)
ScrollUpNew bstack.Owner, players(prive)


End If
End If

End Function
Function ProcFont(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, s$
    prive = GetCode(bstack.Owner)
    If IsStrExp(bstack, rest$, s$) Then
        On Error Resume Next
        x1 = bstack.Owner.Font.charset
        bstack.Owner.Font.name = s$
        If Not (x1 = bstack.Owner.Font.charset) Then
            bstack.Owner.Font.charset = x1
        End If
    
        If LCase(bstack.Owner.Font.name) <> LCase(s$) Then
        
            bstack.Owner.Font.name = MYFONT
            bstack.Owner.Font.charset = bstack.myCharSet
        End If
    End If
        StoreFont bstack.Owner.Font.name, players(prive).SZ, bstack.Owner.Font.charset
        players(prive).FontName = bstack.Owner.Font.name
        SetText bstack.Owner
        GetXYb bstack.Owner, players(prive), players(prive).curpos, players(prive).currow
 ProcFont = True
End Function
Function ProcStack(bstack As basetask, rest$, lang As Long) As Boolean
Dim ss$, frm$, ps As mStiva, it As Long, x As Double, s$, Once As Boolean, prive As Boolean
Dim x1 As Long, pa$, what$, i As Long, pppp As mArray, f As Long, myobject As Object
ProcStack = True
   If IsLabelSymbolNew(rest$, "ΝΕΟΣ", "NEW", lang) Then
   If FastSymbol(rest$, "{") Then
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
Set ps = bstack.soros
Set bstack.Sorosref = New mStiva
Call executeblock(it, bstack, ss$, False, Once)
Set bstack.Sorosref = ps
Set ps = Nothing
If it = 0 Then ProcStack = False
Exit Function
End If
End If
   Else
If FastSymbol(rest$, "!") Then
If VALIDATEpart(rest$, s$) Then
Do While s$ <> ""
If ISSTRINGA(s$, pa$) Then
bstack.soros.DataStr pa$
ElseIf IsNumberD(s$, x) Then
bstack.soros.DataVal x
Else
Exit Do
End If
Loop
Else
ProcStack = False
End If
Exit Function
Else
' STACK A$
' stack a$, "NN"
x1 = Abs(IsLabel(bstack, rest$, what$))
If x1 = 3 Then
If GetVar(bstack, what$, it) Then
ss$ = var(it)
If FastSymbol(rest$, ",") Then
If Not IsStrExp(bstack, rest$, pa$) Then ProcStack = False: Exit Function
End If
If VALIDATE(ss$, pa$, frm$) Then
IsSymbol3 pa$, ","
If Typename(var(it)) = doc Then
Set var(it) = New Document
var(it).textDoc = pa$
Else
var(it) = pa$
End If
Set ps = New mStiva
i = 1
Do While i <= Len(frm$) And ss$ <> ""
If Mid$(frm$, i, 1) = "S" Then
    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
Else
    If IsNumberD(ss$, x) Then ps.DataVal x
End If
IsSymbol ss$, ","
i = i + 1
Loop
   With bstack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
Else
ProcStack = False
Exit Function
End If
Else
rest$ = what$ & " " & rest$
If IsStrExp(bstack, rest$, ss$) Then
pa$ = ""
If VALIDATE(ss$, pa$, frm$) Then
Set ps = New mStiva
i = 1
Do While i <= Len(frm$) And ss$ <> ""
If Mid$(frm$, i, 1) = "S" Then
    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
Else
    If IsNumberD(ss$, x) Then ps.DataVal x
End If
IsSymbol ss$, ","
i = i + 1
Loop
   With bstack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
End If
Else
ProcStack = False
Exit Function
End If
End If
ElseIf x1 = 6 Then
If neoGetArray(bstack, what$, pppp) Then
If Not NeoGetArrayItem(pppp, bstack, what$, f, rest$) Then ProcStack = False: Exit Function
ss$ = pppp.item(f)
If FastSymbol(rest$, ",") Then
If Not IsStrExp(bstack, rest$, pa$) Then ProcStack = False: Exit Function
End If

If VALIDATE(ss$, pa$, frm$) Then
IsSymbol3 pa$, ","
If Typename(pppp.item(f)) = doc Then
s$ = pppp.item(f)
       Set pppp.item(f) = New Document
       If s$ <> "" Then
       pppp.item(f).textDoc = s$
       End If
Else
pppp.item(f) = pa$
End If
Set ps = New mStiva
i = 1
Do While i <= Len(frm$) And ss$ <> ""
If Mid$(frm$, i, 1) = "S" Then
    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
Else
    If IsNumberD(ss$, x) Then ps.DataVal x
End If
IsSymbol ss$, ","
i = i + 1
Loop
   With bstack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
'stack$(bstack) = ss$ & stack$(bstack)
Else
ProcStack = False
Exit Function
End If
Else
rest$ = what$ & rest$
If IsStrExp(bstack, rest$, ss$) Then
pa$ = ""
If VALIDATE(ss$, pa$, frm$) Then
Set ps = New mStiva
i = 1
Do While i <= Len(frm$) And ss$ <> ""
If Mid$(frm$, i, 1) = "S" Then
    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
Else
    If IsNumberD(ss$, x) Then ps.DataVal x
End If
IsSymbol ss$, ","
i = i + 1
Loop
   With bstack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
'stack$(bstack) = ss$ & stack$(bstack)
End If
Else
ProcStack = False
Exit Function
End If
End If
ElseIf IsStrExp(bstack, rest$, ss$) Then
pa$ = ""
If VALIDATE(ss$, pa$, frm$) Then
Set ps = New mStiva
i = 1
Do While i <= Len(frm$) And ss$ <> ""
If Mid$(frm$, i, 1) = "S" Then
    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
Else
    If IsNumberD(ss$, x) Then ps.DataVal x
End If
IsSymbol ss$, ","
i = i + 1
Loop
   With bstack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
'stack$(bstack) = ss$ & stack$(bstack)
End If
Else
i = 0
With bstack.soros
s$ = ""
Do
i = i + 1
If .Total < i Then Exit Do

Select Case .StackItemType(i)
Case "?"
s$ = s$ & "(?) "
Case "N", "L"
s$ = s$ & Trim$(Str(.StackItem(i))) & " "
Case "S"
ss$ = .StackItem(i)
    If Len(ss$) > 78 Then
    s$ = s$ & Chr(34) + Left$(ss$, 75) & ".." & Chr(34)
    Else
    s$ = s$ & Chr(34) + ss$ & Chr(34)
    End If
Case ">"
If lang = 1 Then
ss$ = "[optional]"
Else
ss$ = "[προαιρετικό]"
End If
    
    s$ = s$ & ss$
    

Case Else
Set myobject = .StackItem(i)
If Not myobject Is Nothing Then
If TypeOf myobject Is mHandler Then

Select Case myobject.T1
Case 1
    s$ = s$ + "*[Inventory]"
Case 2
    s$ = s$ + "*[Buffer]"
Case Else
    s$ = s$ + "*[" + Typename(myobject.objref) + "]"
End Select
End If
Else
    s$ = s$ + "*[" + Typename(myobject) + "]"
    End If
End Select
Loop
Set myobject = Nothing
End With
prive = GetCode(bstack.Owner)
PlainBaSket bstack.Owner, players(prive), s$
crNew bstack, players(prive)
Exit Function
End If
End If
End If

End Function
Function ProcCHANGE(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, x As Double, w$
If IsExp(bstack, rest$, p) Then
p = CLng(p)
If p >= 0 And p < UBound(q()) Then
     
              '
While FastSymbol(rest$, ",")
If IsLabelSymbolNew(rest$, "ΦΡΑΣΗ", "TEXT", lang) Then
If IsStrExp(bstack, rest$, w$) Then q(p).Tag = w$
ElseIf IsLabelSymbolNew(rest$, "ΠΕΝΑ", "PEN", lang) Then
If IsExp(bstack, rest$, x) Then q(p).Pen = x
ElseIf IsLabelSymbolNew(rest$, "ΦΟΝΤΟ", "BACK", lang) Then
If IsExp(bstack, rest$, x) Then q(p).back = x
ElseIf IsLabelSymbolNew(rest$, "ΠΛΑΙΣΙΟ", "BORDER", lang) Then
If IsExp(bstack, rest$, x) Then q(p).fore = x
ElseIf IsLabelSymbolNew(rest$, "ΟΔΗΓΙΑ", "COMMAND", lang) Then
If IsStrExp(bstack, rest$, w$) Then q(p).Comm = w$
End If

Wend
RTarget bstack, q(p)
End If
End If
ProcCHANGE = True
End Function
Function ProcSaveAs(bstack As basetask, rest$, lang As Long) As Boolean
Dim scr As Object, frm$, pa$, s$, ss$, w$
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi

frm$ = mcd
DialogSetupLang lang

IsStrExp bstack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(bstack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder rest$: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(bstack, rest$, pa$) Then ss$ = pa$
If FastSymbol(rest$, ",") Then If Not IsStrExp(bstack, rest$, w$) Then Exit Function
olamazi
If TypeOf bstack.Owner Is GuiM2000 Then
Set scr = bstack.Owner
Else
If Form1.Visible Then
Set scr = Form1
Else
Set scr = Nothing
End If
End If
' change for file type
If InStr(w$, "|") > 0 Then w$ = ""  ' NOT COMBATIBLE..CHANGE TO ALL FILES
If SaveAsDialog(bstack, scr, s$, frm$, ss$, w$) Then
bstack.soros.PushStr ReturnFile
Else
bstack.soros.PushStr ""
End If
Set scr = Nothing
ProcSaveAs = True
End Function
Function ProcChooseColor(bstack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, i As Long, it As Long, scr As Object
olamazi
With players(GetCode(bstack.Owner))
If IsExp(bstack, rest$, p) Then
i = CLng(p)
Else
i = -.mypen
End If
it = i
If i > 16 Then it = -it
If i > 0 And i < 16 Then i = QBColor(i)

If TypeOf bstack.Owner Is GuiM2000 Then
Set scr = bstack.Owner
Else
    If Form1.Visible Then
    Set scr = Form1
    Else
    Set scr = Nothing
    End If
End If
DialogSetupLang lang
If OpenColor(bstack, scr, i) Then
bstack.soros.PushVal CDbl(-i)
Else
bstack.soros.PushVal CDbl(-it)

End If
Set scr = Nothing
End With
ProcChooseColor = True
End Function
Function ProcDesktop(bstack As basetask, rest$, lang As Long) As Boolean
Dim photo As cDIBSection, s$, p As Double, x As Double
olamazi
If IsLabelSymbolNew(rest$, "ΕΙΚΟΝΑ", "IMAGE", lang) Then
If IsStrExp(bstack, rest$, s$) Then
' FILL WIDTH  IMAGE
 If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
 Set photo = New cDIBSection
 If Not cDib(s$, photo) Then MissCdibStr:  Exit Function
  photo.GetDpi 96, 96
  If form5iamloaded Then
  Form5.RestoreSizePos
  Form5.Cls
  photo.ThumbnailPaint Form5
  Else
  photo.ThumbnailPaint Form1
  End If
 Else
 If ExtractType(s$) = "" Then s$ = s$ & ".jpg"
                    If CFname(s$) = "" Then
                        s$ = mcd & s$
                        If CFname(s$) = "" Then
                        BadFilename
                        Exit Function
                        End If
                    Else
                        s$ = CFname(s$)
                    End If
        If Len(s$) < 254 Then
        ' look for image to load
            Set photo = New cDIBSection
            If CFname(s$) <> "" Then
            s$ = CFname(s$)
                    photo.CreateFromPicture LoadPicture(GetDosPath(s$))
                                           
                    If photo.bitsPerPixel <> 24 Then
                        Conv24 photo
                        Else
                        CheckOrientation photo, s$
                        End If
                       photo.GetDpi 96, 96
                       If form5iamloaded Then
                       Form5.RestoreSizePos
                       Form5.Cls
                       photo.ThumbnailPaint Form5
                       Else
                       photo.ThumbnailPaint Form1
                       End If
                    End If
        Else
        BadFilename
        End If
        End If
 Set photo = Nothing
End If
ElseIf IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", lang) Then
If Not form5iamloaded Then
'
End If
Form5.BackColor = &H0 ' ALWAYS BLACK
Form5.Cls
SetTrans Form5, CByte(255), mycolor(0), True
ElseIf IsLabelSymbolNew(rest$, "ΚΑΘΑΡΗ", "CLEAR", lang) Then
If form5iamloaded Then
Form5.RestoreSizePos
Form5.BackColor = &H0 ' ALWAYS BLACK
Form5.Cls

Set Form5.Picture = LoadPicture("")
Form5.Cls
SetTrans Form5, CByte(255), mycolor(-2)

Else
Form1.Cls
End If
Else
If Not Form1.Visible Then
MyEr "You cant't set DESKTOP before a SHOW or after HIDE", "Δεν μπορείς να ρυθμίσεις την ΕΠΙΦΑΝΕΙΑ αν δεν ανάψει η οΘόνη"
Exit Function
End If
If IsExp(bstack, rest$, p) Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, x) Then

Form5.Visible = True
Form5.ZOrder 1
SetTrans Form1, CByte(p And &HFF), mycolor(x), True

End If
Else

Form5.Visible = True
'Form5.ZOrder 1

SetTrans Form1, CByte(p And &HFF)

End If
Else
CdESK
End If
End If
ProcDesktop = True
End Function
Function ProcPath(bstack As basetask, rest$, lang As Long) As Boolean
Dim f As Boolean, p As Double, col As Long, it As Long, ss$, x As Double, par As Boolean, frm$
ProcPath = True
f = IsLabelSymbolNew(rest$, "ΠΑΝΩ", "OVER", lang)
If FastSymbol(rest$, "!") Then par = True

If IsExp(bstack, rest$, p) Then
        col = CLng(p)  ' using a fill color
        If FastSymbol(rest$, ",") Then
           If Not IsExp(bstack, rest$, x) Then MissNumExpr
           Else
           x = vbSolid
           End If
        If FastSymbol(rest$, "{") Then
            ss$ = "{" & block(rest$) & "}"
            frm$ = rest$
            If FastSymbol(rest$, "}") Then
          
                        BeginPath bstack.Owner.hDC
                        Call executeblock(it, bstack, ss$, False, False)
                      
                        ' what for 2 and 3 values
                        EndPath bstack.Owner.hDC
        
                        bstack.Owner.FillStyle = Int(x) Mod 8
                        bstack.Owner.FillColor = mycolor(col)
                        col = p ' from  6.3 change
                        If par Then bstack.Owner.DrawMode = 7
                        If f Then  ' from 8 rev 83
                                If bstack.Owner.FillStyle = 1 Then
                                   StrokeAndFillPath bstack.Owner.hDC
                                Else
                                    FillPath bstack.Owner.hDC
                                  End If
                        Else
                             StrokeAndFillPath bstack.Owner.hDC         ' stroke and fill path
                        End If
                        If par Then bstack.Owner.DrawMode = 13
                        bstack.Owner.FillStyle = vbSolid
          
                If Trim(ss$) = "" Then ss$ = " "
                  If it <> 1 Then rest$ = Left$(ss$, Len(ss$) - 1) + frm$: ProcPath = False
              End If
            Else
       MissPar
ProcPath = False
        End If
        Exit Function
    Else
        If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
            If Trim(ss$) = "" Then
             ProcPath = FastSymbol(rest$, "}")
            If FastSymbol(rest$, ";") Then
  
                SelectClipRgn bstack.Owner.hDC, 0&
            
            End If
            Exit Function
            End If
            ss$ = "{" & ss$ & "}"
            frm$ = rest$
            If FastSymbol(rest$, "}") Then
            
                BeginPath bstack.Owner.hDC
                Call executeblock(it, bstack, ss$, False, False)
                EndPath bstack.Owner.hDC
                bstack.Owner.FillStyle = vbSolid
                If FastSymbol(rest$, ";") Then           ' path { block of commands };
                If f Then
                SelectClipPath bstack.Owner.hDC, 2
                Else
                    SelectClipPath bstack.Owner.hDC, RGN_COPY  ' make a clip path
                    End If
                Else
                    If par Then bstack.Owner.DrawMode = 7
                    StrokePath bstack.Owner.hDC               ' stroke path
                    If par Then bstack.Owner.DrawMode = 13
                End If
                If Trim(ss$) = "" Then ss$ = " "
                   If it <> 1 Then rest$ = Left$(ss$, Len(ss$) - 1) + frm$: ProcPath = False: Exit Function

        End If
    Else
MissPar
ProcPath = False
    End If
    
End If

End Function
Function ProcFLOODFILL(bstack As basetask, rest$, lang As Long) As Boolean
Dim x1 As Long, y1 As Long, col As Long, p As Double, par As Boolean

With players(GetCode(bstack.Owner))
par = IsLabelSymbolNew(rest$, "ΧΡΩΜΑ", "COLOR", lang)
x1 = .XGRAPH
y1 = .YGRAPH
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = CLng(p)
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = CLng(p)
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = CLng(p) Else MissNumExpr: Exit Function
Ffill bstack.Owner, (x1), (y1), col, par
End With
MyDoEvents1 bstack.Owner
ProcFLOODFILL = True
End Function
Function ProcFill(bstack As basetask, rest$) As Boolean
Dim prive As Long, x As Double, p As Double, y As Double, x1 As Long, y1 As Long, par As Boolean, col As Long
Dim scr As Object, ss$
Set scr = bstack.Owner
prive = GetCode(scr)
With players(prive)
If FastSymbol(rest$, "@") Then par = True
x1 = 0
y1 = 1
col = players(prive).mypen
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p

scr.CurrentX = .XGRAPH
scr.CurrentY = .YGRAPH
If par Then

'*****************
y = 5
If FastSymbol(rest$, ",") Then If Not IsExp(bstack, rest$, y) Then y = 5
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, x) Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
MyFill scr, (x1), (y1), (y), (x), (p)
Else
    MissNumExpr
    Exit Function
End If
Else
MyFill scr, (x1), (y1), (y), (x)
End If
ElseIf IsStrExp(bstack, rest$, ss$) Then
MyFill scr, (x1), (y1), (y), ss$
Else
MyFill scr, (x1), (y1), 5, "?"
End If
Else
MyFill scr, (x1), (y1), 6, 0
End If

'*******************
Else
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MissNumExpr: Exit Function
If FastSymbol(rest$, ",") Then 'ok
par = False
    If Not IsExp(bstack, rest$, x) Then
        If col = 0 Then x = rgb(255, 255, 255) Else x = 0
        Else
        par = True
    End If
    y = True
    If FastSymbol(rest$, ",") Then 'ok
        If IsExp(bstack, rest$, y) Then
            y = y <> 0
            par = True
        End If
    End If
    p = True
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, p) Then
            p = p <> 0
            par = True
        End If
    End If
    If par Then
    Gradient scr, mycolor(col), mycolor(x), RMIN(.XGRAPH, x1 + .XGRAPH), scr.Width - RMAX(.XGRAPH, x1 + .XGRAPH), RMIN(.YGRAPH, y1 + .YGRAPH), scr.Height - RMAX(.YGRAPH, y1 + .YGRAPH), y, p
    .XGRAPH = .XGRAPH + x1
    .YGRAPH = .YGRAPH + y1
    MyDoEvents1 scr
    Set scr = Nothing
    ProcFill = True
    Exit Function
    End If
    Set scr = Nothing
MissNumExpr:  Exit Function
Else

scr.Line (.XGRAPH, .YGRAPH)-Step(x1, y1), mycolor(col), BF
.XGRAPH = scr.CurrentX
.YGRAPH = scr.CurrentY

End If
End If


End With
MyDoEvents1 scr
Set scr = Nothing
ProcFill = True
End Function
Function MyCursor(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, y1 As Long, p As Double
prive = GetCode(bstack.Owner)
MyCursor = True
With players(prive)
If FastSymbol(rest$, "!") Then
 .curpos = .XGRAPH \ .Xt
  .currow = (.YGRAPH) \ .Yt '(.Yt + .uMineLineSpace)
ElseIf IsExp(bstack, rest$, p) Then
x1 = CLng(p) Mod 1000 '' Mod (.mx + 1)
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
y1 = CLng(p) Mod 1000   ''Mod (.my + 1)
.curpos = x1
.currow = y1

Else
MyCursor = False
End If
Else
.curpos = x1
End If
Else
MyCursor = False
End If
.lastprint = False
End With

End Function
Function MyLineInput(bstack As basetask, rest$, lang As Long) As Boolean
Dim f As Long, p As Double, what$, it As Long, s$, i As Long, prive As Long, frm$
Dim pppp As mArray
If IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗΣ", "INPUT", lang) Then
If FastSymbol(rest$, "#") Then

    If Not IsExp(bstack, rest$, p) Then Exit Function
    If Not FastSymbol(rest$, ",") Then Exit Function
    f = CLng(MyMod(p, 512))
    Select Case Abs(IsLabel(bstack, rest$, what$))
    Case 3
    MyLineInput = True
    If Uni(f) Then
    If Not getUniStringlINE(f, s$) Then MyLineInput = False: MyEr "Can't input, not UTF16LE", "Δεν μπορώ να εισάγω, όχι UTF16LE": Exit Function
    Else
    getAnsiStringlINE f, s$
    End If
    If GetVar(bstack, what$, i) Then
    CheckVar var(i), s$
    Else
    GlobalVar what$, s$
    End If
    Case 6
    If neoGetArray(bstack, what$, pppp) Then

    If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
    Else
    Exit Function
    End If
    MyLineInput = True
    If Uni(f) Then
    If Not getUniStringlINE(f, s$) Then MyLineInput = False: MyEr "Can;t input, not UTF16LE", "Δεν μπορώ να εισάγω, όχι UTF16LE": Exit Function
    Else
    getAnsiStringlINE f, s$
    End If
    If Typename(pppp.item(it)) = doc Then
    Set pppp.item(it) = New Document
    If s$ <> "" Then pppp.item(it).textDoc = s$
    Else
    pppp.item(it) = s$
    End If
    End Select
Else
If Not releasemouse Then If Not Form1.Visible Then Form1.Visible = True
If bstack.toprinter = True Then oxiforPrinter:   Exit Function
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
Select Case Abs(IsLabel(bstack, rest$, what$))
Case 3
           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
QUERY bstack, frm$, s$, 1000, False

                If GetVar(bstack, what$, i) Then
                        CheckVar var(i), s$
                Else
                        GlobalVar what$, s$
                End If
                 MyLineInput = True
Case 6
If neoGetArray(bstack, what$, pppp) Then
                       If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                Else
                 MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                       Exit Function
                End If
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
QUERY bstack, frm$, s$, 1000, False

 If Typename(pppp.item(it)) = doc Then
                Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                Else
                        pppp.item(it) = s$
                End If
                 MyLineInput = True
End Select

End If


End If
End Function

Function MyFrame(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, y1 As Long, col As Long, p As Double
Dim x As Double, y As Double, ss$
MyFrame = True
prive = GetCode(bstack.Owner)
With players(prive)
x1 = 1
y1 = 1
col = .mypen
If FastSymbol(rest$, "@") Then
If FastSymbol(rest$, "(") Then
    If IsExp(bstack, rest$, p) Then x1 = Abs(p + .curpos) Mod (.mx + 1)
    If Not FastSymbol(rest$, ")") Then MissSymbol rest$, ")": Exit Function
Else
    If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod (.mx + 1)
End If
If FastSymbol(rest$, ",") Then
    If FastSymbol(rest$, "(") Then
        If IsExp(bstack, rest$, p) Then y1 = Abs(p + .currow - 1) Mod (.My + 1)
        If Not FastSymbol(rest$, ")") Then MissSymbol rest$, ")": Exit Function
    
    Else
        If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod (.My + 1)
    End If
    '
    
End If
y = 5
If FastSymbol(rest$, ",") Then If Not IsExp(bstack, rest$, y) Then y = 5
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, x) Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
MyRect bstack.Owner, players(prive), (x1), (y1), (y), (x), (p)
Else
 MyFrame = False: MissNumExpr: Exit Function
End If
Else
MyRect bstack.Owner, players(prive), (x1), (y1), (y), (x)
End If
ElseIf IsStrExp(bstack, rest$, ss$) Then
MyRect bstack.Owner, players(prive), (x1), (y1), (y), ss$
Else
MyRect bstack.Owner, players(prive), (x1), (y1), 5, "?"
End If
Else
MyRect bstack.Owner, players(prive), (x1), (y1), 6, 0
End If
Else
If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod .mx
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod .My

x1 = x1 + .curpos - 1
y1 = y1 + .currow - 1
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then BoxColorNew bstack.Owner, players(prive), x1, y1, (p)


If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MyFrame = False: MissNumExpr: Exit Function


BoxBigNew bstack.Owner, players(prive), x1, y1, col
End If
End With
MyDoEvents1 bstack.Owner


End Function
Function MyMark(bstack As basetask, rest$) As Boolean
Dim prive As Long, p As Double, par As Boolean, x1 As Long, y1 As Long, col As Long
MyMark = True
prive = GetCode(bstack.Owner)
With players(prive)
x1 = 1
y1 = 1
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod .mx
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod .My
x1 = x1 + .curpos - 1
y1 = y1 + .currow - 1
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then par = Not (p = 0)

CircleBig bstack.Owner, players(prive), x1, y1, col, par
End With
MyDoEvents1 bstack.Owner


End Function
Function MyMenu(entrypoint As Long, bstack As basetask, rest$, lang As Long) As Boolean
Dim prive As Long, p As Double, par As Boolean, x1 As Long, y1 As Long, col As Long
Dim frm$, it As Long, s$, f As Long
MyMenu = True
If entrypoint = 1 Then GoTo ekei
If bstack.toprinter Then
oxiforPrinter
 MyMenu = False
Exit Function
End If
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
prive = GetCode(bstack.Owner)
            If IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", lang) Then
                If Form1.List1.Visible Then
                        If IsStrExp(bstack, rest$, s$) Then
                            p = Form1.List1.Find(s$)
                        ElseIf IsExp(bstack, rest$, p) Then
                            p = p - 1
                        Else
                            SyntaxError
                            MyMenu = False
                        End If
                        If p <> -1 Then
                            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then  ' CHANGE MENU ITEM IN AN OPEN MENU
                                If IsStrExp(bstack, rest$, s$) Then
                                    Form1.List1.list(CLng(p)) = s$
                                Else
                                   MissStringExpr
                                  MyMenu = False
                                End If
                            End If
                            If Not FastSymbol(rest$, ";") Then Form1.List1.ShowThis CLng(p + 1) Else Form1.List1.ShowMe2
                        End If
                Else
                        If Form1.List1.listcount > 0 Then  ' YOU CAN OPEN A MENU WITH A START ITEM OTHER THAN 1
                            If IsStrExp(bstack, rest$, s$) Then
                                p = Form1.List1.Find(s$)
                            ElseIf IsExp(bstack, rest$, p) Then
                                p = p - 1
                            Else
                               SyntaxError
                               MyMenu = False
                            End If
                            If p <> -1 Then
                                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then  ' CHANGE MENU ITEM IN AN OPEN MENU
                                ' IN A THREAD OR IN A @ VARIANT
                                    If IsStrExp(bstack, rest$, s$) Then
                                        Form1.List1.list(CLng(p)) = s$
                                    Else
                                        MissStringExpr
                                        MyMenu = False
                                    End If
                                Else
                                    If p < Form1.List1.listcount Then Form1.List1.ListIndex = CLng(p)
                                End If
                        End If
                        frm$ = Form1.List1.Tag
                End If
                GoTo ekei
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΠΛΑΙΣΙΟ", "FRAME", lang) Then
            Form1.List1.BorderStyle = 1 - Abs(IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", lang))
    ElseIf IsLabelSymbolNew(rest$, "ΒΑΨΕ", "FILL", lang) Then
        If IsExp(bstack, rest$, p) Then
        Form1.List1.CapColor = mycolor(p)
        LEVCOLMENU = 1
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, p) Then
                   Form1.List1.BackColor = mycolor(p)
                   LEVCOLMENU = 2
                           If FastSymbol(rest$, ",") Then
                                If IsExp(bstack, rest$, p) Then
                                   Form1.List1.ForeColor = mycolor(p)
                                   LEVCOLMENU = 3
                                   Else
                                   MissNumExpr
                                               MyMenu = False
                                   End If
                        End If
            
                   Else
                   MissNumExpr
                               MyMenu = False
                   End If
            End If
     
        Else
        MissNumExpr
                    MyMenu = False
        End If
        ElseIf IsLabelSymbolNew(rest$, "ΤΙΤΛΟΣ", "TITLE", lang) Then
        If Not IsStrExp(bstack, rest$, s$) Then Exit Function
        If Right$(s$, 2) = vbCrLf Then s$ = Left$(s$, Len(s$) - 2)
        Form1.List1.enabled = Form1.List1.Visible
    
        Form1.List1.HeadLine = s$
        Form1.List1.FloatList = Not IsLabelSymbolNew(rest$, "ΚΡΑΤΗΣΕ", "HOLD", lang)
        ElseIf IsLabelSymbolNew(rest$, "ΕΠΙΛΕΞΕ", "SELECT", lang) Then
        '' If Form1.List1.LeaveonChoose Then

         Form1.List1.PressSoft

        '' End If
        Else
If FastSymbol(rest$, "@") Then
    par = True
    If Not IsStrExp(bstack, rest$, s$) Then Exit Function
    frm$ = s$
    If FastSymbol(rest$, "!") Then GoTo ekei
    If Not FastSymbol(rest$, ",") Then Exit Function
    
    Else
    par = False
    End If
    If FastSymbol(rest$, "+") Then
    If Not IsStrExp(bstack, rest$, s$) Then Exit Function

    Form1.List1.additemFast s$
       While FastSymbol(rest$, ",")
    If Not IsStrExp(bstack, rest$, s$) Then MyMenu = False: Exit Function
    Form1.List1.additemFast s$
    Wend
   If Form1.List1.LeaveonChoose Then GoTo ekei Else Exit Function
    
    End If
    If Not FastSymbol(rest$, "!") Then
    If Form1.List1.enabled = True Then
    Form1.List1.Visible = False
    If Not par Then Form1.List1.HeadLine = ""
    End If
    If entrypoint = 2 Then GoTo ekei
    Form1.List1.enabled = False
    
    Form1.List1.Clear

    If Not IsStrExp(bstack, rest$, s$) Then
  bstack.Owner.TabStop = False
    Form1.List1.HeadLine = "": Form1.KeyPreview = True: Exit Function
    End If
    
    
    Form1.List1.additemFast s$
    If TextWidth(bstack.Owner, s$) > f Then f = TextWidth(bstack.Owner, s$)
    While FastSymbol(rest$, ",")
    If Not IsStrExp(bstack, rest$, s$) Then MyMenu = False: Exit Function
    Form1.List1.additemFast s$
    If TextWidth(bstack.Owner, s$) > f Then f = TextWidth(bstack.Owner, s$)
    Wend
    'f = f \ .xt + 1
    Else
ekei:
    it = Form1.List1.listcount
    f = 0
    If it > 0 Then
    With Form1.List1
            
            For it = it - 1 To 0 Step -1
            If TextWidth(bstack.Owner, .list(it)) > f Then f = TextWidth(bstack.Owner, .list(it))
            
            Next
    End With
    End If
    End If
    
    
    it = Form1.List1.listcount
With players(prive)
If .lastprint Then
x1 = (bstack.Owner.CurrentX + .Xt - dv15) \ .Xt
If x1 < 0 Then x1 = 0
If x1 > .mx Then x1 = .mx - 1
Else
x1 = .curpos

End If
y1 = .currow
If x1 < 0 Then
  x1 = 0
  ElseIf x1 > .mx Then
  x1 = .mx - 1
  Else
  
  ''    GetXYb scr, players(prive), .curpos, .currow
    End If
    f = Int(f / TextWidth(bstack.Owner, "W") + 0.5)
    If it > 0 Then
            If f < 4 Then f = 4  ' 4 chars minimum
            If f > .mx Then f = .mx  ' .mx maximum
            If f + x1 > .mx Then x1 = .mx - f - 1
            If it > .My \ 2 Then it = .My \ 2
            If CLng(.My - y1) < it Then  ' need space above
                If .My - y1 > 2 Then  ' if we have space under
                    it = .My - .currow - 1
                    
                Else  ' no we dont have
                   y1 = .My - it - 1
                
                End If
            End If

            If Not Form1.Visible Then Form1.Visible = True: MyDoEvents
            bstack.Owner.Refresh
                If Not Form1.List1.Visible Then
                    If Not bstack.Owner.Visible Then bstack.Owner.Visible
                    If bstack.tolayer Then bstack.Owner.ZOrder 0
                End If
                With Form1.List1
            .enabled = True
            .NoPanRight = False
            .NoFreeMoveUpDown = True
            .SingleLineSlide = True
            SetTextBasketBack bstack.Owner, players(prive)
            .overrideTextHeight = fonttest.TextHeight("fj")
            End With
    ListChoise bstack, frm$, x1, y1, f + x1, it + y1 - 1
    INK$ = ""
    UINK$ = ""
    MINK$ = ""
    End If
    '------------------------
End With

End If
End Function
Function ProcScreenRes(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double
If IsExp(basestack, rest$, x) Then
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
            ChangeScreenRes CLng(x), CLng(y)
        Else
            
            MissNumExpr
        End If
    Else
        
        SyntaxError
    End If
ElseIf FastSymbol(rest$, "!") Then
    ScreenRestore
Else
    
    MissNumExpr
End If
ProcScreenRes = True
End Function
Function ProcDrop(basestack As basetask, rest$) As Boolean
Dim x As Double
ProcDrop = True
If Not IsExp(basestack, rest$, x) Then x = 1

If x < 0 Then
     
        MyEr "No many items to drop from stack", "Δεν υπάρχουν τιμές να πετάξω από το σωρό"
Exit Function
End If

If x = 0 Then
    ' do nothing
Else
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    ElseIf x = basestack.soros.Total Then
    basestack.soros.Flush
    Else
    basestack.soros.drop CLng(x)
    End If
    End If

End Function
Function ProcShift(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcShift = True
If Not IsExp(basestack, rest$, x) Then x = basestack.soros.Total
If x <= 0 Then
     
        MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"
Exit Function
End If
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    Else

    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
        y = Int(y)
        If y < 0 Then
        y = Abs(y)
        x = x - 1
        For i = x + 1 To x + y
        
         basestack.soros.MakeTopItem CLng(i)
      
        Next i
        Else
           'y = y - 1

        For i = y To 1 Step -1
        
         basestack.soros.MakeTopItem CLng(x + y - 1)
      
        Next i

        End If
    End If
    Else
        basestack.soros.MakeTopItem CLng(x)
    End If
    End If


End Function
Function ProcShiftBack(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcShiftBack = True
If Not IsExp(basestack, rest$, x) Then x = basestack.soros.Total
If x <= 0 Then
     
        MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"

Exit Function
End If
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    Else
    
    
        If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
        If y < 0 Then
        y = Abs(Int(y))
        x = x - 1
        
        For i = y To 2 Step -1
        
         basestack.soros.MakeTopItemBack CLng(i + x)
      
        Next i
        If x > 0 Then basestack.soros.MakeTopItemBack CLng(i + x)
        Else
        y = Int(y)
        For i = 1 To y
        basestack.soros.MakeTopItemBack CLng(x + y - 1)
        Next i
     
        End If
    End If
    Else
    basestack.soros.MakeTopItemBack CLng(x)
    End If
    End If
End Function
Function ProcOver(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcOver = True
If Not IsExp(basestack, rest$, x) Then x = 1
    If x <= 0 Then
         
            MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"
    Exit Function
    End If
    If x > basestack.soros.Total Then
        MissStackItem
        
        Exit Function
    Else
        If FastSymbol(rest$, ",") Then
            If IsExp(basestack, rest$, y) Then
            y = Int(y)
                For i = 1 To y
                    basestack.soros.Copy2TopItem CLng(x)
                Next i
            Else
                MissPar
            End If
        Else
            basestack.soros.Copy2TopItem CLng(x)
        End If
    End If

End Function
Function ProcSort(basestack As basetask, rest$, lang As Long) As Boolean
Dim i As Long, s$, sx As Double, sy As Double, pppp As mArray
Dim x1 As Long, y1 As Long, p As Double, ML As Long, desc As Boolean
ProcSort = False
desc = IsLabelSymbolNew(rest$, "ΦΘΙΝΟΥΣΑ", "DESCENDING", lang)
    y1 = Abs(IsLabel(basestack, rest$, s$))
    If y1 = 1 Then
         If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = "mHandler" Then
                        If var(i).ReadOnly Then
                        MyEr "Read Only", "Μόνο για ανάγνωση"
                        Exit Function
                        End If
                            If var(i).T1 = 1 Then
                            If FastSymbol(rest$, ",") Then
                                If IsExp(basestack, rest$, p) Then
                                    If p <> 0 Then
                                        var(i).objref.Sort
                                    Else
                                        var(i).objref.SortDes
                                    End If
                                Else
                                    MissPar
                                    Exit Function
                                End If
                            Else
                                If desc Then
                                 var(i).objref.SortDes
                                Else
                                    var(i).objref.Sort
                                End If
                            End If
                            ProcSort = True
                            Else
                            MyEr "Expected Inventory", "Περίμενα Κατάσταση"
                            End If
                Else
                   MyEr "Expected Inventory", "Περίμενα Κατάσταση"
                End If
            Else
                   MissFuncParameterStringVar
            End If
    Exit Function
    ElseIf y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, sx) Then    ' FROM
            If FastSymbol(rest$, ",") Then
            sx = 1
                GoTo sort2
            Else
                MissNumExpr
                Exit Function
            End If
        End If
    Else
 sx = 1
    End If
    
     If FastSymbol(rest$, ",") Then
sort2:
        If Not IsExp(basestack, rest$, p) Then   ' TO
            If FastSymbol(rest$, ",") Then
            x1 = 0
                GoTo sort3
            Else
                MissNumExpr
                Exit Function
            End If
        End If
        x1 = CLng(p)
     Else
        x1 = 0    ' TO THE LAST
    End If
         If FastSymbol(rest$, ",") Then
sort3:
        If Not IsExp(basestack, rest$, sy) Then   ' TO
                        MissNumExpr
                        Exit Function
        End If
        ML = CLng(sy)
     Else
        ML = 1   ' KEYSTART
    End If
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                            If desc Then
                            var(i).SortDocDes ML, CLng(sx), x1
                            Else
                            var(i).SortDoc ML, CLng(sx), x1
                            End If
                            ProcSort = True '*******************************************
                Else
                   MissingDoc
                End If
            Else
                   MissFuncParameterStringVar
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                                If desc Then
                                pppp.item(i).SortDocDes ML, CLng(sx), x1
                                Else
                                pppp.item(i).SortDoc ML, CLng(sx), x1
                                End If
                                ProcSort = True  '*****************************************
                      Else
                                MissingDoc
                      End If
        Else
                    MissPar
        End If

End Function
Function ProcWords(basestack As basetask, rest$) As Boolean
Dim x1 As Long, y1 As Long, s$, sx As Double, i As Long, p As Double, pppp As mArray
ProcWords = True
    y1 = Abs(IsLabel(basestack, rest$, s$))

    If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, sx) Then    ' FROM
            MissNumExpr
            Exit Function
        End If
    Else
 sx = 1
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                basestack.soros.Begin 1
                var(i).ExportWords2ObjectAddItem basestack.soros, sx <> 0
                var(i).ResetWords
                    
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                   Exit Function
                    
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                        basestack.soros.Begin 1
                         pppp.item(i).ExportWords2ObjectAddItem basestack.soros, sx <> 0
                         pppp.item(i).ResetWords
                      Else
                      MissingDoc
                      Exit Function
                      End If
               
                    
    Else
                    
                MissPar
                Exit Function
    End If

End Function
Function ProcFind(basestack As basetask, rest$) As Boolean
Dim i As Long, s$, pppp As mArray, x1 As Long, y1 As Long
Dim p As Double, col As Long, frm$, ss$
ProcFind = True
    y1 = Abs(IsLabel(basestack, rest$, s$))
     
        If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                    MissingDoc
                    Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, frm$) Then
        MissStringExpr
        Exit Function
    End If
        ss$ = GetNextLine(frm$)
        SetNextLine frm$
    If frm$ <> "" Then
        MyEr "Search string with line breaks", "Αλφαριθμητικό αναζήτησης με αλλαγές γραμμών"
        Exit Function
    End If
    Else
        MissPar
        Exit Function
    End If
    
     If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then
            MissNumExpr
            Exit Function
        End If
        x1 = CLng(p)
     Else
        x1 = 0
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                
                     x1 = var(i).FindStr(ss$, x1, y1, col)
                     If x1 > 0 Then
                        basestack.soros.PushVal CDbl(col)  ' CHAR IN PARAGRAPH
                        basestack.soros.PushVal CDbl(y1)   'PARAGRAPH ORDER ..NUMBER START FROM 1
                     End If
                        basestack.soros.PushVal CDbl(x1)   ' POSITION IN ALL DOCUMENT
                    
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                    Exit Function
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
          
                        x1 = pppp.item(i).FindStr(ss$, x1, y1, col)
                            If x1 > 0 Then
                               basestack.soros.PushVal CDbl(col)  ' CHAR IN PARAGRAPH
                               basestack.soros.PushVal CDbl(y1)   'PARAGRAPH ORDER ..NUMBER START FROM 1
                            End If
                        basestack.soros.PushVal CDbl(x1)   ' POSITION IN ALL DOCUMENT
                    
              
                        Else
                         MissingDoc
                         Exit Function
                        End If
                    
    Else
                    
                MissPar
                Exit Function
    End If

End Function
Function ProcSaveDoc(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim DUM As Boolean, w$, i As Long, s$, pppp As mArray, ss$, p As Double
Dim x1 As Long, y1 As Long
If entrypoint = 1 Then DUM = True
    y1 = Abs(IsLabel(basestack, rest$, s$))
         If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, w$) Then
        MissStringExpr
        Exit Function
    End If
    ss$ = GetNextLine(w$)
    SetNextLine w$
    If w$ <> "" Then
    MyEr "filename with line breaks", "όνομα αρχείου με αλλαγές γραμμών"
    Exit Function
    End If
    ' check valid name
    If ExtractNameOnly(ss$) = "" Then BadFilename:  Exit Function
    If ExtractPath(ss$) = "" Then
    ss$ = mylcasefILE(mcd + ss$)
    End If
    If ExtractType(ss$) = "" Then ss$ = ss$ + ".txt"
    Else
    MissPar
    Exit Function
    End If
    
     If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then    'type...for saving
        MissNumExpr
        Exit Function
        End If
        x1 = CLng(p)
     Else
        x1 = -1 ' ' 2 = utf-8 standard save mode
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                         If x1 = -1 Then
                    If var(i).ListLoadedType <> 0 Then
                    x1 = var(i).ListLoadedType
                    Else
                    x1 = 2
                    End If
                    End If
                    If CanKillFile(ss$) Then
                     If Not var(i).SaveUnicodeOrAnsi(ss$, x1, DUM) Then
                       MyEr "can't save " + ss$, "δεν μπορώ να σώσω " + ss$
                      End If
                      Else
                      FilePathNotForUser
                      Exit Function
                      End If
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                    Exit Function
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                    If x1 = -1 Then
                    If pppp.item(i).ListLoadedType <> 0 Then
                    x1 = pppp.item(i).ListLoadedType
                    Else
                    x1 = 2
                    End If
                    End If
                    If CanKillFile(ss$) Then
                     If Not pppp.item(i).SaveUnicodeOrAnsi(ss$, x1, DUM) Then
                       MyEr "can't save " + ss$, "δεν μπορώ να σώσω " + ss$
                       Exit Function
                      End If
                      Else
                      FilePathNotForUser
                      Exit Function
                      End If
                        Else
                         MissingDoc
                         Exit Function
                        End If
                    
    Else
                    
                MissPar
                Exit Function
    End If
ProcSaveDoc = True
End Function
Function ProcWin(basestack As basetask, rest$) As Boolean
Dim s$, w$, x1 As Long
If IsSupervisor Then
x1 = Abs(IsLabelBig(basestack, rest$, s$, , w$))
If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If

If x1 Then
On Error Resume Next

If s$ = ExtractPath$(s$) Then
MyShell "explorer " & Chr(34) + s$ & Chr(34)
Else
MyShell s$
End If
'***********************************************
End If
Else
BadCommand
Exit Function
End If
ProcWin = True
End Function
Function ProcDos(basestack As basetask, rest$) As Boolean
Dim s$, w$, x1 As Long, p As Double
If IsSupervisor Then
On Error Resume Next
x1 = Abs(IsLabelBig(basestack, rest$, s$, , w$))
If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, p) Then MissNumExpr: Exit Function
Else
p = 300
End If
        If x1 Then
        
                    If FastSymbol(rest$, ";") Then
                                Shell "CMD /C " & s$, vbMinimizedNoFocus
                    Else
                                Shell "CMD /K " & s$, vbNormalFocus
                    End If
        Else
                    Shell "CMD", vbNormalFocus
        End If

           MyDoEvents
        Sleep CLng(Abs(p))

Else
BadCommand
Exit Function
End If
ProcDos = True
End Function
Function ProcSpeech(basestack As basetask, rest$) As Boolean
Dim s$, p As Double, DUM As Boolean
If IsStrExp(basestack, rest$, s$) Then

If FastSymbol(rest$, "#") Then s$ = "<spell>" & s$ & "</spell>"
DUM = FastSymbol(rest$, "!")
If FastSymbol(rest$, ",") Then ' get voice number
If Not IsExp(basestack, rest$, p) Then MissNumExpr:  Exit Function
SPEeCH s$, DUM, CLng(p)
Else
SPEeCH s$, DUM
End If
End If
ProcSpeech = True
End Function
Function ProcPropeties(basestack As basetask, rest$) As Boolean
Dim s$
  If IsStrExp(basestack, rest$, s$) Then
  LoadArray MyDM(), s$
  Else
  SyntaxError
  Exit Function
  End If
ProcPropeties = True
End Function
Function ProcFlush(basestack As basetask, rest$, lang As Long) As Boolean
Dim pppp As mArray, what$, it As Long, y1 As Long
If IsLabelSymbolNew(rest$, "ΛΑΘΟΣ", "ERROR", lang) Then
         NOEXECUTION = False
         NERR = False
           LastErNum1 = 0
         LastErNum = 0
            LastErName = ""
            LastErNameGR = ""
ElseIf IsLabelSymbolNew(rest$, "ΣΚΟΥΠΙΔΙΑ", "GARBAGE", lang) Then
    GarbageFlush2
Else
Do
    y1 = Abs(IsLabel(basestack, rest$, what$))
    If y1 = 0 Then
     If it = 0 Then basestack.soros.Flush
    Else
        If y1 = 3 Then
            If GetVar(basestack, what$, it) Then
                If Typename(var(it)) = doc Then
                    var(it).EmptyDoc
                Else
                      SyntaxError
                        Exit Function
                End If
            Else
                  SyntaxError
                        Exit Function
            End If
        ElseIf y1 = 6 Then
        If neoGetArray(basestack, what$, pppp) Then
        If Not pppp.Arr Then NotArray: Exit Function
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then Exit Function
                         If Typename(pppp.item(it)) = doc Then
                         Set pppp.item(it) = New Document
                         pppp.item(it).EmptyDoc
                         Else
                      SyntaxError
                        Exit Function
                         End If
                 
       Else
       SyntaxError
        Exit Function
       End If
        End If
    End If
    Loop Until Not FastSymbol(rest$, ",")
End If
ProcFlush = True
End Function
Function ProcOpenImage(basestack As basetask, rest$, lang As Long) As Boolean
Dim pa$, ss$, frm$, s$, w$, scr As Object, x1 As Long
Dim aaa() As String
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi
 
frm$ = mcd
DialogSetupLang lang

IsStrExp basestack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder rest$: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then ss$ = pa$
If FastSymbol(rest$, ",") Then If Not IsStrExp(basestack, rest$, w$) Then MissNumExpr:  Exit Function
If TypeOf basestack.Owner Is GuiM2000 Then
Set scr = basestack.Owner
Else
         If Form1.Visible Then
        Set scr = Form1
        Else
        Set scr = Nothing
        End If
End If
If InStr(w$, "|") > 0 Then
If InStr(w$, "(*.") > 0 Then
aaa() = Split(w$, "(*.")
Else
aaa() = Split(w$, "|")
End If
w$ = ""
If UBound(aaa()) > LBound(aaa()) Then
w$ = "|"
For x1 = LBound(aaa()) + 1 To UBound(aaa())
w$ = w$ & UCase(Left$(aaa(x1), InStr(aaa(x1), ")") - 1) & "|")
Next x1
End If
End If
    If OpenImage(basestack, scr, frm$, s$, ss$, w$) Then
    ' push to stack
    If multifileselection Then
    If ReturnListOfFiles <> "" Then
    aaa() = Split(ReturnListOfFiles, "#")
    If UBound(aaa()) > LBound(aaa()) Then

For x1 = UBound(aaa()) To LBound(aaa()) + 1 Step -1
    basestack.soros.PushStr aaa(x1)
Next x1
basestack.soros.PushVal UBound(aaa()) - LBound(aaa())
basestack.soros.PushStr aaa(x1)
End If
Else
    basestack.soros.PushStr ReturnFile
    End If
    Else
    basestack.soros.PushStr ReturnFile
    End If
    Else
    basestack.soros.PushStr ""
    End If

Set scr = Nothing
ProcOpenImage = True
End Function
Function ProcOpenFile(basestack As basetask, rest$, lang As Long) As Boolean
Dim pa$, ss$, frm$, s$, w$, scr As Object, x1 As Long, p As Double, par As Boolean, f As Boolean
Dim aaa() As String, DUM As Boolean
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi
frm$ = mcd
DialogSetupLang lang

IsStrExp basestack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder rest$: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then ss$ = pa$
par = False
If FastSymbol(rest$, ",") Then If Not IsStrExp(basestack, rest$, w$) Then Exit Function
If FastSymbol(rest$, ",") Then If IsExp(basestack, rest$, p) Then par = p <> 0
If FastSymbol(rest$, ",") Then f = IsExp(basestack, rest$, p) Else p = 0  '' if f is false what???
 DUM = p <> 0
If TypeOf basestack.Owner Is GuiM2000 Then
Set scr = basestack.Owner
Else
 If Form1.Visible Then
Set scr = Form1
Else
Set scr = Nothing
End If
End If
If InStr(w$, "|") > 0 Then
    If InStr(w$, "(*.") > 0 Then
        aaa() = Split(w$, "(*.")
        w$ = ""
        If UBound(aaa()) > LBound(aaa()) Then
            w$ = "|"
            For x1 = LBound(aaa()) + 1 To UBound(aaa())
                w$ = w$ & UCase(Left$(aaa(x1), InStr(aaa(x1), ")") - 1) & "|")
            Next x1
        End If
    Else
        aaa() = Split(w$, "|")
        w$ = ""
        If UBound(aaa()) > LBound(aaa()) Then
            w$ = "|"
            For x1 = LBound(aaa()) To UBound(aaa())
                w$ = w$ & UCase(aaa(x1)) & "|"
            Next x1
        End If
    End If
End If

    If OpenDialog(basestack, scr, frm$, s$, ss$, w$, Not par, DUM) Then
     If multifileselection Then
        If ReturnListOfFiles <> "" Then
                aaa() = Split(ReturnListOfFiles, "#")
                If UBound(aaa()) > LBound(aaa()) Then
            
                        For x1 = UBound(aaa()) To LBound(aaa()) + 1 Step -1
                            basestack.soros.PushStr aaa(x1)
                        Next x1
                        basestack.soros.PushVal UBound(aaa()) - LBound(aaa())
                        basestack.soros.PushStr aaa(x1)
                 End If
            Else
            
     If isdir(ReturnFile) Then
     basestack.soros.PushStr ""
    Else
    basestack.soros.PushStr ReturnFile
    End If
        End If
    Else
    If isdir(ReturnFile) Then
     basestack.soros.PushStr ""
    Else
    basestack.soros.PushStr ReturnFile
    End If
    End If
    Else
    basestack.soros.PushStr ""
    End If

Set scr = Nothing
ProcOpenFile = True
End Function
Function ProcUSE(basestack As basetask, rest$, lang As Long) As Boolean
Dim ss$, ML As Long, x As Double, pa$, s$, stac1$, p As Double, frm$, i As Long, w$, pppp As mArray
Dim it As Long, what$
If IsStrExp(basestack, rest$, ss$) Then   'gsb
ElseIf Not Abs(IsLabel(basestack, rest$, ss$)) = 1 Then ' WITHOUT " .gsb"
SyntaxError
Exit Function
End If
ML = 0
If UCase(ss$) = "PIPE" Or UCase(ss$) = "ΑΥΛΟΥ" Then
ML = 1
End If

stac1$ = ""
If FastSymbol(rest$, "!") And ML <> 1 Then
If VALIDATEpart(rest$, s$) Then
Do While s$ <> ""
    If ISSTRINGA(s$, pa$) Then
        basestack.soros.DataStr pa$
    ElseIf IsNumberD(s$, x) Then
        basestack.soros.DataVal x
    Else
        Exit Do
    End If
Loop
Else
SyntaxError
Exit Function
End If
Else
If ML <> 1 Then
    Do
        If IsExp(basestack, rest$, p) Then
        stac1$ = stac1$ & Str$(p)
        ElseIf IsStrExp(basestack, rest$, s$) Then
         stac1$ = stac1$ & Sput(s$)
        Else
        Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
    Loop
    pa$ = ExtractPath(ss$)
    para$ = RTrim$(".gsb " & Mid$(ss$, Len(ExtractPath(ss$) + ExtractName(ss$)) + 1))
    If pa$ = "" Then pa$ = mcd
    frm$ = ExtractNameOnly(ss$)
    End If
End If

If Not IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then

w$ = "S" & CStr(Int(Rnd(12) * 100000))

Else

Select Case Abs(IsLabel(basestack, rest$, ss$))

Case 3
    If GetVar(basestack, ss$, i) Then
       w$ = "V" & CStr(i)
       s$ = frm$
       frm$ = var(i)
       var(i) = ""
      Else
     i = GlobalVar(ss$, "")
             If i <> 0 Then
              w$ = "V" & CStr(i)
              
            var(i) = ""
            End If
                        
     End If
Case 6
   
     If neoGetArray(basestack, ss$, pppp) Then
            If Not NeoGetArrayItem(pppp, basestack, ss$, it, rest$) Then
        MyEr "Not such index for array", "Περίμενα σωστούς δείκτες για πίνακα"
        
        Exit Function
        End If
     Else
     MyEr "Not such array, need to DIM fisrt", "Περίμενα πίνακα, πρέπει να ορίσεις έναν"
: Exit Function
     End If
    
    w$ = "A" & CopyArrayItems(basestack, ss$) + Str(it) ''''''''''εδω για τον νεο πίνακα πρέπει να δώσω το mArray???
    s$ = frm$
    frm$ = pppp.item(it)
    If Typename(pppp.item(it)) = doc Then
    Set pppp.item(it) = New Document
    Else
     pppp.item(it) = ""
    End If
   
    Case Else
    SyntaxError
: Exit Function
   End Select
   If Left$(w$, 1) <> "S" Then

p = GetTaskId + 10000 ' starts from 10000
If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", lang) Then
's$ = validpipename(ss$)

If frm$ <> "" Then

ss$ = frm$
Else

ss$ = "M" & CStr(p)
End If

Thing w$, validpipename(ss$)
sThread CLng(p), 0, ss$, w$
TaskMaster.Message CLng(p), 3, CLng(100)
Exit Function
Else
Select Case Abs(IsLabel(basestack, rest$, what$))
Case 0 ' TAKE A NUMBER
If IsNumberLabel(rest$, what$) Then
frm$ = "S" + Right$("0000" + what$, 5)
p = val(what$)
s$ = frm$
If Left$(w$, 1) = "V" Then var(val(Mid$(w$, 2))) = validpipename(frm$)
Else
MyEr "No number found (5 digits)", "Δεν βρήκα αριθμό (5 ψηφία)"
Exit Function
End If
Case 1
    If GetVar(basestack, what, i) Then
    If var(i) < 10000 Then var(i) = p Else p = var(i)
      Else
      GlobalVar what, p
                             
     End If
Case 5, 7
   
     If neoGetArray(basestack, what, pppp) Then
        If Not NeoGetArrayItem(pppp, basestack, ss$, it, rest$) Then
        MyEr "Not such index for array", "Περίμενα σωστούς δείκτες για πίνακα"
      
        Exit Function
        End If
     Else
     MyEr "Not such array, need to DIM fisrt", "Περίμενα πίνακα, πρέπει να ορίσεις έναν"
     
      Exit Function
     End If
     If pppp.item(it) < 10000 Then pppp.item(it) = p Else p = pppp.item(it)
    Case Else
    MyEr "Wrong parameter", "Λάθος παράμετρος"
     Exit Function
   End Select
   End If
End If
'ss$ = validpipename("M" & CStr(p))
'stac1$ = Sput(ss$) + stac1$
If frm$ <> "" Then
ss$ = frm$
Else
ss$ = "M" & CStr(p)
End If
frm$ = s$
sThread CLng(p), 0, ss$, w$
TaskMaster.Message CLng(p), 3, CLng(100)
ss$ = validpipename(ss$)
stac1$ = Sput(ss$) + stac1$
ss$ = "M" & CStr(p)
End If
If ML <> 1 Then
If stac1$ = "" And Left$(s$, 1) = "S" Then
s$ = App.path
AddDirSep s$
s$ = s$ & "M2000.EXE "
If Shell(s$ & Chr(34) + pa$ & frm$ & ".gsb" & para$ & Chr(34), vbNormalFocus) > 0 Then
End If
End If
If Left$(w$, 1) = "V" Then
ss$ = GetTag$ & ".gsb"
Else
ss$ = w$ & ".gsb"
End If
i = FreeFile
On Error Resume Next
 If Not NeoUnicodeFile(strTemp + ss$) Then
 MyEr "can't save " + strTemp + ss$, "δεν μπορώ να σώσω " + strTemp + ss$
what$ = ""
 Exit Function
End If

Open GetDosPath(strTemp + ss$) For Output As i
If Err.Number > 0 Then
MyEr "Internal Error", "Εσωτερικό Λάθος"
what$ = ""
Exit Function
End If
If stac1$ <> "" Then

' look for unicode...
Print #i, "STACK !" & stac1$ & ": DIR " & Chr(34) + pa$ & Chr(34) & " : LOAD " & Chr(34) + frm$ & para$ & Chr(34)

Else
Print #i, "DIR " & Chr(34) + pa$ & Chr(34) & " : LOAD " & Chr(34) + frm$ & para$ & Chr(34)

End If
Close i
tempList2delete = Sput(strTemp + ss$) + tempList2delete
s$ = App.path
AddDirSep s$
s$ = s$ & "M2000.EXE "
If Shell(s$ & Chr(34) + strTemp + ss$ & Chr(34), vbNormalFocus) > 0 Then
'killfile strTemp + ss$
End If
End If
ProcUSE = True
End Function
Function ProcRelease() As Boolean
' make this for each Guim2000 form also
Form1.MY_BACK.PaintPicture Form1.DIS.hDC
ProcRelease = True
End Function
Function ProcHold() As Boolean
' make this for each Guim2000 form also
Form1.MY_BACK.ClearUp
If Form1.MY_BACK.Create(Form1.DIS.Width / DXP, Form1.DIS.Height / DYP) Then
Form1.MY_BACK.LoadPictureBlt Form1.DIS.hDC
If Form1.MY_BACK.bitsPerPixel <> 24 Then Conv24 Form1.MY_BACK
End If
ProcHold = True
End Function
Function ProcGet(basestack As basetask, rest$) As Boolean
Dim pppp As mArray, it As Long, what$, p As Double, f As Long, par As Boolean, i As Long, s$
Dim flag As Boolean, myobject As mHandler, PP As Double
IsSymbol3 rest$, "#"

If IsExp(basestack, rest$, p) Then
    f = CLng(MyMod(p, 512))
    If Not FastSymbol(rest$, ",") Then GoTo ex123
    
    Select Case IsLabel(basestack, rest$, what$)
    Case 1  ' check to see if is a handler
    If GetVar(basestack, what$, it) Then
     PP = 0
     If Typename(var(it)) = "mHandler" Then
    
        If var(it).ReadOnly Then
                     MyEr "Read Only", "Μόνο για ανάγνωση"
                             GoTo ex123
                     End If
        End If
      Set myobject = var(it)
     
     flag = True
    End If
    par = False
    Case 5  'check for handler
    what$ = Left$(what$, Len(what$) - 1)
    If GetVar(basestack, what$, it) Then
    PP = 0
    If IsExp(basestack, rest$, PP) Then
    ' nothing here
    End If
    If Not FastSymbol(rest$, ")") Then GoTo ex123
    If Not Typename(var(it)) = "mHandler" Then GoTo ex123
        
           If var(it).ReadOnly Then
                        MyEr "Read Only", "Μόνο για ανάγνωση"
                                GoTo ex123
                        End If
        Set myobject = var(it)
        flag = True
    End If
    par = False
    Case 3
        par = True: If Not GetVar(basestack, what$, it) Then it = GlobalVar(what$, "")
    Case 6
        par = False: If neoGetArray(basestack, what$, pppp) Then If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then GoTo ex123
        '' maybe  I can use index in bbb$(index) to pass to mHandler at a spare property
        '' so I can read it after
        'If Not pppp.Arr Then
        'If pppp.GroupRef Is Nothing Then Goto ex123
        'If TypeOf pppp.GroupRef Is mHandler Then
        'Set myobject = pppp.GroupRef
        'flag = True
        'End If
        'End If
    Case Else
        MissingStrVar
        GoTo ex123
    End Select
    
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, p) Then
            i = CLng(MyMod(p, 2147483647))
            Seek #f, (i - 1) * FLEN(f) + 1
        Else
            MissNumExpr
            GoTo ex123
        End If
    End If
If flag Then
With myobject.objref
' pp is offset
If .ValidArea2(PP, FLEN(f)) Then
Dim aa() As Byte
ReDim aa(0 To FLEN(f) - 1)
Get #f, , aa()
CopyBytes FLEN(f), .GetPtr(PP), VarPtr(aa(0))
Else
MyEr "Wrong size-position for loading the buffer", "Λάθος μέγεθος-θέση για να φορτωθεί η Διάρθρωση"
GoTo ex123
End If
End With
Else
        s$ = Space(FLEN(f) \ 2)
        getUniString f, s$  '
        If Not Uni(f) Then
        s$ = StrConv(s$, vbUnicode)
        End If
        If par Then
        CheckVar var(it), s$
        Else
        If Typename(pppp.item(it)) = doc Then
            Set pppp.item(it) = New Document
            If s$ <> "" Then pppp.item(it).textDoc = s$
            Else
            pppp.item(it) = s$
            End If
        End If
End If
        End If
ProcGet = True
ex123:
Set pppp = Nothing
Set myobject = Nothing
Set basestack.lastobj = Nothing
End Function
Function ProcPipe(basestack As basetask, rest$) As Boolean
Dim stac1$, ss$, p As Double, s$
If IsStrExp(basestack, rest$, ss$) Then
If FastSymbol(rest$, ",") Then
stac1$ = ""
Do
If IsExp(basestack, rest$, p) Then
stac1$ = stac1$ & " " & Trim$(Str$(p))
ElseIf IsStrExp(basestack, rest$, s$) Then
stac1$ = stac1$ & Sput(s$)
Else
Exit Do
End If
If Not FastSymbol(rest$, ",") Then Exit Do
Loop

If VALIDATE(stac1$, "", s$) Then
ProcPipe = Trans2pipe(ss$, Sput(ss$) + Sput(s$) + stac1$)
Exit Function
End If
End If
End If
ProcPipe = True

End Function
Function ProcJoypad(basestack As basetask, rest$) As Boolean
Dim p As Double
        If IsExp(basestack, rest$, p) Then
        If Not StartJoypadk(Int(p)) Then
        ' ERROR
        MyEr "Joypad " & CStr(p) & " not exist", "η λαβή " & CStr(p) & " δεν υπάρχει"
        
        Exit Function
        End If
        While FastSymbol(rest$, ",")
        
         If IsExp(basestack, rest$, p) Then
        If Not StartJoypadk(Int(p)) Then
        MyEr "Joypad " & CStr(p) & " not exist", "η λαβή " & CStr(p) & " δεν υπάρχει"
        
        Exit Function

        End If
        Else
        MyEr "Joypad Number?", "Αριθμός Λαβής?"
        
        Exit Function

        End If
        Wend
        
        Else
        FlushJoyAll
        End If
ProcJoypad = True
End Function
Function ProcKeyboard(basestack As basetask, rest$) As Boolean
Dim par As Boolean, s$, p As Double
If FastSymbol(rest$, "!") Then
    MyShell "osk.exe"
Else
    par = True
    Do
        If par = False Then Exit Do
        If IsExp(basestack, rest$, p) Then
            MKEY$ = MKEY$ & ChrW$(Int(p) And &HFFFF)
            par = False
        ElseIf IsStrExp(basestack, rest$, s$) Then
        MKEY$ = MKEY$ & s$
        par = False
        Else
        Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
        par = True
    Loop
End If
ProcKeyboard = True
End Function
Function ProcSoundRec(basestack As basetask, rest$, lang As Long) As Boolean
' not tested yet...
Dim s$, p As Double, ss$, x As Double, y As Double
    If IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", lang) Then
    Set sRec = New RecordMci
    sRec.Rec_Initialize
    If IsStrExp(basestack, rest$, s$) Then
    
    sRec.FileName = s$
    End If
    If FastSymbol(rest$, ",") Then
    If IsExp(basestack, rest$, p) Then
    ' hz
        If IsLabelSymbolLatin(rest$, "STEREO") Then
        sRec.Stereo
        Else
        sRec.Mono
        End If
        If IsLabelSymbolLatin(rest$, "HIFI") Then
        sRec.Bit16
        Else
        sRec.Bit8
        End If
        sRec.QualityAny p
    End If
    Else
        sRec.RecFast
    End If
    ElseIf Not (sRec Is Nothing) Then
    ss$ = ""
    If IsLabelSymbolNewExp(rest$, "ΕΙΣΑΓΩΓΗ", "INSERT", lang, ss$) Then
        sRec.Capture True
    ElseIf IsLabelSymbolNewExp(rest$, "ΑΛΛΑΓΗ", "OVERWRITE", lang, ss$) Then
        sRec.ReCapture
    ElseIf IsLabelSymbolNewExp(rest$, "ΑΠΟΚΟΠΗ", "DELETE", lang, ss$) Then
            If IsExp(basestack, rest$, x) Then
            Else
                x = 0
            End If
            If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", lang) Then
                If Not IsExp(basestack, rest$, y) Then
                    y = sRec.getLengthInMS
                End If
            Else
                y = sRec.getLengthInMS
            End If
            sRec.CutRecordMs x, y
    ElseIf IsLabelSymbolNewExp(rest$, "STOP", "ΔΙΑΚΟΠΗ", lang, ss$) Then
        sRec.recStop
    ElseIf IsLabelSymbolNewExp(rest$, "ΔΟΚΙΜΗ", "TEST", lang, ss$) Then
        sRec.recPlay
    ElseIf IsLabelSymbolNewExp(rest$, "ΘΕΣΗ", "POS", lang, ss$) Then
        If sRec.isRecPlaying Then
            If IsExp(basestack, rest$, x) Then
            sRec.recPlayFromMs x
            Else
            sRec.recPlay
            End If
        Else
        ' SEEK
            If IsExp(basestack, rest$, x) Then
            sRec.oneMCI "seek capture to " & CStr(CLng(x))
            Else
            sRec.oneMCI "seek capture to 0"
            End If
        End If
    ElseIf IsLabelSymbolNewExp(rest$, "ΣΩΣΕ", "SAVE", lang, ss$) Then
        If IsStrExp(basestack, rest$, s$) Then
            sRec.SaveAs s$
        Else
            sRec.Save
        End If
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΛΕΙΣΕ", "END", lang, ss$) Then
        Set sRec = Nothing
    End If
    Else
        
        MyEr "You don't have new recording", "Δεν έχεις ετοιμάσει νέα ηχογράφηση"
    End If
  ProcSoundRec = True
End Function
Function ProcLoadDoc(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim DUM As Boolean, pppp As mArray, s$, i As Long, x1 As Long, y1 As Long, frm$, ss$
ProcLoadDoc = True
If entrypoint = 1 Then DUM = True
      y1 = Abs(IsLabel(basestack, rest$, s$))

        If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                    If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                    MissingDoc
                    Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, frm$) Then
    MissStringExpr
    
    Exit Function
    End If
    ss$ = GetNextLine(frm$)
    SetNextLine frm$
    If frm$ <> "" Then
    MyEr "filename with line breaks", "όνομα αρχείου με αλλαγές γραμμών"
    
    End If
    ' check valid name
    If ExtractNameOnly(ss$) = "" Then BadFilename:  Exit Function
    If ExtractPath(ss$) = "" Then
    ss$ = mylcasefILE(mcd + ss$)
    End If
    If ExtractType(ss$) = "" Then ss$ = ss$ + ".txt"
    Else
    
    MissPar
    Exit Function
    End If
    
   
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then

                x1 = 2
                On Error Resume Next
                If FastSymbol(rest$, ",") Then
                Dim p As Double
                If IsExp(basestack, rest$, p) Then
                var(i).LCID = CLng(p)
                End If
                End If
                var(i).ReadUnicodeOrANSI ss$, DUM, x1
                If Err.Number > 0 Then Err.Clear: Exit Function
                 var(i).ListLoadedType = x1
                 Exit Function
                Else
                    MissingDoc
                    
                End If
            Else
                   MissFuncParameterStringVar
                    
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                                    x1 = 2
                pppp.item(i).ReadUnicodeOrANSI ss$, DUM, x1
                 pppp.item(i).ListLoadedType = x1
                    
                        Else
                         MissingDoc
                         
                        End If
    Else
                MissPar
    End If
End Function
Function ProcRecursionLimit(basestack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, prive As Long
ProcRecursionLimit = True
If IsExp(basestack, rest$, p) Then
deep = Abs(Int(p))
If IsSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then funcdeep = Abs(Int(p))
End If
ElseIf IsSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then funcdeep = Abs(Int(p))
Else
prive = GetCode(basestack.Owner)
    If deep = 0 Then
            If lang = 1 Then
            PlainBaSket basestack.Owner, players(prive), "NO RECURSION LIMIT FOR SUBRUTINES"
            Else
            PlainBaSket basestack.Owner, players(prive), "ΧΩΡΙΣ ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΡΟΥΤΙΝΕΣ"
            End If
            
    Else
    If lang = 1 Then
        PlainBaSket basestack.Owner, players(prive), "RECURSION LIMIT FOR SUBRUTINES " + CStr(deep)
         crNew basestack, players(prive)
        PlainBaSket basestack.Owner, players(prive), "RECURSION LIMIT FOR FUNCTIONS " + CStr(funcdeep)
    Else
        PlainBaSket basestack.Owner, players(prive), "ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΡΟΥΤΙΝΕΣ " + CStr(deep)
         crNew basestack, players(prive)
        PlainBaSket basestack.Owner, players(prive), "ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΣΥΝΑΡΤΗΣΕΙΣ " + CStr(funcdeep)
    End If
    End If
      '  PlainBaSket basestack.Owner, players(prive), CStr(deep)
    crNew basestack, players(prive)
End If
If funcdeep < 128 Then funcdeep = 128
If funcdeep > 14800 Then funcdeep = 14800
End Function
Function ProcSalata(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim p As Double, scr As Object, prive As Long
ProcSalata = True
On entrypoint GoTo charset, codepage, Locale
Exit Function
charset:
If IsExp(basestack, rest$, p) Then
On Error Resume Next
chr11:
    Set scr = basestack.Owner
    prive = GetCode(scr)
    scr.Font.charset = CInt(p)
    Form1.TEXT1.Font.charset = scr.Font.charset
    Form1.List1.Font.charset = scr.Font.charset
      StoreFont scr.Font.name, players(prive).SZ, scr.Font.charset
      players(prive).charset = scr.Font.charset
          Set scr = Nothing
End If
Exit Function
codepage:
        If IsExp(basestack, rest$, p) Then
        ' usercodepage for use compare.
        ' also change to form.
        On Error Resume Next
CHR222:
        UserCodePage = p
        p = GetCharSet(CLng(p))
        
        GoTo chr11
        End If
Exit Function
Locale:
    On Error Resume Next
    If IsExp(basestack, rest$, p) Then
    cLid = CLng(p)
    p = GetCodePage(CLng(p))
    GoTo CHR222
    End If
End Function
Function ProcGroup(entrypoint As Long, basestack As basetask, rest$, lang As Long) As Boolean
Dim s$, x1 As Long, y1 As Long, what$, flag As Boolean, ss$, i As Long, par As Boolean
Dim p As Double
ProcGroup = True
If entrypoint = 1 Then flag = True
If IsLabelSymbolNew(rest$, "ΑΥΤΟ", "THIS", lang) Then
    If basestack.UseGroupname <> "" Then
        MyEr "Not in a Group Definition: Remove Group This { }", "Όχι σε ορισμό ομάδας: Αφαίρεσε την Ομάδα Αυτό {} "
        Exit Function
    Else
        If IsLabel(basestack, ".DELETEME", s$) < 0 Then
            If Len(s$) = 8 Then: Exit Function '' why
            what$ = Left$(s$, Len(s$) - 9)
            x1 = 1
        Else
            MyEr "Used in a For statement, For Group { this= or =this }", "Χρησιμοποιείται εντός ενός ΓΙΑ ομάδα { αυτό= ή =αυτό} "
            Exit Function
        End If
    End If
Else
    x1 = Abs(IsLabel(basestack, rest$, what$))
  '' changed  '' no same name allowed with module
 '   If here$ = what$ Then NameConflict: Exit Function
End If
 
If x1 = 1 Then
    If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", lang) Then
        If IsStrExp(basestack, rest$, ss$) Then
            s$ = basestack.GroupName
            prepareGroup basestack, what$, y1, flag
            ProcGroup = ExecuteVarOnly(basestack, basestack.GroupName & what$, y1, ss$, lang) <> 0
            basestack.GroupName = s$
        End If
    Else
        par = Not FastSymbol(rest$, "+")
        If FastSymbol(rest$, "{") Then
            If par Then
            '' GROUP
                s$ = basestack.GroupName
                prepareGroup basestack, what$, y1, flag
                If flag Then ss$ = here$: here$ = ""
                If ExecuteVarOnly(basestack, basestack.GroupName & what$, y1, rest$, lang, flag) = 0 Then
                    var(y1).edittag = "'11001EDIT " + here$ + ", " + CStr(Len(rest$))
                End If
                If flag Then here$ = ss$
                ProcGroup = FastSymbol(rest$, "}")
            Else
            '' CLASS
                    ss$ = block(rest$)
                    s$ = basestack.GroupName
                    prepareGroup basestack, what$, y1, flag
                    If ExecuteVarOnly(basestack, basestack.GroupName & what$, y1, ss$, lang, flag) = 0 Then
                       rest$ = ss$ + rest$
                    Else
                        ProcGroup = FastSymbol(rest$, "}")
                    End If
            End If
            basestack.GroupName = s$
       Else
            If GetVar(basestack, basestack.GroupName & what$, i, flag) Then
            ProcGroup = True
            Else
                i = GlobalVar(basestack.GroupName & what$, CLng(0), False, flag)
                Set var(i) = New Group
                If FastSymbol(rest$, "=") Then
                    If IsExp(basestack, rest$, p) Then
                        If Not basestack.lastobj Is Nothing Then
                            If Typename(basestack.lastobj) = "Group" Then
                                s$ = here$: here$ = ""
                                UnFloatGroup basestack, basestack.GroupName & what$, i, basestack.lastobj
                                here$ = s$
                                Set basestack.lastobj = Nothing
                            End If
                        End If
                    End If
                End If
                Exit Function
            End If
        End If
    End If
End If
  
End Function
Function MyModule(basestack As basetask, rest$, lang As Long) As Boolean
Dim s$, pa$, ss$, x1 As Long, par As Boolean, what$, ohere$, i As Long, X3 As Long
ohere$ = here$
MyModule = True
x1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", lang)
        par = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", lang)
If x1 <> 0 Then
        If MaybeIsSymbol(rest$, Chr(34)) Then
                ISSTRINGA rest$, what$
                GoTo BYPASS1
        End If
End If
X3 = Abs(IsLabel(basestack, rest$, what$))
If X3 = 1 Or X3 > 4 Then
If X3 <> 1 Then
FastSymbol rest$, ")"
what$ = what$ + ")"
End If

        If x1 Then
BYPASS1:

                If Not GetGlobalSubAfterHere(basestack, what$, x1) Then
                        x1 = GlobalSub(what$, ""): basestack.IndexSub = x1
                End If
                If FastSymbol(rest$, "{") Then
                ss$ = block(rest$)
                i = Len(rest$)
                If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                If Left$(sbf(basestack.OriginalCode).sb, 10) = "'11001EDIT" Then
                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                s$ = ""
                        Else
                                pa$ = sbf(basestack.OriginalCode).sb
                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                            s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                End If
                        End If
                Else
                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                s$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf
                        End If
                End If
                 sbf(x1).sb = s$ + ss$: basestack.IndexSub = x1
                         If Not FastSymbol(rest$, "}") Then MyModule = False
                        
                Else
                        MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                End If
                Exit Function
        Else
          If par Then
                x1 = GlobalSub(what$, "", "")
                GoTo JUMP0
                ElseIf here$ = "" And GetSub(what$, x1) Then
JUMP0:
                        If x1 >= lckfrm And lckfrm <> 0 Then
                                MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                rest$ = ""
                                MyModule = False: Exit Function
                        End If
                        If FastSymbol(rest$, "{") Then
                            what$ = block(rest$)
                        If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                   If Not FastSymbol(rest$, "}") Then
                                           MyModule = False
                                      Else
                                     Call preProcessor(basestack, what$)
                                    If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                      
                                            sbf(x1).sb = what$: basestack.IndexSub = x1
                                End If
                               
                                        
                        Else
                                rest$ = ":" & what$ & " " & rest$      ''why
                        End If
                        Exit Function
                ElseIf GetlocalSub(basestack.GroupName & what$, x1) Then
                        If x1 >= lckfrm And lckfrm <> 0 Then
                                MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                rest$ = ""
                                MyModule = False: Exit Function
                        End If
                        If FastSymbol(rest$, "{") Then
                                i = Len(rest$) ''
                                what$ = block(rest$) + " "
                                While Left$(what$, 10) = "'11001EDIT"
                                        SetNextLine what$
                                Wend
                                If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                what$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf + what$
                                If Not FastSymbol(rest$, "}") Then
                                        MyModule = False
                                Else
                                Call preProcessor(basestack, what$)
                                If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                sbf(x1).sb = what$
                                basestack.IndexSub = x1
                                End If
                        Else
                                rest$ = ":" & basestack.GroupName & what$ & " " & rest$
                        End If
                        Exit Function
                ElseIf FastSymbol(rest$, "{") Then
                        If here$ = "" Then
                                pa$ = block(rest$)
                                Call preProcessor(basestack, pa$)
                                If Right$(pa$, 2) <> vbCrLf Then pa$ = pa$ + vbCrLf
                                basestack.IndexSub = GlobalSub(what$, pa$)
                        Else
                                ss$ = block(rest$)
                                Call preProcessor(basestack, ss$)
                                i = Len(rest$)
                                If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                If Left$(sbf(basestack.OriginalCode).sb, 10) = "'11001EDIT" Then
                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                s$ = ""
                                        Else
                                                pa$ = sbf(basestack.OriginalCode).sb
                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                            s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                                End If
                                        End If
                                Else
                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                s$ = "'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf
                                        End If
                                End If
                                basestack.IndexSub = GlobalSub(here$ & "." & basestack.GroupName & what$, s$ + ss$) 's$ + block(Rest$)
                        End If
                        If Not FastSymbol(rest$, "}") Then MyModule = False
                        Exit Function
                Else
                If basestack.StaticCollection Is Nothing Then ConnectStatic basestack, myUcase(what$)
                   basestack.connectnow = True
                        here$ = what$
                End If
        End If
Else
        If what$ <> "" Then rest$ = what$ & " :" & rest$
        If IsStrExp(basestack, rest$, s$) Then
         
                If basestack.StaticCollection Is Nothing Then ConnectStatic basestack, myUcase(s$)
                 basestack.connectnow = True
                here$ = myUcase(s$)
        Else
                rest$ = what$ & " " & rest$
                MyModule = False
        End If
End If
End Function
Function MyEscape(rest$, lang As Long) As Boolean
MyEscape = True
If lang = 1 Then
If IsLabelSymbolLatin(rest$, "ON") Then
escok = True
ElseIf IsLabelSymbolLatin(rest$, "OFF") Then
escok = False
Else
MyEscape = False
End If
Else
If IsLabelSymbol(rest$, "ΝΑΙ") Then
escok = True
ElseIf IsLabelSymbol(rest$, "ΟΧΙ") Then
escok = False
Else
MyEscape = False
End If
End If
End Function
Function MyIcon(basestack As basetask, rest$) As Boolean
Dim s$
If ttl Then
    If IsStrExp(basestack, rest$, s$) Then
        If CFname$(s$) <> "" Then Set Form3.Icon = LoadPicture(GetDosPath(s$))
    Else
        Set Form3.Icon = Form2.Icon
    End If
End If
End Function
Function ProcTitle(basestack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, s$
If IsStrExp(basestack, rest$, s$) Then
If Not ttl Then Load Form3
If Form1.Visible Then Form3.Timer1.Interval = 30
Form3.Timer1.enabled = False
''If s$ <> "" Then fonttest.font.charset = GetCharSet(GetCodePage(FoundLocaleId(s$)))
Form3.CaptionW = s$
Form3.Visible = True

If FastSymbol(rest$, ",") Then

    If IsExp(basestack, rest$, p) Then
        If p = 0 Then
                   If Not Form3.WindowState = 1 Then
                        Form3.Visible = True: Form3.Move -48000, 48000
                        Form3.WindowState = 1
                   End If
        Else
            If Not Form3.WindowState = 0 Then
                Form3.Visible = True

                Form3.WindowState = 0
             Form3.Move -48000, 48000
                End If
            
        End If
          
             mywait basestack, 100
        ProcTitle = True
        Exit Function
    Else
        ProcTitle = False
    End If
Else


    Form3.WindowState = 0
'If App.StartMode = vbSModeStandalone Then
    
   MyDoEvents
  '  Sleep 1
  '  End If
End If
ElseIf ttl Then
    If Form3.WindowState = 1 Then
    Form3.WindowState = 0
    MyDoEvents
    Sleep 1
    End If
Unload Form3
End If
ProcTitle = True
End Function
Function MyWrite(basestack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, s$, it As Long, par As Boolean, i As Long
If IsLabelSymbolNew(rest$, "ΜΕ", "WITH", lang) Then
    If IsStrExp(basestack, rest$, s$) Then
        csvsep$ = Left$(s$, 1)
        If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, s$) Then csvDec$ = Left$(s$, 1): MyWrite = True
    End If
    Exit Function
End If
MyWrite = True
If csvsep$ = "" Then csvsep$ = ","
If IsLabelSymbolNew(rest$, "ΔΕΚΑΕΞ", "HEX", lang) Then it = 1
If FastSymbol(rest$, "#") Then

    MyWrite = False
    If IsExp(basestack, rest$, p) Then

        On Error Resume Next
        i = CLng(MyMod(p, 512))
        
        par = False
        Do While FastSymbol(rest$, ",")

            If IsExp(basestack, rest$, p) Then
                If par Then
                        If Uni(i) Then
                                putUniString i, csvsep$
                        Else
                                putANSIString i, csvsep$
                               ' Print #i, ",";
                        End If
                End If
                If Uni(i) Then
                If it Then
                putUniString i, PACKLNG2$(p)
                Else
                    If Len(csvDec$) = 0 Then
                    putUniString i, NLtrim$(Str$(p))
                    Else
                    putUniString i, NLtrim$(Replace(Str$(p), ".", csvDec$))
                    End If
                End If
                Else
                    If Len(csvDec$) = 0 Then
                        putANSIString i, NLtrim$(Str$(p))
                    Else
                    putANSIString i, NLtrim$(Replace(Str$(p), ".", csvDec$))
                    End If
                End If
                If Err.Number > 0 Then Exit Function
                ElseIf IsStrExp(basestack, rest$, s$) Then
                If par Then
                        If Uni(i) Then
                                putUniString i, csvsep$
                        Else
                                putANSIString i, csvsep$
                        '       Print #i, ",";
                        End If
                        End If
                         s$ = Replace$(s$, Chr(34), Chr(34) + Chr(34))
                         If Uni(i) Then
                        
                    putUniString i, Chr(34) + s$ & Chr(34)
                Else
                    putANSIString i, Chr(34) + s$ & Chr(34)
'                    Print #i, chr(34) + S$ & chr(34);
                    End If
                    If Err.Number > 0 Then Exit Function
                Else
                
                    Exit Function
                End If
                par = True
        Loop
        If Uni(i) Then
            putUniString i, vbCrLf
        Else
            putANSIString i, vbCrLf
            'Print #i, Chr$(13) + Chr$(10);
        End If
        MyWrite = True

    End If
End If

End Function
Function MyPut(basestack As basetask, rest$) As Boolean
Dim s$, f As Long, p As Double, i As Long, par As Boolean, PP As Double, it As Long
Dim myobject As mHandler, what$
MyPut = False
 IsSymbol3 rest$, "#"
If IsExp(basestack, rest$, p) Then
f = CLng(MyMod(p, 512))
If Not FastSymbol(rest$, ",") Then Exit Function
    If IsExp(basestack, rest$, p) Then
    If basestack.lastobj Is Nothing Then Exit Function
    If Not TypeOf basestack.lastobj Is mHandler Then Exit Function
    If Not TypeOf basestack.lastobj.objref Is MemBlock Then Exit Function
    Set myobject = basestack.lastobj
    par = True
    Else
    If Not IsStrExp(basestack, rest$, s$) Then Exit Function
    End If

If par Then
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
    i = CLng(MyMod(p, 2147483647))
    Seek #f, (i - 1) * FLEN(f) + 1
Else
    GoTo ex123
End If
End If
With myobject.objref
Dim aa() As Byte
If .ValidArea2(0, FLEN(f)) Then
ReDim aa(0 To FLEN(f) - 1)
CopyBytes FLEN(f), VarPtr(aa(0)), .GetPtr(0)
Put #f, , aa()
Else
MyEr "Wrong size-position for loading the buffer", "Λάθος μέγεθος-θέση για να φορτωθεί η Διάρθρωση"
GoTo ex123
End If
End With
' use pp for
Else
If Uni(f) Then
s$ = Left$(s$, FLEN(f) \ 2)
s$ = s$ & Space$(FLEN(f) \ 2 - Len(s$))
Else
s$ = Left$(s$, FLEN(f))
s$ = s$ & Space$(FLEN(f) - Len(s$))
End If
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
i = CLng(MyMod(p, 2147483647))
Seek #f, (i - 1) * FLEN(f) + 1
Else
Exit Function
End If
End If
If Uni(f) Then
putUniString f, s$
Else
Put #f, , s$
End If
End If
MyPut = True
End If
ex123:
Set myobject = Nothing
Set basestack.lastobj = Nothing
End Function
Function ProcSubDir(basestack As basetask, rest$, lang As Long) As Boolean
Dim x1 As Long, ss$, w$
x1 = Abs(IsLabelBig(basestack, rest$, ss$, , w$))
If x1 = 1 Then
    ss$ = w$
ElseIf x1 = 0 Or x1 = 3 Or x1 = 6 Then
rest$ = ss$ + rest$
    x1 = IsStrExp(basestack, rest$, ss$)
End If
If x1 <> 0 Then
    ss$ = mcd + ss$
    AddDirSep ss$
    If PathMakeDirs(ss$) Then
        mcd = ss$
        ProcSubDir = True
    Else
        BadPath
    End If
Else
MissDir
End If

End Function
Function ProcDir(basestack As basetask, rest$, lang As Long) As Boolean
Dim pa$, w$, par As Boolean, s$, ss$, i As Long, p As Double, what$, x1 As Long
If IsLabelSymbolNew(rest$, "ΧΡΗΣΤΗ", "USER", lang) Then
If IsSupervisor Then
dset
Else
    mcd = userfiles
    End If
    ProcDir = True
    Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΚΥΡΙΟ", "MASTER", lang) Then

    userfiles = GetSpecialfolder(CLng(26)) & "\M2000\"
    ProcDir = True
    Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΥΠΟΛΟΓΙΣΤΗ", "COMPUTER", lang) Then
 If IsSupervisor Then pa$ = "#" Else BadCommand: ProcDir = False: Exit Function
Else
    pa$ = ""
End If
If FastSymbol(rest$, "?") Or pa$ <> "" Then
If IsSelectorInUse Then
ProcDir = False
SelectorInUse
Exit Function
End If
ProcDir = True
    If pa$ = "#" Then
    w$ = "#"
    pa$ = ""
    Else
    p = CBool(IsStrExp(basestack, rest$, w$))
    End If
    If pa$ = "" Then If FastSymbol(rest$, ",") Then p = CBool(IsStrExp(basestack, rest$, pa$))
    olamazi
    DialogSetupLang lang
    par = False
    If w$ <> "" Then
    
        If Right$(w$, 1) = "?" Then
            w$ = Trim$(Left$(w$, Len(w$) - 1))
    mcd = w$ '' userfiles = W$
            par = True
        End If
    Else
    If IsSupervisor Then w$ = "\" Else w$ = userfiles
    End If

s$ = ""
    If Form1.Visible Then
    If w$ = "#" Then
        If IsSupervisor Then
          If FolderSelector(basestack, Form1, "", "*", pa$, False) Then
            s$ = ReturnFile
        End If
        Else
        BadCommand
        ProcDir = False
        Exit Function
        End If
    Else
    If w$ <> "" Then If Not isdir(w$) Then BadPath: ProcDir = False: Exit Function
    If Not CanKillFile(w$) Then FilePathNotForUser: ProcDir = False: Exit Function
        If FolderSelector(basestack, Form1, mcd, w$, pa$, par) Then
            s$ = ReturnFile
        End If
    End If
    ElseIf form5iamloaded Then
      If w$ <> "" Then If Not isdir(w$) Then BadPath: ProcDir = False: Exit Function

      If Not CanKillFile(w$) Then FilePathNotForUser: ProcDir = False: Exit Function
        If FolderSelector(basestack, Form5, mcd, w$, pa$, par) Then
           s$ = ReturnFile
        End If
    End If
    s$ = mylcasefILE(s$)
            If s$ <> "" Then
            AddDirSep s$
                ''If Right(s$, 1) <> "\" Then s$ = s$ & "\"
                If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
                      Select Case Abs(IsLabel(basestack, rest$, what$))
                        Case 3
                        ProcDir = True
                            If GetVar(basestack, what$, i) Then
                            CheckVar var(i), s$
                            Else
                            GlobalVar what$, s$
                    
                            End If
                        Case Else
                            MissingStrVar
                            ProcDir = True
                            Exit Function
                        End Select
                 Else
                   mcd = s$
        
                   ProcDir = True
                   Exit Function
                End If
            End If
Else
x1 = Abs(IsLabelBig(basestack, rest$, ss$, , w$))
If x1 = 1 Then
ss$ = w$
ElseIf x1 = 0 Or x1 = 3 Or x1 = 6 Then
rest$ = ss$ + rest$
x1 = IsStrExp(basestack, rest$, ss$)
End If

If Left$(ss$, 1) = "." Then x1 = 1
If ss$ = ".." And mcd = userfiles And Not IsSupervisor Then ProcDir = True: Exit Function ' no error
FixPath ss$
If x1 = 0 Then
IsSymbol3 rest$, "."
If FastSymbol(rest$, "*") Then
rest$ = Chr(34) + "*" + Chr(34) + rest$
ElseIf Not FastSymbol(rest$, "!") Then
rest$ = Chr(34) + "GSB" + Chr(34) + rest$
End If
 x1 = 1: ss$ = mcd
 par = True
End If
If x1 <> 0 Then
AddDirSep ss$
    If isdir(ss$) Then
        If Right(ss$, 1) <> "\" Then ss$ = ss$ & "\"
        If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
                Select Case Abs(IsLabel(basestack, rest$, what$))
                Case 3
                ProcDir = True
                    If GetVar(basestack, what$, i) Then
                    CheckVar var(i), ss$
                    Else
                    GlobalVar what$, ss$
            
                    End If
                Case Else
               MissingStrVar
               ProcDir = False
            Exit Function
                End Select
          
        Else
        If CanKillFile(ss$) Then
            mcd = ss$
            ProcDir = True
            If par = True Then
            'GOTO FILES
            If UserPath = "." Then
            If lang Then
            ss$ = Chr(34) & "Dir User " & Originalusername & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος Χρήστη " & Originalusername & Chr(34)
            End If
            Else
            If IsSupervisor Then
            If lang Then
            ss$ = Chr(34) & "Dir: " & UserPath2 & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος: " & UserPath2 & Chr(34)
            End If
            Else
            If lang Then
            ss$ = Chr(34) & "Dir User " & Originalusername & ": " & mylcasefILE(UserPath2) & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος Χρήστη " & Originalusername & ": " & mylcasefILE(UserPath2) & Chr(34)
            End If
            End If
            End If
          
            par = MyReport(basestack, ss$, lang)
            par = ProcFiles(basestack, rest$, lang)
            par = ProcCat(basestack, "", lang)
            End If
            Else
            
         mcd = ss$
            ProcDir = True
            If par Then
            If lang Then
            ss$ = "{Read Only Folder: " & mcd & "}"
            Else
            ss$ = "{Κατάλογος μόνο για ανάγνωση: " & mcd & "}"
            End If
            par = MyReport(basestack, ss$, lang)
            par = ProcFiles(basestack, rest$, lang)
            par = ProcCat(basestack, "", lang) Or par
            
            End If
            End If
            Exit Function
          
        End If
     Else
     BadPath
            ProcDir = False
            Exit Function
    End If
    End If
End If

End Function

Function ProcRemove(basestack As basetask, rest$, lang As Long) As Boolean
Dim ss$
ProcRemove = True
If IsLabelSymbolNew(rest$, "ΑΔΕΙΑΣ", "LICENCE", lang) Then
If IsStrExp(basestack, rest$, ss$) Then
Licenses.Remove ss$
Else
MissStringExpr
End If
Else
If sb2used <= basestack.OriginalCode And basestack.OriginalCode <> 0 Then
MyEr "Can't Remove Last Module/Function", "Δεν μπορώ να διαγράψω το τελευταίο τμήμα/συνάρτηση"
ProcRemove = False
ElseIf IsStrExp(basestack, rest$, ss$) Then
RemoveDll ss$
Else
If sb2used > 0 Then
If subHash.count > 0 Then subHash.ReduceHash subHash.count - 1, sbf()
    If UBound(sbf()) / 2 > sb2used And UBound(sbf()) > 19 Then
       ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
         
    End If
    sb2used = sb2used - 1

If lckfrm <> 0 Then
If lckfrm > sb2used Then lckfrm = 0

End If
End If


End If
End If
End Function
Function ProcClass(basestack As basetask, rest$, lang As Long) As Boolean
Dim i As Long, ss$, y1 As Long, what$, w$, ohere$
ohere$ = here$
ProcClass = True
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", lang)
If IsLabelA("", rest$, w$) = 1 Then
        If FastSymbol(rest$, "{") Then
                ss$ = block(rest$)
                i = Len(rest$)
                If lang = 1 Then
                        rest$ = w$ + "{'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf + "group " + w$ + " +{" + ss$ & "}" + vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=" + w$ + rest$
                Else
                        rest$ = w$ + "{'11001EDIT " & StripRVAL(ohere$) & ",-" & CStr(i) + vbCrLf + "ομαδα " + w$ + " +{" + ss$ & "}" + vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=" + w$ + rest$
                End If
                ProcClass = MyFunction(1, basestack, rest$, lang)
         Else
                If Not GetVar(basestack, basestack.GroupName & what$, i) Then
                        i = GlobalVar(basestack.GroupName & what$, CLng(0))
                        Set var(i) = New Group
                Else
                        If Typename(var(i)) <> "Group" Then Set var(i) = New Group
                End If
        End If
Else
        MyEr what$ & " without name", what$ & "χωρίς όνομα"
        ProcClass = False
End If

End Function
Function ProcDef(basestack As basetask, rest$) As Boolean
Dim i As Long, what$, y1 As Long, ss$, s$
ProcDef = True
y1 = IsLabel(basestack, rest$, what$)
If y1 >= 5 Then
s$ = BlockParam(rest$)
rest$ = Mid$(rest$, Len(s$) + 1)
If FastSymbol(rest$, ")", True) Then
If FastSymbol(rest$, "=", True) Then
ss$ = ""
Do
i = 1
aheadstatus rest$, False, i
ss$ = ss$ + Left$(rest$, i - 1)
rest$ = Mid$(rest$, i)
If Not FastSymbol(rest$, ",") Then Exit Do
ss$ = ss$ + ", "
Loop
ProcDef = MyFunction(0, basestack, Left$(what$, Len(what$) - 1) + " {  @read " + s$ + vbCrLf + "=" + ss$ + "}", 1)
Exit Function
End If
End If
Else
MyEr "Need name for function with parenthesis", "Θέλω όνομα συνάρτησης με παρενθέσεις"
ProcDef = False
Exit Function
End If

End Function
Function ProcLoad(basestack As basetask, rest$) As Boolean
Dim x1 As Long, s$, w$, ss$, par As Boolean, vvl As Variant
ProcLoad = True
Do
x1 = Abs(IsLabelBig(basestack, rest$, s$, , w$))
If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If
If x1 <> 0 Then
If ExtractType(s$) <> "gsb" Then

s$ = CFname(mcd + ExtractNameOnly(s$) & ".gsb")

If s$ = "" Then s$ = mcd + ExtractNameOnly(s$) & ".gsb"
Else
ss$ = s$
If ExtractPath$(s$) = "" Then
s$ = ExtractName(s$)
ss$ = Trim$(Mid$(ss$, Len(s$) + 1))
s$ = mcd + s$
Else
s$ = ExtractPath(s$) + ExtractName(s$)
ss$ = Trim$(Mid$(ss$, Len(s$) + 1))

End If

Switches ss$
End If
If ExtractNameOnly(s$) = "" Then
MyEr "No such file", "Δεν υπάρχει τέτοιο αρχείο"
Exit Function
End If
ss$ = ReadUnicodeOrANSI(s$, True)
If ss$ <> "" Then
If Err.Number = 0 And here$ = "" Then LASTPROG$ = s$
If FastSymbol(rest$, ",") Then
        If IsStrExp(basestack, rest$, w$) Then
                ss$ = mycoder.decryptline(ss$, w$, (Len(ss$) / 2) Mod 33)
                If Abs(IsLabel(basestack, ss$, w$)) Then
                        If Not Left$(ss$, 3) = ":" & vbCrLf Then ProcLoad = False: Exit Function
                        If lckfrm = 0 And Not NORUN1 Then lckfrm = sb2used + 1
                End If
        End If
End If
par = False

Do While MaybeIsSymbol(ss$, "\'[*")
SetNextLine ss$
par = True
Loop
ss$ = Replace(ss$, Chr$(9), "      ")
If ss$ <> "" Then
If par Then GoTo skipme
If (AscW(ss$) > 127 And myUcase(Left$(ss$, 5)) <> "ΚΛΑΣΗ" And myUcase(Left$(ss$, 5)) <> "ΤΜΗΜΑ" And myUcase(Left$(ss$, 9)) <> "ΣΥΝΑΡΤΗΣΗ") Or (((AscW(ss$) And &H4000) = &H4000)) Then
    ss$ = mycoder.must(ss$)
    If NORUN1 Then
        Clipboard.Clear
        ''Clipboard.SetText SS$, vbCFText
        
        SetTextData CF_UNICODETEXT, ss$
    End If

    If IsLabelA("", ss$, w$) Then
        If Not (Left$(ss$, 3) = ":" & vbCrLf) Then ProcLoad = False: Exit Function
        'lock that module
        If lckfrm = 0 And Not NORUN1 Then lckfrm = sb2used + 1
    Else
        MOUT = True
    End If
Else
skipme:
    While FastSymbol(ss$, vbCrLf, , 2)
    
      ''  SleepWait 20
    Wend
    If Abs(IsLabel(basestack, ss$, w$)) Then
        If Not (Left$(ss$, 3) = ":" & vbCrLf) Then
        ss$ = w$ & " " & ss$
        End If
    End If
End If

vvl = CStr(vvl) + vbCrLf + ss$ & vbCrLf
End If
End If
End If
Loop Until MOUT Or Not IsSymbol(rest$, "&&", 2)
rest$ = CStr(vvl) + rest$

End Function
Function MyDocument(basestack As basetask, rest$, lang As Long) As Boolean
Dim ss$, s$, what$, x1 As Long, i As Long, it As Long, pppp As mArray
MyDocument = True
ss$ = ""
Do
    x1 = Abs(IsLabel(basestack, rest$, what$))
        If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
    If x1 = 3 Or x1 = 6 Then
        If x1 = 3 Then
        
                
                
            If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(basestack.GroupName & what$, i) Then
            GoTo there0
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            GoTo there0
            Else
            i = GlobalVar(basestack.GroupName & what$, s$)  ' MAKE ONE  '
             GoTo makeitnow
            End If
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            
there0:
                s$ = var(i)
                MakeitObject var(i)
                CheckVar var(i), s$
                GoTo there1
            Else
        
                i = GlobalVar(basestack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow:
                    MakeitObject var(i)
there1:
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                            CheckVar var(i), s$
                        Else
                            MissStringExpr
                            MyDocument = False
                        End If
                    Else
                    ' DO NOTHING
                    End If
                End If
            End If
        Else
            ' ARRAYf
            If neoGetArray(basestack, what$, pppp, here$ <> "") Then   ' basestack.GroupName &
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then MyDocument = False: Exit Function
                x1 = 0
                If Not IsObject(pppp.item(it)) Then
                    s$ = pppp.item(it)
                    Set pppp.item(it) = New Document
                    If s$ <> "" Then pppp.item(it).textDoc = s$
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                            CheckVar pppp.item(it), s$
                        Else
                            MissStringExpr
                        MyDocument = False
                        End If
                    End If
                Else
                If FastSymbol(rest$, "=") Then
                    If IsStrExp(basestack, rest$, s$) Then
                        CheckVar pppp.item(it), s$
                    Else
                        MissStringExpr
                        MyDocument = False
                    End If
                Else
                    Exit Do
                   End If
                End If
                MyDocument = True
            Else
            MyErMacro rest$, "array has no dimension", "ο πίνακας δεν έχει οριστεί"
             MyDocument = False
             Exit Function
            End If
          
            End If
    Else
    SyntaxError
    MyDocument = False
    
    End If
    Loop Until Not FastSymbol(rest$, ",")

End Function
Function MyLong(basestack As basetask, rest$, lang As Long) As Boolean
Dim s$, what$, i As Long, p As Double
MyLong = True

     Do While Abs(IsLabel(basestack, rest$, what$)) = 1
     If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
     If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(basestack.GroupName & what$, i) Then
            p = var(i)
            GoTo there01
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
             p = var(i)
            GoTo there01
            Else
            i = GlobalVar(basestack.GroupName & what$, s$)     ' MAKE ONE  '

             GoTo makeitnow1
            End If
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            
there01:
                
                MakeitObjectLong var(i)
                CheckVarLong var(i), CLng(p)
                GoTo there12
            Else
        
                i = GlobalVar(basestack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow1:
                    MakeitObjectLong var(i)
there12:
                    If FastSymbol(rest$, "=") Then
                        If IsExp(basestack, rest$, p) Then
                        
                            CheckVarLong var(i), CLng(p)
                        Else
                            MissNumExpr
                            MyLong = False
                        End If
                    Else
                    ' DO NOTHING
                    End If
                End If
            End If
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     Loop
End Function
Function MyLink(basestack As basetask, rest$, lang As Long) As Boolean
MyLink = True
Dim myobject As mStiva, ohere$, s$, ss$, x1 As Long, it As Long
ohere$ = here$
Set myobject = basestack.soros
Set basestack.Sorosref = New mStiva
s$ = ""
Do
    If IsLabelSymbolNew(rest$, "ΙΣΧΝΗ", "WEAK", lang) Then
        If IsStrExp(basestack, rest$, ss$) Then
            If GetSub(ss$, x1) Then
                basestack.soros.DataStr "{" + sbf(x1).sb + "}": x1 = 1: GoTo contlink2
            Else
                basestack.soros.DataStr ss$: x1 = 1: GoTo contlink2
            End If
        End If
        MissStringExpr
        MyLink = False
        Exit Function
    End If
    it = IsLabelDot(ohere$, rest$, ss$)
    If it = 2 Then it = IsLabelDot(ohere$, rest$, ss$)
    If it = 0 Then If IsStrExp(basestack, rest$, ss$) Then x1 = 1: basestack.soros.DataStr ss$: GoTo contlink2
    If it <> 0 And ss$ <> "" Then
        If Left$(ss$, 1) = "&" Then ss$ = Mid$(ss$, 2)
            If it < 0 Then IsLabel basestack, (ss$), ss$
            If it > 4 Then
                ss$ = ss$ + ")"
                If Not FastSymbol(rest$, ")") Then it = 0
            End If
            x1 = 1
            aheadstatus rest$, False, x1
            s$ = "&" + ss$ + Mid$(rest$, 1, x1 - 1)
            If x1 > 1 Then rest$ = Mid$(rest$, x1)
            If Not MyData(basestack, s$) Then
            Set basestack.Sorosref = myobject
            Exit Function
        End If
    End If
    If s$ <> "" Then rest$ = s$ + rest$
Loop While FastSymbol(rest$, ",")
contlink2:
If basestack.soros.Total = 0 Then
    MyEr "Nothing to link", "Τίποτα για να ενώσω"
ElseIf IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", lang) Then
    MyLink = MyRead(2, basestack, rest$, lang)
ElseIf IsLabelSymbolNew(rest$, "ΣΤΗ", "TO", lang, True) Then
    MyLink = MyRead(2, basestack, rest$, lang)
End If
Set basestack.Sorosref = myobject
Set myobject = Nothing
End Function

Function MyError(basestack As basetask, rest$, lang As Long) As Boolean
Dim p As Double, x1 As Long, s$, ss$, what$
x1 = LastErNum
If IsExp(basestack, rest$, p) Then
If p = 0 Then
NERR = True
MyError = False
Exit Function
ElseIf p = -1 Then
NERR = False
MyError = False
Exit Function
Else
If p = -2 Then
 ISSTRINGA rest$, s$
 ISSTRINGA rest$, ss$
MyEr s, ss$
If basestack.IamThread Then
On Error Resume Next
basestack.Parent.ThrowThreads
NERR = False
MyError = False
Exit Function
End If
MyError = False
Exit Function

Else
MyEr "ERROR " & Trim$(Str$(p)), "ΛΑΘΟΣ " & Trim$(Str$(p))
LastErNum = p
End If
End If
ElseIf IsStrExp(basestack, rest$, s$) Then
MyEr what$ & " " & s$, what$ & " " & s$
Else
LastErNum = 0 ': LastErNum1 = 0
LastErNameGR = ""
LastErName = ""

MyError = True
Exit Function
End If

MyError = False

End Function


Function MyDim(basestack As basetask, rest$, lang As Long) As Boolean
Dim par As Boolean, pppp As mArray, it As Long
Dim p As Double, w$, s$, x As Double, i As Long, f As Long, reverse As Boolean, ss$
MyDim = True
reverse = IsLabelSymbolNew(rest$, "OLE", "OLE", lang)
par = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", lang)

Do

    it = Abs(IsLabelDIM(basestack, rest$, w$))
    If basestack.priveflag Then w$ = ChrW(&HFFBF) + w$
    If MaybeIsSymbol(rest$, ")") Then rest$ = "0" + rest$

    ''*********************
    If neoGetArray(basestack, w$, pppp, here$ <> "") And Not par Then
    If pppp.IHaveClass And pppp.GroupRef Is Nothing Then Set pppp = Nothing: Exit Function
   ' If reverse Then pppp.RevOrder = True
    Select Case it
    Case 5, 6, 7
   GlobalArrResize pppp, basestack, w$, rest$, i
   p = i
    If i < 0 Then it = 0
    Case Else
    it = 0
    End Select
   Else
    Select Case it
    Case 5, 6, 7
    GlobalArr basestack, w$, rest$, i, f, , reverse
    p = i
    If i < 0 Then it = 0
    Case Else
    it = 0
    End Select
    End If
    Select Case it
    Case 5
    x = 0
    If FastSymbol(rest$, "=") Then
        If IsExp(basestack, rest$, x) Then
        If neoGetArray(basestack, w$, pppp) Then
                     If Not basestack.lastobj Is Nothing Then
                            If Typename(basestack.lastobj) = "Group" Then
                                Set pppp.GroupRef = basestack.lastobj
                                 pppp.IHaveClass = True
                                  Set basestack.lastobj = Nothing
                                 pppp.SerialItem 0, 0, 3
                            ElseIf Typename(basestack.lastobj) = "lambda" Then
                                    pppp.FillLambda basestack
                            Else
                            Set basestack.lastobj = Nothing
                                                        MyEr "Only Group or Lambda", "Μόνο Ομάδες και λάμδα"
                                                        MyDim = False
                                                        Exit Function
                                         
                    
                            End If
                    Else
                            pppp.SerialItem x, 0, 3
                    End If
            Else
            it = 0
        End If
        End If
    ElseIf FastSymbol(rest$, "<<", , 2) Then
         f = 1
         s$ = aheadstatus(rest$, True, f)
         If f > 0 Then
                s$ = Left$(rest$, f - 1)
                rest$ = Mid$(rest$, f)
                If neoGetArray(basestack, w$, pppp) Then
                        For i = 0 To pppp.UpperMonoLimit
                        If IsExp(basestack, (s$), x) Then
                                        If Not basestack.lastobj Is Nothing Then
                                                 If Typename(basestack.lastobj) = "Group" Then
                                                     Set pppp.GroupRef = Nothing
                                                     pppp.IHaveClass = False
                                                        pppp.item(i) = basestack.lastobj
                                                  ElseIf Typename(basestack.lastobj) = "lambda" Then
                                                     pppp.item(i) = basestack.lastobj
                                                    Else
                                                        Set basestack.lastobj = Nothing
                                                        MyEr "Only Group or Lambda objects here", "Μόνο Ομάδες ή λάμδα αντικείμενα εδώ"
                                                        MyDim = False
                                                        Exit Function
                                                        Exit For
                                                     End If
                                                     
                                        Else
                                                pppp.item(i) = x
                                        End If
                                        
                        Else
                          Set basestack.lastobj = Nothing
                            MyDim = False
                            Exit Function
                            Exit For
                        End If
                        Next i
                          Set basestack.lastobj = Nothing
            Else
            it = 0
        
                End If
          End If
     
    
     End If
    Case 7
    x = 0
    If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
   If neoGetArray(basestack, w$, pppp) Then ''basestack.GroupName &
    If Typename(basestack.lastobj) = "lambda" Then
                                pppp.FillLambda basestack
                             
   Else
    pppp.SerialItem Int(x), 0, 3
    End If
    End If
    Else
    it = 0
    End If
   ElseIf FastSymbol(rest$, "<<", , 2) Then
         f = 1
         s$ = aheadstatus(rest$, True, f)
         If f > 0 Then
                s$ = Left$(rest$, f - 1)
                rest$ = Mid$(rest$, f)
                If neoGetArray(basestack, w$, pppp) Then
                        For i = 0 To pppp.UpperMonoLimit
                        If IsExp(basestack, (s$), x) Then
                            If Typename(basestack.lastobj) = "lambda" Then
                                    pppp.item(i) = basestack.lastobj
                            ElseIf basestack.lastobj Is Nothing Then
                                    pppp.item(i) = Int(x)
                            Else
                                                     Set basestack.lastobj = Nothing
                                                        MyEr "Only Lambda objects here", "Μόνο λάμδα αντικείμενα εδώ"
                                                        MyDim = False
                                                        Exit Function
                                                        Exit For
                            End If
                        Else
                            Set basestack.lastobj = Nothing
                            MyDim = False
                            Exit Function
                            Exit For
                        End If
                        Next i
                        Set basestack.lastobj = Nothing
            Else
                        it = 0
            End If
          End If
     End If
    Case 6
        s$ = ""
    If FastSymbol(rest$, "=") Then
    If IsStrExp(basestack, rest$, s$) Then
   If neoGetArray(basestack, w$, pppp) Then '' basestack.GroupName &
   If Typename(basestack.lastobj) = "lambda" Then
                                pppp.FillLambda basestack
                            
   Else
    pppp.SerialItem s$, 0, 3
       End If
    End If
    Else
    it = 0
    End If
   ElseIf FastSymbol(rest$, "<<", , 2) Then
         f = 1
         s$ = aheadstatus(rest$, True, f)
         If f > 0 Then
                s$ = Left$(rest$, f - 1)
                rest$ = Mid$(rest$, f)
                If neoGetArray(basestack, w$, pppp) Then
                        For i = 0 To pppp.UpperMonoLimit
                        If IsStrExp(basestack, (s$), ss$) Then
                            If Typename(basestack.lastobj) = "lambda" Then
                                    pppp.item(i) = basestack.lastobj
                            ElseIf basestack.lastobj Is Nothing Then
                                    pppp.item(i) = ss$
                            Else
                                                     Set basestack.lastobj = Nothing
                                                        MyEr "Only Lambda objects here", "Μόνο λάμδα αντικείμενα εδώ"
                                                        MyDim = False
                                                        Exit Function
                                                        Exit For
                            End If
                        Else
                            Set basestack.lastobj = Nothing
                            MyDim = False
                            Exit Function
                            Exit For
                        End If
                        Next i
                        Set basestack.lastobj = Nothing
            Else
                        it = 0
            End If
          End If
     End If
    End Select
    If it = 0 Then
      MyEr "Array dimensions missing ", "Ο πίνακας δεν έχει διαστάσεις "

    rest$ = basestack.GroupName & w$ & rest$
    MyDim = False
    Exit Function
    End If
    
Loop Until Not FastSymbol(rest$, ",")

End Function
Function MyNew(basestack As basetask, rest$, lang As Long) As Boolean
MyNew = True
If (basestack.Process Is Nothing) And (basestack.Parent Is Nothing) Then
Set basestack.StaticCollection = Nothing 'New FastCollection
abt = False
LASTPROG$ = ""
Randomize Timer
Set comhash = New sbHash
allcommands comhash
If lang = 0 Then
sHelp "Μ2000 [ΒΟΗΘΕΙΑ]", "Γράψε ΤΕΛΟΣ για να βγείς από το πρόγραμμα" & vbCrLf & "Δες τα ΟΛΑ (κάνε κλικ στο ΟΛΑ)" & vbCrLf & "George Karras 2016", (ScrX() - 1) * 3 / 5, (ScrY() - 1) * 1 / 7
Else
sHelp "Μ2000 [HELP]", "Write END for exit from this program" & vbCrLf & "See ALL commands  (click on ALL)" & vbCrLf & "George Karras 2016", (ScrX() - 1) * 3 / 5, (ScrY() - 1) * 1 / 7
End If
NERR = False
lckfrm = 0
subHash.ReduceHash 0, sbf()
sb2used = 0
ReDim sbf(50) As modfun
TaskMaster.Dispose

CloseAllConnections
CleanupLibHandles
' This is the INPUT END
If Not NOEDIT Then
NOEDIT = True
Else
If QRY Then QRY = False
End If
' restore DB.Provider for User
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
End If

End Function
Function MyScan(basestack As basetask, rest$) As Boolean
Dim p As Double, y As Double
If Not Targets Then MyDoEvents: Exit Function
If basestack.Owner.Visible = False Then basestack.Owner.Visible = True
basestack.Owner.SetFocus

NoAction = False

nomore = True
If IsExp(basestack, rest$, p) Then
y = Timer + p

Do ' TOO
MyDoEvents
Loop Until NoAction Or Timer > y Or NOEXECUTION
    'End If
Else
Do ' TOO
 MyDoEvents
If FKey > 0 Then
If FK$(FKey) <> "" Then
rest$ = FK$(FKey) + rest$
FKey = 0
Exit Do
End If
End If
Loop Until NoAction Or NOEXECUTION
End If
nomore = False ' TOO

End Function

Function MySeek(basestack As basetask, rest$) As Boolean
Dim x1 As Long, x As Double
MySeek = True
IsSymbol3 rest$, "#"   ' OPTIONAL   ...SEEK #I, 10020  ΒΥΤΕ
If IsExp(basestack, rest$, x) Then
x1 = CLng(MyMod(Abs(x), 512))
If FLEN(x1) = 0 Then
MySeek = False
MyEr "not valid file number", "λάθος αριθμός αρχείου"
Exit Function
End If
If FLEN(x1) <> 1 Then
MySeek = False
MyEr "not valid file type", "λάθος ΤΥΠΟΣ αρχείου"
Exit Function
End If
If Not FastSymbol(rest$, ",") Then
MissNumExpr
Else
If IsExp(basestack, rest$, x) Then
Seek #x1, x
Else
''''MySeek = False  'I HAVE TO LOOK THAT
MissNumExpr
End If
End If
End If

End Function
Function MyClose(basestack As basetask, rest$, lang As Long) As Boolean
Dim par As Boolean, p As Double, ss$
MyClose = True
If Not IsLabelSymbolNew(rest$, "ΒΑΣΗ", "BASE", lang) Then
    par = False
    Do
        IsSymbol3 rest$, "#" ' optional
        If IsExp(basestack, rest$, p) Then
            p = CLng(MyMod(Abs(p), 512))
            Close Abs(p)
            FLEN(p) = 0
        Else
            If par Then
                MyClose = False
            Else
                closeAll
            End If
        Exit Do
        End If
        par = True
    Loop Until Not FastSymbol(rest$, ",")
Else
Do
If IsStrExp(basestack, rest$, ss$) Then
RemoveOneConn ss$
End If
Loop Until Not FastSymbol(rest$, ",")
End If

End Function
Function MyVol(basestack As basetask, rest$) As Boolean
Dim p As Double
If IsExp(basestack, rest$, p) Then
    vol = CLng(MyMod(Abs(p), 101))
    If AVIRUN Then
        MediaPlayer1.setLeftVolume vol * 10
        MediaPlayer1.setRightVolume vol * 10
    Else
        MediaPlayer1.SetMasterVolume vol
    End If
End If
MyVol = True
End Function
Function MyHelp(basestack As basetask, rest$, lang As Long) As Boolean
Dim s$
abt = False
If Abs(IsLabel(basestack, rest$, s$)) > 0 Then
    vH_title$ = ""
    fHelp basestack, s$, AscW(s$ + Mid$(" Σ", Abs(pagio$ = "GREEK") + 1)) < 128
ElseIf Not ISSTRINGA(rest$, s$) Then
    nhelp basestack, lang <> 1
Else
    fHelp basestack, s$, lang = 1
End If
MyHelp = True
End Function
Function MyClipboard(basestack As basetask, rest$) As Boolean
Dim s$, photo As cDIBSection
    If IsStrExp(basestack, rest$, s$) Then
        If (Left$(s$, 4) = "cDIB" And Len(s$) > 12) Then         ' MAGIC LETTERS cDIB choose the bitmap
            Set photo = New cDIBSection
            If Not cDib(s$, photo) Then  ' copy from string to cDIBSection
                Set photo = Nothing
                MissCdibStr
                Exit Function
            Else
                photo.GetDpi 96, 96
                photo.CopyToClipboard
                Set photo = Nothing
            End If
        Else
        Clipboard.Clear
              ' Clipboard.SetText s$, vbCFText  ' set as ansi text
           ' SetTextDataLong 16, GetLCIDFromKeyboard  '' this simulate the fault in VB6
           SetTextData CF_UNICODETEXT, s$   'set as unicode text
        End If
    End If
    MyClipboard = True
End Function
Function MyDelay(basestack As basetask, rest$) As Boolean
Dim p As Double
If IsExp(basestack, rest$, p) Then
mywait basestack, p
Else
mywait basestack, 0
End If
MyDelay = True

End Function
Private Function MyMod(r1 As Double, po) As Double
MyMod = Sgn(r1) * (Int(Abs(r1)) - Int(Int(Abs(r1) / Abs(Int(po))) * Abs(Int(po))))
End Function
Private Function AddInventory(bstack As basetask, rest$) As Boolean
Dim p As Double, s$, pppp As mArray
If Not bstack.lastobj Is Nothing Then
If Typename(bstack.lastobj) = "mHandler" Then
Dim aa As mHandler
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
If Not aa.objref Is Nothing Then
If TypeOf aa.objref Is FastCollection Then
Dim bb As FastCollection
Set bb = aa.objref
If bb.StructLen > 0 Then
MyEr "Structure members are ReadOnly", "Τα μέλη της δομής είναι μόνο για ανάγνωση"
Exit Function
End If

Dim ah As String
FastSymbol rest$, ","
again:
AddInventory = True
ah = aheadstatus(rest$, False) + " "
If InStr(ah, "l") Then
MyEr "No logical expression", "Όχι λογική έκφραση"
AddInventory = False
Else
If Left$(ah, 1) = "N" Then
    If Not IsExp(bstack, rest$, p) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
        AddInventory = False
        GoTo there
    End If
    If bb.ExistKey(p) Then
        MyEr "Key exist, must be unique", "Το κλειδί υπάρχει, πρέπει να είναι μοναδικό"
        AddInventory = False
        GoTo there
    End If
    bb.AddKey p
ElseIf Left$(ah, 1) = "S" Then
    If Not IsStrExp(bstack, rest$, s$) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
        AddInventory = False
        GoTo there
    End If
    If bb.ExistKey(s$) Then
        MyEr "Key exist, must be unique", "Το κλειδί υπάρχει, πρέπει να είναι μοναδικό"
        AddInventory = False
        GoTo there
    End If
    bb.AddKey s$

Else
        MyEr "No Key found", "Δεν βρέθηκε κλειδί"
        AddInventory = False
        GoTo there

End If
If FastSymbol(rest$, ":=", , 2) Then
ah = aheadstatus(rest$, False) + " "
If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
    If Not IsExp(bstack, rest$, p) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
        Set pppp = New mArray
        bstack.lastobj.CopyArray pppp
        Set bb.ValueObj = pppp
        Set pppp = Nothing
        
    Else
    If Typename(bstack.lastobj) = "mHandler" Then
    If Not GarbageCollector.ExistKey(objptr(bstack.lastobj)) Then
    GarbageCollector.AddKey objptr(bstack.lastobj), bstack.lastobj
    End If
    End If
    
    
    
    
        Set bb.ValueObj = bstack.lastobj
    End If
        Set bstack.lastobj = Nothing
    Else
        bb.Value = CDbl(p)
    End If
    
ElseIf Left$(ah, 1) = "S" Then
    If Not IsStrExp(bstack, rest$, s$) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
        Set pppp = New mArray
        bstack.lastobj.CopyArray pppp
        Set bb.ValueObj = pppp
        Set pppp = Nothing
    Else
    
        Set bb.ValueObj = bstack.lastobj
    End If
        Set bstack.lastobj = Nothing
    Else
        bb.Value = s$
    End If

Else
        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
        AddInventory = False
        GoTo there

End If


End If


End If
If FastSymbol(rest$, ",") Then GoTo again
there:
Set bb = Nothing
Set aa = Nothing

Exit Function
End If
End If
MyEr "Wrong type of object (not Inventory)", "Λάθος τύπος αντικειμένου (όχι Κατάσταση)"
Set aa = Nothing
End If
End If
Set bstack.lastobj = Nothing
End Function
Function Appfields(basestack As basetask, rest$) As Boolean
Dim s$, p As Double

If IsExp(basestack, rest$, p) Then
Appfields = AddInventory(basestack, rest$)
ElseIf IsStrExp(basestack, rest$, s$) Then
Appfields = True
append_table basestack, s$, rest$, False
Else
SyntaxError
Appfields = False
End If
Exit Function
End Function
Function rValue(bstack As basetask, ob As Object) As Double
Dim v$
 v$ = Typename(ob)
    If v$ Like "Gui*" Then
        Set bstack.lastobj = ob
        rValue = 0
    ElseIf v$ Like "Pro*" Then
   If IsObject(ob.Value) Then
       Set bstack.lastobj = ob.Value
        rValue = 0
   Else
        rValue = ob
        End If
    ElseIf v$ Like "Gr*" Then
        rValue = 0
        Set bstack.lastobj = ob
       
    ElseIf v$ Like "mE*" Then
        CopyEvent ob, bstack
        rValue = 0
    ElseIf v$ = "lambda" Then
    
    CopyLambda ob, bstack
    rValue = 0
    ElseIf v$ = "mHandler" Then
    
    CopyHandler ob, bstack
    rValue = 0
    ElseIf v$ = "mArray" Then
    Set bstack.lastobj = CopyArray(ob)
    rValue = 0
    Else
    Set bstack.lastobj = Nothing
    rValue = 0
    End If
    
End Function
Sub refreshGui()
   Dim x As Form
                    For Each x In Forms
             
                    If Typename$(x) = "GuiM2000" Then
                    If x.enabled Then x.Refresh
                    End If
                    Next
                    Set x = Nothing
End Sub
Function ExecCode(basestack As basetask, rest$) As Boolean ' experimental
' ver .001
Dim p As Double, mm As MemBlock, w2 As Long
    If IsExp(basestack, rest$, p) Then
        If Not basestack.lastobj Is Nothing Then
          If Not TypeOf basestack.lastobj Is mHandler Then
            Set basestack.lastobj = Nothing
            Exit Function
            End If
            With basestack.lastobj
                  If Not TypeOf .objref Is MemBlock Then
                      Set basestack.lastobj = Nothing
                      Exit Function
                  ElseIf .objref.NoRun Then
                       Set basestack.lastobj = Nothing
                       Exit Function
                  End If
            End With
            Set mm = basestack.lastobj.objref
            If mm.Status = 0 Then
            w2 = mm.GetPtr(0)
            If FastSymbol(rest$, ",") Then
            If Not IsExp(basestack, rest$, p) Then
                Set basestack.lastobj = Nothing
                Set mm = Nothing
                MissPar
                Exit Function
            End If
            If p < 0 Or p >= mm.SizeByte Then
                Set basestack.lastobj = Nothing
                Set mm = Nothing
                MyEr "Offset out of buffer", "Διεύθυνση εκτός διάρθρωσης"
                Exit Function
            End If
            w2 = cUlng(uintnew(w2) + p)
            End If
            Set basestack.lastobj = Nothing
            
            CallWindowProc w2, 0&, 0&, 0&, 0&

            ExecCode = True
            Set mm = Nothing
            End If
            End If
        
    End If
End Function
Sub MouseShow(yes As Boolean)
Dim k As Long, b1 As Boolean
If yes Then
k = ShowCursor(True)
k1 = k = -1
If k < 0 Then
k = ShowCursor(True)
Do While k < 0
If k = -1 And k1 Then Exit Sub ' no mouse found
k = ShowCursor(True)
Loop
End If
Else

k = ShowCursor(False)
Do While k >= 0
k = ShowCursor(False)
Loop
End If
End Sub

Function GetAnewEvent() As Variant

Dim aa As New ComShinkEvent, bb As New mHandler
'Set aa.Callback = Form1
Set bb.objref = aa
 bb.T1 = 3
Set GetAnewEvent = bb
End Function
Public Function CallEventFromCOM(evCom As ComShinkEvent, aString$, what$, NumVar As Long, vrs()) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
Dim f$, F1$, klm As Long
'olescok = escok
'escok = False
CallEventFromCOM = True
F1$ = evCom.ModuleName$
aString$ = UCase(aString$)
f$ = UCase(F1$ + "_" + aString$ + "()") ' No greek
'Debug.Print f$
If Not subHash.Find(f$, klm) Then Exit Function
extr = extreme
extreme = True
tr = trace
trace = False
Dim n$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
bstack.IamAnEvent = True
Dim i As Long
i = evCom.VarIndex
F1$ = evCom.ModuleName$
Set oldbstack = bstack.soros
Dim j As Long, k As Long, s1$, s2$
Dim ohere$
ohere$ = here$
'For j = 0 To a.Count - 1
' GO GLOBAL
here$ = "" ' "EV" + CStr(i)

If evCom.Attached Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            PushStage bstack, False
            
            For k = 1 To NumVar
            Select Case VarType(vrs(k))
            Case vbString
            GlobalVar "EV" + CStr(i + k) + "$", vrs(k)
            bb.DataStr "EV" + CStr(i + k) + "$"
            Case Is >= vbArray
            ' make it normal
            GlobalVar "EV" + CStr(i + k) + "(", RetM2000array(vrs(k))
            bb.DataStr "EV" + CStr(i + k)
            Case Else
            GlobalVar "EV" + CStr(i + k), vrs(k)
            bb.DataStr "EV" + CStr(i + k)
            End Select
            
            
            Next k
            '''bb.DataObj evCom
            '' last is the second name, the class name??
            bb.DataStr what$
            'f$ = aString$
            
           '' WE ARE GOING TO OUR MODULE
            here$ = evCom.modulenameonly
            If FastCallModule(bstack, klm) <> 1 Then
            
            
            
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
                  here$ = ""
                  If NumVar > 0 Then
       For k = LBound(vrs()) To UBound(vrs()) - 1
       Select Case VarType(vrs(k))
       Case vbString
            GetlocalVar "EV" + CStr(i + k) + "$", j
            vrs(k) = var(j)
       Case Is >= vbArray
            GetlocalVar "EV" + CStr(i + k) + "(", j
            RetComArray var(j), vrs(k)
       
        Case Else
            GetlocalVar "EV" + CStr(i + k), j
             vrs(k) = var(j)
            End Select
           
            Next k
            End If
            PopStage bstack

            bb.Flush

End If

conthere:

Set bstack.Sorosref = oldbstack
here$ = ohere$
conthere0:
Set oldbstack = Nothing
Set bb = Nothing

extreme = extr
trace = tr

'escok = olescok
End Function
Sub RetComArray(varFrom As Variant, varTo As Variant)
Dim ar As mArray, v()
Set ar = varFrom
ar.CopyBackSerialize v()
varTo = v()
End Sub
Function RetM2000array(var As Variant) As Variant
Dim ar As New mArray, v(), manydim As Long, probe As Long, probelow As Long
Dim j As Long
v() = var
On Error GoTo ma100
For j = 1 To 60
    probe = UBound(v, j)
    If Err Then Exit For
Next j
manydim = j - 1
On Error Resume Next
For j = manydim To 1 Step -1
    
    probe = UBound(v, j)
    If Err Then Exit For
    probelow = LBound(v, j)
    ar.PushDim probe - probelow + 1
Next j
ar.PushEnd
ar.RevOrder = True
ar.CopySerialize v()
ma100:
Set RetM2000array = ar

End Function
Function FastCallModule(bstack As basetask, mod_id As Long) As Long
Dim i As Long, frm$
 'i = preProcessor(bstack, sbf(mod_id).sb)
 If myexit(bstack) Then FastCallModule = 0: Exit Function
 frm$ = Mid$(sbf(mod_id).sb, 1)
 FastCallModule = Execute(bstack, frm$, False, False)
 
 
End Function

Function MakeATypeLib(v As Variant, Optional usetypelib As Boolean = False) As FastCollection
    Dim obj             As Object, vv As FastCollection
    ' create the requested object
    
    Set obj = v
    If usetypelib Then
            ' find typelib and load it
    Set MakeATypeLib = New FastCollection
    Else
    Call GetAllMembers(vv, obj)
    Set MakeATypeLib = vv
    Set vv = Nothing
    End If
    Set obj = Nothing
End Function
Public Sub GarbageFlush()
Dim objptr, obj As Object, i As Long
With GarbageCollector
If .count > 0 Then
For i = 0 To .count - 1
.index = i
Set obj = .ValueObj
If TypeOf obj Is FastCollection Then
    obj.GarbageJob
ElseIf TypeOf obj Is mHandler Then
If obj.objref Is Nothing Then

ElseIf TypeOf obj.objref Is FastCollection Then
obj.objref.GarbageJob

End If
End If
Next i
Set obj = .ValueObj
GarbageCollector.GarbageJob
End If
End With

End Sub
Public Sub GarbageFlush2()
Dim objptr, obj As Object, i As Long, Tmp As New GarbageClass
With GarbageCollector
If .count > 0 Then
For i = 0 To .count - 1
.index = i
Set obj = .ValueObj
If TypeOf obj Is FastCollection Then

Tmp.AddKey .KeyLong
    obj.GarbageJob
ElseIf TypeOf obj Is mHandler Then
If obj.objref Is Nothing Then

ElseIf TypeOf obj.objref Is FastCollection Then
Tmp.AddKey .KeyLong
obj.objref.GarbageJob

End If
End If
Next i
End If
End With
Set obj = Nothing
If Tmp.count > 0 Then
With Tmp
For i = 0 To .count - 1
.index = i
If GarbageCollector.Find(Tmp.KeyLong) Then
    If GarbageCollector.ReferCountValue = 1 Then
        GarbageCollector.RemoveWithNoFind
    End If
End If

Next i
End With
End If


End Sub

